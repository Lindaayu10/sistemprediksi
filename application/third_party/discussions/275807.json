[
  {
    "Id": "683926",
    "ThreadId": "275807",
    "Html": "<p>I saw some topics in the forums from folks wanting to create Excel files from HTML tables that they've already generated.</p>\n<p>I offer this code as a way of doing that.&nbsp; I use it exclusively on my site and it works well.&nbsp; I have the advantage of pretty much using</p>\n<p>the same HTML to generate tables, so my HTML table inputs are predictable to a degree.&nbsp; Anyway, hope someone finds this useful</p>\n<p>or as a starting point for morphing into a HTML reader class.</p>\n<div style=\"color: black; background-color: white;\">\n<pre>&lt;?php\r\nsession_start();\r\nini_set(<span style=\"color: #a31515;\">\"memory_limit\"</span>, <span style=\"color: #a31515;\">\"-1\"</span>);\r\nini_set(<span style=\"color: #a31515;\">\"set_time_limit\"</span>, <span style=\"color: #a31515;\">\"0\"</span>);\r\nset_time_limit(0);\r\n<span style=\"color: blue;\">if</span> (<span style=\"color: blue;\">isset</span>($_SESSION[<span style=\"color: #a31515;\">'zprofile'</span>])) {\r\n  $username = $_SESSION[<span style=\"color: #a31515;\">'zprofile'</span>][<span style=\"color: #a31515;\">'username'</span>];            <span style=\"color: green;\">// user's name</span>\r\n  $usermail = $_SESSION[<span style=\"color: #a31515;\">'zprofile'</span>][<span style=\"color: #a31515;\">'useremail'</span>];         <span style=\"color: green;\">// user's emailid</span>\r\n  $usercompany = $_SESSION[<span style=\"color: #a31515;\">'zprofile'</span>][<span style=\"color: #a31515;\">'usercompany'</span>];    <span style=\"color: green;\">// user's company</span>\r\n}<span style=\"color: blue;\">else</span>{\r\n  header(<span style=\"color: #a31515;\">'Location: index.php?e=0'</span>);\r\n}\r\n<span style=\"color: blue;\">if</span>(!<span style=\"color: blue;\">isset</span>($_GET[<span style=\"color: #a31515;\">'var'</span>])) {\r\n  <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"&lt;br /&gt;No Table Variable Present, nothing to Export.\"</span>;\r\n  <span style=\"color: blue;\">exit</span>;\r\n}<span style=\"color: blue;\">else</span>{\r\n  $tablevar = $_GET[<span style=\"color: #a31515;\">'var'</span>];\r\n}\r\n<span style=\"color: blue;\">if</span>(!<span style=\"color: blue;\">isset</span>($_GET[<span style=\"color: #a31515;\">'limit'</span>])) {\r\n  $limit = 12;\r\n}<span style=\"color: blue;\">else</span>{\r\n  $limit = $_GET[<span style=\"color: #a31515;\">'limit'</span>];\r\n}\r\n<span style=\"color: blue;\">if</span>(!<span style=\"color: blue;\">isset</span>($_GET[<span style=\"color: #a31515;\">'debug'</span>])) {\r\n  $debug = false;\r\n}<span style=\"color: blue;\">else</span>{\r\n  $debug = true;\r\n  $handle = fopen(<span style=\"color: #a31515;\">\"Auditlog/exportlog.txt\"</span>, <span style=\"color: #a31515;\">\"w\"</span>);\r\n  fwrite($handle, <span style=\"color: #a31515;\">\"\\nDebugging On...\"</span>);\r\n}\r\n<span style=\"color: blue;\">if</span>(!<span style=\"color: blue;\">isset</span>($_SESSION[$tablevar]) OR $_SESSION[$tablevar] == <span style=\"color: #a31515;\">''</span>) {\r\n  <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"&lt;br /&gt;Empty HTML Table, nothing to Export.\"</span>;\r\n  <span style=\"color: blue;\">exit</span>;\r\n}<span style=\"color: blue;\">else</span>{\r\n  $htmltable = $_SESSION[$tablevar];\r\n}\r\n<span style=\"color: blue;\">if</span>(strlen($htmltable) == strlen(strip_tags($htmltable)) ) {\r\n  <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"&lt;br /&gt;Invalid HTML Table after Stripping Tags, nothing to Export.\"</span>;\r\n  <span style=\"color: blue;\">exit</span>;\r\n}\r\n$htmltable = strip_tags($htmltable, <span style=\"color: #a31515;\">\"&lt;table&gt;&lt;tr&gt;&lt;th&gt;&lt;thead&gt;&lt;tbody&gt;&lt;tfoot&gt;&lt;td&gt;&lt;br&gt;&lt;br /&gt;&lt;b&gt;&lt;span&gt;\"</span>);\r\n$htmltable = str_replace(<span style=\"color: #a31515;\">\"&lt;br /&gt;\"</span>, <span style=\"color: #a31515;\">\"\\n\"</span>, $htmltable);\r\n$htmltable = str_replace(<span style=\"color: #a31515;\">\"&lt;br/&gt;\"</span>, <span style=\"color: #a31515;\">\"\\n\"</span>, $htmltable);\r\n$htmltable = str_replace(<span style=\"color: #a31515;\">\"&lt;br&gt;\"</span>, <span style=\"color: #a31515;\">\"\\n\"</span>, $htmltable);\r\n$htmltable = str_replace(<span style=\"color: #a31515;\">\"&amp;nbsp;\"</span>, <span style=\"color: #a31515;\">\" \"</span>, $htmltable);\r\n$htmltable = str_replace(<span style=\"color: #a31515;\">\"\\n\\n\"</span>, <span style=\"color: #a31515;\">\"\\n\"</span>, $htmltable);\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">//  Extract HTML table contents to array</span>\r\n<span style=\"color: green;\">//</span>\r\n$dom = <span style=\"color: blue;\">new</span> domDocument;\r\n$dom-&gt;loadHTML($htmltable);\r\n<span style=\"color: blue;\">if</span>(!$dom) {\r\n  <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"&lt;br /&gt;Invalid HTML DOM, nothing to Export.\"</span>;\r\n  <span style=\"color: blue;\">exit</span>;\r\n}\r\n$dom-&gt;preserveWhiteSpace = false;             <span style=\"color: green;\">// remove redundant whitespace</span>\r\n$tables = $dom-&gt;getElementsByTagName(<span style=\"color: #a31515;\">'table'</span>);\r\n<span style=\"color: blue;\">if</span>(!is_object($tables)) {\r\n  <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"&lt;br /&gt;Invalid HTML Table DOM, nothing to Export.\"</span>;\r\n  <span style=\"color: blue;\">exit</span>;\r\n}\r\n<span style=\"color: blue;\">if</span>($debug) {\r\n  fwrite($handle, <span style=\"color: #a31515;\">\"\\nTable Count: \"</span>.$tables-&gt;length);\r\n}\r\n$tbcnt = $tables-&gt;length - 1;                 <span style=\"color: green;\">// count minus 1 for 0 indexed loop over tables</span>\r\n<span style=\"color: blue;\">if</span>($tbcnt &gt; $limit) {\r\n  $tbcnt = $limit;\r\n}\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">// Create new PHPExcel object with default attributes</span>\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: blue;\">require_once</span> (<span style=\"color: #a31515;\">'PHPExcel/PHPExcel.php'</span>);\r\n$objPHPExcel = <span style=\"color: blue;\">new</span> PHPExcel();\r\n$objPHPExcel-&gt;getDefaultStyle()-&gt;getFont()-&gt;setName(<span style=\"color: #a31515;\">'Arial'</span>);\r\n$objPHPExcel-&gt;getDefaultStyle()-&gt;getFont()-&gt;setSize(9);\r\n$tm = date(YmdHis);\r\n$pos = strpos($usermail, <span style=\"color: #a31515;\">\"@\"</span>);\r\n$user = substr($usermail, 0, $pos);\r\n$user = str_replace(<span style=\"color: #a31515;\">\".\"</span>,<span style=\"color: #a31515;\">\"\"</span>,$user);\r\n$tfn = $user.<span style=\"color: #a31515;\">\"_\"</span>.$tm.<span style=\"color: #a31515;\">\"_\"</span>.$tablevar.<span style=\"color: #a31515;\">\".xlsx\"</span>;\r\n<span style=\"color: green;\">//$fname = \"AuditLog/\".$tfn;</span>\r\n$fname = $tfn;\r\n$objPHPExcel-&gt;getProperties()-&gt;setCreator($username)\r\n\t\t\t\t\t\t\t -&gt;setLastModifiedBy($username)\r\n\t\t\t\t\t\t\t -&gt;setTitle(<span style=\"color: #a31515;\">\"Automated Export\"</span>)\r\n\t\t\t\t\t\t\t -&gt;setSubject(<span style=\"color: #a31515;\">\"Automated Report Generation\"</span>)\r\n\t\t\t\t\t\t\t -&gt;setDescription(<span style=\"color: #a31515;\">\"Automated report generation.\"</span>)\r\n\t\t\t\t\t\t\t -&gt;setKeywords(<span style=\"color: #a31515;\">\"Exported File\"</span>)\r\n               -&gt;setCompany($usercompany)\r\n\t\t\t\t\t\t\t -&gt;setCategory(<span style=\"color: #a31515;\">\"Export\"</span>);\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">// Loop over tables in DOM to create an array, each table becomes a worksheet</span>\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: blue;\">for</span>($z=0;$z&lt;=$tbcnt;$z++) {\r\n  $maxcols = 0;\r\n  $totrows = 0;\r\n  $headrows = <span style=\"color: blue;\">array</span>();\r\n  $bodyrows = <span style=\"color: blue;\">array</span>();\r\n  $r = 0;\r\n  $h = 0;\r\n  $rows = $tables-&gt;item($z)-&gt;getElementsByTagName(<span style=\"color: #a31515;\">'tr'</span>);\r\n  $totrows = $rows-&gt;length;\r\n  <span style=\"color: blue;\">if</span>($debug) {\r\n    fwrite($handle, <span style=\"color: #a31515;\">\"\\nTotal Rows: \"</span>.$totrows);\r\n  }\r\n  <span style=\"color: blue;\">foreach</span> ($rows <span style=\"color: blue;\">as</span> $row) {\r\n      $ths = $row-&gt;getElementsByTagName(<span style=\"color: #a31515;\">'th'</span>);\r\n      <span style=\"color: blue;\">if</span>(is_object($ths)) {\r\n        <span style=\"color: blue;\">if</span>($ths-&gt;length &gt; 0) {\r\n          $headrows[$h][<span style=\"color: #a31515;\">'colcnt'</span>] = $ths-&gt;length;\r\n          <span style=\"color: blue;\">if</span>($ths-&gt;length &gt; $maxcols) {\r\n            $maxcols = $ths-&gt;length;\r\n          }\r\n          $nodes = $ths-&gt;length - 1;\r\n          <span style=\"color: blue;\">for</span>($x=0;$x&lt;=$nodes;$x++) {\r\n            $thishdg = $ths-&gt;item($x)-&gt;nodeValue;\r\n            $headrows[$h][<span style=\"color: #a31515;\">'th'</span>][] = $thishdg;\r\n            $headrows[$h][<span style=\"color: #a31515;\">'bold'</span>][] = findBoldText(innerHTML($ths-&gt;item($x)));\r\n            <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'style'</span>)) {\r\n              $style = $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'style'</span>);\r\n              $stylecolor = findStyleColor($style);\r\n              <span style=\"color: blue;\">if</span>($stylecolor == <span style=\"color: #a31515;\">''</span>) {\r\n                $headrows[$h][<span style=\"color: #a31515;\">'color'</span>][] = findSpanColor(innerHTML($ths-&gt;item($x)));\r\n              }<span style=\"color: blue;\">else</span>{\r\n                $headrows[$h][<span style=\"color: #a31515;\">'color'</span>][] = $stylecolor;\r\n              }\r\n            }<span style=\"color: blue;\">else</span>{\r\n              $headrows[$h][<span style=\"color: #a31515;\">'color'</span>][] = findSpanColor(innerHTML($ths-&gt;item($x)));\r\n            }\r\n            <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'colspan'</span>)) {\r\n              $headrows[$h][<span style=\"color: #a31515;\">'colspan'</span>][] = $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'colspan'</span>);\r\n            }<span style=\"color: blue;\">else</span>{\r\n              $headrows[$h][<span style=\"color: #a31515;\">'colspan'</span>][] = 1;\r\n            }\r\n            <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'align'</span>)) {\r\n              $headrows[$h][<span style=\"color: #a31515;\">'align'</span>][] = $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'align'</span>);\r\n            }<span style=\"color: blue;\">else</span>{\r\n              $headrows[$h][<span style=\"color: #a31515;\">'align'</span>][] = <span style=\"color: #a31515;\">'left'</span>;\r\n            }\r\n            <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'valign'</span>)) {\r\n              $headrows[$h][<span style=\"color: #a31515;\">'valign'</span>][] = $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'valign'</span>);\r\n            }<span style=\"color: blue;\">else</span>{\r\n              $headrows[$h][<span style=\"color: #a31515;\">'valign'</span>][] = <span style=\"color: #a31515;\">'top'</span>;\r\n            }\r\n            <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'bgcolor'</span>)) {\r\n              $headrows[$h][<span style=\"color: #a31515;\">'bgcolor'</span>][] = str_replace(<span style=\"color: #a31515;\">\"#\"</span>, <span style=\"color: #a31515;\">\"\"</span>, $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'bgcolor'</span>));\r\n            }<span style=\"color: blue;\">else</span>{\r\n              $headrows[$h][<span style=\"color: #a31515;\">'bgcolor'</span>][] = <span style=\"color: #a31515;\">'FFFFFF'</span>;\r\n            }\r\n          }\r\n          $h++;\r\n        }\r\n      }\r\n  }\r\n  <span style=\"color: blue;\">foreach</span> ($rows <span style=\"color: blue;\">as</span> $row) {\r\n      $tds = $row-&gt;getElementsByTagName(<span style=\"color: #a31515;\">'td'</span>);\r\n      <span style=\"color: blue;\">if</span>(is_object($tds)) {\r\n        <span style=\"color: blue;\">if</span>($tds-&gt;length &gt; 0) {\r\n          $bodyrows[$r][<span style=\"color: #a31515;\">'colcnt'</span>] = $tds-&gt;length;\r\n          <span style=\"color: blue;\">if</span>($tds-&gt;length &gt; $maxcols) {\r\n            $maxcols = $tds-&gt;length;\r\n          }\r\n          $nodes = $tds-&gt;length - 1;\r\n          <span style=\"color: blue;\">for</span>($x=0;$x&lt;=$nodes;$x++) {\r\n            $thistxt = $tds-&gt;item($x)-&gt;nodeValue;\r\n            $bodyrows[$r][<span style=\"color: #a31515;\">'td'</span>][] = $thistxt;\r\n            $bodyrows[$r][<span style=\"color: #a31515;\">'bold'</span>][] = findBoldText(innerHTML($tds-&gt;item($x)));\r\n            <span style=\"color: blue;\">if</span>($tds-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'style'</span>)) {\r\n              $style = $tds-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'style'</span>);\r\n              $stylecolor = findStyleColor($style);\r\n              <span style=\"color: blue;\">if</span>($stylecolor == <span style=\"color: #a31515;\">''</span>) {\r\n                $bodyrows[$r][<span style=\"color: #a31515;\">'color'</span>][] = findSpanColor(innerHTML($tds-&gt;item($x)));\r\n              }<span style=\"color: blue;\">else</span>{\r\n                $bodyrows[$r][<span style=\"color: #a31515;\">'color'</span>][] = $stylecolor;\r\n              }\r\n            }<span style=\"color: blue;\">else</span>{\r\n              $bodyrows[$r][<span style=\"color: #a31515;\">'color'</span>][] = findSpanColor(innerHTML($tds-&gt;item($x)));\r\n            }\r\n            <span style=\"color: blue;\">if</span>($tds-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'colspan'</span>)) {\r\n              $bodyrows[$r][<span style=\"color: #a31515;\">'colspan'</span>][] = $tds-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'colspan'</span>);\r\n            }<span style=\"color: blue;\">else</span>{\r\n              $bodyrows[$r][<span style=\"color: #a31515;\">'colspan'</span>][] = 1;\r\n            }\r\n            <span style=\"color: blue;\">if</span>($tds-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'align'</span>)) {\r\n              $bodyrows[$r][<span style=\"color: #a31515;\">'align'</span>][] = $tds-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'align'</span>);\r\n            }<span style=\"color: blue;\">else</span>{\r\n              $bodyrows[$r][<span style=\"color: #a31515;\">'align'</span>][] = <span style=\"color: #a31515;\">'left'</span>;\r\n            }\r\n            <span style=\"color: blue;\">if</span>($tds-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'valign'</span>)) {\r\n              $bodyrows[$r][<span style=\"color: #a31515;\">'valign'</span>][] = $tds-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'valign'</span>);\r\n            }<span style=\"color: blue;\">else</span>{\r\n              $bodyrows[$r][<span style=\"color: #a31515;\">'valign'</span>][] = <span style=\"color: #a31515;\">'top'</span>;\r\n            }\r\n            <span style=\"color: blue;\">if</span>($tds-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'bgcolor'</span>)) {\r\n              $bodyrows[$r][<span style=\"color: #a31515;\">'bgcolor'</span>][] = str_replace(<span style=\"color: #a31515;\">\"#\"</span>, <span style=\"color: #a31515;\">\"\"</span>, $tds-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'bgcolor'</span>));\r\n            }<span style=\"color: blue;\">else</span>{\r\n              $bodyrows[$r][<span style=\"color: #a31515;\">'bgcolor'</span>][] = <span style=\"color: #a31515;\">'FFFFFF'</span>;\r\n            }\r\n          }\r\n          $r++;\r\n        }\r\n      }\r\n  }\r\n  <span style=\"color: blue;\">if</span>($z &gt; 0) {\r\n    $objPHPExcel-&gt;createSheet($z);\r\n  }\r\n  $suf = $z + 1;\r\n  $tableid = $tablevar.$suf;\r\n  $wksheetname = ucfirst($tableid);\r\n  $objPHPExcel-&gt;setActiveSheetIndex($z);                      <span style=\"color: green;\">// each sheet corresponds to a table in html</span>\r\n  $objPHPExcel-&gt;getActiveSheet()-&gt;setTitle($wksheetname);     <span style=\"color: green;\">// tab name</span>\r\n  $worksheet = $objPHPExcel-&gt;getActiveSheet();                <span style=\"color: green;\">// set worksheet we're working on</span>\r\n  $style_overlay = <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'font'</span> =&gt;\r\n                    <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'color'</span> =&gt;\r\n                      <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'rgb'</span> =&gt; <span style=\"color: #a31515;\">'000000'</span>),<span style=\"color: #a31515;\">'bold'</span> =&gt; false,),\r\n                          <span style=\"color: #a31515;\">'fill'</span> \t=&gt;\r\n                              <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'type'</span> =&gt; PHPExcel_Style_Fill::FILL_SOLID, <span style=\"color: #a31515;\">'color'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'rgb'</span> =&gt; <span style=\"color: #a31515;\">'CCCCFF'</span>)),\r\n                          <span style=\"color: #a31515;\">'alignment'</span> =&gt;\r\n                              <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'wrap'</span> =&gt; true, <span style=\"color: #a31515;\">'horizontal'</span> =&gt; PHPExcel_Style_Alignment::HORIZONTAL_CENTER,\r\n                                         <span style=\"color: #a31515;\">'vertical'</span> =&gt; PHPExcel_Style_Alignment::VERTICAL_TOP),\r\n                          <span style=\"color: #a31515;\">'borders'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'top'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),\r\n                                             <span style=\"color: #a31515;\">'bottom'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),\r\n                                             <span style=\"color: #a31515;\">'left'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),\r\n                                             <span style=\"color: #a31515;\">'right'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN)),\r\n                       );\r\n  $xcol = <span style=\"color: #a31515;\">''</span>;\r\n  $xrow = 1;\r\n  $usedhdrows = 0;\r\n  $heightvars = <span style=\"color: blue;\">array</span>(1=&gt;<span style=\"color: #a31515;\">'42'</span>, 2=&gt;<span style=\"color: #a31515;\">'42'</span>, 3=&gt;<span style=\"color: #a31515;\">'48'</span>, 4=&gt;<span style=\"color: #a31515;\">'52'</span>, 5=&gt;<span style=\"color: #a31515;\">'58'</span>, 6=&gt;<span style=\"color: #a31515;\">'64'</span>, 7=&gt;<span style=\"color: #a31515;\">'68'</span>, 8=&gt;<span style=\"color: #a31515;\">'76'</span>, 9=&gt;<span style=\"color: #a31515;\">'82'</span>);\r\n  <span style=\"color: blue;\">for</span>($h=0;$h&lt;count($headrows);$h++) {\r\n    $th = $headrows[$h][<span style=\"color: #a31515;\">'th'</span>];\r\n    $colspans = $headrows[$h][<span style=\"color: #a31515;\">'colspan'</span>];\r\n    $aligns = $headrows[$h][<span style=\"color: #a31515;\">'align'</span>];\r\n    $valigns = $headrows[$h][<span style=\"color: #a31515;\">'valign'</span>];\r\n    $bgcolors = $headrows[$h][<span style=\"color: #a31515;\">'bgcolor'</span>];\r\n    $colcnt = $headrows[$h][<span style=\"color: #a31515;\">'colcnt'</span>];\r\n    $colors = $headrows[$h][<span style=\"color: #a31515;\">'color'</span>];\r\n    $bolds = $headrows[$h][<span style=\"color: #a31515;\">'bold'</span>];\r\n    $usedhdrows++;\r\n    $mergedcells = false;\r\n    <span style=\"color: blue;\">for</span>($t=0;$t&lt;count($th);$t++) {\r\n      <span style=\"color: blue;\">if</span>($xcol == <span style=\"color: #a31515;\">''</span>) {$xcol = <span style=\"color: #a31515;\">'A'</span>;}<span style=\"color: blue;\">else</span>{$xcol++;}\r\n      $thishdg = $th[$t];\r\n      $thisalign = $aligns[$t];\r\n      $thisvalign = $valigns[$t];\r\n      $thiscolspan = $colspans[$t];\r\n      $thiscolor = $colors[$t];\r\n      $thisbg = $bgcolors[$t];\r\n      $thisbold = $bolds[$t];\r\n      $strbold = ($thisbold==true) ? <span style=\"color: #a31515;\">'true'</span> : <span style=\"color: #a31515;\">'false'</span>;\r\n      <span style=\"color: blue;\">if</span>($thisbg == <span style=\"color: #a31515;\">'FFFFFF'</span>) {\r\n        $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'type'</span>] = PHPExcel_Style_Fill::FILL_NONE;\r\n      }<span style=\"color: blue;\">else</span>{\r\n        $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'type'</span>] = PHPExcel_Style_Fill::FILL_SOLID;\r\n      }\r\n      $style_overlay[<span style=\"color: #a31515;\">'alignment'</span>][<span style=\"color: #a31515;\">'vertical'</span>] = $thisvalign;              <span style=\"color: green;\">// set styles for cell</span>\r\n      $style_overlay[<span style=\"color: #a31515;\">'alignment'</span>][<span style=\"color: #a31515;\">'horizontal'</span>] = $thisalign;\r\n      $style_overlay[<span style=\"color: #a31515;\">'font'</span>][<span style=\"color: #a31515;\">'color'</span>][<span style=\"color: #a31515;\">'rgb'</span>] = $thiscolor;\r\n      $style_overlay[<span style=\"color: #a31515;\">'font'</span>][<span style=\"color: #a31515;\">'bold'</span>] = $thisbold;\r\n      $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'color'</span>][<span style=\"color: #a31515;\">'rgb'</span>] = $thisbg;\r\n      $worksheet-&gt;setCellValue($xcol.$xrow, $thishdg);\r\n      $worksheet-&gt;getStyle($xcol.$xrow)-&gt;applyFromArray($style_overlay);\r\n      <span style=\"color: blue;\">if</span>($debug) {\r\n        fwrite($handle, <span style=\"color: #a31515;\">\"\\n\"</span>.$xcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow.<span style=\"color: #a31515;\">\" ColSpan:\"</span>.$thiscolspan.<span style=\"color: #a31515;\">\" Color:\"</span>.$thiscolor.<span style=\"color: #a31515;\">\" Align:\"</span>.$thisalign.<span style=\"color: #a31515;\">\" VAlign:\"</span>.$thisvalign.<span style=\"color: #a31515;\">\" BGColor:\"</span>.$thisbg.<span style=\"color: #a31515;\">\" Bold:\"</span>.$strbold.<span style=\"color: #a31515;\">\" cellValue: \"</span>.$thishdg);\r\n      }\r\n      <span style=\"color: blue;\">if</span>($thiscolspan &gt; 1) {                                                <span style=\"color: green;\">// spans more than 1 column</span>\r\n        $mergedcells = true;\r\n        $lastxcol = $xcol;\r\n        <span style=\"color: blue;\">for</span>($j=1;$j&lt;$thiscolspan;$j++) {\r\n          $lastxcol++;\r\n          $worksheet-&gt;setCellValue($lastxcol.$xrow, <span style=\"color: #a31515;\">''</span>);\r\n          $worksheet-&gt;getStyle($lastxcol.$xrow)-&gt;applyFromArray($style_overlay);\r\n        }\r\n        $cellRange = $xcol.$xrow.<span style=\"color: #a31515;\">':'</span>.$lastxcol.$xrow;\r\n        <span style=\"color: blue;\">if</span>($debug) {\r\n          fwrite($handle, <span style=\"color: #a31515;\">\"\\nmergeCells: \"</span>.$xcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow.<span style=\"color: #a31515;\">\" \"</span>.$lastxcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow);\r\n        }\r\n        $worksheet-&gt;mergeCells($cellRange);\r\n        $worksheet-&gt;getStyle($cellRange)-&gt;applyFromArray($style_overlay);\r\n        $num_newlines = substr_count($thishdg, <span style=\"color: #a31515;\">\"\\n\"</span>);                       <span style=\"color: green;\">// count number of newline chars</span>\r\n        <span style=\"color: blue;\">if</span>($num_newlines &gt; 1) {\r\n          $rowheight = $heightvars[1];                                      <span style=\"color: green;\">// default to 35</span>\r\n          <span style=\"color: blue;\">if</span>(array_key_exists($num_newlines, $heightvars)) {\r\n            $rowheight = $heightvars[$num_newlines];\r\n          }<span style=\"color: blue;\">else</span>{\r\n            $rowheight = 75;\r\n          }\r\n          $worksheet-&gt;getRowDimension($xrow)-&gt;setRowHeight($rowheight);     <span style=\"color: green;\">// adjust heading row height</span>\r\n        }\r\n        $xcol = $lastxcol;\r\n      }\r\n    }\r\n    $xrow++;\r\n    $xcol = <span style=\"color: #a31515;\">''</span>;\r\n  }\r\n  <span style=\"color: green;\">//Put an auto filter on last row of heading only if last row was not merged</span>\r\n  <span style=\"color: blue;\">if</span>(!$mergedcells) {\r\n    $worksheet-&gt;setAutoFilter(<span style=\"color: #a31515;\">\"A$usedhdrows:\"</span> . $worksheet-&gt;getHighestColumn() . $worksheet-&gt;getHighestRow() );\r\n  }\r\n  <span style=\"color: blue;\">if</span>($debug) {\r\n    fwrite($handle, <span style=\"color: #a31515;\">\"\\nautoFilter: A\"</span>.$usedhdrows.<span style=\"color: #a31515;\">\":\"</span>.$worksheet-&gt;getHighestColumn().$worksheet-&gt;getHighestRow());\r\n  }\r\n  <span style=\"color: green;\">// Freeze heading lines starting after heading lines</span>\r\n  $usedhdrows++;\r\n  $worksheet-&gt;freezePane(<span style=\"color: #a31515;\">\"A$usedhdrows\"</span>);\r\n  <span style=\"color: blue;\">if</span>($debug) {\r\n    fwrite($handle, <span style=\"color: #a31515;\">\"\\nfreezePane: A\"</span>.$usedhdrows);\r\n  }\r\n  <span style=\"color: green;\">//</span>\r\n  <span style=\"color: green;\">// Loop thru data rows and write them out</span>\r\n  <span style=\"color: green;\">//</span>\r\n  $xcol = <span style=\"color: #a31515;\">''</span>;\r\n  $xrow = $usedhdrows;\r\n  <span style=\"color: blue;\">for</span>($b=0;$b&lt;count($bodyrows);$b++) {\r\n    $td = $bodyrows[$b][<span style=\"color: #a31515;\">'td'</span>];\r\n    $colcnt = $bodyrows[$b][<span style=\"color: #a31515;\">'colcnt'</span>];\r\n    $colspans = $bodyrows[$b][<span style=\"color: #a31515;\">'colspan'</span>];\r\n    $aligns = $bodyrows[$b][<span style=\"color: #a31515;\">'align'</span>];\r\n    $valigns = $bodyrows[$b][<span style=\"color: #a31515;\">'valign'</span>];\r\n    $bgcolors = $bodyrows[$b][<span style=\"color: #a31515;\">'bgcolor'</span>];\r\n    $colors = $bodyrows[$b][<span style=\"color: #a31515;\">'color'</span>];\r\n    $bolds = $bodyrows[$b][<span style=\"color: #a31515;\">'bold'</span>];\r\n    <span style=\"color: blue;\">for</span>($t=0;$t&lt;count($td);$t++) {\r\n      <span style=\"color: blue;\">if</span>($xcol == <span style=\"color: #a31515;\">''</span>) {$xcol = <span style=\"color: #a31515;\">'A'</span>;}<span style=\"color: blue;\">else</span>{$xcol++;}\r\n      $thistext = $td[$t];\r\n      $thisalign = $aligns[$t];\r\n      $thisvalign = $valigns[$t];\r\n      $thiscolspan = $colspans[$t];\r\n      $thiscolor = $colors[$t];\r\n      $thisbg = $bgcolors[$t];\r\n      $thisbold = $bolds[$t];\r\n      $strbold = ($thisbold==true) ? <span style=\"color: #a31515;\">'true'</span> : <span style=\"color: #a31515;\">'false'</span>;\r\n      <span style=\"color: blue;\">if</span>($thisbg == <span style=\"color: #a31515;\">'FFFFFF'</span>) {\r\n        $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'type'</span>] = PHPExcel_Style_Fill::FILL_NONE;\r\n      }<span style=\"color: blue;\">else</span>{\r\n        $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'type'</span>] = PHPExcel_Style_Fill::FILL_SOLID;\r\n      }\r\n      $style_overlay[<span style=\"color: #a31515;\">'alignment'</span>][<span style=\"color: #a31515;\">'vertical'</span>] = $thisvalign;              <span style=\"color: green;\">// set styles for cell</span>\r\n      $style_overlay[<span style=\"color: #a31515;\">'alignment'</span>][<span style=\"color: #a31515;\">'horizontal'</span>] = $thisalign;\r\n      $style_overlay[<span style=\"color: #a31515;\">'font'</span>][<span style=\"color: #a31515;\">'color'</span>][<span style=\"color: #a31515;\">'rgb'</span>] = $thiscolor;\r\n      $style_overlay[<span style=\"color: #a31515;\">'font'</span>][<span style=\"color: #a31515;\">'bold'</span>] = $thisbold;\r\n      $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'color'</span>][<span style=\"color: #a31515;\">'rgb'</span>] = $thisbg;\r\n      <span style=\"color: blue;\">if</span>($thiscolspan == 1) {\r\n        $worksheet-&gt;getColumnDimension($xcol)-&gt;setWidth(25);\r\n      }\r\n      $worksheet-&gt;setCellValue($xcol.$xrow, $thistext);\r\n      <span style=\"color: blue;\">if</span>($debug) {\r\n        fwrite($handle, <span style=\"color: #a31515;\">\"\\n\"</span>.$xcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow.<span style=\"color: #a31515;\">\" ColSpan:\"</span>.$thiscolspan.<span style=\"color: #a31515;\">\" Color:\"</span>.$thiscolor.<span style=\"color: #a31515;\">\" Align:\"</span>.$thisalign.<span style=\"color: #a31515;\">\" VAlign:\"</span>.$thisvalign.<span style=\"color: #a31515;\">\" BGColor:\"</span>.$thisbg.<span style=\"color: #a31515;\">\" Bold:\"</span>.$strbold.<span style=\"color: #a31515;\">\" cellValue: \"</span>.$thistext);\r\n      }\r\n      $worksheet-&gt;getStyle($xcol.$xrow)-&gt;applyFromArray($style_overlay);\r\n      <span style=\"color: blue;\">if</span>($thiscolspan &gt; 1) {                                                <span style=\"color: green;\">// spans more than 1 column</span>\r\n        $lastxcol = $xcol;\r\n        <span style=\"color: blue;\">for</span>($j=1;$j&lt;$thiscolspan;$j++) {\r\n          $lastxcol++;\r\n        }\r\n        $cellRange = $xcol.$xrow.<span style=\"color: #a31515;\">':'</span>.$lastxcol.$xrow;\r\n        <span style=\"color: blue;\">if</span>($debug) {\r\n          fwrite($handle, <span style=\"color: #a31515;\">\"\\nmergeCells: \"</span>.$xcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow.<span style=\"color: #a31515;\">\" \"</span>.$lastxcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow);\r\n        }\r\n        $worksheet-&gt;mergeCells($cellRange);\r\n        $worksheet-&gt;getStyle($cellRange)-&gt;applyFromArray($style_overlay);\r\n        $xcol = $lastxcol;\r\n      }\r\n    }\r\n    $xrow++;\r\n    $xcol = <span style=\"color: #a31515;\">''</span>;\r\n  }\r\n  <span style=\"color: green;\">// autosize columns to fit data</span>\r\n  $azcol = <span style=\"color: #a31515;\">'A'</span>;\r\n  <span style=\"color: blue;\">for</span>($x=1;$x==$maxcols;$x++) {\r\n    $worksheet-&gt;getColumnDimension($azcol)-&gt;setAutoSize(true);\r\n    $azcol++;\r\n  }\r\n  <span style=\"color: blue;\">if</span>($debug) {\r\n    fwrite($handle, <span style=\"color: #a31515;\">\"\\nHEADROWS: \"</span>.print_r($headrows, true));\r\n    fwrite($handle, <span style=\"color: #a31515;\">\"\\nBODYROWS: \"</span>.print_r($bodyrows, true));\r\n  }\r\n} <span style=\"color: green;\">// end for over tables</span>\r\n$objPHPExcel-&gt;setActiveSheetIndex(0);                      <span style=\"color: green;\">// set to first worksheet before close</span>\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">// Write to Browser</span>\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: blue;\">if</span>($debug) {\r\n  <span style=\"color: blue;\">fclose</span>($handle);\r\n}\r\nheader(<span style=\"color: #a31515;\">'Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'</span>);\r\nheader(<span style=\"color: #a31515;\">\"Content-Disposition: attachment;filename=$fname\"</span>);\r\nheader(<span style=\"color: #a31515;\">'Cache-Control: max-age=0'</span>);\r\n$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color: #a31515;\">'Excel2007'</span>);\r\n<span style=\"color: green;\">//$objWriter-&gt;save($fname);</span>\r\n$objWriter-&gt;save(<span style=\"color: #a31515;\">'php://output'</span>);\r\n<span style=\"color: blue;\">exit</span>;\r\n<span style=\"color: blue;\">function</span> innerHTML($node) {\r\n  $doc = $node-&gt;ownerDocument;\r\n  $frag = $doc-&gt;createDocumentFragment();\r\n  <span style=\"color: blue;\">foreach</span> ($node-&gt;childNodes <span style=\"color: blue;\">as</span> $child) {\r\n    $frag-&gt;appendChild($child-&gt;cloneNode(TRUE));\r\n  }\r\n  <span style=\"color: blue;\">return</span> $doc-&gt;saveXML($frag);\r\n}\r\n<span style=\"color: blue;\">function</span> findSpanColor($node) {\r\n  $pos = stripos($node, <span style=\"color: #a31515;\">\"color:\"</span>);       <span style=\"color: green;\">// ie: looking for style='color: #FF0000;'</span>\r\n  <span style=\"color: blue;\">if</span> ($pos === false) {                  <span style=\"color: green;\">//                        12345678911111</span>\r\n    <span style=\"color: blue;\">return</span> <span style=\"color: #a31515;\">'000000'</span>;                     <span style=\"color: green;\">//                                 01234</span>\r\n  }\r\n  $node = substr($node, $pos);           <span style=\"color: green;\">// truncate to color: start</span>\r\n  $start = <span style=\"color: #a31515;\">\"#\"</span>;                          <span style=\"color: green;\">// looking for html color string</span>\r\n  $end = <span style=\"color: #a31515;\">\";\"</span>;                            <span style=\"color: green;\">// should end with semicolon</span>\r\n  $node = <span style=\"color: #a31515;\">\" \"</span>.$node;                     <span style=\"color: green;\">// prefix node with blank</span>\r\n\t$ini = stripos($node,$start);          <span style=\"color: green;\">// look for #</span>\r\n\t<span style=\"color: blue;\">if</span> ($ini === false) <span style=\"color: blue;\">return</span> <span style=\"color: #a31515;\">\"000000\"</span>;   <span style=\"color: green;\">// not found, return default color of black</span>\r\n\t$ini += strlen($start);                <span style=\"color: green;\">// get 1 byte past start string</span>\r\n\t$len = stripos($node,$end,$ini) - $ini; <span style=\"color: green;\">// grab substr between start and end positions</span>\r\n\t<span style=\"color: blue;\">return</span> substr($node,$ini,$len);        <span style=\"color: green;\">// return the RGB color without # sign</span>\r\n}\r\n<span style=\"color: blue;\">function</span> findStyleColor($style) {\r\n  $pos = stripos($style, <span style=\"color: #a31515;\">\"color:\"</span>);      <span style=\"color: green;\">// ie: looking for style='color: #FF0000;'</span>\r\n  <span style=\"color: blue;\">if</span> ($pos === false) {                  <span style=\"color: green;\">//                        12345678911111</span>\r\n    <span style=\"color: blue;\">return</span> <span style=\"color: #a31515;\">''</span>;                           <span style=\"color: green;\">//                                 01234</span>\r\n  }\r\n  $style = substr($style, $pos);           <span style=\"color: green;\">// truncate to color: start</span>\r\n  $start = <span style=\"color: #a31515;\">\"#\"</span>;                          <span style=\"color: green;\">// looking for html color string</span>\r\n  $end = <span style=\"color: #a31515;\">\";\"</span>;                            <span style=\"color: green;\">// should end with semicolon</span>\r\n  $style = <span style=\"color: #a31515;\">\" \"</span>.$style;                     <span style=\"color: green;\">// prefix node with blank</span>\r\n\t$ini = stripos($style,$start);          <span style=\"color: green;\">// look for #</span>\r\n\t<span style=\"color: blue;\">if</span> ($ini === false) <span style=\"color: blue;\">return</span> <span style=\"color: #a31515;\">\"\"</span>;         <span style=\"color: green;\">// not found, return default color of black</span>\r\n\t$ini += strlen($start);                <span style=\"color: green;\">// get 1 byte past start string</span>\r\n\t$len = stripos($style,$end,$ini) - $ini; <span style=\"color: green;\">// grab substr between start and end positions</span>\r\n\t<span style=\"color: blue;\">return</span> substr($style,$ini,$len);        <span style=\"color: green;\">// return the RGB color without # sign</span>\r\n}\r\n<span style=\"color: blue;\">function</span> findBoldText($node) {\r\n  $pos = stripos($node, <span style=\"color: #a31515;\">\"&lt;b&gt;\"</span>);          <span style=\"color: green;\">// ie: looking for bolded text</span>\r\n  <span style=\"color: blue;\">if</span> ($pos === false) {                  <span style=\"color: green;\">//                        12345678911111</span>\r\n    <span style=\"color: blue;\">return</span> false;                        <span style=\"color: green;\">//                                 01234</span>\r\n  }\r\n  <span style=\"color: blue;\">return</span> true;                           <span style=\"color: green;\">// found &lt;b&gt;</span>\r\n}\r\n?&gt;\r\n</pre>\n</div>",
    "PostedDate": "2011-10-13T12:51:45.343-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "695189",
    "ThreadId": "275807",
    "Html": "<p><span class=\"Apple\" style=\"word-spacing: 0px; font: medium 'Times New Roman'; text-transform: none; color: #000000; text-indent: 0px; white-space: normal; letter-spacing: normal; border-collapse: separate; orphans: 2; widows: 2;\"><span class=\"Apple\" style=\"font-size: 13px; font-family: 'Segoe UI', 'Microsoft Sans Serif', Arial, Geneva, sans-serif;\">\r\n<p>Hi mamuscia.</p>\r\n<p>This code is what I'm looking for but this is way to complicated for me.</p>\r\n<p>I know you are praboblly busy person but can you actualy tel us how to us this script?</p>\r\n<p>All my tables are generated dynamically in php how can I add link to every table like -&gt; [Save as Excel File]?</p>\r\n<p>Do I have to save file as html on my HDD ? Or there is another way?&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>Ps. Thank you for sharing!</p>\r\n</span></span></p>",
    "PostedDate": "2011-11-08T01:33:37.09-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "695367",
    "ThreadId": "275807",
    "Html": "<p>Hi Foxmark,</p>\r\n<p>The method I use to pass the HTML table to this PHP script is by using $_SESSION variables to save the generated HTML into.</p>\r\n<p>The steps are as follows:</p>\r\n<ol>\r\n<li>generate the HTML for the table</li>\r\n<li>put the generated HTML into a $_SESSION variable, as well as displaying the HTML table on the page</li>\r\n<li>generate links at the top of the page that reference the PHP script to export the table to Excel</li>\r\n<li>The PHP script to export the table gets the $_SESSION variable name, then gets the contents of the variable from the $_SESSION variable</li>\r\n<li>The DOM is built from the variable contents and executes like the sample I gave above to use the PHPExcel class&nbsp;</li>\r\n</ol>\r\n<p>I've attached a snippet to show you how I do this from the calling script:</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre>session_start();\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">// get data for table</span>\r\n$data = getData(); <span style=\"color: green;\">// any function you have to get your data</span>\r\n<span style=\"color: green;\">// generate HTML table using data obtained</span>\r\n$html = genHTML($data);  <span style=\"color: green;\">// any function you have to generate the HTML table</span>\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">// generate links to be displayed at top of table</span>\r\n$chtml = <span style=\"color: #a31515;\">\"&lt;br /&gt;&lt;div style='height:26px;width:50%;border: solid gray 1px;background:#F5F5F5;padding-top:4px;'&gt;\\n\"</span>;\r\n$chtml .= <span style=\"color: #a31515;\">\"&lt;a href='javascript:void(0)' onclick='window.print();' title='Print this page'&gt;&lt;img src='images/printer.png' alt='Print this page' hspace='3' /&gt;&lt;/a&gt;\\n\"</span>;\r\n$chtml .=  <span style=\"color: #a31515;\">\"&lt;a href='generalexport_v2.php?var=tablecontents' target='_blank' title='Export table to Excel'&gt;&lt;img src='images/excel.gif' alt='Export table to Excel' hspace='3' /&gt;&lt;/a&gt;\\n\"</span>;\r\n$chtml .=  <span style=\"color: #a31515;\">\"&lt;a href='emailfile.php?var=tablecontents' target='_blank' title='eMail Excel file to me'&gt;&lt;img src='images/email.png' alt='eMail Excel file to me' hspace='3' /&gt;&lt;/a&gt;\\n\"</span>;\r\n$chtml .= <span style=\"color: #a31515;\">\"&lt;/div&gt;&lt;br /&gt;\\n\"</span>;\r\n$_SESSION[<span style=\"color: #a31515;\">'tablecontents'</span>] = $html;\r\n<span style=\"color: blue;\">echo</span> $chtml;\r\n<span style=\"color: blue;\">echo</span> $html;\r\n<span style=\"color: blue;\">exit</span>;\r\n</pre>\r\n<pre>Notice how the generalexport.php file uses a parameter of VAR=</pre>\r\n<pre>This will be the session variable name where you stored the generated HTML table.</pre>\r\n<pre>It should be a unique name so that other pages that use this same method generate their own unique session variable contents. </pre>\r\n<pre>Hope this helps explain how to call and use this generic export function.</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2011-11-08T08:12:17.39-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "695382",
    "ThreadId": "275807",
    "Html": "Here's an updated copy of the generalexport.php script.  ~&lt;?php session_start(); ini_set(&quot;memory_limit&quot;, &quot;-1&quot;); ini_set(&quot;set_time_limit&quot;, &quot;0&quot;); set_time_limit(0); if (isset($_SESSION['zprofile'])) { $username = $_SESSION['zprofile']['username']; // user's name $usermail = $_SESSION['zprofile']['useremail']; // user's emailid $usercompany = $_SESSION['zprofile']['usercompany']; // user's company }else{ header('Location: index.php?e=0'); } if(!isset($_GET['var'])) { echo &quot;&lt;br /&gt;No Table Variable Present, nothing to Export.&quot;; exit; }else{ $tablevar = $_GET['var']; } if(!isset($_GET['limit'])) { $limit = 12; // maximum number of Excel tabs to create, optional }else{ $limit = $_GET['limit']; } if(!isset($_GET['debug'])) { // optional, debug script by writing out to log file $debug = false; }else{ $debug = true; $handle = fopen(&quot;Auditlog/exportdebug_log.txt&quot;, &quot;w&quot;); fwrite($handle, &quot;\\nDebugging On...&quot;); } if(!isset($_SESSION[$tablevar]) OR $_SESSION[$tablevar] == '') { echo &quot;&lt;br /&gt;Empty HTML Table, nothing to Export.&quot;; exit; }else{ $htmltable = $_SESSION[$tablevar]; } if(strlen($htmltable) == strlen(strip_tags($htmltable)) ) { // anything left after we strip HTML? echo &quot;&lt;br /&gt;Invalid HTML Table after Stripping Tags, nothing to Export.&quot;; exit; } if($debug) { fwrite($handle, &quot;\\n-------------------------------------------&quot;); fwrite($handle, &quot;\\nHTML before prep: \\n&quot;.$htmltable); fwrite($handle, &quot;\\n-------------------------------------------&quot;); } $htmltable = strip_tags($htmltable, &quot;&lt;table&gt;&lt;tr&gt;&lt;th&gt;&lt;thead&gt;&lt;tbody&gt;&lt;tfoot&gt;&lt;td&gt;&lt;br&gt;&lt;b&gt;&lt;span&gt;&quot;); $htmltable = str_replace(&quot;&lt;br /&gt;&quot;, &quot;\\n&quot;, $htmltable); $htmltable = str_replace(&quot;&lt;br/&gt;&quot;, &quot;\\n&quot;, $htmltable); $htmltable = str_replace(&quot;&lt;br&gt;&quot;, &quot;\\n&quot;, $htmltable); $htmltable = str_replace(&quot;&amp;nbsp;&quot;, &quot; &quot;, $htmltable); $htmltable = str_replace(&quot;\\n\\n&quot;, &quot;\\n&quot;, $htmltable); if($debug) { fwrite($handle, &quot;\\n-------------------------------------------&quot;); fwrite($handle, &quot;\\nHTML after prep: \\n&quot;.$htmltable); fwrite($handle, &quot;\\n-------------------------------------------&quot;); } // // Create Document Object Model from HTML table contents // $dom = new domDocument; $dom-&gt;loadHTML($htmltable); if(!$dom) { echo &quot;&lt;br /&gt;Invalid HTML DOM, nothing to Export.&quot;; exit; } $dom-&gt;preserveWhiteSpace = false; // remove redundant whitespace $tables = $dom-&gt;getElementsByTagName('table'); if(!is_object($tables)) { echo &quot;&lt;br /&gt;Invalid HTML Table DOM, nothing to Export.&quot;; exit; } if($debug) { fwrite($handle, &quot;\\nTable Count: &quot;.$tables-&gt;length); } if($tables-&gt;length &lt; 1) { echo &quot;&lt;br /&gt;DOM Table Count is &quot;.$tables-&gt;length.&quot;, nothing to Export.&quot;; exit; } $tbcnt = $tables-&gt;length - 1; // count minus 1 for 0 indexed loop over tables if($tbcnt &gt; $limit) { $tbcnt = $limit; } // // // Create new PHPExcel object with default attributes // require_once ('PHPExcel/PHPExcel.php'); $objPHPExcel = new PHPExcel(); $objPHPExcel-&gt;getDefaultStyle()-&gt;getFont()-&gt;setName('Arial'); $objPHPExcel-&gt;getDefaultStyle()-&gt;getFont()-&gt;setSize(9); $tm = date(YmdHis); $pos = strpos($usermail, &quot;@&quot;); $user = substr($usermail, 0, $pos); $user = str_replace(&quot;.&quot;,&quot;&quot;,$user); $tfn = $user.&quot;<em>&quot;.$tm.&quot;</em>&quot;.$tablevar.&quot;.xlsx&quot;; //$fname = &quot;AuditLog/&quot;.$tfn; $fname = $tfn; $objPHPExcel-&gt;getProperties()-&gt;setCreator($username) -&gt;setLastModifiedBy($username) -&gt;setTitle(&quot;Automated Export&quot;) -&gt;setSubject(&quot;Automated Report Generation&quot;) -&gt;setDescription(&quot;Automated Report generation.&quot;) -&gt;setKeywords(&quot;Exported File&quot;) -&gt;setCompany($usercompany) -&gt;setCategory(&quot;Export&quot;); // // Loop over tables in DOM to create an array, each table becomes a worksheet // for($z=0;$z&lt;=$tbcnt;$z++) { $maxcols = 0; $totrows = 0; $headrows = array(); $bodyrows = array(); $r = 0; $h = 0; $rows = $tables-&gt;item($z)-&gt;getElementsByTagName('tr'); $totrows = $rows-&gt;length; if($debug) { fwrite($handle, &quot;\\nTotal Rows: &quot;.$totrows); } // // Get TH values // foreach ($rows as $row) { $ths = $row-&gt;getElementsByTagName('th'); if(is_object($ths)) { if($ths-&gt;length &gt; 0) { $headrows[$h]['colcnt'] = $ths-&gt;length; if($ths-&gt;length &gt; $maxcols) { $maxcols = $ths-&gt;length; } $nodes = $ths-&gt;length - 1; for($x=0;$x&lt;=$nodes;$x++) { $thishdg = $ths-&gt;item($x)-&gt;nodeValue; $headrows[$h]['th'][] = $thishdg; $headrows[$h]['bold'][] = findBoldText(innerHTML($ths-&gt;item($x))); if($ths-&gt;item($x)-&gt;hasAttribute('style')) { $style = $ths-&gt;item($x)-&gt;getAttribute('style'); $stylecolor = findStyleColor($style); if($stylecolor == '') { $headrows[$h]['color'][] = findSpanColor(innerHTML($ths-&gt;item($x))); }else{ $headrows[$h]['color'][] = $stylecolor; } }else{ $headrows[$h]['color'][] = findSpanColor(innerHTML($ths-&gt;item($x))); } if($ths-&gt;item($x)-&gt;hasAttribute('colspan')) { $headrows[$h]['colspan'][] = $ths-&gt;item($x)-&gt;getAttribute('colspan'); }else{ $headrows[$h]['colspan'][] = 1; } if($ths-&gt;item($x)-&gt;hasAttribute('align')) { $headrows[$h]['align'][] = $ths-&gt;item($x)-&gt;getAttribute('align'); }else{ $headrows[$h]['align'][] = 'left'; } if($ths-&gt;item($x)-&gt;hasAttribute('valign')) { $headrows[$h]['valign'][] = $ths-&gt;item($x)-&gt;getAttribute('valign'); }else{ $headrows[$h]['valign'][] = 'top'; } if($ths-&gt;item($x)-&gt;hasAttribute('bgcolor')) { $headrows[$h]['bgcolor'][] = str_replace(&quot;#&quot;, &quot;&quot;, $ths-&gt;item($x)-&gt;getAttribute('bgcolor')); }else{ $headrows[$h]['bgcolor'][] = 'FFFFFF'; } } $h++; } } } // // Get TD values // foreach ($rows as $row) { $tds = $row-&gt;getElementsByTagName('td'); if(is_object($tds)) { if($tds-&gt;length &gt; 0) { $bodyrows[$r]['colcnt'] = $tds-&gt;length; if($tds-&gt;length &gt; $maxcols) { $maxcols = $tds-&gt;length; } $nodes = $tds-&gt;length - 1; for($x=0;$x&lt;=$nodes;$x++) { $thistxt = $tds-&gt;item($x)-&gt;nodeValue; $bodyrows[$r]['td'][] = $thistxt; $bodyrows[$r]['bold'][] = findBoldText(innerHTML($tds-&gt;item($x))); if($tds-&gt;item($x)-&gt;hasAttribute('style')) { $style = $tds-&gt;item($x)-&gt;getAttribute('style'); $stylecolor = findStyleColor($style); if($stylecolor == '') { $bodyrows[$r]['color'][] = findSpanColor(innerHTML($tds-&gt;item($x))); }else{ $bodyrows[$r]['color'][] = $stylecolor; } }else{ $bodyrows[$r]['color'][] = findSpanColor(innerHTML($tds-&gt;item($x))); } if($tds-&gt;item($x)-&gt;hasAttribute('colspan')) { $bodyrows[$r]['colspan'][] = $tds-&gt;item($x)-&gt;getAttribute('colspan'); }else{ $bodyrows[$r]['colspan'][] = 1; } if($tds-&gt;item($x)-&gt;hasAttribute('align')) { $bodyrows[$r]['align'][] = $tds-&gt;item($x)-&gt;getAttribute('align'); }else{ $bodyrows[$r]['align'][] = 'left'; } if($tds-&gt;item($x)-&gt;hasAttribute('valign')) { $bodyrows[$r]['valign'][] = $tds-&gt;item($x)-&gt;getAttribute('valign'); }else{ $bodyrows[$r]['valign'][] = 'top'; } if($tds-&gt;item($x)-&gt;hasAttribute('bgcolor')) { $bodyrows[$r]['bgcolor'][] = str_replace(&quot;#&quot;, &quot;&quot;, $tds-&gt;item($x)-&gt;getAttribute('bgcolor')); }else{ $bodyrows[$r]['bgcolor'][] = 'FFFFFF'; } } $r++; } } } if($z &gt; 0) { $objPHPExcel-&gt;createSheet($z); } $suf = $z + 1; $tableid = $tablevar.$suf; $wksheetname = ucfirst($tableid); $objPHPExcel-&gt;setActiveSheetIndex($z); // each sheet corresponds to a table in html $objPHPExcel-&gt;getActiveSheet()-&gt;setTitle($wksheetname); // tab name $worksheet = $objPHPExcel-&gt;getActiveSheet(); // set worksheet we're working on $style_overlay = array('font' =&gt; array('color' =&gt; array('rgb' =&gt; '000000'),'bold' =&gt; false,), 'fill' =&gt; array('type' =&gt; PHPExcel_Style_Fill::FILL_SOLID, 'color' =&gt; array('rgb' =&gt; 'CCCCFF')), 'alignment' =&gt; array('wrap' =&gt; true, 'horizontal' =&gt; PHPExcel_Style_Alignment::HORIZONTAL_CENTER, 'vertical' =&gt; PHPExcel_Style_Alignment::VERTICAL_TOP), 'borders' =&gt; array('top' =&gt; array('style' =&gt; PHPExcel_Style_Border::BORDER_THIN), 'bottom' =&gt; array('style' =&gt; PHPExcel_Style_Border::BORDER_THIN), 'left' =&gt; array('style' =&gt; PHPExcel_Style_Border::BORDER_THIN), 'right' =&gt; array('style' =&gt; PHPExcel_Style_Border::BORDER_THIN)), ); $xcol = ''; $xrow = 1; $usedhdrows = 0; $heightvars = array(1=&gt;'42', 2=&gt;'42', 3=&gt;'48', 4=&gt;'52', 5=&gt;'58', 6=&gt;'64', 7=&gt;'68', 8=&gt;'76', 9=&gt;'82'); for($h=0;$h&lt;count($headrows);$h++) { $th = $headrows[$h]['th']; $colspans = $headrows[$h]['colspan']; $aligns = $headrows[$h]['align']; $valigns = $headrows[$h]['valign']; $bgcolors = $headrows[$h]['bgcolor']; $colcnt = $headrows[$h]['colcnt']; $colors = $headrows[$h]['color']; $bolds = $headrows[$h]['bold']; $usedhdrows++; $mergedcells = false; for($t=0;$t&lt;count($th);$t++) { if($xcol == '') {$xcol = 'A';}else{$xcol++;} $thishdg = $th[$t]; $thisalign = $aligns[$t]; $thisvalign = $valigns[$t]; $thiscolspan = $colspans[$t]; $thiscolor = $colors[$t]; $thisbg = $bgcolors[$t]; $thisbold = $bolds[$t]; $strbold = ($thisbold==true) ? 'true' : 'false'; if($thisbg == 'FFFFFF') { $style_overlay['fill']['type'] = PHPExcel_Style_Fill::FILL_NONE; }else{ $style_overlay['fill']['type'] = PHPExcel_Style_Fill::FILL_SOLID; } $style_overlay['alignment']['vertical'] = $thisvalign; // set styles for cell $style_overlay['alignment']['horizontal'] = $thisalign; $style_overlay['font']['color']['rgb'] = $thiscolor; $style_overlay['font']['bold'] = $thisbold; $style_overlay['fill']['color']['rgb'] = $thisbg; if($thiscolspan &gt; 1) { // spans more than 1 column $mergedcells = true; $lastxcol = $xcol; for($j=1;$j&lt;$thiscolspan;$j++) { // count to last column in span $lastxcol++; } $cellRange = $xcol.$xrow.':'.$lastxcol.$xrow; if($debug) { fwrite($handle, &quot;\\nmergeCells: &quot;.$xcol.&quot;:&quot;.$xrow.&quot; &quot;.$lastxcol.&quot;:&quot;.$xrow); } $worksheet-&gt;mergeCells($cellRange); // merge the columns $worksheet-&gt;setCellValue($xcol.$xrow, $thishdg); $worksheet-&gt;getStyle($cellRange)-&gt;applyFromArray($style_overlay); $worksheet-&gt;getStyle($cellRange)-&gt;getAlignment()-&gt;setWrapText(tru<br />\n```<br />\n",
    "PostedDate": "2011-11-08T08:39:24.443-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "695401",
    "ThreadId": "275807",
    "Html": "<p>Also, worht noting is that the HTML I generate for tables is fairly consistent and I use this general format.&nbsp; You can put STYLE='COLOR: xxxxxxx' anywhere, as well as &lt;BR /&gt;'s which will be</p>\r\n<p>turned into newlines chars.</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">table</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">thead</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: green;\">&lt;!-- Heading row(s) --&gt;</span>\r\n  <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">th</span> <span style=\"color: red;\">colspan</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'4'</span> <span style=\"color: red;\">align</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'center'</span> <span style=\"color: red;\">valign</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'top'</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">b</span><span style=\"color: blue;\">&gt;</span>Some Heading Text<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">b</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">th</span> <span style=\"color: red;\">align</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'center'</span> <span style=\"color: red;\">valign</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'top'</span><span style=\"color: blue;\">&gt;</span>Heading 1<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">th</span> <span style=\"color: red;\">align</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'center'</span> <span style=\"color: red;\">valign</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'top'</span><span style=\"color: blue;\">&gt;</span>Heading 2<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">th</span> <span style=\"color: red;\">align</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'center'</span> <span style=\"color: red;\">valign</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'top'</span><span style=\"color: blue;\">&gt;</span>Heading 3<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">th</span> <span style=\"color: red;\">align</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'center'</span> <span style=\"color: red;\">valign</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'top'</span><span style=\"color: blue;\">&gt;</span>Heading 4<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">thead</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: green;\">&lt;!-- Data row(s) --&gt;</span>\r\n  <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">tbody</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span> <span style=\"color: red;\">align</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'left'</span> <span style=\"color: red;\">valign</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'top'</span><span style=\"color: blue;\">&gt;</span>data...<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span> <span style=\"color: red;\">align</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'left'</span> <span style=\"color: red;\">valign</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'top'</span><span style=\"color: blue;\">&gt;</span>data...<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span> <span style=\"color: red;\">align</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'left'</span> <span style=\"color: red;\">valign</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'top'</span><span style=\"color: blue;\">&gt;</span>data...<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span> <span style=\"color: red;\">align</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'left'</span> <span style=\"color: red;\">valign</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">'top'</span><span style=\"color: blue;\">&gt;</span>data...<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: green;\">&lt;!-- more Data row(s), as needed ... --&gt;</span>\r\n  <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">tbody</span><span style=\"color: blue;\">&gt;</span>\r\n<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">table</span><span style=\"color: blue;\">&gt;</span>\r\n</pre>\r\n</div>",
    "PostedDate": "2011-11-08T09:14:48.8-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "695701",
    "ThreadId": "275807",
    "Html": "<p>Hi mamuscia,</p>\r\n<p>Thnak you for all your work!</p>\r\n<p>I'm going to work on this&nbsp;beauty&nbsp;today, we will see how good am I :)</p>\r\n<p>Best Regards,</p>",
    "PostedDate": "2011-11-09T00:39:09.47-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "705225",
    "ThreadId": "275807",
    "Html": "<p>&nbsp;</p>\r\n<p><span style=\"font-size: 10pt; color: black; font-family: 'Segoe UI','sans-serif';\">Hi mamuscia,</span></p>\r\n<p><span style=\"font-size: 10pt; color: black; font-family: 'Segoe UI','sans-serif';\">It&rsquo;s been a while since my last post,</span></p>\r\n<p><span style=\"font-size: 10pt; color: black; font-family: 'Segoe UI','sans-serif';\">But this morning I returned to excel project and I have to say - great job!!!</span></p>\r\n<p><span style=\"font-size: 10pt; color: black; font-family: 'Segoe UI','sans-serif';\">I managed to generate about 5000 lines of data and save it to excel in a snap.</span></p>\r\n<p><span style=\"font-size: 10pt; color: black; font-family: 'Segoe UI','sans-serif';\">All I have to do now is change the way my functions return tables but this is easy.</span></p>\r\n<p><span style=\"font-size: 10pt; color: black; font-family: 'Segoe UI','sans-serif';\">One more time thx for your help and support. </span></p>\r\n<p><span style=\"font-size: 10pt; color: black; font-family: 'Segoe UI','sans-serif';\">Thx,</span></p>\r\n<p><span style=\"font-size: 10pt; color: black; font-family: 'Segoe UI','sans-serif';\">Paul</span></p>",
    "PostedDate": "2011-11-30T04:11:40.92-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "705226",
    "ThreadId": "275807",
    "Html": "<p>&nbsp;Ps. All I done was removing this condition:<br /><br /></p>\n<div style=\"color: black; background-color: white;\">\n<pre><span style=\"color: blue;\">if</span> (<span style=\"color: blue;\">isset</span>($_SESSION[<span style=\"color: #a31515;\">'zprofile'</span>])) {\r\n  $username = $_SESSION[<span style=\"color: #a31515;\">'zprofile'</span>][<span style=\"color: #a31515;\">'username'</span>];            <span style=\"color: green;\">// user's name</span>\r\n  $usermail = $_SESSION[<span style=\"color: #a31515;\">'zprofile'</span>][<span style=\"color: #a31515;\">'useremail'</span>];         <span style=\"color: green;\">// user's emailid</span>\r\n  $usercompany = $_SESSION[<span style=\"color: #a31515;\">'zprofile'</span>][<span style=\"color: #a31515;\">'usercompany'</span>];    <span style=\"color: green;\">// user's company</span>\r\n}<span style=\"color: blue;\">else</span>{\r\n  header(<span style=\"color: #a31515;\">'Location: index.php?e=0'</span>);\r\n}\r\n\r\n</pre>\n</div>",
    "PostedDate": "2011-11-30T04:11:49.517-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "705258",
    "ThreadId": "275807",
    "Html": "<p>Foxmark,</p>\r\n<p>Glad you found this to be useful.&nbsp;</p>\r\n<p>That section you removed checking for the $_SESSION['zprofile'] is ok to do.&nbsp; Just make sure you start a session from both pages so you can store your generated HTML table</p>\r\n<p>into a session variable.</p>",
    "PostedDate": "2011-11-30T05:53:24.167-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "705263",
    "ThreadId": "275807",
    "Html": "<p>I start looking at your code and I found this</p>\n<div style=\"color: black; background-color: white;\">\n<pre>$objPHPExcel-&gt;getDefaultStyle()-&gt;getFont()-&gt;setName(<span style=\"color: #a31515;\">'Arial'</span>);\r\n$objPHPExcel-&gt;getDefaultStyle()-&gt;getFont()-&gt;setSize(9);</pre>\n<pre>Can you tell me please how can I change font size for my TH tag?</pre>\n<pre>I managed to change bgcolor but I dont know how to start with font size and decoration.\r\n</pre>\n</div>\n<div style=\"color: black; background-color: white;\">\n<pre>  <span style=\"color: green;\">// Get TH values</span>\r\n  <span style=\"color: green;\">//</span>\r\n  <span style=\"color: blue;\">foreach</span> ($rows <span style=\"color: blue;\">as</span> $row) {\r\n      $ths = $row-&gt;getElementsByTagName(<span style=\"color: #a31515;\">'th'</span>);\r\n      <span style=\"color: blue;\">if</span>(is_object($ths)) {\r\n        <span style=\"color: blue;\">if</span>($ths-&gt;length &gt; 0) {\r\n          $headrows[$h][<span style=\"color: #a31515;\">'colcnt'</span>] = $ths-&gt;length;\r\n          <span style=\"color: blue;\">if</span>($ths-&gt;length &gt; $maxcols) {\r\n            $maxcols = $ths-&gt;length;\r\n          }\r\n          $nodes = $ths-&gt;length - 1;\r\n          <span style=\"color: blue;\">for</span>($x=0;$x&lt;=$nodes;$x++) {\r\n            $thishdg = $ths-&gt;item($x)-&gt;nodeValue;\r\n            $headrows[$h][<span style=\"color: #a31515;\">'th'</span>][] = $thishdg;\r\n            $headrows[$h][<span style=\"color: #a31515;\">'bold'</span>][] = findBoldText(innerHTML($ths-&gt;item($x)));\r\n            <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'style'</span>)) {\r\n              $style = $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'style'</span>);\r\n              $stylecolor = findStyleColor($style);\r\n              <span style=\"color: blue;\">if</span>($stylecolor == <span style=\"color: #a31515;\">''</span>) {\r\n                $headrows[$h][<span style=\"color: #a31515;\">'color'</span>][] = findSpanColor(innerHTML($ths-&gt;item($x)));\r\n              }<span style=\"color: blue;\">else</span>{\r\n                $headrows[$h][<span style=\"color: #a31515;\">'color'</span>][] = $stylecolor;\r\n              }\r\n            }<span style=\"color: blue;\">else</span>{\r\n              $headrows[$h][<span style=\"color: #a31515;\">'color'</span>][] = findSpanColor(innerHTML($ths-&gt;item($x)));\r\n            }\r\n            <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'colspan'</span>)) {\r\n              $headrows[$h][<span style=\"color: #a31515;\">'colspan'</span>][] = $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'colspan'</span>);\r\n            }<span style=\"color: blue;\">else</span>{\r\n              $headrows[$h][<span style=\"color: #a31515;\">'colspan'</span>][] = 1;\r\n            }\r\n            <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'align'</span>)) {\r\n              $headrows[$h][<span style=\"color: #a31515;\">'align'</span>][] = $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'align'</span>);\r\n            }<span style=\"color: blue;\">else</span>{\r\n              $headrows[$h][<span style=\"color: #a31515;\">'align'</span>][] = <span style=\"color: #a31515;\">'left'</span>;\r\n            }\r\n            <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'valign'</span>)) {\r\n              $headrows[$h][<span style=\"color: #a31515;\">'valign'</span>][] = $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'valign'</span>);\r\n            }<span style=\"color: blue;\">else</span>{\r\n              $headrows[$h][<span style=\"color: #a31515;\">'valign'</span>][] = <span style=\"color: #a31515;\">'top'</span>;\r\n            }\r\n            <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'bgcolor'</span>)) {\r\n              $headrows[$h][<span style=\"color: #a31515;\">'bgcolor'</span>][] = str_replace(<span style=\"color: #a31515;\">\"#\"</span>, <span style=\"color: #a31515;\">\"\"</span>, $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'bgcolor'</span>));\r\n            }<span style=\"color: blue;\">else</span>{\r\n              $headrows[$h][<span style=\"color: #a31515;\">'bgcolor'</span>][] = <span style=\"color: #a31515;\">'cccccc'</span>; // my new color\r\n            }\r\n          }\r\n          $h++;\r\n        }\r\n      }\r\n  }\r\n  <span style=\"color: green;\">//</span>\r\n</pre>\n<pre>Im using css to style all my tables so php output is raw html table with no colors, font size or any formating.</pre>\n<pre>Thank you  and have a nice day!</pre>\n</div>",
    "PostedDate": "2011-11-30T06:07:30.663-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "705534",
    "ThreadId": "275807",
    "Html": "<p>I did not write this to go after all those styling attributes from css.&nbsp; Also, if you use classes the styling will not be picked up.</p>\r\n<p>You'd have to write your own parsing function like I did to look for specific items.&nbsp;</p>",
    "PostedDate": "2011-11-30T14:02:34.76-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "705904",
    "ThreadId": "275807",
    "Html": "<p>Hello,</p>\r\n<p>I am beginner in php and html.</p>\r\n<p>Your above code is what i am searching to do. In fact, I display informations from an excel file in a html table and i add for each row a checkbox.</p>\r\n<p>The purpose of the checkbox is to give the user the ability to select which lines hes is interested from&nbsp; the global information (excel file)&nbsp; to finaly create another excel file containing just the rows selected.</p>\r\n<p>So the purpose of my code is :&nbsp; To create Excel files from HTML tables that they've already generated.</p>\r\n<p>1. I wrote the php code that read an excel file using the PHPExcel package and the html code that generate the page with the table with all informations in the excel file, below is the code :</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre>&lt;html&gt;\r\n&lt;head&gt;\r\n    &lt;meta http-equiv=<span style=\"color: #a31515;\">\"content-type\"</span> content=<span style=\"color: #a31515;\">\"text/html; charset=iso-8859-1\"</span> /&gt;\r\n    &lt;title&gt;Tableau de voisngae 2G 2G&lt;/title&gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n\r\n&lt;?php\r\n$File_name = <span style=\"color: #a31515;\">\"2G2G12.xls\"</span>;\r\n<span style=\"color: blue;\">require_once</span> <span style=\"color: #a31515;\">'PHPExcel/IOFactory.php'</span>;\r\n$objPHPExcel = PHPExcel_IOFactory::load($File_name);\r\n?&gt;\r\n\r\n&lt;table id=<span style=\"color: #a31515;\">\"tableau\"</span> border=<span style=\"color: #a31515;\">\"1\"</span> align=<span style=\"color: #a31515;\">\"center\"</span>&gt;\r\n        &lt;thead&gt;\r\n          &lt;tr  BGCOLOR=FF6600&gt;\r\n              &lt;th&gt;&lt;font color=black&gt;Nom_S&lt;/font&gt;&lt;/th&gt;\r\n              &lt;th&gt;&lt;font color=black&gt;LAC_S&lt;/font&gt;&lt;/th&gt;\r\n              &lt;th&gt;&lt;font color=black&gt;CI_S&lt;/font&gt;&lt;/th&gt;\r\n              &lt;th&gt;&lt;font color=black&gt;Nom_V&lt;/font&gt;&lt;/th&gt;\r\n              &lt;th&gt;&lt;font color=black&gt;LAC_V&lt;/font&gt;&lt;/th&gt;\r\n              &lt;th&gt;&lt;font color=black&gt;CI_V&lt;/font&gt;&lt;/th&gt;\r\n              &lt;th&gt;&lt;font color=black&gt;Distance(Km)&lt;/th&gt;\r\n              &lt;th&gt;&lt;font color=black&gt;Plaque&lt;/font&gt;&lt;/th&gt;\r\n              &lt;th&gt;\r\n                  &lt;button type=<span style=\"color: #a31515;\">\"button\"</span>&gt;\r\n                  &lt;font color=black&gt;Ajouter&lt;/font&gt;\r\n                  &lt;/button&gt;\r\n\r\n              &lt;/th&gt;\r\n          &lt;/tr&gt;\r\n         &lt;/thead&gt;\r\n\r\n&lt;tbody&gt;\r\n&lt;?php\r\n <span style=\"color: blue;\">foreach</span> ($objPHPExcel-&gt;getWorksheetIterator() <span style=\"color: blue;\">as</span> $worksheet) {\r\n  $highestRow         = $worksheet-&gt;getHighestRow();\r\n  $highestColumn      = $worksheet-&gt;getHighestColumn();\r\n  $highestColumnIndex = PHPExcel_Cell::columnIndexFromString($highestColumn);\r\n?&gt;\r\n                          &lt;?php\r\n<span style=\"color: blue;\">for</span> ($row = 2; $row &lt;= $highestRow; ++ $row) {\r\n                          ?&gt;\r\n                             &lt;tr&gt;\r\n                             &lt;?php\r\n                             <span style=\"color: blue;\">for</span> ($col = 0; $col &lt; $highestColumnIndex; ++ $col) {\r\n                               $cell = $worksheet-&gt;getCellByColumnAndRow($col, $row);\r\n\r\n                               $val = $cell-&gt;getValue();\r\n\r\n                               $dataType = PHPExcel_Cell_DataType::dataTypeForValue($val);\r\n\r\n                             <span style=\"color: blue;\">if</span> ( $val == <span style=\"color: #a31515;\">\"A\"</span> ) {\r\n                             ?&gt;\r\n                               &lt;td align=<span style=\"color: #a31515;\">\"center\"</span>&gt;&lt;input name=<span style=\"color: #a31515;\">\"Ajouter\"</span> align=<span style=\"color: #a31515;\">\"center\"</span> align=<span style=\"color: #a31515;\">\"center\"</span> type=<span style=\"color: #a31515;\">\"checkbox\"</span> value=<span style=\"color: #a31515;\">\"0\"</span> id=<span style=\"color: #a31515;\">\"&lt;?php echo $row; ?&gt;\"</span> checked&gt;&lt;/input&gt;&lt;/td&gt;\r\n\r\n                             &lt;?php } <span style=\"color: blue;\">else</span> { ?&gt;\r\n\r\n                                     &lt;td&gt;&lt;?php <span style=\"color: blue;\">echo</span> $val; ?&gt;&lt;/td&gt;\r\n\r\n                             &lt;?php }\r\n                             }\r\n                             ?&gt;\r\n                             &lt;/tr&gt;\r\n                           &lt;?php\r\n                           }\r\n                           ?&gt;\r\n\r\n&lt;?php\r\n}\r\n?&gt;\r\n&lt;/tbody&gt;\r\n&lt;SCRIPT language=<span style=\"color: #a31515;\">\"Javascript\"</span>&gt;\r\n  <span style=\"color: blue;\">function</span> sauverResultatEpreuve()\r\n  {\r\n      <span style=\"color: blue;\">var</span> arrayLignes = document.getElementById(<span style=\"color: #a31515;\">\"tableau\"</span>).rows;\r\n      <span style=\"color: blue;\">var</span> longueur = arrayLignes.length;\r\n      <span style=\"color: blue;\">for</span>(<span style=\"color: blue;\">var</span> iter=1; iter &lt; longueur; ++iter)\r\n      {\r\n        alert(iter);\r\n        <span style=\"color: blue;\">var</span> arrayColonnes = arrayLignes[1].cells;\r\n        alert((arrayColonnes[0].innerHTML));\r\n        <span style=\"color: blue;\">var</span> largeur = arrayColonnes.length;\r\n        <span style=\"color: blue;\">var</span> valeur =  arrayColonnes[8].innerHTML;\r\n        alert(valeur);\r\n        <span style=\"color: blue;\">var</span> input = document.getElementById(iter + 1);\r\n        <span style=\"color: blue;\">var</span> id_cb = input.id;\r\n        alert(id_cb);\r\n        <span style=\"color: blue;\">if</span> ((document.getElementById(id_cb).checked) == false)\r\n        {\r\n           document.getElementById(<span style=\"color: #a31515;\">'tableau'</span>).deleteRow(arrayLignes[1].rowIndex);\r\n        }\r\n        <span style=\"color: blue;\">else</span>\r\n        {\r\n                    go();\r\n       }\r\n    }\r\n  }\r\n<span style=\"color: blue;\">function</span> getXhr(){\r\n      <span style=\"color: blue;\">var</span> xhr = null;\r\n      <span style=\"color: blue;\">if</span>(window.XMLHttpRequest) <span style=\"color: green;\">// Firefox et autres</span>\r\n           xhr = <span style=\"color: blue;\">new</span> XMLHttpRequest();\r\n      <span style=\"color: blue;\">else</span> <span style=\"color: blue;\">if</span>(window.ActiveXObject){ <span style=\"color: green;\">// Internet Explorer</span>\r\n                                   <span style=\"color: blue;\">try</span> {\r\n                                        xhr = <span style=\"color: blue;\">new</span> ActiveXObject(<span style=\"color: #a31515;\">\"Msxml2.XMLHTTP\"</span>);\r\n                                    } <span style=\"color: blue;\">catch</span> (e) {\r\n                                        xhr = <span style=\"color: blue;\">new</span> ActiveXObject(<span style=\"color: #a31515;\">\"Microsoft.XMLHTTP\"</span>);\r\n                                    }\r\n                                }\r\n                                <span style=\"color: blue;\">else</span> { <span style=\"color: green;\">// XMLHttpRequest non support&eacute;ar le navigateur</span>\r\n                                   alert(<span style=\"color: #a31515;\">\"Votre navigateur ne supporte pas les objets XMLHTTPRequest...\"</span>);\r\n                                   xhr = false;\r\n                                }\r\n                                <span style=\"color: blue;\">return</span> xhr\r\n                        }\r\n\r\n                        <span style=\"color: green;\">/**\r\n                        * M&eacute;ode qui sera appel&eacute;sur le click du bouton\r\n                        */</span>\r\n\r\n                        <span style=\"color: blue;\">function</span> go(){\r\n                                <span style=\"color: blue;\">var</span> xhr = getXhr()\r\n                                <span style=\"color: green;\">// On d&eacute;ni ce qu'on va faire quand on aura la r&eacute;nse</span>\r\n                                xhr.onreadystatechange = <span style=\"color: blue;\">function</span>(){\r\n                                        <span style=\"color: green;\">// On ne fait quelque chose que si on a tout re&ccedil;et que le serveur est ok</span>\r\n                                        <span style=\"color: blue;\">if</span>(xhr.readyState == 4 &amp;&amp; xhr.status == 200){\r\n                                                alert(xhr.responseText);\r\n                                        }\r\n                                }\r\n                                xhr.open(<span style=\"color: #a31515;\">\"GET\"</span>,<span style=\"color: #a31515;\">\"ajax.php\"</span>,true);\r\n                                xhr.send(null);\r\n                        }\r\n\r\n&lt;/SCRIPT&gt;\r\n&lt;/table&gt;\r\n&lt;button type=<span style=\"color: #a31515;\">\"button\"</span> onclick=<span style=\"color: #a31515;\">\"JavaScript:sauverResultatEpreuve()\"</span>&gt;\r\n           &lt;font color=black&gt;Ajouter&lt;/font&gt;\r\n&lt;/button&gt;\r\n\r\n&lt;script language=<span style=\"color: #a31515;\">\"javascript\"</span>&gt;&lt;/script&gt;\r\n\r\n&lt;/body&gt;\r\n&lt;/html&gt;</pre>\r\n<pre><strong>But i have always the problem how to create the excel file from the html table generated from the code above,and i found your code that i thing it will do what i really want :)</strong></pre>\r\n<pre><strong>The problem that i don't have any idea about how to create the session variable and how to get the html table from the code above and how to call your code (generalexport.php) :((.</strong></pre>\r\n<pre><strong>Hope that you will be able to help me to acheive my goal.</strong></pre>\r\n<pre><strong>Thank you in advance</strong></pre>\r\n<pre><strong>Kass34</strong></pre>\r\n<pre><strong></strong></pre>\r\n<pre>\r\n\r\n\r\n\r\n</pre>\r\n</div>",
    "PostedDate": "2011-12-01T08:01:59.53-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "705910",
    "ThreadId": "275807",
    "Html": "<p>Hi Kass34</p>\n<p>I started from smth easy llike:</p>\n<div style=\"color: black; background-color: white;\">\n<pre>&lt;?php\r\nsession_start();\r\nini_set(<span style=\"color: #a31515;\">'display_errors'</span>,1); \r\nerror_reporting(E_ALL);\r\n<span style=\"color: blue;\">function</span> printTable() {\r\n$part = \"&lt;table&gt;\r\n&lt;thead&gt;\r\n&lt;tr&gt;\r\n&lt;th colspan=\\\"4\\\" align=\\\"center\\\" valign=\\\"top\\\"&gt;&lt;b&gt;Some Heading Text&lt;/b&gt;&lt;/th&gt;\r\n&lt;/tr&gt;\r\n&lt;tr&gt;\r\n&lt;th align=\\\"center\\\" valign=\\\"top\\\"&gt;Heading 1&lt;/th&gt;\r\n&lt;th align=\\\"center\\\" valign=\\\"top\\\"&gt;Heading 2&lt;/th&gt;\r\n&lt;th align=\\\"center\\\" valign=\\\"top\\\"&gt;Heading 3&lt;/th&gt;\r\n&lt;th align=\\\"center\\\" valign=\\\"top\\\"&gt;Heading 4&lt;/th&gt;\r\n&lt;/tr&gt;\r\n&lt;/thead&gt;\r\n&lt;tbody&gt;\";\r\n$z = 101;\r\n$x = 201;\r\n$y = 301;\r\n<span style=\"color: blue;\">for</span> ($i = 1; $i &lt;= 50; $i++) {\r\n$part .=\"&lt;tr&gt;\r\n&lt;td align=\\\"left\\\" valign=\\\"top\\\"&gt;$i&lt;/td&gt;\r\n&lt;td align=\\\"left\\\" valign=\\\"top\\\"&gt;$z&lt;/td&gt;\r\n&lt;td align=\\\"left\\\" valign=\\\"top\\\"&gt;$x&lt;/td&gt;\r\n&lt;td align=\\\"left\\\" valign=\\\"top\\\"&gt;$y&lt;/td&gt;\r\n&lt;/tr&gt;\";\r\n$z++;\r\n$x++;\r\n$y++;\r\n}\r\n$part .= <span style=\"color: #a31515;\">\"&lt;/tbody&gt;&lt;/table&gt;\"</span>;\r\n<span style=\"color: blue;\">return</span> $part;\r\n}\r\n$chtml = <span style=\"color: #a31515;\">\"&lt;br /&gt;&lt;div style='height:26px;width:100px;border: solid gray 1px;background:#F5F5F5;padding-top:4px;'&gt;\\n\"</span>;\r\n$chtml .=  <span style=\"color: #a31515;\">\"&lt;a href='generalexport.php?var=tablecontents' title='Export table to Excel'&gt;&lt;img src='images/excel.png' alt='Export table to Excel' hspace='3' /&gt;&lt;/a&gt;\\n\"</span>;\r\n$chtml .= <span style=\"color: #a31515;\">\"&lt;/div&gt;&lt;br /&gt;\\n\"</span>;\r\n<span style=\"color: blue;\">echo</span> $chtml;</pre>\n<pre>$table = printTable();\r\n$_SESSION[<span style=\"color: #a31515;\">'tablecontents'</span>] = $table;</pre>\n<pre><span style=\"color: blue;\">echo</span> $table;</pre>\n<pre>?&gt;\r\n</pre>\n<pre>For session variable try:</pre>\n<pre>&lt;?php<br /></pre>\n<pre>session_start();</pre>\n<pre>$_SESSION[<span style=\"color: #a31515;\">'test'</span>] = \"My Test\";</pre>\n<pre>echo $_SESSION[<span style=\"color: #a31515;\">'test'</span>];</pre>\n<pre>?&gt;<br /></pre>\n<pre>And PS. make sure you name your file 'generalexport.php' !!<br /></pre>\n</div>",
    "PostedDate": "2011-12-01T08:10:43.667-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "705939",
    "ThreadId": "275807",
    "Html": "<p>Kass34 -</p>\r\n<p>If you&nbsp;utilize the method described here to export to Excel, then the entire table will be exported, not just selected rows.&nbsp; If you only want to export</p>\r\n<p>check rows, you will have to modify generalexport.php to search through the check boxes to determine which rows to include/exclude from the export.</p>\r\n<p>generalexport was meant to be lightweight and a simple table to excel option for export/download and doesn't check every iteration of HTML or CSS</p>\r\n<p>&nbsp;</p>\r\n<p>The example Foxmark shows above is a good illustration of how to use the generalexport&nbsp;method</p>",
    "PostedDate": "2011-12-01T08:38:40.337-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "706331",
    "ThreadId": "275807",
    "Html": "<p>Hello,</p>\r\n<p>Thanks for your response.</p>\r\n<p>I have problem with functions&nbsp; \"findBoldText, findSpanColor,.....\"</p>\r\n<p>in fact there is errors and it doesn't work and when i comment them there is no problem.</p>\r\n<p>Any idea please ?</p>\r\n<p>the html table that i created is look like :</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">table</span> <span style=\"color: red;\">id</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"tableau\"</span> <span style=\"color: red;\">border</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"1\"</span> <span style=\"color: red;\">align</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"center\"</span><span style=\"color: blue;\">&gt;</span>\r\n        <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">thead</span><span style=\"color: blue;\">&gt;</span>\r\n          <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">tr</span>  <span style=\"color: red;\">BGCOLOR</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">FF6600</span><span style=\"color: blue;\">&gt;</span>\r\n              <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">font</span> <span style=\"color: red;\">color</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">black</span><span style=\"color: blue;\">&gt;</span>Nom_S<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">font</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span>\r\n              <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">font</span> <span style=\"color: red;\">color</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">black</span><span style=\"color: blue;\">&gt;</span>LAC_S<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">font</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span>\r\n              <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">font</span> <span style=\"color: red;\">color</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">black</span><span style=\"color: blue;\">&gt;</span>CI_S<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">font</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span>\r\n              <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">font</span> <span style=\"color: red;\">color</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">black</span><span style=\"color: blue;\">&gt;</span>Nom_V<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">font</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span>\r\n              <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">font</span> <span style=\"color: red;\">color</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">black</span><span style=\"color: blue;\">&gt;</span>LAC_V<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">font</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span>\r\n              <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">font</span> <span style=\"color: red;\">color</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">black</span><span style=\"color: blue;\">&gt;</span>CI_V<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">font</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span>\r\n              <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">font</span> <span style=\"color: red;\">color</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">black</span><span style=\"color: blue;\">&gt;</span>Distance(Km)<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span>\r\n              <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">font</span> <span style=\"color: red;\">color</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">black</span><span style=\"color: blue;\">&gt;</span>Plaque<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">font</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span>\r\n              <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">font</span> <span style=\"color: red;\">color</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">black</span><span style=\"color: blue;\">&gt;</span>Ajouter<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">font</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">th</span><span style=\"color: blue;\">&gt;</span>\r\n          <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n         <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">thead</span><span style=\"color: blue;\">&gt;</span>\r\n     <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">tbody</span><span style=\"color: blue;\">&gt;</span>\r\n      <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n       <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span> <span style=\"color: red;\">align</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"center\"</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">input</span> <span style=\"color: red;\">name</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"Ajouter\"</span> <span style=\"color: red;\">align</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"center\"</span> <span style=\"color: red;\">align</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"center\"</span> <span style=\"color: red;\">type</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"checkbox\"</span> <span style=\"color: red;\">value</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"0\"</span> <span style=\"color: red;\">checked</span> <span style=\"color: red;\">id</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">$row</span> <span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">input</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n      <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n     &lt;!--more data rows as the excel file contains lines.. &gt;&gt;&gt;\r\n\r\n<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">tbody</span><span style=\"color: blue;\">&gt;</span>\r\n<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">table</span><span style=\"color: blue;\">&gt;</span>\r\n</pre>\r\n</div>\r\n<p>Does i have to get TH values for creating the excel file ?</p>\r\n<p>Thnaks for your help</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2011-12-02T01:42:05.187-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "706338",
    "ThreadId": "275807",
    "Html": "<p>Hello,</p>\r\n<p>I am very sorry i didn't see that these functions are declared in the end.</p>\r\n<p>I will try again, and sorry again.</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2011-12-02T02:01:00.123-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "706414",
    "ThreadId": "275807",
    "Html": "<p>Hello,</p>\r\n<p>I tested&nbsp;to print &nbsp;$_SESSION[<span style=\"color: #a31515;\">'tablecontents''</span>] and i get&nbsp; the content of my table=&gt; the table is not empty but when i run with generalexport it generate an empty Excel file&nbsp; &nbsp;:( :( :(&nbsp;.</p>\r\n<p>Also the two instructions below are not working :</p>\r\n<p>$objWriter-&gt;save($tfn);</p>\r\n<p>$objWriter-&gt;save('php://output');</p>\r\n<p>ofcourse i used one of them.</p>\r\n<p>I commented them in order to generate the excel file ( the result was empty excel file) if&nbsp; they are not commented the programm did not run i have an error look like that the web site could not open the page.</p>\r\n<p>Any idea please and thanks in advance for your help.</p>\r\n<p>BR,</p>\r\n<p>Kass34</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2011-12-02T04:58:40.74-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "706576",
    "ThreadId": "275807",
    "Html": "<p>Hello,</p>\r\n<p>I have another question please :</p>\r\n<p>In my table for each row the last colome is a checkbox. The code of the generaleexport return a NULL value for the check box ? why ?</p>\r\n<p>From the code of the generalexport how can i get the checkbox colom and how can i verify if it is checked or&nbsp; no ?</p>\r\n<p>I know it is not the purpose of the generalexport but i hope that you could help in this issue.</p>\r\n<p>Thanks in advance</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2011-12-02T09:58:05.47-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "707292",
    "ThreadId": "275807",
    "Html": "<p>Kass34, <br />generalexport will only export the original version of your table since you saved the HTML in the session variable right after you first generated it.&nbsp;</p>\r\n<p>The script does not maintain the session variable contents, it only uses the value.&nbsp;</p>\r\n<p>If you want to do other things to support dynamically updating the saved HTML as something changes in the table,&nbsp; you'd need to write a combination of javascript and PHP script to accomplish that.&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>I'm embedding a sample where I did that by using javascript and PHP.&nbsp; Within the generated table, I embedded DIVs with ID's.&nbsp; Then, I use SIMPLE_HTML_DOM to update values as they change in the table so</p>\r\n<p>when I export it, the latest HTML values are available in the session variable.&nbsp;</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre>&lt;?php\r\nsession_start();\r\nerror_reporting(E_ALL);\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">// Replace HTML ID element value</span>\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">// ID passed to this script is the ID of the HTML element so that innerHTML can be changed to the passed value</span>\r\n<span style=\"color: green;\">// VALUE passed to this script is the new value to replace the existing value within the HTML element</span>\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: blue;\">if</span>(<span style=\"color: blue;\">isset</span>($_GET[<span style=\"color: #a31515;\">'id'</span>])) {\r\n  $id = $_GET[<span style=\"color: #a31515;\">'id'</span>];\r\n}<span style=\"color: blue;\">else</span>{\r\n  <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"Missing ID parameter!\"</span>;      <span style=\"color: green;\">// can't do anything without ID</span>\r\n  <span style=\"color: blue;\">exit</span>;\r\n}\r\n<span style=\"color: blue;\">if</span>(<span style=\"color: blue;\">isset</span>($_GET[<span style=\"color: #a31515;\">'value'</span>])) {\r\n  $value = $_GET[<span style=\"color: #a31515;\">'value'</span>];           <span style=\"color: green;\">// ascii string with \\n for newline breaks</span>\r\n}<span style=\"color: blue;\">else</span>{\r\n  <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"Missing Value parameter!\"</span>;   <span style=\"color: green;\">// can't do anything without a value</span>\r\n  <span style=\"color: blue;\">exit</span>;\r\n}\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">// Using Simple HTML DOM, update the HTML element in the session table, then save the session table</span>\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: blue;\">include</span>(<span style=\"color: #a31515;\">'includes/simple_html_dom.php'</span>);                 <span style=\"color: green;\">// find this at  http://simplehtmldom.sourceforge.net/</span>\r\n$html = str_get_html($_SESSION[<span style=\"color: #a31515;\">'mysessionvarname'</span>]);     <span style=\"color: green;\">// get the table contents from the session variable</span>\r\n$valueexcel = str_ireplace(<span style=\"color: #a31515;\">\"\\n\"</span>, <span style=\"color: #a31515;\">\"&lt;br&gt;\"</span>, $value);        <span style=\"color: green;\">// replace line breaks \\n to HTML &lt;BR&gt;</span>\r\n$e = $html-&gt;find(<span style=\"color: #a31515;\">\"div[id=$id]\"</span>);                         <span style=\"color: green;\">// find the HTML element</span>\r\n<span style=\"color: blue;\">foreach</span>($e <span style=\"color: blue;\">as</span> $single_e){\r\n  <span style=\"color: blue;\">if</span>($single_e-&gt;id == $id) {                             <span style=\"color: green;\">// if we find our ID</span>\r\n    $single_e-&gt;innertext = $valueexcel;                  <span style=\"color: green;\">// replace the innerText (innerHTML) content with new value</span>\r\n    $_SESSION[<span style=\"color: #a31515;\">'mysessionvarname'</span>] = <span style=\"color: #a31515;\">\"\"</span>;                  <span style=\"color: green;\">// clear the session table value</span>\r\n    $_SESSION[<span style=\"color: #a31515;\">'mysessionvarname'</span>] = $html-&gt;save();       <span style=\"color: green;\">// now save updated HTML into the session table value</span>\r\n  }\r\n}\r\n$html-&gt;clear();                                          <span style=\"color: green;\">// Close and release resources</span>\r\n<span style=\"color: blue;\">unset</span>($html);\r\n<span style=\"color: green;\">// you could also update databases or other sources if needed while you have this data, or simply exit</span>\r\n?&gt;\r\nThe functions within generalexport only look for limited HTML or CSS attributes.&nbsp; You can write your own functions to look <br />for other attributes.&nbsp; For example, I see you use&nbsp;&nbsp;&nbsp;&lt;th&gt;&lt;font color=black&gt;Nom_S&lt;/font&gt;&lt;/th&gt;&nbsp;you could write your own function to look for FONT attributes.&nbsp;&nbsp;&nbsp;&nbsp;</pre>\r\n</div>",
    "PostedDate": "2011-12-04T15:13:43.613-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "707408",
    "ThreadId": "275807",
    "Html": "<div class=\"UserName\">Mamuscia,</div>\r\n<div class=\"UserName\">Thanks for this claridifcation.</div>\r\n<div class=\"UserName\">The big issue for me now is why the generalexportt.php generate an empty excel file and&nbsp;the two functions are not&nbsp;&nbsp;working :</div>\r\n<div class=\"UserName\">\r\n<p>$objWriter-&gt;save($tfn);</p>\r\n<p>$objWriter-&gt;save('php://output');</p>\r\n<p>I commented them in order to generate the excel file ( the result was empty excel file) if&nbsp; they are not commented the programm did not run i have an error look like that the web site could not open the page.</p>\r\n<p>P.S: i tried to generate excel file with the the original version of&nbsp; my table (i saved the HTML in the session variable right after&nbsp; i generate it).&nbsp;</p>\r\n<p>Any idea please and thanks in advance for your help</p>\r\n<p>Kass34</p>\r\n</div>",
    "PostedDate": "2011-12-05T00:56:29.227-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "707530",
    "ThreadId": "275807",
    "Html": "<p>Kass34,</p>\r\n<p>First of all, you should only be using one or the other of the save methods.&nbsp; Also note to use the lastest version of the generalexport script I posted above. It uses $fname, not $tfn to save</p>\r\n<p>the file to disk.&nbsp; Send me your table and let me test in my browser.</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2011-12-05T06:58:22.893-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "707657",
    "ThreadId": "275807",
    "Html": "<p>&nbsp;</p>\r\n<p>Mamuscia,</p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"font-size: x-small;\">\r\n<p>In fact the input is an excel file (see table in the end). From the excel file i generate my html table and i displayed it. The table is 9 coloms the las colum is a checkbox.</p>\r\n<p>My goal:</p>\r\n<p>By default all rows are checked. The user can choose to deselect a row.</p>\r\n<p>when the user click on the \"Submit\" we call the generalexport.php as you mentioned above. In addition, i tried to get just the rows with the checkbox is selected ( when we create the arrays i will not add all rows with deselected rows) and then to export an excel file about the lef rows (that mean to export an excel file with the selected rows). I DONT WANT TO CHANGE VALUES.</p>\r\n<p>Problems:</p>\r\n<p>1. I couldn't run the generalexport.php, i got errors when arriving to save method. In fact i tried the both way and i have the same thing. And when i comment the save command i got an empty excel file ???</p>\r\n<p>2. In the piece of program where i get the TD values, i tried to check if the checkbox is checked or not ? i succeed to get the attribute name , the id value but i didn't know how to check the status of the checkbox?</p>\r\n<p>Below you found the :</p>\r\n<p>1. piece of code that generate the HTML table</p>\r\n<p>2. piece of code (genrateexport.php) with some modifications</p>\r\n<p>3. an exemple of the contents of the input excel file</p>\r\n</span></p>\r\n<p>1&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre>&lt;html&gt;\r\n&lt;head&gt;\r\n    &lt;meta http-equiv=<span style=\"color: #a31515;\">\"content-type\"</span> content=<span style=\"color: #a31515;\">\"text/html; charset=iso-8859-1\"</span> /&gt;\r\n    &lt;title&gt;Tableau de voisngae 2G 2G&lt;/title&gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n\r\n&lt;?php\r\nsession_start();\r\nini_set(<span style=\"color: #a31515;\">'display_errors'</span>,1); \r\nerror_reporting(E_ALL);\r\n\r\n<span style=\"color: blue;\">require_once</span> <span style=\"color: #a31515;\">'PHPExcel/IOFactory.php'</span>;\r\n\r\n<span style=\"color: blue;\">function</span> printTable() {\r\n    $File_name = <span style=\"color: #a31515;\">\"2G2G12.xls\"</span>;\r\n    \r\n    $objPHPExcel = PHPExcel_IOFactory::load($File_name);\r\n\r\n    $part = '&lt;table id=<span style=\"color: #a31515;\">\"tableau\"</span> border=<span style=\"color: #a31515;\">\"1\"</span> align=<span style=\"color: #a31515;\">\"center\"</span>&gt;\r\n        &lt;thead&gt;\r\n          &lt;tr  BGCOLOR=FF6600&gt;\r\n              &lt;th&gt;&lt;font color=black&gt;Nom_S&lt;/font&gt;&lt;/th&gt;\r\n              &lt;th&gt;&lt;font color=black&gt;LAC_S&lt;/font&gt;&lt;/th&gt;\r\n              &lt;th&gt;&lt;font color=black&gt;CI_S&lt;/font&gt;&lt;/th&gt;\r\n              &lt;th&gt;&lt;font color=black&gt;Nom_V&lt;/font&gt;&lt;/th&gt;\r\n              &lt;th&gt;&lt;font color=black&gt;LAC_V&lt;/font&gt;&lt;/th&gt;\r\n              &lt;th&gt;&lt;font color=black&gt;CI_V&lt;/font&gt;&lt;/th&gt;\r\n              &lt;th&gt;&lt;font color=black&gt;Distance(Km)&lt;/th&gt;\r\n              &lt;th&gt;&lt;font color=black&gt;Plaque&lt;/font&gt;&lt;/th&gt;\r\n              &lt;th&gt;&lt;font color=black&gt;Ajouter&lt;/font&gt;&lt;/th&gt;\r\n          &lt;/tr&gt;\r\n         &lt;/thead&gt;\r\n\r\n         &lt;tbody&gt;';\r\n      <span style=\"color: blue;\">foreach</span> ($objPHPExcel-&gt;getWorksheetIterator() <span style=\"color: blue;\">as</span> $worksheet) {\r\n               $highestRow         = $worksheet-&gt;getHighestRow();\r\n               $highestColumn      = $worksheet-&gt;getHighestColumn();\r\n               $highestColumnIndex = PHPExcel_Cell::columnIndexFromString($highestColumn);\r\n               \r\n               <span style=\"color: blue;\">for</span> ($row = 2; $row &lt;= $highestRow; ++ $row) {\r\n                   \r\n                   $part .=<span style=\"color: #a31515;\">'&lt;tr&gt;'</span>;\r\n                  \r\n                   <span style=\"color: blue;\">for</span> ($col = 0; $col &lt; $highestColumnIndex; ++ $col) {\r\n                        \r\n                       $cell = $worksheet-&gt;getCellByColumnAndRow($col, $row);\r\n                       $val = $cell-&gt;getValue();\r\n                       $dataType = PHPExcel_Cell_DataType::dataTypeForValue($val);\r\n                       <span style=\"color: blue;\">if</span> ( $val == <span style=\"color: #a31515;\">\"A\"</span> ) {\r\n                          $part .=<span style=\"color: #a31515;\">'&lt;td align=\"center\"&gt;&lt;input name=\"Ajouter\" align=\"center\" align=\"center\" type=\"checkbox\" value=\"0\" checked id='</span>;\r\n                          $part .= $row ;\r\n                          $part .= <span style=\"color: #a31515;\">'&gt;&lt;/input&gt;&lt;/td&gt;'</span>;\r\n                       }\r\n                       <span style=\"color: blue;\">else</span> {\r\n                           $part .=<span style=\"color: #a31515;\">'&lt;td&gt;'</span>;\r\n                           $part.= $val;\r\n                           $part .=<span style=\"color: #a31515;\">'&lt;/td&gt;'</span>;\r\n                       }\r\n\r\n                   }\r\n                          \r\n                   $part .=<span style=\"color: #a31515;\">'&lt;/tr&gt;'</span>;\r\n               }\r\n               \r\n      }\r\n\r\n$part .= <span style=\"color: #a31515;\">\"&lt;/tbody&gt;&lt;/table&gt;\"</span>;\r\n<span style=\"color: blue;\">return</span> $part;\r\n}\r\n\r\n$chtml = <span style=\"color: #a31515;\">\"&lt;br /&gt;&lt;div style='height:26px;width:100px;border: solid gray 1px;background:#F5F5F5;padding-top:4px;'&gt;\\n\"</span>;\r\n$chtml .=  <span style=\"color: #a31515;\">\"&lt;a href='generalexport.php?var=tablecontents&amp;debug=false' title='Export table to Excel'&gt;&lt;img src='ajouter.gif' alt='Export table to Excel' hspace='3' /&gt;&lt;/a&gt;\\n\"</span>;\r\n$chtml .= <span style=\"color: #a31515;\">\"&lt;/div&gt;&lt;br /&gt;\\n\"</span>;\r\n\r\n$table = printTable();\r\n$_SESSION[<span style=\"color: #a31515;\">'tablecontents'</span>] = $table;\r\n\r\n<span style=\"color: blue;\">echo</span> $table;\r\n\r\n<span style=\"color: blue;\">echo</span> $chtml;\r\n\r\n?&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;</pre>\r\n<pre>1&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</pre>\r\n<pre>And here the generalexport i used ( in fact i modified some lines in order to run it in my envirronement) :</pre>\r\n<pre><div style=\"color: black; background-color: white;\"><div style=\"color: black; background-color: white;\"><pre>2&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</pre>\r\n<pre>&lt;?php\r\n\r\nsession_start();\r\nini_set(<span style=\"color: #a31515;\">\"memory_limit\"</span>, <span style=\"color: #a31515;\">\"-1\"</span>);\r\nini_set(<span style=\"color: #a31515;\">\"set_time_limit\"</span>, <span style=\"color: #a31515;\">\"0\"</span>);\r\nset_time_limit(0);\r\n\r\n<span style=\"color: blue;\">if</span>(!<span style=\"color: blue;\">isset</span>($_GET[<span style=\"color: #a31515;\">'limit'</span>])) {\r\n  $limit = 12;\r\n}<span style=\"color: blue;\">else</span>{\r\n  $limit = $_GET[<span style=\"color: #a31515;\">'limit'</span>];\r\n}\r\n<span style=\"color: blue;\">if</span>(!<span style=\"color: blue;\">isset</span>($_GET[<span style=\"color: #a31515;\">'debug'</span>])) {\r\n  $debug = false;\r\n}<span style=\"color: blue;\">else</span>{\r\n  $debug = true;\r\n  $handle = fopen(<span style=\"color: #a31515;\">\"/exec/users/orito_urso/www/exportlog.txt\"</span>, <span style=\"color: #a31515;\">\"w\"</span>); <span style=\"color: green;\">// i modified this line</span>\r\n  fwrite($handle, <span style=\"color: #a31515;\">\"\\nDebugging On...\"</span>);\r\n}\r\n\r\n<span style=\"color: blue;\">if</span>(!<span style=\"color: blue;\">isset</span>($_GET[<span style=\"color: #a31515;\">'var'</span>])) {\r\n  <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"&lt;br /&gt;No Table Variable Present, nothing to Export.\"</span>;\r\n  <span style=\"color: blue;\">exit</span>;\r\n}<span style=\"color: blue;\">else</span>{\r\n  $tablevar = $_GET[<span style=\"color: #a31515;\">'var'</span>];\r\n}\r\n\r\n<span style=\"color: blue;\">if</span>(!<span style=\"color: blue;\">isset</span>($_SESSION[$tablevar]) OR $_SESSION[$tablevar] == <span style=\"color: #a31515;\">''</span>) {\r\n  <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"&lt;br /&gt;Empty HTML Table, nothing to Export.\"</span>;\r\n  <span style=\"color: blue;\">exit</span>;\r\n}<span style=\"color: blue;\">else</span>{\r\n  $htmltable = $_SESSION[$tablevar];\r\n}\r\n<span style=\"color: blue;\">if</span>(strlen($htmltable) == strlen(strip_tags($htmltable)) ) {     <span style=\"color: green;\">// anything left after we strip HTML?</span>\r\n  <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"&lt;br /&gt;Invalid HTML Table after Stripping Tags, nothing to Export.\"</span>;\r\n  <span style=\"color: blue;\">exit</span>;\r\n}\r\n\r\n$htmltable = strip_tags($htmltable, <span style=\"color: #a31515;\">\"&lt;table&gt;&lt;tr&gt;&lt;th&gt;&lt;thead&gt;&lt;tbody&gt;&lt;tfoot&gt;&lt;td&gt;&lt;br&gt;&lt;b&gt;&lt;span&gt;&lt;input&gt;\"</span>);\r\n$htmltable = str_replace(<span style=\"color: #a31515;\">\"&lt;br /&gt;\"</span>, <span style=\"color: #a31515;\">\"\\n\"</span>, $htmltable);\r\n$htmltable = str_replace(<span style=\"color: #a31515;\">\"&lt;br/&gt;\"</span>, <span style=\"color: #a31515;\">\"\\n\"</span>, $htmltable);\r\n$htmltable = str_replace(<span style=\"color: #a31515;\">\"&lt;br&gt;\"</span>, <span style=\"color: #a31515;\">\"\\n\"</span>, $htmltable);\r\n$htmltable = str_replace(<span style=\"color: #a31515;\">\"&amp;nbsp;\"</span>, <span style=\"color: #a31515;\">\" \"</span>, $htmltable);\r\n$htmltable = str_replace(<span style=\"color: #a31515;\">\"\\n\\n\"</span>, <span style=\"color: #a31515;\">\"\\n\"</span>, $htmltable);\r\n\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">//  Create Document Object Model from HTML table contents</span>\r\n<span style=\"color: green;\">//</span>\r\n$dom = <span style=\"color: blue;\">new</span> domDocument;\r\n$dom-&gt;loadHTML($htmltable);\r\n<span style=\"color: blue;\">if</span>(!$dom) {\r\n  <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"&lt;br /&gt;Invalid HTML DOM, nothing to Export.\"</span>;\r\n  <span style=\"color: blue;\">exit</span>;\r\n}\r\n\r\n$dom-&gt;preserveWhiteSpace = false;             <span style=\"color: green;\">// remove redundant whitespace</span>\r\n$tables = $dom-&gt;getElementsByTagName(<span style=\"color: #a31515;\">'table'</span>);\r\n<span style=\"color: blue;\">if</span>(!is_object($tables)) {\r\n  <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"&lt;br /&gt;Invalid HTML Table DOM, nothing to Export.\"</span>;\r\n  <span style=\"color: blue;\">exit</span>;\r\n}\r\n\r\n<span style=\"color: blue;\">if</span>($tables-&gt;length &lt; 1) {\r\n  <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"&lt;br /&gt;DOM Table Count is \"</span>.$tables-&gt;length.<span style=\"color: #a31515;\">\", nothing to Export.\"</span>;\r\n  <span style=\"color: blue;\">exit</span>;\r\n}\r\n\r\n$tbcnt = $tables-&gt;length - 1;                 <span style=\"color: green;\">// count minus 1 for 0 indexed loop over tables</span>\r\n\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">// Create new PHPExcel object with default attributes</span>\r\n<span style=\"color: green;\">//</span>\r\n\r\n<span style=\"color: blue;\">require_once</span> (<span style=\"color: #a31515;\">'PHPExcel.php'</span>);\r\n$objPHPExcel = <span style=\"color: blue;\">new</span> PHPExcel();\r\n$objPHPExcel-&gt;getDefaultStyle()-&gt;getFont()-&gt;setName(<span style=\"color: #a31515;\">'Arial'</span>);\r\n$objPHPExcel-&gt;getDefaultStyle()-&gt;getFont()-&gt;setSize(9);\r\n\r\n$tm = date(YmdHis);\r\n$fname = <span style=\"color: #a31515;\">\"testprog.xls\"</span>;  <span style=\"color: green;\">// i modified this line</span>\r\n\r\n<span style=\"color: green;\">// i did modification here</span>\r\n$objPHPExcel-&gt;getProperties()-&gt;setCreator(<span style=\"color: #a31515;\">\"Maarten Balliauw\"</span>);\r\n$objPHPExcel-&gt;getProperties()-&gt;setLastModifiedBy(<span style=\"color: #a31515;\">\"Maarten Balliauw\"</span>);\r\n$objPHPExcel-&gt;getProperties()-&gt;setTitle(<span style=\"color: #a31515;\">\"Office 2007 XLSX Test Document\"</span>);\r\n$objPHPExcel-&gt;getProperties()-&gt;setSubject(<span style=\"color: #a31515;\">\"Office 2007 XLSX Test Document\"</span>);\r\n$objPHPExcel-&gt;getProperties()-&gt;setDescription(<span style=\"color: #a31515;\">\"Test document for Office 2007 XLSX, generated using PHP classes.\"</span>);\r\n$objPHPExcel-&gt;getProperties()-&gt;setKeywords(<span style=\"color: #a31515;\">\"Exported File\"</span>);\r\n$objPHPExcel-&gt;getProperties()-&gt;setCategory(<span style=\"color: #a31515;\">\"Export\"</span>);\r\n\r\n\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">// Loop over tables in DOM to create an array, each table becomes a worksheet</span>\r\n<span style=\"color: green;\">//</span>\r\n\r\n  <span style=\"color: blue;\">for</span>($z=0;$z&lt;=$tbcnt;$z++) {\r\n  $maxcols = 0;\r\n  $totrows = 0;\r\n  $headrows = <span style=\"color: blue;\">array</span>();\r\n  $bodyrows = <span style=\"color: blue;\">array</span>();\r\n  $r = 0;\r\n  $h = 0;\r\n  $rows = $tables-&gt;item($z)-&gt;getElementsByTagName(<span style=\"color: #a31515;\">'tr'</span>);\r\n  $totrows = $rows-&gt;length;\r\n  <span style=\"color: blue;\">if</span>($debug) {\r\n    fwrite($handle, <span style=\"color: #a31515;\">\"\\nTotal Rows: \"</span>.$totrows);\r\n  }\r\n\r\n           \r\n          <span style=\"color: green;\">//</span>\r\n          <span style=\"color: green;\">// Get TH values</span>\r\n          <span style=\"color: green;\">//</span>\r\n          <span style=\"color: blue;\">foreach</span> ($rows <span style=\"color: blue;\">as</span> $row) {\r\n                  $ths = $row-&gt;getElementsByTagName(<span style=\"color: #a31515;\">'th'</span>);\r\n                  <span style=\"color: blue;\">if</span>(is_object($ths)) {\r\n                     <span style=\"color: blue;\">if</span>($ths-&gt;length &gt; 0) {\r\n                         $headrows[$h][<span style=\"color: #a31515;\">'colcnt'</span>] = $ths-&gt;length;\r\n                         <span style=\"color: blue;\">if</span>($ths-&gt;length &gt; $maxcols) {\r\n                            $maxcols = $ths-&gt;length;\r\n                         }\r\n                         $nodes = $ths-&gt;length - 1; <span style=\"color: green;\">// - 1</span>\r\n                        \r\n                         <span style=\"color: blue;\">for</span>($x=0;$x&lt;=$nodes;$x++) {\r\n                            $thishdg = $ths-&gt;item($x)-&gt;nodeValue;\r\n\r\n                            $headrows[$h][<span style=\"color: #a31515;\">'th'</span>][] = $thishdg;\r\n                            $headrows[$h][<span style=\"color: #a31515;\">'bold'</span>][] = findBoldText(innerHTML($ths-&gt;item($x)));\r\n                            <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'style'</span>)) {\r\n                               $style = $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'style'</span>);\r\n                               $stylecolor = findStyleColor($style);\r\n                               <span style=\"color: blue;\">if</span>($stylecolor == <span style=\"color: #a31515;\">''</span>) {\r\n                                 $headrows[$h][<span style=\"color: #a31515;\">'color'</span>][] = findSpanColor(innerHTML($ths-&gt;item($x)));\r\n                               }<span style=\"color: blue;\">else</span> {\r\n                                 $headrows[$h][<span style=\"color: #a31515;\">'color'</span>][] = $stylecolor;\r\n                               }\r\n\r\n                            }<span style=\"color: blue;\">else</span> {\r\n                                 $headrows[$h][<span style=\"color: #a31515;\">'color'</span>][] = findSpanColor(innerHTML($ths-&gt;item($x)));\r\n\r\n                            }\r\n                            \r\n                            <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'colspan'</span>)) {\r\n                                  $headrows[$h][<span style=\"color: #a31515;\">'colspan'</span>][] = $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'colspan'</span>);\r\n                            }<span style=\"color: blue;\">else</span>{\r\n                                  $headrows[$h][<span style=\"color: #a31515;\">'colspan'</span>][] = 1;\r\n                            }  \r\n                            \r\n                            <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'align'</span>)) {\r\n                               $headrows[$h][<span style=\"color: #a31515;\">'align'</span>][] = $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'align'</span>);\r\n                            }<span style=\"color: blue;\">else</span>{\r\n                               $headrows[$h][<span style=\"color: #a31515;\">'align'</span>][] = <span style=\"color: #a31515;\">'left'</span>;\r\n                            }\r\n\r\n                            <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'valign'</span>)) {\r\n                               $headrows[$h][<span style=\"color: #a31515;\">'valign'</span>][] = $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'valign'</span>);\r\n                            }<span style=\"color: blue;\">else</span>{\r\n                               $headrows[$h][<span style=\"color: #a31515;\">'valign'</span>][] = <span style=\"color: #a31515;\">'top'</span>;\r\n                            }\r\n\r\n                            <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'bgcolor'</span>)) {\r\n                              $headrows[$h][<span style=\"color: #a31515;\">'bgcolor'</span>][] = str_replace(<span style=\"color: #a31515;\">\"#\"</span>, <span style=\"color: #a31515;\">\"\"</span>, $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'bgcolor'</span>));\r\n                            }<span style=\"color: blue;\">else</span>{\r\n                              $headrows[$h][<span style=\"color: #a31515;\">'bgcolor'</span>][] = <span style=\"color: #a31515;\">'FFFFFF'</span>;\r\n                            }\r\n                                                       \r\n                         }\r\n                         $h++;\r\n                     }\r\n                  }\r\n          } <span style=\"color: green;\">// TH values      </span>\r\n  }\r\n  \r\n\r\n            <span style=\"color: green;\">//</span>\r\n            <span style=\"color: green;\">// Get TD values</span>\r\n            <span style=\"color: green;\">//</span>\r\n            <span style=\"color: blue;\">foreach</span> ($rows <span style=\"color: blue;\">as</span> $row) {\r\n                  \r\n                 $tds = $row-&gt;getElementsByTagName(<span style=\"color: #a31515;\">'td'</span>);\r\n                 <span style=\"color: blue;\">if</span>(is_object($tds)) {\r\n                   <span style=\"color: blue;\">if</span>($tds-&gt;length &gt; 0) {\r\n                     $bodyrows[$r][<span style=\"color: #a31515;\">'colcnt'</span>] = $tds-&gt;length;\r\n                     <span style=\"color: blue;\">if</span>($tds-&gt;length &gt; $maxcols) {\r\n                        $maxcols = $tds-&gt;length;\r\n                     }\r\n                     $nodes = $tds-&gt;length - 1;\r\n                     <span style=\"color: blue;\">for</span>($x=0;$x&lt;=$nodes;$x++) {\r\n                        $thistxt = $tds-&gt;item($x)-&gt;nodeValue;\r\n                     <span style=\"color: green;\">// i added this lines in order to check if the checkbox is checked or not</span>\r\n\t\t\t     <span style=\"color: blue;\">if</span>($x == $nodes) {\r\n                        $tinputs = $row-&gt;getElementsByTagName(<span style=\"color: #a31515;\">'input'</span>);\r\n                        $len = $tinputs-&gt;length;\r\n                         fwrite($handle, <span style=\"color: #a31515;\">\"\\n len: \"</span>.$len);\r\n                        <span style=\"color: blue;\">if</span>(is_object($tds)) {\r\n                            $valueID = $tinputs-&gt;item(0)-&gt;nodeName;\r\n                            fwrite($handle, <span style=\"color: #a31515;\">\"\\n ValueID: \"</span>.$valueID);\r\n                            $attributeid = $tinputs-&gt;item(0)-&gt;getAttribute(<span style=\"color: #a31515;\">'id'</span>);\r\n                            $attributename = $tinputs-&gt;item(0)-&gt;getAttribute(<span style=\"color: #a31515;\">'name'</span>);\r\n                            fwrite($handle, <span style=\"color: #a31515;\">\"\\n Attributes_name: \"</span>.$attributename);\r\n                            fwrite($handle, <span style=\"color: #a31515;\">\"\\n Attributes_id: \"</span>.$attributeid);\r\n                        }\r\n                    }    \r\n                        <span style=\"color: blue;\">if</span>($debug){\r\n\r\n                            fwrite($handle, <span style=\"color: #a31515;\">\"\\n cellValue: \"</span>.$thistxt);\r\n                        } \r\n                        $bodyrows[$r][<span style=\"color: #a31515;\">'td'</span>][] = $thistxt;\r\n                        $bodyrows[$r][<span style=\"color: #a31515;\">'bold'</span>][] = findBoldText(innerHTML($tds-&gt;item($x)));\r\n                        <span style=\"color: blue;\">if</span>($tds-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'style'</span>)) {\r\n                          $style = $tds-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'style'</span>);\r\n                          $stylecolor = findStyleColor($style);\r\n                          <span style=\"color: blue;\">if</span>($stylecolor == <span style=\"color: #a31515;\">''</span>) {\r\n                                $bodyrows[$r][<span style=\"color: #a31515;\">'color'</span>][] = findSpanColor(innerHTML($tds-&gt;item($x)));\r\n                          }<span style=\"color: blue;\">else</span>{\r\n                               $bodyrows[$r][<span style=\"color: #a31515;\">'color'</span>][] = $stylecolor;\r\n                          }\r\n                          }<span style=\"color: blue;\">else</span>{\r\n                               $bodyrows[$r][<span style=\"color: #a31515;\">'color'</span>][] = findSpanColor(innerHTML($tds-&gt;item($x)));\r\n                          }\r\n                          <span style=\"color: blue;\">if</span>($tds-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'colspan'</span>)) {\r\n                            $bodyrows[$r][<span style=\"color: #a31515;\">'colspan'</span>][] = $tds-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'colspan'</span>);\r\n                          }<span style=\"color: blue;\">else</span>{\r\n                            $bodyrows[$r][<span style=\"color: #a31515;\">'colspan'</span>][] = 1;\r\n                          }\r\n                          <span style=\"color: blue;\">if</span>($tds-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'align'</span>)) {\r\n                            $bodyrows[$r][<span style=\"color: #a31515;\">'align'</span>][] = $tds-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'align'</span>);\r\n                          }<span style=\"color: blue;\">else</span>{\r\n                            $bodyrows[$r][<span style=\"color: #a31515;\">'align'</span>][] = <span style=\"color: #a31515;\">'left'</span>;\r\n                          }\r\n                          <span style=\"color: blue;\">if</span>($tds-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'valign'</span>)) {\r\n                             $bodyrows[$r][<span style=\"color: #a31515;\">'valign'</span>][] = $tds-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'valign'</span>);\r\n                          }<span style=\"color: blue;\">else</span>{\r\n                             $bodyrows[$r][<span style=\"color: #a31515;\">'valign'</span>][] = <span style=\"color: #a31515;\">'top'</span>;\r\n                          }\r\n                          <span style=\"color: blue;\">if</span>($tds-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'bgcolor'</span>)) {\r\n                             $bodyrows[$r][<span style=\"color: #a31515;\">'bgcolor'</span>][] = str_replace(<span style=\"color: #a31515;\">\"#\"</span>, <span style=\"color: #a31515;\">\"\"</span>, $tds-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'bgcolor'</span>));\r\n                          }<span style=\"color: blue;\">else</span>{\r\n                             $bodyrows[$r][<span style=\"color: #a31515;\">'bgcolor'</span>][] = <span style=\"color: #a31515;\">'FFFFFF'</span>;\r\n                          }\r\n                      }\r\n                 $r++;\r\n                }\r\n              }\r\n     \r\n\r\n          }<span style=\"color: green;\">// Get TD values</span>\r\n\r\n  <span style=\"color: blue;\">if</span>($z &gt; 0) {\r\n      $objPHPExcel-&gt;createSheet($z);\r\n  }\r\n         \r\n  $suf = $z + 1;\r\n  $tableid = $tablevar.$suf;\r\n  $wksheetname = ucfirst($tableid);\r\n  $objPHPExcel-&gt;setActiveSheetIndex($z);                      <span style=\"color: green;\">// each sheet corresponds to a table in html</span>\r\n  $objPHPExcel-&gt;getActiveSheet()-&gt;setTitle($wksheetname);     <span style=\"color: green;\">// tab name</span>\r\n  $worksheet = $objPHPExcel-&gt;getActiveSheet();                <span style=\"color: green;\">// set worksheet we're working on</span>\r\n\r\n  $style_overlay = <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'font'</span> =&gt;\r\n                    <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'color'</span> =&gt;\r\n                      <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'rgb'</span> =&gt; <span style=\"color: #a31515;\">'000000'</span>),<span style=\"color: #a31515;\">'bold'</span> =&gt; false,),\r\n                          <span style=\"color: #a31515;\">'fill'</span> \t=&gt;\r\n                              <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'type'</span> =&gt; PHPExcel_Style_Fill::FILL_SOLID, <span style=\"color: #a31515;\">'color'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'rgb'</span> =&gt; <span style=\"color: #a31515;\">'CCCCFF'</span>)),\r\n                          <span style=\"color: #a31515;\">'alignment'</span> =&gt;\r\n                              <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'wrap'</span> =&gt; true, <span style=\"color: #a31515;\">'horizontal'</span> =&gt; PHPExcel_Style_Alignment::HORIZONTAL_CENTER,\r\n                                         <span style=\"color: #a31515;\">'vertical'</span> =&gt; PHPExcel_Style_Alignment::VERTICAL_TOP),\r\n                          <span style=\"color: #a31515;\">'borders'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'top'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),\r\n                                             <span style=\"color: #a31515;\">'bottom'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),\r\n                                             <span style=\"color: #a31515;\">'left'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),\r\n                                             <span style=\"color: #a31515;\">'right'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN)),\r\n                       );\r\n  $xcol = <span style=\"color: #a31515;\">''</span>;\r\n  $xrow = 1;\r\n  $usedhdrows = 0;\r\n  $heightvars = <span style=\"color: blue;\">array</span>(1=&gt;<span style=\"color: #a31515;\">'42'</span>, 2=&gt;<span style=\"color: #a31515;\">'42'</span>, 3=&gt;<span style=\"color: #a31515;\">'48'</span>, 4=&gt;<span style=\"color: #a31515;\">'52'</span>, 5=&gt;<span style=\"color: #a31515;\">'58'</span>, 6=&gt;<span style=\"color: #a31515;\">'64'</span>, 7=&gt;<span style=\"color: #a31515;\">'68'</span>, 8=&gt;<span style=\"color: #a31515;\">'76'</span>, 9=&gt;<span style=\"color: #a31515;\">'82'</span>);\r\n\r\n  <span style=\"color: blue;\">for</span>($h=0;$h&lt;count($headrows);$h++) {\r\n\r\n    $th = $headrows[$h][<span style=\"color: #a31515;\">'th'</span>];\r\n    $colspans = $headrows[$h][<span style=\"color: #a31515;\">'colspan'</span>];\r\n    $aligns = $headrows[$h][<span style=\"color: #a31515;\">'align'</span>];\r\n    $valigns = $headrows[$h][<span style=\"color: #a31515;\">'valign'</span>];\r\n    $bgcolors = $headrows[$h][<span style=\"color: #a31515;\">'bgcolor'</span>];\r\n    $colcnt = $headrows[$h][<span style=\"color: #a31515;\">'colcnt'</span>];\r\n    $colors = $headrows[$h][<span style=\"color: #a31515;\">'color'</span>];\r\n    $bolds = $headrows[$h][<span style=\"color: #a31515;\">'bold'</span>];\r\n    $usedhdrows++;\r\n    $mergedcells = false;\r\n   \r\n    <span style=\"color: blue;\">for</span>($t=0;$t&lt;count($th);$t++) {\r\n        \r\n      <span style=\"color: blue;\">if</span>($xcol == <span style=\"color: #a31515;\">''</span>) {$xcol = <span style=\"color: #a31515;\">'A'</span>;}<span style=\"color: blue;\">else</span>{$xcol++;}\r\n      $thishdg = $th[$t];\r\n      $thisalign = $aligns[$t];\r\n      $thisvalign = $valigns[$t];\r\n      $thiscolspan = $colspans[$t];\r\n      $thiscolor = $colors[$t];\r\n      $thisbg = $bgcolors[$t];\r\n      $thisbold = $bolds[$t];\r\n      $strbold = ($thisbold==true) ? <span style=\"color: #a31515;\">'true'</span> : <span style=\"color: #a31515;\">'false'</span>;\r\n      <span style=\"color: blue;\">if</span>($thisbg == <span style=\"color: #a31515;\">'FFFFFF'</span>) {\r\n        $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'type'</span>] = PHPExcel_Style_Fill::FILL_NONE;\r\n      }<span style=\"color: blue;\">else</span>{\r\n        $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'type'</span>] = PHPExcel_Style_Fill::FILL_SOLID;\r\n      }\r\n      $style_overlay[<span style=\"color: #a31515;\">'alignment'</span>][<span style=\"color: #a31515;\">'vertical'</span>] = $thisvalign;              <span style=\"color: green;\">// set styles for cell</span>\r\n      $style_overlay[<span style=\"color: #a31515;\">'alignment'</span>][<span style=\"color: #a31515;\">'horizontal'</span>] = $thisalign;\r\n      $style_overlay[<span style=\"color: #a31515;\">'font'</span>][<span style=\"color: #a31515;\">'color'</span>][<span style=\"color: #a31515;\">'rgb'</span>] = $thiscolor;\r\n      $style_overlay[<span style=\"color: #a31515;\">'font'</span>][<span style=\"color: #a31515;\">'bold'</span>] = $thisbold;\r\n      $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'color'</span>][<span style=\"color: #a31515;\">'rgb'</span>] = $thisbg;\r\n      \r\n      <span style=\"color: blue;\">if</span>($thiscolspan &gt; 1) {                                                <span style=\"color: green;\">// spans more than 1 column</span>\r\n        $mergedcells = true;\r\n        $lastxcol = $xcol;\r\n        <span style=\"color: blue;\">for</span>($j=1;$j&lt;$thiscolspan;$j++) {                                    <span style=\"color: green;\">// count to last column in span</span>\r\n          $lastxcol++;\r\n        }\r\n        $cellRange = $xcol.$xrow.<span style=\"color: #a31515;\">':'</span>.$lastxcol.$xrow;\r\n        <span style=\"color: blue;\">if</span>($debug) {\r\n          fwrite($handle, <span style=\"color: #a31515;\">\"\\nmergeCells: \"</span>.$xcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow.<span style=\"color: #a31515;\">\" \"</span>.$lastxcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow);\r\n        }\r\n        $worksheet-&gt;mergeCells($cellRange);                                <span style=\"color: green;\">// merge the columns</span>\r\n        $worksheet-&gt;setCellValue($xcol.$xrow, $thishdg);\r\n        $worksheet-&gt;getStyle($cellRange)-&gt;applyFromArray($style_overlay);\r\n        $worksheet-&gt;getStyle($cellRange)-&gt;getAlignment()-&gt;setWrapText(true);\r\n        $num_newlines = substr_count($thishdg, <span style=\"color: #a31515;\">\"\\n\"</span>);\r\n        <span style=\"color: blue;\">if</span>($num_newlines &gt; 1) {\r\n          $rowheight = $heightvars[1];                                      <span style=\"color: green;\">// default to 42</span>\r\n          <span style=\"color: blue;\">if</span>(array_key_exists($num_newlines, $heightvars)) {                <span style=\"color: green;\">// I couldn't find a PHPExcel method</span>\r\n            $rowheight = $heightvars[$num_newlines];                        <span style=\"color: green;\">// to do this, so I look to see how</span>\r\n          }<span style=\"color: blue;\">else</span>{                                                            <span style=\"color: green;\">// many newlines and just guess at</span>\r\n            $rowheight = 75;                                                <span style=\"color: green;\">// row height</span>\r\n          }\r\n          $worksheet-&gt;getRowDimension($xrow)-&gt;setRowHeight($rowheight);     <span style=\"color: green;\">// adjust heading row height</span>\r\n          <span style=\"color: green;\">//$worksheet-&gt;getRowDimension($xrow)-&gt;setRowHeight(-1);           // this doesn't work in PHPExcel</span>\r\n        }\r\n        <span style=\"color: blue;\">if</span>($debug) {\r\n          fwrite($handle, <span style=\"color: #a31515;\">\"\\n\"</span>.$cellRange.<span style=\"color: #a31515;\">\" ColSpan:\"</span>.$thiscolspan.<span style=\"color: #a31515;\">\" Color:\"</span>.$thiscolor.<span style=\"color: #a31515;\">\" Align:\"</span>.$thisalign.<span style=\"color: #a31515;\">\" VAlign:\"</span>.$thisvalign.<span style=\"color: #a31515;\">\" BGColor:\"</span>.$thisbg.<span style=\"color: #a31515;\">\" Bold:\"</span>.$strbold.<span style=\"color: #a31515;\">\" cellValue: \"</span>.$thishdg);\r\n        }\r\n        $xcol = $lastxcol;\r\n\r\n\r\n\r\n    }<span style=\"color: blue;\">else</span>{\r\n      \r\n        $worksheet-&gt;setCellValue($xcol.$xrow, $thishdg);\r\n        $worksheet-&gt;getStyle($xcol.$xrow)-&gt;applyFromArray($style_overlay);\r\n        <span style=\"color: blue;\">if</span>($debug) {\r\n          fwrite($handle, <span style=\"color: #a31515;\">\"\\n\"</span>.$xcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow.<span style=\"color: #a31515;\">\" ColSpan:\"</span>.$thiscolspan.<span style=\"color: #a31515;\">\" Color:\"</span>.$thiscolor.<span style=\"color: #a31515;\">\" Align:\"</span>.$thisalign.<span style=\"color: #a31515;\">\" VAlign:\"</span>.$thisvalign.<span style=\"color: #a31515;\">\" BGColor:\"</span>.$thisbg.<span style=\"color: #a31515;\">\" Bold:\"</span>.$strbold.<span style=\"color: #a31515;\">\" cellValue: \"</span>.$thishdg);\r\n        }\r\n\r\n    }\r\n\r\n  }\r\n  $xrow++;\r\n  $xcol = <span style=\"color: #a31515;\">''</span>;\r\n\r\n}\r\n  <span style=\"color: green;\">//Put an auto filter on last row of heading only if last row was not merged</span>\r\n  <span style=\"color: blue;\">if</span>(!$mergedcells) {\r\n    $worksheet-&gt;setAutoFilter(<span style=\"color: #a31515;\">\"A$usedhdrows:\"</span> . $worksheet-&gt;getHighestColumn() . $worksheet-&gt;getHighestRow() );\r\n  }\r\n  <span style=\"color: blue;\">if</span>($debug) {\r\n    fwrite($handle, <span style=\"color: #a31515;\">\"\\nautoFilter: A\"</span>.$usedhdrows.<span style=\"color: #a31515;\">\":\"</span>.$worksheet-&gt;getHighestColumn().$worksheet-&gt;getHighestRow());\r\n  }\r\n  <span style=\"color: green;\">// Freeze heading lines starting after heading lines</span>\r\n  $usedhdrows++;\r\n  $worksheet-&gt;freezePane(<span style=\"color: #a31515;\">\"A$usedhdrows\"</span>);\r\n  <span style=\"color: blue;\">if</span>($debug) {\r\n    fwrite($handle, <span style=\"color: #a31515;\">\"\\nfreezePane: A\"</span>.$usedhdrows);\r\n  }\r\n\r\n  <span style=\"color: green;\">//</span>\r\n  <span style=\"color: green;\">// Loop thru data rows and write them out</span>\r\n  <span style=\"color: green;\">//</span>\r\n    $xcol = <span style=\"color: #a31515;\">''</span>;\r\n  $xrow = $usedhdrows;\r\n  <span style=\"color: blue;\">for</span>($b=0;$b&lt;count($bodyrows);$b++) {\r\n    $td = $bodyrows[$b][<span style=\"color: #a31515;\">'td'</span>];\r\n    $colcnt = $bodyrows[$b][<span style=\"color: #a31515;\">'colcnt'</span>];\r\n    $colspans = $bodyrows[$b][<span style=\"color: #a31515;\">'colspan'</span>];\r\n    $aligns = $bodyrows[$b][<span style=\"color: #a31515;\">'align'</span>];\r\n    $valigns = $bodyrows[$b][<span style=\"color: #a31515;\">'valign'</span>];\r\n    $bgcolors = $bodyrows[$b][<span style=\"color: #a31515;\">'bgcolor'</span>];\r\n    $colors = $bodyrows[$b][<span style=\"color: #a31515;\">'color'</span>];\r\n    $bolds = $bodyrows[$b][<span style=\"color: #a31515;\">'bold'</span>];\r\n    <span style=\"color: blue;\">for</span>($t=0;$t&lt;count($td);$t++) {\r\n      <span style=\"color: blue;\">if</span>($xcol == <span style=\"color: #a31515;\">''</span>) {$xcol = <span style=\"color: #a31515;\">'A'</span>;}<span style=\"color: blue;\">else</span>{$xcol++;}\r\n      $thistext = $td[$t];\r\n      $thisalign = $aligns[$t];\r\n      $thisvalign = $valigns[$t];\r\n      $thiscolspan = $colspans[$t];\r\n      $thiscolor = $colors[$t];\r\n      $thisbg = $bgcolors[$t];\r\n      $thisbold = $bolds[$t];\r\n      $strbold = ($thisbold==true) ? <span style=\"color: #a31515;\">'true'</span> : <span style=\"color: #a31515;\">'false'</span>;\r\n      <span style=\"color: blue;\">if</span>($thisbg == <span style=\"color: #a31515;\">'FFFFFF'</span>) {\r\n        $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'type'</span>] = PHPExcel_Style_Fill::FILL_NONE;\r\n      }<span style=\"color: blue;\">else</span>{\r\n        $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'type'</span>] = PHPExcel_Style_Fill::FILL_SOLID;\r\n      }\r\n      $style_overlay[<span style=\"color: #a31515;\">'alignment'</span>][<span style=\"color: #a31515;\">'vertical'</span>] = $thisvalign;              <span style=\"color: green;\">// set styles for cell</span>\r\n      $style_overlay[<span style=\"color: #a31515;\">'alignment'</span>][<span style=\"color: #a31515;\">'horizontal'</span>] = $thisalign;\r\n      $style_overlay[<span style=\"color: #a31515;\">'font'</span>][<span style=\"color: #a31515;\">'color'</span>][<span style=\"color: #a31515;\">'rgb'</span>] = $thiscolor;\r\n      $style_overlay[<span style=\"color: #a31515;\">'font'</span>][<span style=\"color: #a31515;\">'bold'</span>] = $thisbold;\r\n      $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'color'</span>][<span style=\"color: #a31515;\">'rgb'</span>] = $thisbg;\r\n      <span style=\"color: blue;\">if</span>($thiscolspan &gt; 1) {                                              <span style=\"color: green;\">// spans more than 1 column</span>\r\n        $lastxcol = $xcol;\r\n        <span style=\"color: blue;\">for</span>($j=1;$j&lt;$thiscolspan;$j++) {                                  <span style=\"color: green;\">// count spanned columns</span>\r\n          $lastxcol++;\r\n        }\r\n        $cellRange = $xcol.$xrow.<span style=\"color: #a31515;\">':'</span>.$lastxcol.$xrow;\r\n        <span style=\"color: blue;\">if</span>($debug) {\r\n          fwrite($handle, <span style=\"color: #a31515;\">\"\\nmergeCells: \"</span>.$xcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow.<span style=\"color: #a31515;\">\" \"</span>.$lastxcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow);\r\n        }\r\n        $worksheet-&gt;mergeCells($cellRange);                               <span style=\"color: green;\">// merge columns in span</span>\r\n        $worksheet-&gt;setCellValue($xcol.$xrow, $thistext);\r\n        $worksheet-&gt;getStyle($cellRange)-&gt;applyFromArray($style_overlay);\r\n        $worksheet-&gt;getStyle($cellRange)-&gt;getAlignment()-&gt;setWrapText(true);\r\n        $num_newlines = substr_count($thistext, <span style=\"color: #a31515;\">\"\\n\"</span>);                       <span style=\"color: green;\">// count number of newline chars</span>\r\n        <span style=\"color: blue;\">if</span>($num_newlines &gt; 1) {\r\n          $rowheight = $heightvars[1];                                      <span style=\"color: green;\">// default to 42</span>\r\n          <span style=\"color: blue;\">if</span>(array_key_exists($num_newlines, $heightvars)) {                <span style=\"color: green;\">// I could not find a method in PHPExcel</span>\r\n            $rowheight = $heightvars[$num_newlines];                        <span style=\"color: green;\">// that would set row height automatically</span>\r\n          }<span style=\"color: blue;\">else</span>{                                                            <span style=\"color: green;\">// based on content, so I guess based</span>\r\n            $rowheight = 75;                                                <span style=\"color: green;\">// on number of newlines in the content</span>\r\n          }\r\n          $worksheet-&gt;getRowDimension($xrow)-&gt;setRowHeight($rowheight);     <span style=\"color: green;\">// adjust heading row height</span>\r\n          <span style=\"color: green;\">//$worksheet-&gt;getRowDimension($xrow)-&gt;setRowHeight(-1);           // this doesn't work in PHPExcel</span>\r\n        }\r\n        <span style=\"color: blue;\">if</span>($debug) {\r\n          fwrite($handle, <span style=\"color: #a31515;\">\"\\n\"</span>.$cellRange.<span style=\"color: #a31515;\">\" ColSpan:\"</span>.$thiscolspan.<span style=\"color: #a31515;\">\" Color:\"</span>.$thiscolor.<span style=\"color: #a31515;\">\" Align:\"</span>.$thisalign.<span style=\"color: #a31515;\">\" VAlign:\"</span>.$thisvalign.<span style=\"color: #a31515;\">\" BGColor:\"</span>.$thisbg.<span style=\"color: #a31515;\">\" Bold:\"</span>.$strbold.<span style=\"color: #a31515;\">\" cellValue: \"</span>.$thistext);\r\n        }\r\n        <span style=\"color: green;\">//$worksheet-&gt;getRowDimension($xrow)-&gt;setRowHeight(-1);</span>\r\n        $xcol = $lastxcol;\r\n      }<span style=\"color: blue;\">else</span>{\r\n        $worksheet-&gt;getColumnDimension($xcol)-&gt;setWidth(25);                <span style=\"color: green;\">// default width</span>\r\n        $worksheet-&gt;setCellValue($xcol.$xrow, $thistext);\r\n        $worksheet-&gt;getStyle($xcol.$xrow)-&gt;applyFromArray($style_overlay);\r\n        <span style=\"color: blue;\">if</span>($debug) {\r\n          fwrite($handle, <span style=\"color: #a31515;\">\"\\n\"</span>.$xcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow.<span style=\"color: #a31515;\">\" ColSpan:\"</span>.$thiscolspan.<span style=\"color: #a31515;\">\" Color:\"</span>.$thiscolor.<span style=\"color: #a31515;\">\" Align:\"</span>.$thisalign.<span style=\"color: #a31515;\">\" VAlign:\"</span>.$thisvalign.<span style=\"color: #a31515;\">\" BGColor:\"</span>.$thisbg.<span style=\"color: #a31515;\">\" Bold:\"</span>.$strbold.<span style=\"color: #a31515;\">\" cellValue: \"</span>.$thistext);\r\n        }\r\n      }\r\n    }\r\n    $xrow++;\r\n    $xcol = <span style=\"color: #a31515;\">''</span>;\r\n  }\r\n\r\n  <span style=\"color: green;\">// autosize columns to fit data</span>\r\n  $azcol = <span style=\"color: #a31515;\">'A'</span>;\r\n  <span style=\"color: blue;\">for</span>($x=1;$x==$maxcols;$x++) {\r\n    $worksheet-&gt;getColumnDimension($azcol)-&gt;setAutoSize(true);\r\n    $azcol++;\r\n  }\r\n  <span style=\"color: blue;\">if</span>($debug) {\r\n    fwrite($handle, <span style=\"color: #a31515;\">\"\\nHEADROWS: \"</span>.print_r($headrows, true));\r\n    fwrite($handle, <span style=\"color: #a31515;\">\"\\nBODYROWS: \"</span>.print_r($bodyrows, true));\r\n  }\r\n\r\n <span style=\"color: green;\">// end for over tables </span>\r\n\r\n$objPHPExcel-&gt;setActiveSheetIndex(0);                      <span style=\"color: green;\">// set to first worksheet before close</span>\r\n\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">// Write to Browser</span>\r\n<span style=\"color: green;\">//</span>\r\n\r\n<span style=\"color: blue;\">if</span>($debug) {\r\n  <span style=\"color: blue;\">fclose</span>($handle);\r\n}\r\n\r\nheader(<span style=\"color: #a31515;\">'Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'</span>);\r\nheader(<span style=\"color: #a31515;\">\"Content-Disposition: attachment;filename=$fname\"</span>);\r\nheader(<span style=\"color: #a31515;\">'Cache-Control: max-age=0'</span>);\r\n\r\n$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color: #a31515;\">'Excel2007'</span>);\r\n<span style=\"color: green;\">//$objWriter-&gt;save($fname);</span>\r\n\r\n$objWriter-&gt;save(<span style=\"color: #a31515;\">'php://output'</span>);\r\n\r\n<span style=\"color: blue;\">exit</span>;\r\n\r\n\r\n<span style=\"color: blue;\">function</span> innerHTML($node) {\r\n  $doc = $node-&gt;ownerDocument;\r\n  $frag = $doc-&gt;createDocumentFragment();\r\n  <span style=\"color: blue;\">foreach</span> ($node-&gt;childNodes <span style=\"color: blue;\">as</span> $child) {\r\n    $frag-&gt;appendChild($child-&gt;cloneNode(TRUE));\r\n  }\r\n  <span style=\"color: blue;\">return</span> $doc-&gt;saveXML($frag);\r\n}\r\n<span style=\"color: blue;\">function</span> findSpanColor($node) {\r\n  $pos = stripos($node, <span style=\"color: #a31515;\">\"color:\"</span>);       <span style=\"color: green;\">// ie: looking for style='color: #FF0000;'</span>\r\n  <span style=\"color: blue;\">if</span> ($pos === false) {                  <span style=\"color: green;\">//                        12345678911111</span>\r\n    <span style=\"color: blue;\">return</span> <span style=\"color: #a31515;\">'000000'</span>;                     <span style=\"color: green;\">//                                 01234</span>\r\n  }\r\n  $node = substr($node, $pos);           <span style=\"color: green;\">// truncate to color: start</span>\r\n  $start = <span style=\"color: #a31515;\">\"#\"</span>;                          <span style=\"color: green;\">// looking for html color string</span>\r\n  $end = <span style=\"color: #a31515;\">\";\"</span>;                            <span style=\"color: green;\">// should end with semicolon</span>\r\n  $node = <span style=\"color: #a31515;\">\" \"</span>.$node;                     <span style=\"color: green;\">// prefix node with blank</span>\r\n\t$ini = stripos($node,$start);          <span style=\"color: green;\">// look for #</span>\r\n\t<span style=\"color: blue;\">if</span> ($ini === false) <span style=\"color: blue;\">return</span> <span style=\"color: #a31515;\">\"000000\"</span>;   <span style=\"color: green;\">// not found, return default color of black</span>\r\n\t$ini += strlen($start);                <span style=\"color: green;\">// get 1 byte past start string</span>\r\n\t$len = stripos($node,$end,$ini) - $ini; <span style=\"color: green;\">// grab substr between start and end positions</span>\r\n\t<span style=\"color: blue;\">return</span> substr($node,$ini,$len);        <span style=\"color: green;\">// return the RGB color without # sign</span>\r\n}\r\n<span style=\"color: blue;\">function</span> findStyleColor($style) {\r\n  $pos = stripos($style, <span style=\"color: #a31515;\">\"color:\"</span>);      <span style=\"color: green;\">// ie: looking for style='color: #FF0000;'</span>\r\n  <span style=\"color: blue;\">if</span> ($pos === false) {                  <span style=\"color: green;\">//                        12345678911111</span>\r\n    <span style=\"color: blue;\">return</span> <span style=\"color: #a31515;\">''</span>;                           <span style=\"color: green;\">//                                 01234</span>\r\n  }\r\n  $style = substr($style, $pos);           <span style=\"color: green;\">// truncate to color: start</span>\r\n  $start = <span style=\"color: #a31515;\">\"#\"</span>;                          <span style=\"color: green;\">// looking for html color string</span>\r\n  $end = <span style=\"color: #a31515;\">\";\"</span>;                            <span style=\"color: green;\">// should end with semicolon</span>\r\n  $style = <span style=\"color: #a31515;\">\" \"</span>.$style;                     <span style=\"color: green;\">// prefix node with blank</span>\r\n\t$ini = stripos($style,$start);          <span style=\"color: green;\">// look for #</span>\r\n\t<span style=\"color: blue;\">if</span> ($ini === false) <span style=\"color: blue;\">return</span> <span style=\"color: #a31515;\">\"\"</span>;         <span style=\"color: green;\">// not found, return default color of black</span>\r\n\t$ini += strlen($start);                <span style=\"color: green;\">// get 1 byte past start string</span>\r\n\t$len = stripos($style,$end,$ini) - $ini; <span style=\"color: green;\">// grab substr between start and end positions</span>\r\n\t<span style=\"color: blue;\">return</span> substr($style,$ini,$len);        <span style=\"color: green;\">// return the RGB color without # sign</span>\r\n}\r\n<span style=\"color: blue;\">function</span> findBoldText($node) {\r\n  $pos = stripos($node, <span style=\"color: #a31515;\">\"&lt;b&gt;\"</span>);          <span style=\"color: green;\">// ie: looking for bolded text</span>\r\n  <span style=\"color: blue;\">if</span> ($pos === false) {                  <span style=\"color: green;\">//                        12345678911111</span>\r\n    <span style=\"color: blue;\">return</span> false;                        <span style=\"color: green;\">//                                 01234</span>\r\n  }\r\n  <span style=\"color: blue;\">return</span> true;                           <span style=\"color: green;\">// found &lt;b&gt;</span>\r\n}\r\n?&gt;\r\n\r\n2&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</pre>\r\n<pre>and below the table (its an excel file content):</pre>\r\n<pre><table dir=\"ltr\" border=\"1\" cellspacing=\"1\" cellpadding=\"2\" width=\"1381\" bordercolor=\"#ffffff\"><tbody><tr><td width=\"26%\" height=\"32\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>Cell 1</p></span></span></td><td width=\"3%\" height=\"32\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>LAC 1</p></span></span></td><td width=\"3%\" height=\"32\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><p>&nbsp;</p></span></span></span><p><span style=\"font-size: x-small;\">CI 1</span></p></td><td width=\"26%\" height=\"32\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>Cell 2</p></span></span></td><td width=\"3%\" height=\"32\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>LAC 2</p></span></span></td><td width=\"3%\" height=\"32\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>CI 2</p></span></span></td><td width=\"4%\" height=\"32\"><span style=\"font-size: x-small;\"><p>Distance</p><span style=\"font-size: x-small;\"><p>(km)</p></span></span></td><td width=\"24%\" height=\"32\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><p>&nbsp;</p></span></span></span><p><span style=\"font-size: x-small;\">Plaque</span></p></td><td width=\"6%\" height=\"32\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>Ajout</p></span></span></td></tr><tr><td width=\"26%\" height=\"16\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><p>A</p></span></span></span><p>&nbsp;</p></td><td width=\"3%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>1539</p></span></span></td><td width=\"3%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>12306</p></span></span></td><td width=\"26%\" height=\"16\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><p>E</p></span></span></span><p>&nbsp;</p></td><td width=\"3%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>1539</p></span></span></td><td width=\"3%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>16442</p></span></span></td><td width=\"4%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>100</p></span></span></td><td width=\"24%\" height=\"16\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><p>palque1</p></span></span></span><p>&nbsp;</p></td><td width=\"6%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>A</p></span></span></td></tr><tr><td width=\"26%\" height=\"16\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><p>B</p></span></span></span><p>&nbsp;</p></td><td width=\"3%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>1543</p></span></span></td><td width=\"3%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>29136</p></span></span></td><td width=\"26%\" height=\"16\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><p>F</p></span></span></span><p>&nbsp;</p></td><td width=\"3%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>1543</p></span></span></td><td width=\"3%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>62867</p></span></span></td><td width=\"4%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>100</p></span></span></td><td width=\"24%\" height=\"16\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><p>plaque2</p></span></span></span><p>&nbsp;</p></td><td width=\"6%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>A</p></span></span></td></tr><tr><td width=\"26%\" height=\"16\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><p>C</p></span></span></span><p>&nbsp;</p></td><td width=\"3%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>1544</p></span></span></td><td width=\"3%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>2222</p></span></span></td><td width=\"26%\" height=\"16\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><p>G</p></span></span></span><p>&nbsp;</p></td><td width=\"3%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>1544</p></span></span></td><td width=\"3%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>31551</p></span></span></td><td width=\"4%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>100</p></span></span></td><td width=\"24%\" height=\"16\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><p>plaque3</p></span></span></span><p>&nbsp;</p></td><td width=\"6%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>A</p></span></span></td></tr><tr><td width=\"26%\" height=\"16\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><p>D</p></span></span></span><p>&nbsp;</p></td><td width=\"3%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>1544</p></span></span></td><td width=\"3%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>2090</p></span></span></td><td width=\"26%\" height=\"16\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><p>H</p></span></span></span><p>&nbsp;</p></td><td width=\"3%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>1544</p></span></span></td><td width=\"3%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>42723</p></span></span></td><td width=\"4%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>100</p></span></span></td><td width=\"24%\" height=\"16\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\"><p>plaque4</p></span></span></span><p>&nbsp;</p></td><td width=\"6%\" height=\"16\"><span style=\"font-size: x-small;\"><span style=\"font-size: x-small;\"><p>A</p></span></span></td></tr></tbody></table><span style=\"font-size: x-small; font-family: Arial;\"><span style=\"font-size: x-small; font-family: Arial;\">&nbsp;</span></span></pre>\r\n</div>\r\n</div>\r\n</pre>\r\n</div>",
    "PostedDate": "2011-12-05T09:52:46.85-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "708467",
    "ThreadId": "275807",
    "Html": "<p>Kass34,</p>\r\n<p>First off, I can't help you with&nbsp; <strong>$objWriter-&gt;save($fname);&nbsp; and $objWriter-&gt;save(<span style=\"color: #a31515;\">'php://output'</span>)</strong>;&nbsp;&nbsp;that is part of PHPExcel code.&nbsp; It works either way on my systems.</p>\r\n<p>Secondly, an explanation here is going to be wordy.......</p>\r\n<p>If you simply want to capture the HTML table as it was first created and also check the values in&nbsp;checkboxes, then you can simply use the first example below&nbsp;instead of generalexport.</p>\r\n<p>Beware that there is no way to actually see if a box was checked, you can only see the value of whatever attributes are set in the HTML at time of creation.&nbsp;&nbsp;</p>\r\n<p>&lt;?php<br />session_start();<br />ini_set(<span style=\"color: #a31515;\">\"memory_limit\"</span>, <span style=\"color: #a31515;\">\"-1\"</span>);<br />ini_set(<span style=\"color: #a31515;\">\"set_time_limit\"</span>, <span style=\"color: #a31515;\">\"0\"</span>);<br />set_time_limit(0);<br /><span style=\"color: blue;\">if</span> (<span style=\"color: blue;\">isset</span>($_SESSION[<span style=\"color: #a31515;\">'zprofile'</span>])) {<br />&nbsp; $username = $_SESSION[<span style=\"color: #a31515;\">'zprofile'</span>][<span style=\"color: #a31515;\">'username'</span>];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// user's name</span><br />&nbsp; $usermail = $_SESSION[<span style=\"color: #a31515;\">'zprofile'</span>][<span style=\"color: #a31515;\">'useremail'</span>];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// user's emailid</span><br />&nbsp; $usercompany = $_SESSION[<span style=\"color: #a31515;\">'zprofile'</span>][<span style=\"color: #a31515;\">'usercompany'</span>];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// user's company</span><br />&nbsp; $usergroup = $_SESSION[<span style=\"color: #a31515;\">'zprofile'</span>][<span style=\"color: #a31515;\">'usergroup'</span>];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// user's group</span><br />&nbsp; $useraccount = $_SESSION[<span style=\"color: #a31515;\">'zprofile'</span>][<span style=\"color: #a31515;\">'useraccount'</span>];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// user's group</span><br />}<span style=\"color: blue;\">else</span>{<br />&nbsp; header(<span style=\"color: #a31515;\">'Location: index.php?e=0'</span>);<br />}<br /><span style=\"color: blue;\">if</span>(!<span style=\"color: blue;\">isset</span>($_GET[<span style=\"color: #a31515;\">'var'</span>])) {<br />&nbsp; <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"&lt;br /&gt;No Table Variable Present, nothing to Export.\"</span>;<br />&nbsp; <span style=\"color: blue;\">exit</span>;<br />}<span style=\"color: blue;\">else</span>{<br />&nbsp; $tablevar = $_GET[<span style=\"color: #a31515;\">'var'</span>];<br />}<br /><span style=\"color: blue;\">if</span>(!<span style=\"color: blue;\">isset</span>($_GET[<span style=\"color: #a31515;\">'limit'</span>])) {<br />&nbsp; $limit = 12;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// maximum number of Excel tabs to create, optional</span><br />}<span style=\"color: blue;\">else</span>{<br />&nbsp; $limit = $_GET[<span style=\"color: #a31515;\">'limit'</span>];<br />}<br /><span style=\"color: blue;\">if</span>(!<span style=\"color: blue;\">isset</span>($_GET[<span style=\"color: #a31515;\">'debug'</span>])) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// optional, debug script by writing out to log file</span><br />&nbsp; $debug = false;<br />}<span style=\"color: blue;\">else</span>{<br />&nbsp; $debug = true;<br />&nbsp; $handle = fopen(<span style=\"color: #a31515;\">\"Auditlog/exportdebug_log.txt\"</span>, <span style=\"color: #a31515;\">\"w\"</span>);<br />&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\nDebugging On...\"</span>);<br />}<br /><span style=\"color: blue;\">if</span>(!<span style=\"color: blue;\">isset</span>($_SESSION[$tablevar]) OR $_SESSION[$tablevar] == <span style=\"color: #a31515;\">''</span>) {<br />&nbsp; <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"&lt;br /&gt;Empty HTML Table, nothing to Export.\"</span>;<br />&nbsp; <span style=\"color: blue;\">exit</span>;<br />}<span style=\"color: blue;\">else</span>{<br />&nbsp; $htmltable = $_SESSION[$tablevar];<br />}<br /><span style=\"color: blue;\">if</span>(strlen($htmltable) == strlen(strip_tags($htmltable)) ) {&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// anything left after we strip HTML?</span><br />&nbsp; <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"&lt;br /&gt;Invalid HTML Table after Stripping Tags, nothing to Export.\"</span>;<br />&nbsp; <span style=\"color: blue;\">exit</span>;<br />}<br /><span style=\"color: blue;\">if</span>($debug) {<br />&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\n-------------------------------------------\"</span>);<br />&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\nHTML before prep: \\n\"</span>.$htmltable);<br />&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\n-------------------------------------------\"</span>);<br />}<br />$htmltable = strip_tags($htmltable, <span style=\"color: #a31515;\">\"&lt;table&gt;&lt;tr&gt;&lt;th&gt;&lt;thead&gt;&lt;tbody&gt;&lt;tfoot&gt;&lt;td&gt;&lt;br&gt;&lt;b&gt;&lt;span&gt;&lt;input&gt;\"</span>);<br />$htmltable = str_replace(<span style=\"color: #a31515;\">\"&lt;br /&gt;\"</span>, <span style=\"color: #a31515;\">\"\\n\"</span>, $htmltable);<br />$htmltable = str_replace(<span style=\"color: #a31515;\">\"&lt;br/&gt;\"</span>, <span style=\"color: #a31515;\">\"\\n\"</span>, $htmltable);<br />$htmltable = str_replace(<span style=\"color: #a31515;\">\"&lt;br&gt;\"</span>, <span style=\"color: #a31515;\">\"\\n\"</span>, $htmltable);<br />$htmltable = str_replace(<span style=\"color: #a31515;\">\"&amp;nbsp;\"</span>, <span style=\"color: #a31515;\">\" \"</span>, $htmltable);<br />$htmltable = str_replace(<span style=\"color: #a31515;\">\"\\n\\n\"</span>, <span style=\"color: #a31515;\">\"\\n\"</span>, $htmltable);<br /><span style=\"color: blue;\">if</span>($debug) {<br />&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\n-------------------------------------------\"</span>);<br />&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\nHTML after prep: \\n\"</span>.$htmltable);<br />&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\n-------------------------------------------\"</span>);<br />}<br /><span style=\"color: green;\">//</span><br /><span style=\"color: green;\">//&nbsp; Create Document Object Model from HTML table contents</span><br /><span style=\"color: green;\">//</span><br />$dom = <span style=\"color: blue;\">new</span> domDocument;<br />$dom-&gt;loadHTML($htmltable);<br /><span style=\"color: blue;\">if</span>(!$dom) {<br />&nbsp; <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"&lt;br /&gt;Invalid HTML DOM, nothing to Export.\"</span>;<br />&nbsp; <span style=\"color: blue;\">exit</span>;<br />}<br />$dom-&gt;preserveWhiteSpace = false;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// remove redundant whitespace</span><br />$tables = $dom-&gt;getElementsByTagName(<span style=\"color: #a31515;\">'table'</span>);<br /><span style=\"color: blue;\">if</span>(!is_object($tables)) {<br />&nbsp; <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"&lt;br /&gt;Invalid HTML Table DOM, nothing to Export.\"</span>;<br />&nbsp; <span style=\"color: blue;\">exit</span>;<br />}<br /><span style=\"color: blue;\">if</span>($debug) {<br />&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\nTable Count: \"</span>.$tables-&gt;length);<br />}<br /><span style=\"color: blue;\">if</span>($tables-&gt;length &lt; 1) {<br />&nbsp; <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"&lt;br /&gt;DOM Table Count is \"</span>.$tables-&gt;length.<span style=\"color: #a31515;\">\", nothing to Export.\"</span>;<br />&nbsp; <span style=\"color: blue;\">exit</span>;<br />}<br />$tbcnt = $tables-&gt;length - 1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// count minus 1 for 0 indexed loop over tables</span><br /><span style=\"color: blue;\">if</span>($tbcnt &gt; $limit) {<br />&nbsp; $tbcnt = $limit;<br />}<br /><span style=\"color: green;\">//</span><br /><span style=\"color: green;\">//</span><br /><span style=\"color: green;\">// Create new PHPExcel object with default attributes</span><br /><span style=\"color: green;\">//</span><br /><span style=\"color: blue;\">require_once</span> (<span style=\"color: #a31515;\">'PHPExcel/PHPExcel.php'</span>);<br />$objPHPExcel = <span style=\"color: blue;\">new</span> PHPExcel();<br />$objPHPExcel-&gt;getDefaultStyle()-&gt;getFont()-&gt;setName(<span style=\"color: #a31515;\">'Arial'</span>);<br />$objPHPExcel-&gt;getDefaultStyle()-&gt;getFont()-&gt;setSize(9);<br />$tm = date(YmdHis);<br />$pos = strpos($usermail, <span style=\"color: #a31515;\">\"@\"</span>);<br />$user = substr($usermail, 0, $pos);<br />$user = str_replace(<span style=\"color: #a31515;\">\".\"</span>,<span style=\"color: #a31515;\">\"\"</span>,$user);<br />$tfn = $user.<span style=\"color: #a31515;\">\"_\"</span>.$tm.<span style=\"color: #a31515;\">\"_\"</span>.$tablevar.<span style=\"color: #a31515;\">\".xlsx\"</span>;<br /><span style=\"color: green;\">//$fname = \"AuditLog/\".$tfn;</span><br />$fname = $tfn;<br />$objPHPExcel-&gt;getProperties()-&gt;setCreator($username)<br /> -&gt;setLastModifiedBy($username)<br /> -&gt;setTitle(<span style=\"color: #a31515;\">\"Automated Export\"</span>)<br /> -&gt;setSubject(<span style=\"color: #a31515;\">\"Automated Report Generation\"</span>)<br /> -&gt;setDescription(<span style=\"color: #a31515;\">\"Automated Report generation.\"</span>)<br /> -&gt;setKeywords(<span style=\"color: #a31515;\">\"Exported File\"</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt;setCompany($usercompany)<br /> -&gt;setCategory(<span style=\"color: #a31515;\">\"Export\"</span>);<br /><span style=\"color: green;\">//</span><br /><span style=\"color: green;\">// Loop over tables in DOM to create an array, each table becomes a worksheet</span><br /><span style=\"color: green;\">//</span><br /><span style=\"color: blue;\">for</span>($z=0;$z&lt;=$tbcnt;$z++) {<br />&nbsp; $maxcols = 0;<br />&nbsp; $totrows = 0;<br />&nbsp; $headrows = <span style=\"color: blue;\">array</span>();<br />&nbsp; $bodyrows = <span style=\"color: blue;\">array</span>();<br />&nbsp; $r = 0;<br />&nbsp; $h = 0;<br />&nbsp; $rows = $tables-&gt;item($z)-&gt;getElementsByTagName(<span style=\"color: #a31515;\">'tr'</span>);<br />&nbsp; $totrows = $rows-&gt;length;<br />&nbsp; <span style=\"color: blue;\">if</span>($debug) {<br />&nbsp;&nbsp;&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\nTotal Rows: \"</span>.$totrows);<br />&nbsp; }<br />&nbsp; <span style=\"color: green;\">//</span><br />&nbsp; <span style=\"color: green;\">// Get TH values</span><br />&nbsp; <span style=\"color: green;\">//</span><br />&nbsp; <span style=\"color: blue;\">foreach</span> ($rows <span style=\"color: blue;\">as</span> $row) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $ths = $row-&gt;getElementsByTagName(<span style=\"color: #a31515;\">'th'</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>(is_object($ths)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($ths-&gt;length &gt; 0) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $headrows[$h][<span style=\"color: #a31515;\">'colcnt'</span>] = $ths-&gt;length;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($ths-&gt;length &gt; $maxcols) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $maxcols = $ths-&gt;length;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $nodes = $ths-&gt;length - 1;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">for</span>($x=0;$x&lt;=$nodes;$x++) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $thishdg = $ths-&gt;item($x)-&gt;nodeValue;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $headrows[$h][<span style=\"color: #a31515;\">'th'</span>][] = $thishdg;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $headrows[$h][<span style=\"color: #a31515;\">'bold'</span>][] = findBoldText(innerHTML($ths-&gt;item($x)));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'style'</span>)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $style = $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'style'</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $stylecolor = findStyleColor($style);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($stylecolor == <span style=\"color: #a31515;\">''</span>) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $headrows[$h][<span style=\"color: #a31515;\">'color'</span>][] = findSpanColor(innerHTML($ths-&gt;item($x)));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $headrows[$h][<span style=\"color: #a31515;\">'color'</span>][] = $stylecolor;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $headrows[$h][<span style=\"color: #a31515;\">'color'</span>][] = findSpanColor(innerHTML($ths-&gt;item($x)));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'colspan'</span>)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $headrows[$h][<span style=\"color: #a31515;\">'colspan'</span>][] = $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'colspan'</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $headrows[$h][<span style=\"color: #a31515;\">'colspan'</span>][] = 1;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'align'</span>)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $headrows[$h][<span style=\"color: #a31515;\">'align'</span>][] = $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'align'</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $headrows[$h][<span style=\"color: #a31515;\">'align'</span>][] = <span style=\"color: #a31515;\">'left'</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'valign'</span>)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $headrows[$h][<span style=\"color: #a31515;\">'valign'</span>][] = $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'valign'</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $headrows[$h][<span style=\"color: #a31515;\">'valign'</span>][] = <span style=\"color: #a31515;\">'top'</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($ths-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'bgcolor'</span>)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $headrows[$h][<span style=\"color: #a31515;\">'bgcolor'</span>][] = str_replace(<span style=\"color: #a31515;\">\"#\"</span>, <span style=\"color: #a31515;\">\"\"</span>, $ths-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'bgcolor'</span>));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $headrows[$h][<span style=\"color: #a31515;\">'bgcolor'</span>][] = <span style=\"color: #a31515;\">'FFFFFF'</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $h++;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp; }<br />&nbsp; <span style=\"color: green;\">//</span><br />&nbsp; <span style=\"color: green;\">// Get TD values</span><br />&nbsp; <span style=\"color: green;\">//</span><br />&nbsp; <span style=\"color: blue;\">foreach</span> ($rows <span style=\"color: blue;\">as</span> $row) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $tds = $row-&gt;getElementsByTagName(<span style=\"color: #a31515;\">'td'</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>(is_object($tds)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($tds-&gt;length &gt; 0) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">//</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// see if there are checkboxes within each TD for the row and only include checked rows in output</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">//</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $nodes = $tds-&gt;length - 1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// number of TD's present</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $includerow = true;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// include row? (true or false), default = true</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">for</span>($x=0;$x&lt;=$nodes;$x++) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// td nodes</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $allinputs = $tds-&gt;item($x)-&gt;getElementsByTagName(<span style=\"color: #a31515;\">'input'</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>(is_object($allinputs)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">for</span> ($i = 0; $i &lt; $allinputs-&gt;length; $i++) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($debug) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span> ($allinputs-&gt;item($i)-&gt;hasAttributes()) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">foreach</span> ($allinputs-&gt;item($i)-&gt;attributes <span style=\"color: blue;\">as</span> $attr) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $name = $attr-&gt;nodeName;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $value = $attr-&gt;nodeValue;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"Attribute '$name' :: '$value'\\n\"</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($allinputs-&gt;item($i)-&gt;hasAttribute(<span style=\"color: #a31515;\">'type'</span>)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $type = $allinputs-&gt;item($i)-&gt;getAttribute(<span style=\"color: #a31515;\">'type'</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($debug) { fwrite($handle, <span style=\"color: #a31515;\">\"\\nType: \"</span>.$type.<span style=\"color: #a31515;\">\"\\n\"</span>); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($type == <span style=\"color: #a31515;\">'checkbox'</span>) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($allinputs-&gt;item($i)-&gt;hasAttribute(<span style=\"color: #a31515;\">'value'</span>)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $value = $allinputs-&gt;item($i)-&gt;getAttribute(<span style=\"color: #a31515;\">'value'</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($debug) { fwrite($handle, <span style=\"color: #a31515;\">\"\\nValue: \"</span>.$value.<span style=\"color: #a31515;\">\"\\n\"</span>); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($value == <span style=\"color: #a31515;\">'0'</span>) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $includerow = false;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($debug) {fwrite($handle, <span style=\"color: #a31515;\">\"\\nInput field found as Type: \"</span>.$type.<span style=\"color: #a31515;\">\"&nbsp; with empty Value: \"</span>.$value.<span style=\"color: #a31515;\">\"\\n\"</span>); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// end checkbox row exclusion</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($includerow) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// checkbox is checked</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $bodyrows[$r][<span style=\"color: #a31515;\">'colcnt'</span>] = $tds-&gt;length;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($tds-&gt;length &gt; $maxcols) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $maxcols = $tds-&gt;length;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $nodes = $tds-&gt;length - 1;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">for</span>($x=0;$x&lt;=$nodes;$x++) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $thistxt = $tds-&gt;item($x)-&gt;nodeValue;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $bodyrows[$r][<span style=\"color: #a31515;\">'td'</span>][] = $thistxt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $bodyrows[$r][<span style=\"color: #a31515;\">'bold'</span>][] = findBoldText(innerHTML($tds-&gt;item($x)));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($tds-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'style'</span>)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $style = $tds-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'style'</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $stylecolor = findStyleColor($style);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($stylecolor == <span style=\"color: #a31515;\">''</span>) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $bodyrows[$r][<span style=\"color: #a31515;\">'color'</span>][] = findSpanColor(innerHTML($tds-&gt;item($x)));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $bodyrows[$r][<span style=\"color: #a31515;\">'color'</span>][] = $stylecolor;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $bodyrows[$r][<span style=\"color: #a31515;\">'color'</span>][] = findSpanColor(innerHTML($tds-&gt;item($x)));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($tds-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'colspan'</span>)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $bodyrows[$r][<span style=\"color: #a31515;\">'colspan'</span>][] = $tds-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'colspan'</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $bodyrows[$r][<span style=\"color: #a31515;\">'colspan'</span>][] = 1;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($tds-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'align'</span>)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $bodyrows[$r][<span style=\"color: #a31515;\">'align'</span>][] = $tds-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'align'</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $bodyrows[$r][<span style=\"color: #a31515;\">'align'</span>][] = <span style=\"color: #a31515;\">'left'</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($tds-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'valign'</span>)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $bodyrows[$r][<span style=\"color: #a31515;\">'valign'</span>][] = $tds-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'valign'</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $bodyrows[$r][<span style=\"color: #a31515;\">'valign'</span>][] = <span style=\"color: #a31515;\">'top'</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($tds-&gt;item($x)-&gt;hasAttribute(<span style=\"color: #a31515;\">'bgcolor'</span>)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $bodyrows[$r][<span style=\"color: #a31515;\">'bgcolor'</span>][] = str_replace(<span style=\"color: #a31515;\">\"#\"</span>, <span style=\"color: #a31515;\">\"\"</span>, $tds-&gt;item($x)-&gt;getAttribute(<span style=\"color: #a31515;\">'bgcolor'</span>));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $bodyrows[$r][<span style=\"color: #a31515;\">'bgcolor'</span>][] = <span style=\"color: #a31515;\">'FFFFFF'</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $r++;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp; }<br />&nbsp; <span style=\"color: blue;\">if</span>($z &gt; 0) {<br />&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;createSheet($z);<br />&nbsp; }<br />&nbsp; $suf = $z + 1;<br />&nbsp; $tableid = $tablevar.$suf;<br />&nbsp; $wksheetname = ucfirst($tableid);<br />&nbsp; $objPHPExcel-&gt;setActiveSheetIndex($z);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// each sheet corresponds to a table in html</span><br />&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setTitle($wksheetname);&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// tab name</span><br />&nbsp; $worksheet = $objPHPExcel-&gt;getActiveSheet();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// set worksheet we're working on</span><br />&nbsp; $style_overlay = <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'font'</span> =&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'color'</span> =&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'rgb'</span> =&gt; <span style=\"color: #a31515;\">'000000'</span>),<span style=\"color: #a31515;\">'bold'</span> =&gt; false,),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: #a31515;\">'fill'</span> =&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'type'</span> =&gt; PHPExcel_Style_Fill::FILL_SOLID, <span style=\"color: #a31515;\">'color'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'rgb'</span> =&gt; <span style=\"color: #a31515;\">'CCCCFF'</span>)),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: #a31515;\">'alignment'</span> =&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'wrap'</span> =&gt; true, <span style=\"color: #a31515;\">'horizontal'</span> =&gt; PHPExcel_Style_Alignment::HORIZONTAL_CENTER,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: #a31515;\">'vertical'</span> =&gt; PHPExcel_Style_Alignment::VERTICAL_TOP),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: #a31515;\">'borders'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'top'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: #a31515;\">'bottom'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: #a31515;\">'left'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: #a31515;\">'right'</span> =&gt; <span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN)),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );<br />&nbsp; $xcol = <span style=\"color: #a31515;\">''</span>;<br />&nbsp; $xrow = 1;<br />&nbsp; $usedhdrows = 0;<br />&nbsp; $heightvars = <span style=\"color: blue;\">array</span>(1=&gt;<span style=\"color: #a31515;\">'42'</span>, 2=&gt;<span style=\"color: #a31515;\">'42'</span>, 3=&gt;<span style=\"color: #a31515;\">'48'</span>, 4=&gt;<span style=\"color: #a31515;\">'52'</span>, 5=&gt;<span style=\"color: #a31515;\">'58'</span>, 6=&gt;<span style=\"color: #a31515;\">'64'</span>, 7=&gt;<span style=\"color: #a31515;\">'68'</span>, 8=&gt;<span style=\"color: #a31515;\">'76'</span>, 9=&gt;<span style=\"color: #a31515;\">'82'</span>);<br />&nbsp; <span style=\"color: blue;\">for</span>($h=0;$h&lt;count($headrows);$h++) {<br />&nbsp;&nbsp;&nbsp; $th = $headrows[$h][<span style=\"color: #a31515;\">'th'</span>];<br />&nbsp;&nbsp;&nbsp; $colspans = $headrows[$h][<span style=\"color: #a31515;\">'colspan'</span>];<br />&nbsp;&nbsp;&nbsp; $aligns = $headrows[$h][<span style=\"color: #a31515;\">'align'</span>];<br />&nbsp;&nbsp;&nbsp; $valigns = $headrows[$h][<span style=\"color: #a31515;\">'valign'</span>];<br />&nbsp;&nbsp;&nbsp; $bgcolors = $headrows[$h][<span style=\"color: #a31515;\">'bgcolor'</span>];<br />&nbsp;&nbsp;&nbsp; $colcnt = $headrows[$h][<span style=\"color: #a31515;\">'colcnt'</span>];<br />&nbsp;&nbsp;&nbsp; $colors = $headrows[$h][<span style=\"color: #a31515;\">'color'</span>];<br />&nbsp;&nbsp;&nbsp; $bolds = $headrows[$h][<span style=\"color: #a31515;\">'bold'</span>];<br />&nbsp;&nbsp;&nbsp; $usedhdrows++;<br />&nbsp;&nbsp;&nbsp; $mergedcells = false;<br />&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">for</span>($t=0;$t&lt;count($th);$t++) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($xcol == <span style=\"color: #a31515;\">''</span>) {$xcol = <span style=\"color: #a31515;\">'A'</span>;}<span style=\"color: blue;\">else</span>{$xcol++;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $thishdg = $th[$t];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $thisalign = $aligns[$t];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $thisvalign = $valigns[$t];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $thiscolspan = $colspans[$t];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $thiscolor = $colors[$t];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $thisbg = $bgcolors[$t];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $thisbold = $bolds[$t];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $strbold = ($thisbold==true) ? <span style=\"color: #a31515;\">'true'</span> : <span style=\"color: #a31515;\">'false'</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($thisbg == <span style=\"color: #a31515;\">'FFFFFF'</span>) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'type'</span>] = PHPExcel_Style_Fill::FILL_NONE;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'type'</span>] = PHPExcel_Style_Fill::FILL_SOLID;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $style_overlay[<span style=\"color: #a31515;\">'alignment'</span>][<span style=\"color: #a31515;\">'vertical'</span>] = $thisvalign;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// set styles for cell</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $style_overlay[<span style=\"color: #a31515;\">'alignment'</span>][<span style=\"color: #a31515;\">'horizontal'</span>] = $thisalign;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $style_overlay[<span style=\"color: #a31515;\">'font'</span>][<span style=\"color: #a31515;\">'color'</span>][<span style=\"color: #a31515;\">'rgb'</span>] = $thiscolor;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $style_overlay[<span style=\"color: #a31515;\">'font'</span>][<span style=\"color: #a31515;\">'bold'</span>] = $thisbold;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'color'</span>][<span style=\"color: #a31515;\">'rgb'</span>] = $thisbg;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($thiscolspan &gt; 1) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// spans more than 1 column</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $mergedcells = true;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $lastxcol = $xcol;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">for</span>($j=1;$j&lt;$thiscolspan;$j++) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// count to last column in span</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $lastxcol++;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $cellRange = $xcol.$xrow.<span style=\"color: #a31515;\">':'</span>.$lastxcol.$xrow;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($debug) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\nmergeCells: \"</span>.$xcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow.<span style=\"color: #a31515;\">\" \"</span>.$lastxcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $worksheet-&gt;mergeCells($cellRange);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// merge the columns</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $worksheet-&gt;setCellValue($xcol.$xrow, $thishdg);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $worksheet-&gt;getStyle($cellRange)-&gt;applyFromArray($style_overlay);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $worksheet-&gt;getStyle($cellRange)-&gt;getAlignment()-&gt;setWrapText(true);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $num_newlines = substr_count($thishdg, <span style=\"color: #a31515;\">\"\\n\"</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// count number of newline chars</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($num_newlines &gt; 1) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $rowheight = $heightvars[1];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// default to 35</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>(array_key_exists($num_newlines, $heightvars)) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// I couldn't find a PHPExcel method</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $rowheight = $heightvars[$num_newlines];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// to do this, so I look to see how</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// many newlines and just guess at</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $rowheight = 75;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// row height</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $worksheet-&gt;getRowDimension($xrow)-&gt;setRowHeight($rowheight);&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// adjust heading row height</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">//$worksheet-&gt;getRowDimension($xrow)-&gt;setRowHeight(-1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // this doesn't work in PHPExcel</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($debug) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\n\"</span>.$cellRange.<span style=\"color: #a31515;\">\" ColSpan:\"</span>.$thiscolspan.<span style=\"color: #a31515;\">\" Color:\"</span>.$thiscolor.<span style=\"color: #a31515;\">\" Align:\"</span>.$thisalign.<span style=\"color: #a31515;\">\" VAlign:\"</span>.$thisvalign.<span style=\"color: #a31515;\">\" BGColor:\"</span>.$thisbg.<span style=\"color: #a31515;\">\" Bold:\"</span>.$strbold.<span style=\"color: #a31515;\">\" cellValue: \"</span>.$thishdg);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $xcol = $lastxcol;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $worksheet-&gt;setCellValue($xcol.$xrow, $thishdg);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $worksheet-&gt;getStyle($xcol.$xrow)-&gt;applyFromArray($style_overlay);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($debug) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\n\"</span>.$xcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow.<span style=\"color: #a31515;\">\" ColSpan:\"</span>.$thiscolspan.<span style=\"color: #a31515;\">\" Color:\"</span>.$thiscolor.<span style=\"color: #a31515;\">\" Align:\"</span>.$thisalign.<span style=\"color: #a31515;\">\" VAlign:\"</span>.$thisvalign.<span style=\"color: #a31515;\">\" BGColor:\"</span>.$thisbg.<span style=\"color: #a31515;\">\" Bold:\"</span>.$strbold.<span style=\"color: #a31515;\">\" cellValue: \"</span>.$thishdg);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; $xrow++;<br />&nbsp;&nbsp;&nbsp; $xcol = <span style=\"color: #a31515;\">''</span>;<br />&nbsp; }<br />&nbsp; <span style=\"color: green;\">//Put an auto filter on last row of heading only if last row was not merged</span><br />&nbsp; <span style=\"color: blue;\">if</span>(!$mergedcells) {<br />&nbsp;&nbsp;&nbsp; $worksheet-&gt;setAutoFilter(<span style=\"color: #a31515;\">\"A$usedhdrows:\"</span> . $worksheet-&gt;getHighestColumn() . $worksheet-&gt;getHighestRow() );<br />&nbsp; }<br />&nbsp; <span style=\"color: blue;\">if</span>($debug) {<br />&nbsp;&nbsp;&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\nautoFilter: A\"</span>.$usedhdrows.<span style=\"color: #a31515;\">\":\"</span>.$worksheet-&gt;getHighestColumn().$worksheet-&gt;getHighestRow());<br />&nbsp; }<br />&nbsp; <span style=\"color: green;\">// Freeze heading lines starting after heading lines</span><br />&nbsp; $usedhdrows++;<br />&nbsp; $worksheet-&gt;freezePane(<span style=\"color: #a31515;\">\"A$usedhdrows\"</span>);<br />&nbsp; <span style=\"color: blue;\">if</span>($debug) {<br />&nbsp;&nbsp;&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\nfreezePane: A\"</span>.$usedhdrows);<br />&nbsp; }<br />&nbsp; <span style=\"color: green;\">//</span><br />&nbsp; <span style=\"color: green;\">// Loop thru data rows and write them out</span><br />&nbsp; <span style=\"color: green;\">//</span><br />&nbsp; $xcol = <span style=\"color: #a31515;\">''</span>;<br />&nbsp; $xrow = $usedhdrows;<br />&nbsp; <span style=\"color: blue;\">for</span>($b=0;$b&lt;count($bodyrows);$b++) {<br />&nbsp;&nbsp;&nbsp; $td = $bodyrows[$b][<span style=\"color: #a31515;\">'td'</span>];<br />&nbsp;&nbsp;&nbsp; $colcnt = $bodyrows[$b][<span style=\"color: #a31515;\">'colcnt'</span>];<br />&nbsp;&nbsp;&nbsp; $colspans = $bodyrows[$b][<span style=\"color: #a31515;\">'colspan'</span>];<br />&nbsp;&nbsp;&nbsp; $aligns = $bodyrows[$b][<span style=\"color: #a31515;\">'align'</span>];<br />&nbsp;&nbsp;&nbsp; $valigns = $bodyrows[$b][<span style=\"color: #a31515;\">'valign'</span>];<br />&nbsp;&nbsp;&nbsp; $bgcolors = $bodyrows[$b][<span style=\"color: #a31515;\">'bgcolor'</span>];<br />&nbsp;&nbsp;&nbsp; $colors = $bodyrows[$b][<span style=\"color: #a31515;\">'color'</span>];<br />&nbsp;&nbsp;&nbsp; $bolds = $bodyrows[$b][<span style=\"color: #a31515;\">'bold'</span>];<br />&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">for</span>($t=0;$t&lt;count($td);$t++) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($xcol == <span style=\"color: #a31515;\">''</span>) {$xcol = <span style=\"color: #a31515;\">'A'</span>;}<span style=\"color: blue;\">else</span>{$xcol++;}</p>\r\n<p>$thistext = $td[$t];       $thisalign = $aligns[$t];       $thisvalign = $valigns[$t];       $thiscolspan = $colspans[$t];       $thiscolor = $colors[$t];       $thisbg = $bgcolors[$t];       $thisbold = $bolds[$t];       $strbold = ($thisbold==true) ? <span style=\"color: #a31515;\">'true'</span> : <span style=\"color: #a31515;\">'false'</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($thisbg == <span style=\"color: #a31515;\">'FFFFFF'</span>) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'type'</span>] = PHPExcel_Style_Fill::FILL_NONE;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'type'</span>] = PHPExcel_Style_Fill::FILL_SOLID;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $style_overlay[<span style=\"color: #a31515;\">'alignment'</span>][<span style=\"color: #a31515;\">'vertical'</span>] = $thisvalign;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// set styles for cell</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $style_overlay[<span style=\"color: #a31515;\">'alignment'</span>][<span style=\"color: #a31515;\">'horizontal'</span>] = $thisalign;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $style_overlay[<span style=\"color: #a31515;\">'font'</span>][<span style=\"color: #a31515;\">'color'</span>][<span style=\"color: #a31515;\">'rgb'</span>] = $thiscolor;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $style_overlay[<span style=\"color: #a31515;\">'font'</span>][<span style=\"color: #a31515;\">'bold'</span>] = $thisbold;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $style_overlay[<span style=\"color: #a31515;\">'fill'</span>][<span style=\"color: #a31515;\">'color'</span>][<span style=\"color: #a31515;\">'rgb'</span>] = $thisbg;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($thiscolspan &gt; 1) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// spans more than 1 column</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $lastxcol = $xcol;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">for</span>($j=1;$j&lt;$thiscolspan;$j++) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// count spanned columns</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $lastxcol++;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $cellRange = $xcol.$xrow.<span style=\"color: #a31515;\">':'</span>.$lastxcol.$xrow;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($debug) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\nmergeCells: \"</span>.$xcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow.<span style=\"color: #a31515;\">\" \"</span>.$lastxcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $worksheet-&gt;mergeCells($cellRange);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// merge columns in span</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $worksheet-&gt;setCellValue($xcol.$xrow, $thistext);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $worksheet-&gt;getStyle($cellRange)-&gt;applyFromArray($style_overlay);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $worksheet-&gt;getStyle($cellRange)-&gt;getAlignment()-&gt;setWrapText(true);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $num_newlines = substr_count($thistext, <span style=\"color: #a31515;\">\"\\n\"</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// count number of newline chars</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($num_newlines &gt; 1) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $rowheight = $heightvars[1];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// default to 35</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>(array_key_exists($num_newlines, $heightvars)) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// I could not find a method in PHPExcel</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $rowheight = $heightvars[$num_newlines];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// that would set row height automatically</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// based on content, so I guess based</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $rowheight = 75;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// on number of newlines in the content</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $worksheet-&gt;getRowDimension($xrow)-&gt;setRowHeight($rowheight);&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// adjust heading row height</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">//$worksheet-&gt;getRowDimension($xrow)-&gt;setRowHeight(-1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // this doesn't work in PHPExcel</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($debug) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\n\"</span>.$cellRange.<span style=\"color: #a31515;\">\" ColSpan:\"</span>.$thiscolspan.<span style=\"color: #a31515;\">\" Color:\"</span>.$thiscolor.<span style=\"color: #a31515;\">\" Align:\"</span>.$thisalign.<span style=\"color: #a31515;\">\" VAlign:\"</span>.$thisvalign.<span style=\"color: #a31515;\">\" BGColor:\"</span>.$thisbg.<span style=\"color: #a31515;\">\" Bold:\"</span>.$strbold.<span style=\"color: #a31515;\">\" cellValue: \"</span>.$thistext);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">//$worksheet-&gt;getRowDimension($xrow)-&gt;setRowHeight(-1);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $xcol = $lastxcol;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<span style=\"color: blue;\">else</span>{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $worksheet-&gt;getColumnDimension($xcol)-&gt;setWidth(25);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// default width</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $worksheet-&gt;setCellValue($xcol.$xrow, $thistext);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $worksheet-&gt;getStyle($xcol.$xrow)-&gt;applyFromArray($style_overlay);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">if</span>($debug) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\n\"</span>.$xcol.<span style=\"color: #a31515;\">\":\"</span>.$xrow.<span style=\"color: #a31515;\">\" ColSpan:\"</span>.$thiscolspan.<span style=\"color: #a31515;\">\" Color:\"</span>.$thiscolor.<span style=\"color: #a31515;\">\" Align:\"</span>.$thisalign.<span style=\"color: #a31515;\">\" VAlign:\"</span>.$thisvalign.<span style=\"color: #a31515;\">\" BGColor:\"</span>.$thisbg.<span style=\"color: #a31515;\">\" Bold:\"</span>.$strbold.<span style=\"color: #a31515;\">\" cellValue: \"</span>.$thistext);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; $xrow++;<br />&nbsp;&nbsp;&nbsp; $xcol = <span style=\"color: #a31515;\">''</span>;<br />&nbsp; }<br />&nbsp; <span style=\"color: green;\">// autosize columns to fit data</span><br />&nbsp; $azcol = <span style=\"color: #a31515;\">'A'</span>;<br />&nbsp; <span style=\"color: blue;\">for</span>($x=1;$x==$maxcols;$x++) {<br />&nbsp;&nbsp;&nbsp; $worksheet-&gt;getColumnDimension($azcol)-&gt;setAutoSize(true);<br />&nbsp;&nbsp;&nbsp; $azcol++;<br />&nbsp; }<br />&nbsp; <span style=\"color: blue;\">if</span>($debug) {<br />&nbsp;&nbsp;&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\nHEADROWS: \"</span>.print_r($headrows, true));<br />&nbsp;&nbsp;&nbsp; fwrite($handle, <span style=\"color: #a31515;\">\"\\nBODYROWS: \"</span>.print_r($bodyrows, true));<br />&nbsp; }<br />} <span style=\"color: green;\">// end for over tables</span><br />$objPHPExcel-&gt;setActiveSheetIndex(0);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// set to first worksheet before close</span><br /><span style=\"color: green;\">//</span><br /><span style=\"color: green;\">// Write to Browser</span><br /><span style=\"color: green;\">//</span><br /><span style=\"color: blue;\">if</span>($debug) {<br />&nbsp; <span style=\"color: blue;\">fclose</span>($handle);<br />}<br />header(<span style=\"color: #a31515;\">'Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'</span>);<br />header(<span style=\"color: #a31515;\">\"Content-Disposition: attachment;filename=$fname\"</span>);<br />header(<span style=\"color: #a31515;\">'Cache-Control: max-age=0'</span>);<br />$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color: #a31515;\">'Excel2007'</span>);<br /><span style=\"color: green;\">//$objWriter-&gt;save($fname);</span><br />$objWriter-&gt;save(<span style=\"color: #a31515;\">'php://output'</span>);<br /><span style=\"color: blue;\">exit</span>;<br /><span style=\"color: blue;\">function</span> innerHTML($node) {<br />&nbsp; $doc = $node-&gt;ownerDocument;<br />&nbsp; $frag = $doc-&gt;createDocumentFragment();<br />&nbsp; <span style=\"color: blue;\">foreach</span> ($node-&gt;childNodes <span style=\"color: blue;\">as</span> $child) {<br />&nbsp;&nbsp;&nbsp; $frag-&gt;appendChild($child-&gt;cloneNode(TRUE));<br />&nbsp; }<br />&nbsp; <span style=\"color: blue;\">return</span> $doc-&gt;saveXML($frag);<br />}<br /><span style=\"color: blue;\">function</span> findSpanColor($node) {<br />&nbsp; $pos = stripos($node, <span style=\"color: #a31515;\">\"color:\"</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// ie: looking for style='color: #FF0000;'</span><br />&nbsp; <span style=\"color: blue;\">if</span> ($pos === false) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 12345678911111</span><br />&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">return</span> <span style=\"color: #a31515;\">'000000'</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01234</span><br />&nbsp; }<br />&nbsp; $node = substr($node, $pos);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// truncate to color: start</span><br />&nbsp; $start = <span style=\"color: #a31515;\">\"#\"</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// looking for html color string</span><br />&nbsp; $end = <span style=\"color: #a31515;\">\";\"</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// should end with semicolon</span><br />&nbsp; $node = <span style=\"color: #a31515;\">\" \"</span>.$node;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// prefix node with blank</span><br /> $ini = stripos($node,$start);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// look for #</span><br /> <span style=\"color: blue;\">if</span> ($ini === false) <span style=\"color: blue;\">return</span> <span style=\"color: #a31515;\">\"000000\"</span>;&nbsp;&nbsp; <span style=\"color: green;\">// not found, return default color of black</span><br /> $ini += strlen($start);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// get 1 byte past start string</span><br /> $len = stripos($node,$end,$ini) - $ini; <span style=\"color: green;\">// grab substr between start and end positions</span><br /> <span style=\"color: blue;\">return</span> substr($node,$ini,$len);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// return the RGB color without # sign</span><br />}<br /><span style=\"color: blue;\">function</span> findStyleColor($style) {<br />&nbsp; $pos = stripos($style, <span style=\"color: #a31515;\">\"color:\"</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// ie: looking for style='color: #FF0000;'</span><br />&nbsp; <span style=\"color: blue;\">if</span> ($pos === false) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 12345678911111</span><br />&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">return</span> <span style=\"color: #a31515;\">''</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01234</span><br />&nbsp; }<br />&nbsp; $style = substr($style, $pos);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// truncate to color: start</span><br />&nbsp; $start = <span style=\"color: #a31515;\">\"#\"</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// looking for html color string</span><br />&nbsp; $end = <span style=\"color: #a31515;\">\";\"</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// should end with semicolon</span><br />&nbsp; $style = <span style=\"color: #a31515;\">\" \"</span>.$style;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// prefix node with blank</span><br /> $ini = stripos($style,$start);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// look for #</span><br /> <span style=\"color: blue;\">if</span> ($ini === false) <span style=\"color: blue;\">return</span> <span style=\"color: #a31515;\">\"\"</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// not found, return default color of black</span><br /> $ini += strlen($start);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// get 1 byte past start string</span><br /> $len = stripos($style,$end,$ini) - $ini; <span style=\"color: green;\">// grab substr between start and end positions</span><br /> <span style=\"color: blue;\">return</span> substr($style,$ini,$len);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// return the RGB color without # sign</span><br />}<br /><span style=\"color: blue;\">function</span> findBoldText($node) {<br />&nbsp; $pos = stripos($node, <span style=\"color: #a31515;\">\"&lt;b&gt;\"</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// ie: looking for bolded text</span><br />&nbsp; <span style=\"color: blue;\">if</span> ($pos === false) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 12345678911111</span><br />&nbsp;&nbsp;&nbsp; <span style=\"color: blue;\">return</span> false;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01234</span><br />&nbsp; }<br />&nbsp; <span style=\"color: blue;\">return</span> true;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style=\"color: green;\">// found &lt;b&gt;</span><br />}<br />?&gt;</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;If you really want to make this dynamic and pick up the latest checked status&nbsp;(value), you will need to use a combination of PHP and javascript.</p>\r\n<p>You need to do&nbsp; something like I outline below to keep the saved HTML values in sync with what the user checks or unchecks.</p>\r\n<p>Here is how the HTML should look:</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">table</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">thead</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>heading1<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>heading2<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>heading3<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>LEF<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">thead</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">tbody</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>row1data1<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>row1data2<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>row1data3<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: green;\">&lt;!-- make sure you use a unique ID for each checkbox, so the right one is updated in the session variable copy .... --&gt;</span>\r\n    <span style=\"color: green;\">&lt;!-- values should be set to 0 with no checked='checked' parameter, OR '1' and checked='checked' parameter --&gt;</span></pre>\r\n<pre><span style=\"color: green;\">&nbsp;</span>   <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">input</span> <span style=\"color: red;\">type</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"checkbox\"</span> <span style=\"color: red;\">id</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"mycheckbox1\"</span> <span style=\"color: red;\">value</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"1\"</span> <span style=\"color: red;\">onchange</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"updateCheckBoxInSessionTable(this, 'tablecontents');\"</span> <span style=\"color: red;\">checked</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"checked\"</span> <span style=\"color: blue;\">/&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>row1data1<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>row1data2<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>row1data3<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">input</span> <span style=\"color: red;\">type</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"checkbox\"</span> <span style=\"color: red;\">id</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"mycheckbox2\"</span> <span style=\"color: red;\">value</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"2\"</span> <span style=\"color: red;\">onchange</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"updateCheckBoxInSessionTable(this, 'tablecontents');\"</span> <span style=\"color: blue;\">/&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n  &lt;!-- more rows as needed .... -&gt;\r\n  <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">tbody</span><span style=\"color: blue;\">&gt;</span>\r\n<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">table</span><span style=\"color: blue;\">&gt;</span>\r\n</pre>\r\n</div>\r\n<p>Then you need to have this javascript function available to your page displaying the table.&nbsp; Everytime a checkbox changes, it will call this function.</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre>&lt;script type=<span style=\"color: #a31515;\">'javascript'</span>&gt;\r\n  <span style=\"color: blue;\">function</span> updateCheckBoxInSessionTable(o_chkbx, sessvarname) {\r\n    <span style=\"color: green;\">//</span>\r\n    <span style=\"color: green;\">// get the checkbox id and value</span>\r\n    <span style=\"color: green;\">//</span>\r\n    <span style=\"color: blue;\">if</span>(o_chkbx.checked) {\r\n      <span style=\"color: blue;\">var</span> value = '1';\r\n    }<span style=\"color: blue;\">else</span>{\r\n      <span style=\"color: blue;\">var</span> value = '0';\r\n    }\r\n    <span style=\"color: blue;\">var</span> id = o_chkbx.id;\r\n    <span style=\"color: green;\">//</span>\r\n    <span style=\"color: green;\">// this is my Ajax function, use your own Ajax function to call the PHP program from javascript</span>\r\n    <span style=\"color: green;\">//</span>\r\n    <span style=\"color: blue;\">var</span> zserverpgm = <span style=\"color: #a31515;\">\"checkboxupdate.php\"</span>;\r\n    <span style=\"color: blue;\">var</span> zserverparms = <span style=\"color: #a31515;\">\"id=\"</span>+id+<span style=\"color: #a31515;\">\"&amp;value=\"</span>+value+<span style=\"color: #a31515;\">\"&amp;var=\"</span>+sessvarname;\r\n    zAsync = <span style=\"color: blue;\">false</span>;\r\n    zajaxgettempnd(zserverpgm, zserverparms);\r\n  }\r\n\r\n  &lt;/script&gt;</pre>\r\n<pre>This PHP script is then used to keep the session variable HTML contents in sync with the displayed page checkbox values, so when you export it, its in sync with what the user sees.</pre>\r\n<pre><div style=\"color: black; background-color: white;\"><pre>&lt;?php // script name: checkboxupdate.php</pre>\r\n<pre>session_start();\r\nerror_reporting(E_ALL);\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">// Replace HTML ID element value</span>\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">// ID passed to this script is the ID of the HTML element so that innerHTML can be changed to the passed value</span>\r\n<span style=\"color: green;\">// VALUE passed to this script is the new value to replace the existing value within the HTML element</span>\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: blue;\">if</span>(<span style=\"color: blue;\">isset</span>($_GET[<span style=\"color: #a31515;\">'id'</span>])) {\r\n  $id = $_GET[<span style=\"color: #a31515;\">'id'</span>];\r\n}<span style=\"color: blue;\">else</span>{\r\n  <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"Missing ID parameter!\"</span>;      <span style=\"color: green;\">// can't do anything without ID</span>\r\n  <span style=\"color: blue;\">exit</span>;\r\n}\r\n<span style=\"color: blue;\">if</span>(<span style=\"color: blue;\">isset</span>($_GET[<span style=\"color: #a31515;\">'value'</span>])) {\r\n  $value = $_GET[<span style=\"color: #a31515;\">'value'</span>];           <span style=\"color: green;\">// ascii string with \\n for newline breaks</span>\r\n}<span style=\"color: blue;\">else</span>{\r\n  <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"Missing Value parameter!\"</span>;   <span style=\"color: green;\">// can't do anything without a value</span>\r\n  <span style=\"color: blue;\">exit</span>;\r\n}\r\n<span style=\"color: blue;\">if</span>(<span style=\"color: blue;\">isset</span>($_GET[<span style=\"color: #a31515;\">'var'</span>])) {\r\n  $<span style=\"color: blue;\">var</span> = $_GET[<span style=\"color: #a31515;\">'var'</span>];\r\n}<span style=\"color: blue;\">else</span>{\r\n  <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"Missing VAR parameter!\"</span>;      <span style=\"color: green;\">// can't do anything without the session var</span>\r\n  <span style=\"color: blue;\">exit</span>;\r\n}\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: green;\">// Using Simple HTML DOM, update the checkbox element in the session table, then save the session table</span>\r\n<span style=\"color: green;\">//</span>\r\n<span style=\"color: blue;\">include</span>(<span style=\"color: #a31515;\">'includes/simple_html_dom.php'</span>);                 <span style=\"color: green;\">// find this at  http://simplehtmldom.sourceforge.net/</span>\r\n$html = str_get_html($_SESSION[$<span style=\"color: blue;\">var</span>]);                   <span style=\"color: green;\">// get the table contents from the session variable</span>\r\n$valueexcel = str_ireplace(<span style=\"color: #a31515;\">\"\\n\"</span>, <span style=\"color: #a31515;\">\"&lt;br&gt;\"</span>, $value);        <span style=\"color: green;\">// replace line breaks \\n to HTML &lt;BR&gt;</span>\r\n$e = $html-&gt;find(<span style=\"color: #a31515;\">\"input[id=$id]\"</span>);                       <span style=\"color: green;\">// find the HTML input element</span>\r\n<span style=\"color: blue;\">foreach</span>($e <span style=\"color: blue;\">as</span> $single_e){\r\n  <span style=\"color: blue;\">if</span>($single_e-&gt;id == $id) {                             <span style=\"color: green;\">// if we find our ID</span>\r\n    $single_e-&gt;value = $valueexcel;                      <span style=\"color: green;\">// replace the innerText (innerHTML) content with new value</span>\r\n    $_SESSION[$<span style=\"color: blue;\">var</span>] = <span style=\"color: #a31515;\">\"\"</span>;                                <span style=\"color: green;\">// clear the session table value</span>\r\n    $_SESSION[$<span style=\"color: blue;\">var</span>] = $html-&gt;save();                     <span style=\"color: green;\">// now save updated HTML into the session table value</span>\r\n  }\r\n}\r\n$html-&gt;clear();                                          <span style=\"color: green;\">// Close and release resources</span>\r\n<span style=\"color: blue;\">unset</span>($html);\r\n<span style=\"color: green;\">// you could also update databases or other sources if needed while you have this data, or simply exit</span>\r\n?&gt;\r\n</pre>\r\n</div>\r\n</pre>\r\n</div>\r\n<p><br />To export this table, use the sample I provided at the top of this reply.</p>",
    "PostedDate": "2011-12-06T15:03:40.72-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "708471",
    "ThreadId": "275807",
    "Html": "<p>Sorry, I have an error in the sample HTML in last reply.&nbsp; The value for non-check checkbox should be 0 (zero), not 2.</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre>td&gt;<span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">input</span> <span style=\"color: red;\">type</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"checkbox\"</span> <span style=\"color: red;\">id</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"mycheckbox1\"</span> <span style=\"color: red;\">value</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"1\"</span> <span style=\"color: red;\">onchange</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"updateCheckBoxInSessionTable(this, 'tablecontents');\"</span> <span style=\"color: red;\">checked</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"checked\"</span> <span style=\"color: blue;\">/&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>row1data1<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>row1data2<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>row1data3<span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n    <span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span><span style=\"color: blue;\">&lt;</span><span style=\"color: #a31515;\">input</span> <span style=\"color: red;\">type</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"checkbox\"</span> <span style=\"color: red;\">id</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"mycheckbox2\"</span> <span style=\"color: red;\">value</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"<strong>0</strong>\"</span> <span style=\"color: red;\">onchange</span><span style=\"color: blue;\">=</span><span style=\"color: blue;\">\"updateCheckBoxInSessionTable(this, 'tablecontents');\"</span> <span style=\"color: blue;\">/&gt;</span><span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">td</span><span style=\"color: blue;\">&gt;</span>\r\n  <span style=\"color: blue;\">&lt;/</span><span style=\"color: #a31515;\">tr</span><span style=\"color: blue;\">&gt;</span>\r\n  &lt;!-- more rows as needed .... -&gt;\r\n\r\n</pre>\r\n</div>",
    "PostedDate": "2011-12-06T15:15:21.75-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "709275",
    "ThreadId": "275807",
    "Html": "<p>Hello mamuscia,</p>\r\n<p>Could you tell me which version of simple_html_dom.php you used ?</p>\r\n<p>because i download the version 1.5 and the str_get_html is not working. do you have an idea ?</p>\r\n<p>Thx in advance</p>",
    "PostedDate": "2011-12-08T05:50:02.84-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "709276",
    "ThreadId": "275807",
    "Html": "<p>Sorry it seems that the version is :</p>\r\n<p>* @author S.C. Chen &lt;<a href=\"mailto:me578022@gmail.com\">me578022@gmail.com</a>&gt;<br />&nbsp;* @author John Schlick<br />&nbsp;* @author Rus Carroll<br />&nbsp;* @version 1.11 ($Rev: 184 $)<br />&nbsp;* @package PlaceLocalInclude<br />&nbsp;* @subpackage simple_html_dom</p>\r\n<p>Thx</p>",
    "PostedDate": "2011-12-08T05:52:49.013-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "709326",
    "ThreadId": "275807",
    "Html": "<p>I found that in the net : (SourceForge site)</p>\r\n<p>&nbsp;</p>\r\n<p><span><strong>str_get_html()'s defaultBRText does'nt work. - ID: 3441953</strong></span></p>\r\n<div class=\"yui\" style=\"font-size: 85%; color: #555; text-align: right;\">Last Update: Tracker Item Submitted ( <a title=\"OKINAKA Kenshin\" href=\"http://sourceforge.net/users/okinakak/\">okinakak</a> )</div>\r\n<div class=\"yui-g box\" style=\"background: #f5f5f5; padding-top: 1em;\"><label>Details:</label></div>\r\n<p class=\"yui-g box\" style=\"background: #f5f5f5; padding-top: 1em;\"><!-- google_ad_section_start -->In str_get_html(), set $stripRN simple_html_dom object<br />and set $defaultBRText in $dom-&gt;load().<br /><br /><br />@@ -82,13 +82,13 @@ function file_get_html($url, $use_include_path = false, $context=null, $offset =<br />// get html dom from string<br />function str_get_html($str, $lowercase=true, $forceTagsClosed=true, $target_charset = DEFAULT_TARGET_CHARSET, $stripRN=true, $defaultBRText=DEFAULT_BR_TEXT)<br />{<br />- $dom = new simple_html_dom(null, $lowercase, $forceTagsClosed, $target_charset, $defaultBRText);<br />+ $dom = new simple_html_dom(null, $lowercase, $forceTagsClosed, $target_charset, $stripRN, $defaultBRText);<br />if (empty($str))<br />{<br />$dom-&gt;clear();<br />return false;<br />}<br />- $dom-&gt;load($str, $lowercase, $stripRN);<br />+ $dom-&gt;load($str, $lowercase, $stripRN, $defaultBRText);<br />return $dom;<br />}<br /><!-- google_ad_section_end --></p>\r\n<div class=\"yui-g box\" style=\"background: #f5f5f5; padding-top: 1em;\">Any idea about that ?</div>\r\n<div class=\"yui-g box\" style=\"background: #f5f5f5; padding-top: 1em;\">\r\n<hr class=\"divider\" noshade=\"noshade\" />\r\n</div>",
    "PostedDate": "2011-12-08T07:03:12.797-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "709335",
    "ThreadId": "275807",
    "Html": "<p>I am using the following version which works fine.</p>\r\n<p>/*******************************************************************************<br />Version: 1.11 ($Rev: 175 $)<br />Website: <a href=\"http://sourceforge.net/projects/simplehtmldom/\">http://sourceforge.net/projects/simplehtmldom/</a><br />Author: S.C. Chen &lt;<a href=\"mailto:me578022@gmail.com\">me578022@gmail.com</a>&gt;<br />Acknowledge: Jose Solorzano (<a href=\"https://sourceforge.net/projects/php-html/\">https://sourceforge.net/projects/php-html/</a>)<br />Contributions by:<br />&nbsp;&nbsp;&nbsp; Yousuke Kumakura (Attribute filters)<br />&nbsp;&nbsp;&nbsp; Vadim Voituk (Negative indexes supports of \"find\" method)<br />&nbsp;&nbsp;&nbsp; Antcs (Constructor with automatically load contents either text or file/url)<br />Licensed under The MIT License<br />Redistributions of files must retain the above copyright notice.<br />*******************************************************************************/</p>\r\n<p>Download the 1.11 version which is what I use.</p>",
    "PostedDate": "2011-12-08T07:16:34.253-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "712216",
    "ThreadId": "275807",
    "Html": "<p>Hello mamuscia,</p>\r\n<p>Thanks for your help, now i can export my table in an excel file :) :):) .....</p>\r\n<p>Just one think also :</p>\r\n<p>What i want to do that when the file is exported&nbsp; i hope that my page display just only ther headers of my table, how can i do that ?</p>\r\n<p>Thanks in advance</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2011-12-14T09:16:09.967-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "712247",
    "ThreadId": "275807",
    "Html": "<p>Kass34,</p>\r\n<p>I'm not sure I understand what you are asking in previous post....can you elaborate please?</p>",
    "PostedDate": "2011-12-14T10:07:02.88-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "712537",
    "ThreadId": "275807",
    "Html": "<p>Mamusica,</p>\r\n<p>here are the steps f my prohram:</p>\r\n<p>1. Read data from an excel file</p>\r\n<p>2. Display them as an html table in a web page</p>\r\n<p>3. The user can select or deselect lines of the thable in web page</p>\r\n<p>4. export the selected lines from the hatml table of the web page</p>\r\n<p>the above steps are well done by your help as described in the previous posts ad your generaleexport.</p>\r\n<p>i have to do the last step:</p>\r\n<p>5. when the user export the selected lines, i want to delete all lines of the table except the header line : that the user don't see anymore the content of the input excel file in order to remind him that he has exported them. then the web page will display just the header line.</p>\r\n<p>Any idea how tyo do that ?</p>\r\n<p>Thx in advance</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2011-12-15T00:13:06.617-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "712931",
    "ThreadId": "275807",
    "Html": "<p>There are a few things to know before we can solve this.</p>\r\n<p>1.&nbsp; how is the table first displayed to the user?&nbsp; does it contain both checked and unchecked rows?</p>\r\n<p>2.&nbsp; how do you want users to check unseen rows?&nbsp; ie: if a row is unchecked you said you didn't want to display it, so how is a user supposed to check a row they cannot see?</p>\r\n<p>3.&nbsp; I don't quite understand what process you want to follow from #5 above.&nbsp; can you break it down a bit into steps</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2011-12-15T13:46:26.597-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "716332",
    "ThreadId": "275807",
    "Html": "<p><span id=\"result_box\" lang=\"en\"><span class=\"hps\">Hi</span><span>.</span><br /> <span class=\"hps\">Excellent example</span><span>, but I have</span> <span class=\"hps\">a table</span> <span class=\"hps\">with</span> <span class=\"hps\">colspan</span> <span class=\"hps\">and</span> <span class=\"hps\">rowspan</span> <span class=\"hps\">html</span><span>, but</span> <span class=\"hps\">does not work</span> <span class=\"hps\">rowspan</span><span>, could</span> <span class=\"hps\">you help me?</span></span></p>\r\n<p>&nbsp;</p>\r\n<p><span lang=\"en\"><span class=\"hps\">Tanks!!<br /></span></span></p>",
    "PostedDate": "2011-12-22T14:52:11.91-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "719376",
    "ThreadId": "275807",
    "Html": "<p>I'm working on an HTML Reader using domDocument (which is meant to be the best tool when working with HTML that's not well-formed, as well as markup that is) that handles colspan and rowspan without problems, though still issues with nested tables (believe me, I've seen examples of this in \"fake\" .xls files where people have simply dumped their HTML markup with an .xls extension and expected PHPExcel to read it) and with (a real surprise, though I understand why) &lt;br /&gt;</p>\n<p>It's on the roadmap to be included in 2012.</p>",
    "PostedDate": "2012-01-02T05:44:40.59-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "730439",
    "ThreadId": "275807",
    "Html": "<p><span class=\"hps\">hi</span>&nbsp;<span class=\"hps\">thanks for your</span>&nbsp;<span class=\"hps\">code is</span>&nbsp;<span class=\"hps\">very interesting, but</span>&nbsp;<span class=\"hps\">I'm trying to</span>&nbsp;<span class=\"hps\">export a table to</span>&nbsp;<span class=\"hps\">excel</span>&nbsp;<span class=\"hps\">and I have two</span>&nbsp;<span class=\"hps\">problems.</span></p>\r\n<div id=\"gt-res-wrap\">\r\n<div id=\"gt-res-content\" class=\"almost_half_cell\">\r\n<div dir=\"ltr\"><span id=\"result_box\" lang=\"en\"><br /><span class=\"hps\">The first is that</span>&nbsp;<span class=\"hps\">I have problems with</span>&nbsp;<span class=\"hps\">rowsnap</span>&nbsp;<span class=\"hps\">that</span>&nbsp;<span class=\"hps\">do not take</span>&nbsp;<span class=\"hps\">the code.</span><br /><br /><span class=\"hps\">the</span>&nbsp;<span class=\"hps\">second is that</span>&nbsp;<span class=\"hps\">when you open the</span>&nbsp;<span class=\"hps\">excel</span>&nbsp;<span class=\"hps\">file</span>&nbsp;<span class=\"hps\">tells me</span>&nbsp;<span class=\"hps\">that he had to</span>&nbsp;<span class=\"hps\">repair the</span>&nbsp;<span class=\"hps\">archvio</span>&nbsp;<span class=\"hps\">on line 2</span>&nbsp;<span class=\"hps\">column</span>&nbsp;<span class=\"hps\">XXXX</span>&nbsp;<span class=\"hps\">column</span>&nbsp;<span class=\"hps\">is always a</span>&nbsp;<span class=\"hps\">4-digit</span>&nbsp;<span class=\"hps\">number</span>, and&nbsp;<span class=\"hps\">do not know why</span>&nbsp;<span class=\"hps\">this</span>&nbsp;<span class=\"hps\">will be produced</span>.</span></div>\r\n</div>\r\n<div id=\"gt-res-tools\">\r\n<div id=\"gt-res-tools-r\">\r\n<div id=\"gt-res-rate\">\r\n<div class=\"goog-inline-block goog-toolbar-menu-button\">\r\n<div class=\"goog-inline-block goog-toolbar-menu-button-outer-box\">\r\n<div class=\"goog-inline-block goog-toolbar-menu-button-inner-box\">\r\n<div class=\"goog-inline-block goog-toolbar-menu-button-caption\"><span class=\"goog-flat-menu-button-img gt-rate-icon jfk-button-img\">&nbsp;</span></div>\r\n</div>\r\n</div>\r\n</div>\r\n</div>\r\n</div>\r\n</div>\r\n</div>\r\n<p>&nbsp;</p>",
    "PostedDate": "2012-01-25T05:09:37.437-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "840675",
    "ThreadId": "275807",
    "Html": "<p>Hello mamuscia,</p>\r\n<p>Thanks for the code, It works great. The only issue I had is with the dom creation:</p>\r\n<div class=\"UserName\" style=\"word-wrap: break-word; white-space: pre-wrap;\">\r\n<div style=\"color: black; background-color: white;\">\r\n<pre>$dom-&gt;loadHTML($htmltable);\r\n</pre>\r\n<pre>It gave me an error. To resolve this I just simply added @ in front to produce:</pre>\r\n<pre><pre>@$dom-&gt;loadHTML($htmltable);</pre>\r\n<pre>Figured I would share in case anyone else had the same issue. The error I got was within the spreadsheet stating:</pre>\r\n<pre>&lt;b&gt;Warning&lt;/b&gt;:&nbsp; DOMDocument::loadHTML() [&lt;a href='domdocument.loadhtml'&gt;domdocument.loadhtml&lt;/a&gt;]: htmlParseEntityRef: no name in Entity, line: 3 in &lt;b&gt;C:\\Program Files\\Apache Software Foundation\\Apache2.2\\htdocs\\rtms\\rtms\\excel_creator2.php&lt;/b&gt; on line &lt;b&gt;45&lt;/b&gt;&lt;br /&gt;</pre>\r\n<pre>Thanks again for the code. </pre>\r\n</pre>\r\n</div>\r\n</div>",
    "PostedDate": "2012-05-24T16:26:02.797-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "843921",
    "ThreadId": "275807",
    "Html": "<p>I have problem, then I call it by AJAX: it's post as utf8 encoded</p>\r\n<p>problem was in domDocument-&gt;loadHTML wich doesn't work with UTF-8 and &nbsp;Russian letters.</p>\r\n<p>It's solved by change to -&gt;loadXML()</p>\r\n<p>&nbsp;</p>\r\n<p>Thanks for great code</p>",
    "PostedDate": "2012-06-02T14:44:37.517-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1024080",
    "ThreadId": "275807",
    "Html": "hello mamuscia,\r<br />\n<br />\nThank you for making the code very great,\r<br />\n<br />\nI need help to create a rowspan,\r<br />\n<br />\nThis code is perfect, and the more perfect if it makes the code to generate rowspan.\r<br />\n<br />\nCan you help me? please\r<br />\n<br />\nthanks\r<br />\n<br />\nSorry for my bad english.<br />\n",
    "PostedDate": "2013-04-02T00:22:40.31-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1024467",
    "ThreadId": "275807",
    "Html": "Hello Tonbad, \r<br />\nit's been a while since I looked at this code.  I don't have a lot of time to help right now given my workload, but let me try to outline something that will get you going. \r<br />\n<br />\nIf you look at the section where it's looping thru the TH's and TD's to find attributes that are set, such as COLSPAN, \r<br />\nthen just duplicate it to look for ROWSPAN and save the value.  Do it in both the TH and TD loops. For example:   \r<br />\n<pre><code>// \nif($ths-&gt;item($x)-&gt;hasAttribute('rowspan')) {\n  $headrows[$h]['rowspan'][] = $ths-&gt;item($x)-&gt;getAttribute('rowspan');\n}else{\n  $headrows[$h]['rowspan'][] = 1;\n}</code></pre>\n\nWhen it generates the Excel, you'll need to MERGE cells based on what you found for the ROWSPAN attribute.\r<br />\nYou'll have to determine what the cell range is for the element you're getting from the TH or TD array, For example:<br />\n<pre><code>for($t=0;$t&lt;count($th);$t++) {\n      if($xcol == '') {$xcol = 'A';}else{$xcol++;}\n      $thishdg = $th[$t];\n      $thisalign = $aligns[$t];\n      $thisvalign = $valigns[$t];\n      $thiscolspan = $colspans[$t];\n      $thisrowspan = $rowspans[$t];\n      $thiscolor = $colors[$t];\n      $thisbg = $bgcolors[$t];\n      $thisbold = $bolds[$t];\n      $strbold = ($thisbold==true) ? 'true' : 'false';\n      if($thisbg == 'FFFFFF') {\n        $style_overlay['fill']['type'] = PHPExcel_Style_Fill::FILL_NONE;\n      }else{\n        $style_overlay['fill']['type'] = PHPExcel_Style_Fill::FILL_SOLID;\n      }\n      $style_overlay['alignment']['vertical'] = $thisvalign;              // set styles for cell\n      $style_overlay['alignment']['horizontal'] = $thisalign;\n      $style_overlay['font']['color']['rgb'] = $thiscolor;\n      $style_overlay['font']['bold'] = $thisbold;\n      $style_overlay['fill']['color']['rgb'] = $thisbg;\n      if($thiscolspan &gt; 1) {                       \n\n....... rest of loop code not shown .......\n\n$worksheet-&gt;mergeCells($cellRange); </code></pre>\n\nAgaun, sorry, but I cannot spend more time helping right now.<br />\n",
    "PostedDate": "2013-04-02T13:02:18.42-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1024551",
    "ThreadId": "275807",
    "Html": "Hello mamuscia,<br />\n<br />\nThanks for quick respond,<br />\nI will try to start modify your code<br />\n<br />\nActually i'm beginner in phpexcel,<br />\n<br />\ncan you give me extra  commentary in your code,? Please<br />\n <br />\nI think i will understand the meaning of the code much better<br />\n<br />\nThanks,<br />\n<br />\nsorry my bad english :).<br />\n",
    "PostedDate": "2013-04-02T17:28:44.1-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1026451",
    "ThreadId": "275807",
    "Html": "Hello Mamuscia,\r<br />\n<br />\nI can't Copy Code that you have updated.\r<br />\n<br />\ndo you have Insert Code function to post your code?\r<br />\n<br />\nThanks.<br />\n",
    "PostedDate": "2013-04-05T20:39:58.33-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1079051",
    "ThreadId": "275807",
    "Html": "Mamuscia, this script is awesome and working great! :)<br />\n<br />\nThe only disadvantage I have found so far is that it has problems with nested tables as it will consider each table as a separate one and put it in a separate worksheet. Any ideas of how to make it work with nested tables?<br />\n<pre><code>&lt;table&gt;\n&lt;thead&gt;\n&lt;tr&gt;\n&lt;th&gt;test&lt;/th&gt;\n&lt;/tr&gt;\n&lt;/thead&gt;\n&lt;tbody&gt;\n&lt;tr&gt;\n&lt;td&gt;\n&lt;table&gt;\n&lt;tr&gt;\n&lt;td&gt;val1&lt;/td&gt;\n&lt;/tr&gt;\n&lt;/table&gt;\n&lt;table&gt;\n&lt;tr&gt;\n&lt;td&gt;val2&lt;/td&gt;\n&lt;/tr&gt;\n&lt;/table&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;/tbody&gt;\n&lt;/table&gt;</code></pre>\n\n",
    "PostedDate": "2013-08-10T06:05:37.113-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1079071",
    "ThreadId": "275807",
    "Html": "\r\n<div>On 10/08/2013 14:05, king999 wrote:<br>\r\n</div>\r\n<blockquote type=\"cite\">\r\n<p>From: king999</p>\r\n<div id=\"ThreadNotificationPostBody\">Mamuscia, this script is awesome and working great! :)\r\n<br>\r\n<br>\r\nThe only disadvantage I have found so far is that it has problems with nested tables as it will consider each table as a separate one and put it in a separate worksheet. Any ideas of how to make it work with nested tables?<br>\r\n<pre><code><table><thead><tr><th>test</th></tr></thead><tbody><tr><td><table><tbody><tr><td>val1&lt;/test&gt; </td></tr></tbody></table><table><tbody><tr><td>val2</td></tr></tbody></table></td></tr></tbody></table></code></pre>\r\n</div>\r\n</blockquote>\r\nI have, similar to handling merged cells, by maintaining a stack; and I plan to implement it at some point, but it does add a fair degree of complexity to the writer... I may find time to implement it as part of my version 2 rewrite<br>\r\n<br>\r\n<pre cols=\"72\">-- \r\nMark Baker</pre>\r\n",
    "PostedDate": "2013-08-10T07:53:56.553-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1079079",
    "ThreadId": "275807",
    "Html": "Mark, it would be a good idea to include it in version 2. Any ideas of a workaround until then with the current script?<br />\n",
    "PostedDate": "2013-08-10T09:24:28.397-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1106439",
    "ThreadId": "275807",
    "Html": "Mark, \r<br />\nit's been a while since I have posted. I am still using PHPExcel and it's fantastic.  I see from above that you have included an HTML reader now.  Is there an example in the latest download on how to use it?  Does the HTML have to come from a file, or can it come from a variable as well?\r<br />\n<br />\nThanks.<br />\n",
    "PostedDate": "2013-10-11T08:14:50.847-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]