[
  {
    "Id": "670468",
    "ThreadId": "272254",
    "Html": "\r\n<p></p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>&lt;?php session_start();\r\n<span style=\"color:blue\">if</span> (@$HTTP_SESSION_VARS[<span style=\"color:#a31515\">&quot;login_status&quot;</span>] &lt;&gt; <span style=\"color:#a31515\">&quot;login&quot;</span>){\r\n\theader(<span style=\"color:#a31515\">&quot;Location: flogin.php&quot;</span>);\r\n\t<span style=\"color:blue\">die</span>();\r\n}\r\n\r\n<span style=\"color:green\">/** Error reporting */</span>\r\nerror_reporting(E_ALL);\r\n\r\n<span style=\"color:blue\">require_once</span> <span style=\"color:#a31515\">'config.php'</span>;\r\n<span style=\"color:blue\">require_once</span> <span style=\"color:#a31515\">'functions.php'</span>;\r\n<span style=\"color:blue\">require_once</span> <span style=\"color:#a31515\">'GradeBook/gradefunctions.php'</span>;\r\n\r\n\r\n<span style=\"color:green\">/** PHPExcel */</span>\r\n<span style=\"color:blue\">require_once</span> dirname(<span style=\"color:blue\">__FILE__</span>) . <span style=\"color:#a31515\">'/Classes/PHPExcel.php'</span>;\r\n<span style=\"color:green\">/** PHPExcel_IOFactory */</span>\r\n<span style=\"color:blue\">require_once</span> <span style=\"color:#a31515\">'/Classes/PHPExcel/IOFactory.php'</span>;\r\n<span style=\"color:green\">// This is to pre-empt the maximum execution time problem</span>\r\n<span style=\"color:green\">//set_time_limit(0);</span>\r\n\r\nini_set(<span style=\"color:#a31515\">'memory_limit'</span>,<span style=\"color:#a31515\">'1024M'</span>);\r\n<span style=\"color:green\">//ini_set('max_execution_time','600');</span>\r\n\r\n<span style=\"color:green\">// Create new PHPExcel object</span>\r\n$objPHPExcel = <span style=\"color:blue\">new</span> PHPExcel();\r\n\r\n<span style=\"color:green\">// Set properties</span>\r\n<span style=\"color:green\">//echo date('H:i:s') . &quot; Set properties\\n&quot;;</span>\r\n$objPHPExcel-&gt;getProperties()-&gt;setCreator(<span style=\"color:#a31515\">&quot;Paul Mimbi&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setLastModifiedBy(<span style=\"color:#a31515\">&quot;Paul Mimbi&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setTitle(<span style=\"color:#a31515\">&quot;stgr Academic Report&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setSubject(<span style=\"color:#a31515\">&quot;Studies Chart&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setDescription(<span style=\"color:#a31515\">&quot;Document generated using PHP classes.&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setKeywords(<span style=\"color:#a31515\">&quot;office 2007 openxml php&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setCategory(<span style=\"color:#a31515\">&quot;File for Decision Making Purposes&quot;</span>);\r\n\r\n<span style=\"color:green\">//colour schemes</span>\r\n$light_green = <span style=\"color:#a31515\">'ACE600'</span>;\r\n$deep_green = <span style=\"color:#a31515\">'004900'</span>;\r\n$amber = <span style=\"color:#a31515\">'FF6600'</span>;\r\n$red = <span style=\"color:#a31515\">'FF0000'</span>;\r\n$purple = <span style=\"color:#a31515\">'D9007E'</span>;\r\n$purple_blue = <span style=\"color:#a31515\">'8800CC'</span>;\r\n$deep_blue = <span style=\"color:#a31515\">'2200CC'</span>;\r\n$sky_blue1 = <span style=\"color:#a31515\">'0099CC'</span>;\r\n$sky_blue2 = <span style=\"color:#a31515\">'33FFCC'</span>;\r\n$sky_blue3 = <span style=\"color:#a31515\">'33CCFF'</span>;\r\n$grey = <span style=\"color:#a31515\">'C3C3C3'</span>;\r\n$white= <span style=\"color:#a31515\">'FFFFFF'</span>;\r\n\r\n<span style=\"color:green\">// read data from recordset...</span>\r\n$qryf10 = &quot;SELECT DISTINCT st.StudentId AS sID, c.CourseId, c.CourseCode, c.Course, t.Score AS tScore, t.MaxScore AS tMax, e.MaxScore AS eMax,\r\n\t\t  m.Marks AS mScore, m.ExamId AS ExamId, c.ProgramId, c.SemesterId, s.SemesterDescription, st.CivilStatusId AS cStatus\r\n\t\t\tFROM courses c \r\n\t\t\tLEFT JOIN exams e ON c.CourseId = e.CourseId\r\n\t\t\tLEFT JOIN marks m ON e.ExamId = m.ExamId\r\n            LEFT JOIN transcripts t ON c.CourseId = t.CourseId\r\n\t\t\tINNER JOIN students st ON t.StudentId = st.StudentId OR m.StudentId = st.StudentId\r\n\t\t\tLEFT JOIN semesters s ON c.SemesterId = s.SemesterId\r\n\t\t\tWHERE c.ProgramId IN (1, 3) \r\n\t\t\tAND st.CivilStatusId IN (1, 2)\r\n\t\t\tORDER BY st.CivilStatusId, c.ProgramId, c.SemesterId, st.StudentId, c.CourseId  ASC&quot;;\r\n<span style=\"color:green\">/* This one also works...\r\n$qryf10 = &quot;SELECT st.StudentId AS sID, c.CourseId, c.CourseCode, c.Course, t.Score AS tScore, t.MaxScore AS tMax, e.MaxScore AS eMax,\r\n\t\t   m.Marks AS mScore, m.ExamId AS ExamId, c.ProgramId, c.SemesterId, s.SemesterDescription, st.CivilStatusId AS cStatus\r\n\t\t\tFROM courses c\r\n            LEFT JOIN semesters s ON c.SemesterId = s.SemesterId\r\n\t\t\tLEFT JOIN exams e ON c.CourseId = e.CourseId\r\n\t\t\tLEFT JOIN marks m ON e.ExamId = m.ExamId\r\n\t\t\tLEFT JOIN transcripts t ON c.CourseId = t.CourseId\r\n\t\t\tLEFT JOIN students st ON t.StudentId = st.StudentId OR m.StudentId = st.StudentId\r\n\t\t\tWHERE c.ProgramId IN (1, 3) \r\n\t\t\tAND st.CivilStatusId IN (1, 2)\r\n\t\t\tORDER BY st.CivilStatusId, c.ProgramId, c.SemesterId, st.StudentId, c.CourseId  ASC&quot;;\r\n*/</span>\t\t\t\r\n$rstf10 = mysql_query($qryf10, $ServerConnect) <span style=\"color:blue\">or</span> <span style=\"color:blue\">die</span>(mysql_error());\r\n$numf10 = mysql_num_rows($rstf10);\r\n<span style=\"color:green\">//mysql_data_seek ($rstf10 , 0 );</span>\r\n\r\n<span style=\"color:green\">// Query to fetch the individual courses per civil status, per program per semester</span>\r\n$query_subjects = 'SELECT DISTINCT c.CourseId, c.Course, c.CourseCode, c.ProgramId, c.SemesterId,\r\n\t\t\ts.SemesterDescription, st.CivilStatusId AS cStatus\r\n\t\t\tFROM courses c \r\n\t\t\tLEFT JOIN transcripts t ON c.CourseId = t.CourseId\r\n\t\t\tLEFT JOIN semesters s ON c.SemesterId = s.SemesterId\r\n\t\t\tLEFT JOIN exams e ON c.CourseId = e.CourseId\r\n\t\t\tLEFT JOIN marks m ON e.ExamId = m.ExamId\r\n\t\t\tINNER JOIN students st ON t.StudentId = st.StudentId OR m.StudentId = st.StudentId\r\n\t\t\tWHERE c.ProgramId = %d\r\n\t\t\tAND st.CivilStatusId= %d\r\n\t\t\tAND c.SemesterId = %d \r\n\t\t\tORDER BY st.CivilStatusId, c.ProgramId, c.SemesterId, c.CourseId  ASC';\r\n\r\n<span style=\"color:green\">/*OLD QUERY...DOES NOT WORK WHEN MARKS TABLE IS EMPTY...\r\n\t$query_subjects = 'SELECT DISTINCT c.CourseId, c.Course, c.CourseCode, c.ProgramId, c.SemesterId,\r\n\t\t\ts.SemesterDescription, st.CivilStatusId AS cStatus\r\n\t\t\tFROM courses c \r\n\t\t\tLEFT JOIN transcripts t ON c.CourseId = t.CourseId\r\n\t\t\tLEFT JOIN exams e ON c.CourseId = e.CourseId\r\n\t\t\tLEFT JOIN marks m ON e.ExamId = m.ExamId\r\n\t\t\tLEFT JOIN students st ON m.StudentId = st.StudentId\r\n\t\t\tLEFT JOIN semesters s ON c.SemesterId = s.SemesterId\r\n\t\t\tWHERE c.ProgramId = %d\r\n\t\t\tAND st.CivilStatusId= %d\r\n\t\t\tAND c.SemesterId = %d \r\n\t\t\tORDER BY st.CivilStatusId, c.ProgramId, c.SemesterId, c.CourseId  ASC';\r\n*/</span>\t\t\t<span style=\"color:green\">/*\r\n\t\t\t*NB: I have removed AND st.StudentId IS NOT NULL from both\r\n\t\t\t*the queries; checked that it was not really necessary...\r\n\t\t\t*/</span>\r\n\r\n<span style=\"color:green\">// function for setting title colors...</span>\r\n<span style=\"color:blue\">function</span> getTitleColorArray($semester_id){\r\n\t$color = <span style=\"color:#a31515\">''</span>;\r\n\t<span style=\"color:blue\">switch</span>($semester_id) {\r\n\t\t<span style=\"color:blue\">case</span> 1:\r\n\t\t\t$color = <span style=\"color:#a31515\">'99FF33'</span>;\r\n\t\t\t<span style=\"color:blue\">break</span>;\r\n\t\t<span style=\"color:blue\">case</span> 2:\r\n\t\t\t$color = <span style=\"color:#a31515\">'FFFF33'</span>;\r\n\t\t\t<span style=\"color:blue\">break</span>;\r\n\t\t<span style=\"color:blue\">case</span> 3:\r\n\t\t\t$color = <span style=\"color:#a31515\">'FF9933'</span>;\r\n\t\t\t<span style=\"color:blue\">break</span>;\r\n\t\t<span style=\"color:blue\">case</span> 4:\r\n\t\t\t$color = <span style=\"color:#a31515\">'FF3333'</span>;\r\n\t\t\t<span style=\"color:blue\">break</span>;\r\n\t\t<span style=\"color:blue\">default</span>:\r\n\t\t   $color = <span style=\"color:#a31515\">'FFFFFF'</span>;\r\n\t}\r\n\t\r\n\t<span style=\"color:blue\">return</span> <span style=\"color:blue\">array</span>(\r\n\t\t<span style=\"color:#a31515\">'font'</span>    =&gt; <span style=\"color:blue\">array</span>(\r\n\t\t\t<span style=\"color:#a31515\">'bold'</span>      =&gt; true\r\n\t\t),\r\n\t\t<span style=\"color:#a31515\">'alignment'</span> =&gt; <span style=\"color:blue\">array</span>(\r\n\t\t\t<span style=\"color:#a31515\">'horizontal'</span> =&gt; PHPExcel_Style_Alignment::HORIZONTAL_RIGHT,\r\n\t\t),\r\n\t\t<span style=\"color:#a31515\">'borders'</span> =&gt; <span style=\"color:blue\">array</span>(\r\n\t\t\t<span style=\"color:#a31515\">'top'</span>     =&gt; <span style=\"color:blue\">array</span>(\r\n\t\t\t\t<span style=\"color:#a31515\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN\r\n\t\t\t)\r\n\t\t),\r\n\t\t<span style=\"color:#a31515\">'fill'</span> =&gt; <span style=\"color:blue\">array</span>(\r\n\t\t\t<span style=\"color:#a31515\">'type'</span>       =&gt; PHPExcel_Style_Fill::FILL_GRADIENT_LINEAR,\r\n\t\t\t<span style=\"color:#a31515\">'rotation'</span>   =&gt; 90,\r\n\t\t\t<span style=\"color:#a31515\">'startcolor'</span> =&gt; <span style=\"color:blue\">array</span>(\r\n\t\t\t\t<span style=\"color:#a31515\">'rgb'</span> =&gt; $color\r\n\t\t\t),\r\n\t\t\t<span style=\"color:#a31515\">'endcolor'</span>   =&gt; <span style=\"color:blue\">array</span>(\r\n\t\t\t\t<span style=\"color:#a31515\">'rgb'</span> =&gt; <span style=\"color:#a31515\">'FFFFFF'</span>\r\n\t\t\t)\r\n\t\t)\r\n\t);\r\n}\r\n\t\r\n<span style=\"color:green\">// Array to hold the report structure to be dumped to Excel</span>\r\n$report  = <span style=\"color:blue\">array</span>();\r\n\r\n<span style=\"color:green\">// Initialize local temporary variable</span>\r\n$civil_status = -1; \t<span style=\"color:green\">// Keeps track of the current civil status</span>\r\n$status_count = -1; \t<span style=\"color:green\">//Counter for the civil status</span>\r\n$program_count = -1; \t<span style=\"color:green\">// Counter for the program</span>\r\n$prog = -1;             <span style=\"color:green\">// Keeps track of program id</span>\r\n$semester_count = -1; \t<span style=\"color:green\">// Counter for the semesters</span>\r\n$student_count = -1;\t<span style=\"color:green\">// Counter to keep track of the number of students per status,program and semester</span>\r\n$student_id= -1; \t\t<span style=\"color:green\">// Keeps track of the current student during the fetch</span>\r\n$course_id = -1; \t\t<span style=\"color:green\">//Keeps track of the current course/subject during the fetch</span>\r\n$semester = -1; \t\t<span style=\"color:green\">// Keeps track of the current semester during the fetch</span>\r\n\r\n<span style=\"color:blue\">while</span> ($rowf10 = mysql_fetch_assoc($rstf10)) {\t\t\t\t\r\n\t<span style=\"color:green\">// Get the civil status</span>\r\n\t<span style=\"color:blue\">if</span> ($civil_status != $rowf10[<span style=\"color:#a31515\">'cStatus'</span>]) {\r\n\t\t$status_count&#43;&#43;;\r\n\t\t$civil_status = $rowf10[<span style=\"color:#a31515\">'cStatus'</span>];\r\n\t\t\r\n\t\t$status_name = <span style=\"color:#a31515\">&quot;&quot;</span>;\r\n\t\t<span style=\"color:blue\">switch</span> ($civil_status) {\r\n\t\t\t<span style=\"color:blue\">case</span> 1:\r\n\t\t\t\t$status_name = <span style=\"color:#a31515\">&quot;n&quot;</span>;\r\n\t\t\t\t<span style=\"color:blue\">break</span>;\r\n\t\t\t<span style=\"color:blue\">case</span> 2:\r\n\t\t\t\t$status_name = <span style=\"color:#a31515\">&quot;agd&quot;</span>;\r\n\t\t\t\t<span style=\"color:blue\">break</span>;\r\n\t\t\t<span style=\"color:blue\">case</span> 3:\r\n\t\t\t\t$status_name = <span style=\"color:#a31515\">&quot;s&quot;</span>;\r\n\t\t\t\t<span style=\"color:blue\">break</span>;\r\n\t\t\t<span style=\"color:blue\">default</span>:\r\n\t\t\t\t$status_name = <span style=\"color:#a31515\">&quot;DiP&quot;</span>;\r\n\t\t}\r\n\t\t$report[$status_count][<span style=\"color:#a31515\">'status_id'</span>] = $civil_status;\r\n\t\t$report[$status_count][<span style=\"color:#a31515\">'civil_status'</span>] = $status_name;\r\n\t}\r\n\t<span style=\"color:green\">// Get the program\t</span>\r\n\t<span style=\"color:blue\">if</span> ($prog != $rowf10[<span style=\"color:#a31515\">'ProgramId'</span>]) {\r\n\t\t$program_count&#43;&#43;;\r\n\t\t\r\n\t\t$prog = $rowf10[<span style=\"color:#a31515\">'ProgramId'</span>];\t\t\t\t\t\t\r\n\t\t$program   = getProgramName($prog, 1);\r\n\t\t\r\n\t\t$report[$status_count][<span style=\"color:#a31515\">'program'</span>][$program_count][<span style=\"color:#a31515\">'id'</span>] = $prog;\r\n\t\t$report[$status_count][<span style=\"color:#a31515\">'program'</span>][$program_count][<span style=\"color:#a31515\">'name'</span>] = $program;\r\n\t}\r\n\t\r\n\t<span style=\"color:green\">// Get the semester</span>\r\n\t<span style=\"color:blue\">if</span> ($semester != $rowf10[<span style=\"color:#a31515\">'SemesterId'</span>]) {\r\n\t\t$semester_count&#43;&#43;;\r\n\t\t$semester= $rowf10[<span style=\"color:#a31515\">'SemesterId'</span>];\r\n\t\t\r\n\t\t$report[$status_count][<span style=\"color:#a31515\">'program'</span>][$program_count][<span style=\"color:#a31515\">'semester'</span>][$semester_count][<span style=\"color:#a31515\">'semester_id'</span>] = $semester;\r\n\t}\r\n\t\r\n\t<span style=\"color:green\">// Get the student(s)</span>\r\n\t<span style=\"color:blue\">if</span> ($student_id != $rowf10[<span style=\"color:#a31515\">'sID'</span>]) {\r\n\t\t$student_count&#43;&#43;;\r\n\t\t$student_id = $rowf10[<span style=\"color:#a31515\">'sID'</span>];\r\n\t\t\r\n\t\t$report[$status_count][<span style=\"color:#a31515\">'program'</span>][$program_count][<span style=\"color:#a31515\">'semester'</span>][$semester_count][<span style=\"color:#a31515\">'student'</span>][$student_count][<span style=\"color:#a31515\">'student_id'</span>] = $student_id;\r\n\t\t$report[$status_count][<span style=\"color:#a31515\">'program'</span>][$program_count][<span style=\"color:#a31515\">'semester'</span>][$semester_count][<span style=\"color:#a31515\">'student'</span>][$student_count][<span style=\"color:#a31515\">'codes'</span>] = <span style=\"color:blue\">array</span>();\r\n\t\t$report[$status_count][<span style=\"color:#a31515\">'program'</span>][$program_count][<span style=\"color:#a31515\">'semester'</span>][$semester_count][<span style=\"color:#a31515\">'student'</span>][$student_count][<span style=\"color:#a31515\">'examid'</span>] = <span style=\"color:blue\">array</span>();\r\n\t\t\r\n\t\t<span style=\"color:green\">//if ($student_id == 26) echo $program.&quot;-&quot;.$semester.&quot;&lt;br/&gt;&quot;;</span>\r\n\t}\r\n\t\r\n\t<span style=\"color:green\">//Get the subject/course and mark</span>\r\n\t<span style=\"color:blue\">if</span> ($course_id != $rowf10[<span style=\"color:#a31515\">'CourseId'</span>]) {\r\n\t\t$course_id = $rowf10[<span style=\"color:#a31515\">'CourseId'</span>];\r\n\t}\r\n\t\t\r\n\t<span style=\"color:blue\">if</span>($rowf10[<span style=\"color:#a31515\">'mScore'</span>] != NULL){\r\n\t\t$marks = $rowf10[<span style=\"color:#a31515\">'mScore'</span>];\r\n\t} <span style=\"color:blue\">else</span> {\r\n\t\t$marks = $rowf10[<span style=\"color:#a31515\">'tScore'</span>];\r\n\t}\t\t\t\t\t\t\r\n\t\r\n\t<span style=\"color:green\">//$marks = $rowf10['mScore'];</span>\r\n\t\r\n\t$temp_array = <span style=\"color:blue\">array</span>($course_id =&gt; <span style=\"color:blue\">array</span>($rowf10[<span style=\"color:#a31515\">'CourseCode'</span>] =&gt; $marks));\r\n\t$exam_id_array = <span style=\"color:blue\">array</span>($course_id =&gt; $rowf10[<span style=\"color:#a31515\">'ExamId'</span>]);\r\n\t\r\n\t$report[$status_count][<span style=\"color:#a31515\">'program'</span>][$program_count][<span style=\"color:#a31515\">'semester'</span>][$semester_count][<span style=\"color:#a31515\">'student'</span>][$student_count][<span style=\"color:#a31515\">'codes'</span>][] = $temp_array;\r\n\t$report[$status_count][<span style=\"color:#a31515\">'program'</span>][$program_count][<span style=\"color:#a31515\">'semester'</span>][$semester_count][<span style=\"color:#a31515\">'student'</span>][$student_count][<span style=\"color:#a31515\">'examid'</span>][] = $exam_id_array;\r\n\t\r\n } <span style=\"color:green\">//end while $rowf10 ...</span>\r\n \r\n<span style=\"color:green\">//die();</span>\r\n<span style=\"color:green\">//print_r($report[0]['program'][0]['semester']);</span>\r\n<span style=\"color:green\">//die();</span>\r\n\r\n<span style=\"color:green\">// add data to worksheet</span>\r\n$shtCount = 0;\r\n<span style=\"color:blue\">foreach</span> ($report <span style=\"color:blue\">as</span> $status) {\r\n\t<span style=\"color:green\">// Get the civil status</span>\r\n\t<span style=\"color:green\">// Create the work sheet for each civil status at this stage</span>\r\n\t$civil_status_id = $status[<span style=\"color:#a31515\">'status_id'</span>];\r\n\t$cstatus =  $status[<span style=\"color:#a31515\">'civil_status'</span>];\r\n\t\r\n\t<span style=\"color:green\">//count for sheet lable</span>\r\n\t<span style=\"color:green\">//$shtCount = 0;</span>\r\n\t\r\n\t<span style=\"color:blue\">foreach</span> ($status[<span style=\"color:#a31515\">'program'</span>] <span style=\"color:blue\">as</span> $program =&gt; $program_data) {\r\n\t\t<span style=\"color:green\">// This is to pre-empt the maximum execution time problem</span>\r\n\t\t<span style=\"color:green\">//set_time_limit(240);</span>\r\n\t\t\t\t\t\r\n\t\t<span style=\"color:green\">// initialize/reset the statistics array (for subjects done..)</span>\r\n\t\t$student_statistics = <span style=\"color:blue\">array</span>();\r\n\r\n        <span style=\"color:green\">// Get the programs under each civil status</span>\r\n\t\t$program_id = $program_data[<span style=\"color:#a31515\">'id'</span>];\r\n\t\t\t\t\r\n\t\t$progname = substr($program_data[<span style=\"color:#a31515\">'name'</span>],22);\r\n\t\t$lblSheet = $progname. <span style=\"color:#a31515\">' ('</span>. $cstatus.<span style=\"color:#a31515\">')'</span>;\r\n\t\t\r\n\t\t$objPHPExcel-&gt;createSheet();\r\n\t\t$objPHPExcel-&gt;setActiveSheetIndex($shtCount);\r\n\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle($lblSheet);\r\n\t\t\r\n\t\t<span style=\"color:green\">// Start cell for the semester title</span>\r\n\t\t<span style=\"color:green\">//$start_cell_char = &quot;B&quot;;</span>\r\n\t\t$start_col_index = 0;\r\n\r\n\t\t<span style=\"color:green\">// Start column for the displaying the subject codes; subject codes are displayed below the title for the semester</span>\r\n        <span style=\"color:green\">// When the loop moves to the next program, a new worksheet is created and the counter is reset to 1</span>\r\n\t\t$column_index = 1;\r\n\t\t\r\n\t\t$rowCount = 3;\r\n\t\t\r\n\t\t<span style=\"color:green\">// Lookup dictionary for the students</span>\r\n\t\t$student_lookup_dictionary = <span style=\"color:blue\">array</span>();\r\n\t\t\r\n\t\t<span style=\"color:blue\">foreach</span> ($program_data[<span style=\"color:#a31515\">'semester'</span>] <span style=\"color:blue\">as</span> $semester=&gt;$semester_data) {\r\n\t\t\t<span style=\"color:green\">// This is to pre-empt the maximum execution time problem</span>\r\n\t\t\tset_time_limit(240);\r\n            <span style=\"color:green\">/**\r\n             * Get the semesters under each program\r\n             * ...but first count how many subjects returned per semester and store it in \r\n             * $columncount...\r\n             */</span>\r\n            \r\n            <span style=\"color:green\">// Get the semester id</span>\r\n\t\t\t$semester_id = $semester_data[<span style=\"color:#a31515\">'semester_id'</span>];\r\n            \r\n            <span style=\"color:green\">// Generate the subject fetch query</span>\r\n            $temp_subjects_query = sprintf($query_subjects, $program_id, $civil_status_id, $semester_id);\r\n  \r\n            <span style=\"color:green\">// Execute the query and store the results</span>\r\n\t\t\t$rstSubjects = mysql_query($temp_subjects_query) <span style=\"color:blue\">or</span> <span style=\"color:blue\">die</span>(mysql_error());\r\n                            \r\n\t\t\t<span style=\"color:green\">// Get the number of records returned - used to determine the no. of cells to merge</span>\r\n\t\t\t$column_count = mysql_num_rows($rstSubjects) <span style=\"color:blue\">or</span> <span style=\"color:blue\">die</span>(mysql_error());\r\n\r\n\t\t\t<span style=\"color:green\">/** Next, determine the start and end cell for the semester title\r\n\t\t\t  * This shall have to be computed by the script e.g. if the first cell for semester 1 is B1\r\n\t\t\t  * and semester 1 has 16 subjects, then the last cell shall be B17. The title for semester 2 \r\n\t\t\t  * shall however start at B18. There is therefore a need to have a variable that keeps track of \r\n\t\t\t  * the last cell so as to ensure the titles appear in the correct cell ranges.\r\n\t\t\t  */</span>\r\n\t\t\t$title = <span style=\"color:#a31515\">''</span>; <span style=\"color:green\">// variable to hold title per semester</span>\r\n\t\t\t$style = 1; <span style=\"color:green\">// variable to hold color and style scheme</span>\r\n\t\t\t<span style=\"color:blue\">switch</span> ($semester_id) {\r\n\t\t\t\t<span style=\"color:blue\">case</span> 1:\r\n\t\t\t\t\t<span style=\"color:green\">// set first year title</span>\r\n\t\t\t\t\t$title = <span style=\"color:#a31515\">'Annus I'</span>;\r\n\t\t\t\t\t$style = 1;\r\n\t\t\t\t\t<span style=\"color:blue\">break</span>;\r\n\t\t\t\t<span style=\"color:blue\">case</span> 2:\r\n\t\t\t\t\t<span style=\"color:green\">// set second year title</span>\r\n\t\t\t\t\t$title = <span style=\"color:#a31515\">'Annus II'</span>;\r\n\t\t\t\t\t$style = 2;\r\n\t\t\t\t\t$column_count = $column_count - 1; <span style=\"color:green\">// to compensate for shifting of $end_col_index...</span>\r\n\t\t\t\t\t<span style=\"color:blue\">break</span>;\r\n\t\t\t\t<span style=\"color:blue\">case</span> 3:\r\n\t\t\t\t\t<span style=\"color:green\">// set 3rd year title</span>\r\n\t\t\t\t\t$title = <span style=\"color:#a31515\">'Annus III'</span>;\r\n\t\t\t\t\t$style = 3;\r\n\t\t\t\t\t$column_count = $column_count - 1;\r\n\t\t\t\t\t<span style=\"color:blue\">break</span>;\r\n\t\t\t\t<span style=\"color:blue\">case</span> 4:\r\n\t\t\t\t\t<span style=\"color:green\">// set 4th year title</span>\r\n\t\t\t\t\t$title = <span style=\"color:#a31515\">'Annus IV'</span>;\r\n\t\t\t\t\t$style = 4;\r\n\t\t\t\t\t$column_count = $column_count - 1;\r\n\t\t\t\t\t<span style=\"color:blue\">break</span>;\r\n\t\t\t}\r\n\t\t\t<span style=\"color:green\">// Determine the end cell for the semester title</span>\r\n\t\t\t<span style=\"color:green\">//$end_cell_char = chr(ord($start_cell_char) &#43; $column_count );</span>\r\n\t\t\t$end_col_index = $start_col_index &#43; $column_count;\r\n\r\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;mergeCellsByColumnAndRow($start_col_index, 1, $end_col_index, 1);\r\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow($start_col_index, 1, $title);\r\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow($start_col_index, 1, $end_col_index, 1)-&gt;applyFromArray(getTitleColorArray($style));\r\n\t\t\t\r\n\t\t\t<span style=\"color:green\">// Set the start cell to the end cell</span>\r\n\t\t\t<span style=\"color:green\">//$start_cell_char = chr(ord($end_cell_char) &#43; 1);</span>\r\n\t\t\t$start_col_index = $end_col_index &#43; 1;\r\n\r\n\t\t\t<span style=\"color:green\">/** \r\n\t\t\t * Create the columns for each subject in the semester at this stage\r\n\t\t\t * NOTE: This will however require the course codes for the semester to have been independently \r\n\t\t\t *fetched in advance\r\n\t\t\t * \r\n\t\t\t */</span>\t\t\r\n\t\t\t\r\n\t\t\t<span style=\"color:green\">// Lookup buffer for the positioning of the marks</span>\r\n\t\t\t$lookup_dictionary = <span style=\"color:blue\">array</span>();\r\n\t\t\t\r\n\t\t\t<span style=\"color:blue\">while</span> ($rowSubjects = mysql_fetch_assoc($rstSubjects)) {\r\n\t\t\t\t<span style=\"color:green\">// Store the column position of each subject</span>\r\n\t\t\t\t$lookup_dictionary[$rowSubjects[<span style=\"color:#a31515\">'CourseCode'</span>]] = $column_index;\r\n\t\t\t\t\r\n\t\t\t\t<span style=\"color:green\">// Set column values (subject headings) for row 2</span>\r\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow($column_index, 2, $rowSubjects[<span style=\"color:#a31515\">'CourseCode'</span>]);\r\n\t\t\t\t\r\n\t\t\t\t<span style=\"color:green\">// Increment the column count</span>\r\n\t\t\t\t$column_index&#43;&#43;;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t<span style=\"color:green\">// Explicitly free the result handle though the MySQL engine implictly does this after a record fetch</span>\r\n            @mysql_free_result($rstSubjects) <span style=\"color:blue\">or</span> <span style=\"color:blue\">die</span>(mysql_error());\r\n\t\t\t\r\n\t\t\t<span style=\"color:blue\">foreach</span> ($semester_data[<span style=\"color:#a31515\">'student'</span>] <span style=\"color:blue\">as</span> $student=&gt;$student_data) {\r\n\t\t\t\t<span style=\"color:green\">/**\r\n                  * Get the students under each semester\r\n                  * It is in this iteration that the row count for the report is incremented\r\n                  */</span>\r\n                $name = getStudentName($student_data[<span style=\"color:#a31515\">'student_id'</span>]);\r\n\t\t\t\t$student_id = $student_data[<span style=\"color:#a31515\">'student_id'</span>];\r\n\t\t\t\t\r\n\t\t\t\t<span style=\"color:green\">// Check if the student id exists in the dictionary</span>\r\n\t\t\t\t<span style=\"color:blue\">if</span> ( ! array_key_exists($student_id, $student_lookup_dictionary)){\r\n\t\t\t\t\t$student_lookup_dictionary[$student_id] = $rowCount;\r\n\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t$objPHPExcel-&gt;setActiveSheetIndex($shtCount);\r\n\t\t\t\t\r\n\t\t\t\t<span style=\"color:green\">// Get the row index for the student's data</span>\r\n\t\t\t\t<span style=\"color:green\">// This is necessary so that the data for students who appear across semesters within the same program</span>\r\n\t\t\t\t<span style=\"color:green\">// appears in the same row in the Excel report</span>\r\n\t\t\t\t$row_index = $student_lookup_dictionary[$student_id];\r\n\r\n\t\t\t\t<span style=\"color:green\">// Enter name of student in first column</span>\r\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow(0, $row_index, $name);\r\n\t\t\t\t\r\n\t\t\t\t<span style=\"color:green\">// set hyperlink for retriving f10s...</span>\r\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getCellByColumnAndRow(0, \r\n\t\t\t\t\t$row_index)-&gt;getHyperlink()-&gt;setUrl(<span style=\"color:#a31515\">'http://localhost/istudium/admin_view_transcript.php?studentID='</span>.$student_id);\r\n\r\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getCellByColumnAndRow(0, \r\n\t\t\t\t\t$row_index)-&gt;getHyperlink()-&gt;setTooltip(<span style=\"color:#a31515\">'Click to download f10'</span>);\r\n\t\t\t\t\t\r\n\t\t\t\t<span style=\"color:green\">// Get the row_index (or student_id) in order to determine the row in which the student appears in the excel report;</span>\r\n\t\t\t\t<span style=\"color:green\">// when $student_id is used in the array, the values at the bottom of the xls sheet are truncated?!</span>\r\n\t\t\t\t<span style=\"color:blue\">if</span> ( ! array_key_exists($row_index, $student_statistics)) {\r\n\t\t\t\t\t$student_statistics[$row_index] = <span style=\"color:blue\">array</span>();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t<span style=\"color:blue\">foreach</span> ($student_data[<span style=\"color:#a31515\">'codes'</span>] <span style=\"color:blue\">as</span> $course_code=&gt;$course_data) {\r\n\t\t\t\t\t<span style=\"color:green\">// This is to pre-empt the maximum execution time problem</span>\r\n\t\t\t\t\t<span style=\"color:green\">//set_time_limit(240);</span>\r\n                    <span style=\"color:green\">// Get the subjects/codes and marks under each student</span>\r\n\t\t\t\t\t<span style=\"color:blue\">foreach</span> ($course_data <span style=\"color:blue\">as</span> $course_id=&gt;$course_id_data) {\r\n                        $item_counter = 0;\r\n\t\t\t\t\r\n                        <span style=\"color:blue\">foreach</span> ($course_id_data <span style=\"color:blue\">as</span> $course_code=&gt;$mark) {\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<span style=\"color:blue\">if</span> (array_key_exists($course_code, $lookup_dictionary)) {\r\n\t\t\t\t\t\t\t\t$mark_column = $lookup_dictionary[$course_code];\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t<span style=\"color:green\">// Get the exam ID for the current subject</span>\r\n\t\t\t\t\t\t\t\tIf (<span style=\"color:blue\">isset</span>($student_data[<span style=\"color:#a31515\">'examid'</span>][$item_counter][($item_counter&#43;1)])){\r\n\t\t\t\t\t\t\t\t\t$cur_exam_id = $student_data[<span style=\"color:#a31515\">'examid'</span>][$item_counter][($item_counter&#43;1)];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t<span style=\"color:green\">// Enter mark; the column co-ordinate corresponds to the subjects above...</span>\r\n\t\t\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow($mark_column,\r\n\t\t\t\t\t\t\t\t\t$row_index, $mark);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t<span style=\"color:green\">// Determine the no. of subjects sat for by the student using the $students_statistics array...</span>\r\n\t\t\t\t\t\t\t\t$student_codes = $student_statistics[$row_index];\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t<span style=\"color:blue\">if</span> (<span style=\"color:blue\">isset</span>($mark) &amp;&amp; $mark &gt; 0 &amp;&amp; !in_array($course_code, $student_codes)) {\r\n\t\t\t\t\t\t\t\t<span style=\"color:green\">//if (isset($mark) &amp;&amp; $mark &gt; 0 &amp;&amp; !array_search($course_code, $student_codes)) {</span>\r\n\t\t\t\t\t\t\t\t\tarray_push($student_codes, $course_code);\r\n\t\t\t\t\t\t\t\t\t$student_statistics[$row_index] = $student_codes;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t<span style=\"color:green\">// shade the cells...\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t$cellColor = <span style=\"color:#a31515\">''</span>;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t<span style=\"color:blue\">if</span> ($mark &gt;= 70) {\r\n\t\t\t\t\t\t\t\t\t$cellColor = $light_green;\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t} <span style=\"color:blue\">elseif</span> ($mark &gt;= 50 &amp;&amp; $mark &lt;=69) {\r\n\t\t\t\t\t\t\t\t\t$cellColor = $amber;\r\n\t\t\t\t\t\t\t\t} <span style=\"color:blue\">elseif</span> ($mark &gt;= 1 &amp;&amp; $mark &lt;=49) {\r\n\t\t\t\t\t\t\t\t\t$cellColor = $red;\r\n\t\t\t\t\t\t\t\t} <span style=\"color:blue\">else</span> {\r\n\t\t\t\t\t\t\t\t\t<span style=\"color:green\">// just leave it blank</span>\r\n\t\t\t\t\t\t\t\t\t$cellColor = $white;\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow($mark_column, \r\n\t\t\t\t\t\t\t\t\t$row_index)-&gt;getFill()-&gt;setFillType(PHPExcel_Style_Fill::FILL_SOLID);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow($mark_column, \r\n\t\t\t\t\t\t\t\t\t$row_index)-&gt;getFill()-&gt;getStartColor()-&gt;setRGB($cellColor);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow($mark_column, \r\n\t\t\t\t\t\t\t\t\t$row_index)-&gt;getFont()-&gt;getColor()-&gt;setRGB($cellColor);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t<span style=\"color:green\">// set hyperlink to folders that contain actae...</span>\r\n\t\t\t\t\t\t\t\t<span style=\"color:green\">//$today = date('Y-m-d');</span>\r\n\t\t\t\t\t\t\t\t<span style=\"color:green\">//$date = explode(&quot;-&quot;, $today);</span>\r\n\t\t\t\t\t\t\t\t<span style=\"color:green\">//obtain course name to use in tooltip...</span>\r\n\t\t\t\t\t\t\t\t$course_name = getCourse($course_id);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getCellByColumnAndRow($mark_column, \r\n\t\t\t\t\t\t\t\t\t$row_index)-&gt;getHyperlink()-&gt;setUrl(<span style=\"color:#a31515\">'http://localhost/istudium/result_summary2.php?courseID='</span>.$course_id.<span style=\"color:#a31515\">'&amp;examID='</span>.$cur_exam_id);\r\n\t\t\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getCellByColumnAndRow($mark_column, \r\n\t\t\t\t\t\t\t\t\t$row_index)-&gt;getHyperlink()-&gt;setTooltip(<span style=\"color:#a31515\">'Click to view the ['</span>.$course_name.<span style=\"color:#a31515\">'] Acta'</span>);\r\n\r\n\t\t\t\t\t\t\t\t<span style=\"color:green\">// Setting borders...</span>\r\n\t\t\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow($mark_column, \r\n\t\t\t\t\t\t\t\t\t$row_index)-&gt;getBorders()-&gt;getAllBorders()-&gt;setBorderStyle(PHPExcel_Style_Border::BORDER_THIN);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t<span style=\"color:green\">// Set border colors</span>\r\n\t\t\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow($mark_column, \r\n\t\t\t\t\t\t\t\t\t$row_index)-&gt;getBorders()-&gt;getAllBorders()-&gt;getColor()-&gt;setARGB(<span style=\"color:#a31515\">'FF993300'</span>);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t<span style=\"color:green\">// Set column width</span>\r\n\t\t\t\t\t\t\t\t<span style=\"color:green\">//$objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension($mark_column)-&gt;setWidth(12);</span>\r\n\t\t\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension(<span style=\"color:#a31515\">'A'</span>)-&gt;setAutoSize(true);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t$item_counter&#43;&#43;;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$rowCount &#43;&#43;;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\r\n         <span style=\"color:green\">//print_r($student_statistics);</span>\r\n         <span style=\"color:green\">//die;</span>\r\n\t\t\r\n\t\t<span style=\"color:green\">//Calculate the total number of subjects/courses per program...</span>\r\n\t\t$query_subj = <span style=\"color:#a31515\">&quot;SELECT * FROM courses WHERE ProgramId = $program_id ORDER BY Course ASC&quot;</span>;\r\n\t\t$result_subj = mysql_query($query_subj);\r\n\t\t$num_subjects = mysql_num_rows($result_subj);\r\n\t\t\r\n\t\t<span style=\"color:green\">// Set the headings for the stats...</span>\r\n\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow($column_index, 2, <span style=\"color:#a31515\">'Done'</span>);\r\n\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow($column_index, 2)\r\n\t\t\t-&gt;getAlignment()-&gt;setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);\r\n\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow($column_index &#43; 1, 2, <span style=\"color:#a31515\">'Pending'</span>);\r\n\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow($column_index &#43; 1, 2)\r\n\t\t\t-&gt;getAlignment()-&gt;setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);\r\n\t\t\r\n\t\t<span style=\"color:blue\">foreach</span>($student_statistics <span style=\"color:blue\">as</span> $key =&gt; $value) {\r\n\t\t\t<span style=\"color:green\">// Output subjects done...in last column...</span>\r\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow($column_index, $key, count($value));\r\n            \r\n            <span style=\"color:green\">// Caclculate the no. of subjects pending</span>\r\n            $subjects_pending = $num_subjects - count($value);\r\n            \r\n\t\t\t<span style=\"color:green\">// Output subjects pending...in next column...</span>\r\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow($column_index &#43; 1, $key, $subjects_pending);\r\n\t\t}\r\n\t\t\r\n\t\t<span style=\"color:green\">// Increment the sheet count</span>\r\n\t\t$shtCount&#43;&#43;;\r\n\t}\r\n}\r\n<span style=\"color:green\">//die;</span>\r\n<span style=\"color:green\">// fetch recordset for the key sheet</span>\r\n$query_key = &quot;SELECT c.CourseId, c.CourseCode, c.Course, s.SpecializationId, s.SName \r\n\t\t\tFROM courses c \r\n\t\t\tLEFT JOIN specializations s ON c.SpecializationId = s.SpecializationId\r\n\t\t\tWHERE c.ProgramId IN (1, 3) \r\n\t\t\tORDER BY c.CourseId ASC &quot;;\r\n\r\n$rst_key = mysql_query($query_key) <span style=\"color:blue\">or</span> <span style=\"color:blue\">die</span>(mysql_error());\r\n<span style=\"color:green\">// set the key sheet</span>\r\n$objPHPExcel-&gt;createSheet();\r\n$objPHPExcel-&gt;setActiveSheetIndex($shtCount);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle(<span style=\"color:#a31515\">&quot;Report Key&quot;</span>);\r\n<span style=\"color:green\">// set row count for the values...</span>\r\n$row_count = 3;\r\n<span style=\"color:blue\">while</span> ($row_key = mysql_fetch_assoc($rst_key)) {\r\n\t<span style=\"color:green\">// Set code and subject headings...</span>\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A1'</span>, <span style=\"color:#a31515\">'Code'</span>);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B1'</span>, <span style=\"color:#a31515\">'Subject'</span>);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C1'</span>, <span style=\"color:#a31515\">'Credits'</span>);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'E8'</span>)-&gt;getFill()-&gt;setFillType(PHPExcel_Style_Fill::FILL_SOLID);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'E9'</span>)-&gt;getFill()-&gt;setFillType(PHPExcel_Style_Fill::FILL_SOLID);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'E10'</span>)-&gt;getFill()-&gt;setFillType(PHPExcel_Style_Fill::FILL_SOLID);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'E8'</span>)-&gt;getFill()-&gt;getStartColor()-&gt;setRGB($light_green);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'E9'</span>)-&gt;getFill()-&gt;getStartColor()-&gt;setRGB($amber);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'E10'</span>)-&gt;getFill()-&gt;getStartColor()-&gt;setRGB($red);\r\n\t<span style=\"color:green\">// setting borders...</span>\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'E8'</span>)-&gt;getBorders()-&gt;getAllBorders()-&gt;setBorderStyle(PHPExcel_Style_Border::BORDER_THIN);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'E9'</span>)-&gt;getBorders()-&gt;getAllBorders()-&gt;setBorderStyle(PHPExcel_Style_Border::BORDER_THIN);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'E10'</span>)-&gt;getBorders()-&gt;getAllBorders()-&gt;setBorderStyle(PHPExcel_Style_Border::BORDER_THIN);\r\n\t<span style=\"color:green\">// Set border colors</span>\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'E8'</span>)-&gt;getBorders()-&gt;getAllBorders()-&gt;getColor()-&gt;setARGB(<span style=\"color:#a31515\">'FF993300'</span>);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'E8'</span>)-&gt;getBorders()-&gt;getAllBorders()-&gt;getColor()-&gt;setARGB(<span style=\"color:#a31515\">'FF993300'</span>);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'E8'</span>)-&gt;getBorders()-&gt;getAllBorders()-&gt;getColor()-&gt;setARGB(<span style=\"color:#a31515\">'FF993300'</span>);\r\n\t<span style=\"color:green\">// set the values </span>\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'F8'</span>, <span style=\"color:#a31515\">'Exam done successfully'</span>);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'F9'</span>, <span style=\"color:#a31515\">'Exam pending'</span>);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'F10'</span>, <span style=\"color:#a31515\">'Resit'</span>);\r\n\r\n\t<span style=\"color:green\">// populate the code, subject and credit values from recordset..</span>\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow(0, $row_count, $row_key[<span style=\"color:#a31515\">'CourseCode'</span>]);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow(1, $row_count, $row_key[<span style=\"color:#a31515\">'Course'</span>]);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow(2, $row_count, $row_key[<span style=\"color:#a31515\">'SName'</span>]);\r\n\t<span style=\"color:green\">// set column 'B' to autosize...</span>\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension(<span style=\"color:#a31515\">'B'</span>)-&gt;setAutoSize(true);\r\n\t<span style=\"color:green\">//$objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('B')-&gt;setWidth(14);</span>\r\n\t\r\n\t<span style=\"color:green\">// Increment the row count</span>\r\n\t$row_count&#43;&#43;;\r\n}\r\n\r\n<span style=\"color:green\">//Set up the document for display</span>\r\n$sheet = 0;\r\n<span style=\"color:blue\">foreach</span> ($objPHPExcel-&gt;getWorksheetIterator() <span style=\"color:blue\">as</span> $worksheet) {\r\n\t$objPHPExcel-&gt;setActiveSheetIndex($sheet);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getPageSetup()-&gt;setHorizontalCentered(true);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getPageSetup()-&gt;setVerticalCentered(false);\r\n\t<span style=\"color:green\">//$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle('Change Report');</span>\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getDefaultStyle()-&gt;getFont()-&gt;setName(<span style=\"color:#a31515\">'Calibri'</span>);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getDefaultStyle()-&gt;getFont()-&gt;setSize(10);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;freezePaneByColumnAndRow(1, 3);\r\n\t$sheet&#43;&#43;;\r\n}\r\n\r\n\r\n<span style=\"color:green\">//Flush the MySQL resource handle used for the data fetch</span>\r\nmysql_free_result($rstf10) <span style=\"color:blue\">or</span> <span style=\"color:blue\">die</span>(mysql_error());\r\n<span style=\"color:green\">//mysql_free_result($rstSubjects) or die(mysql_error());... already done above.</span>\r\nmysql_free_result($rst_key) <span style=\"color:blue\">or</span> <span style=\"color:blue\">die</span>(mysql_error());\r\n\r\n<span style=\"color:green\">//print_r($report[0]['program'][0]['semester'][0]);</span>\r\n<span style=\"color:green\">//die;</span>\r\n<span style=\"color:green\">//print_r($report[0]['program'][0]['semester'][0]['student'][53]);</span>\r\n<span style=\"color:green\">//die;</span>\r\n<span style=\"color:green\">//print_r($report);</span>\r\n<span style=\"color:green\">//die;</span>\r\n\r\n\t\t\t\t\r\n<span style=\"color:green\">//Set active sheet index to the first sheet, so Excel opens this as the first sheet</span>\r\n$objPHPExcel-&gt;setActiveSheetIndex(0);\r\n<span style=\"color:green\">//var_dump(iconv('UTF-8', 'UTF-16LE', 'x'));</span>\r\n\r\n\r\n<span style=\"color:green\">//Redirect output to a client�s web browser (Excel2007)</span>\r\nheader(<span style=\"color:#a31515\">'Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'</span>);\r\nheader(<span style=\"color:#a31515\">'Content-Disposition: attachment;filename=&quot;StatusReport-'</span>.date(<span style=\"color:#a31515\">'dMY'</span>).<span style=\"color:#a31515\">'.xlsx&quot;'</span>);\r\nheader(<span style=\"color:#a31515\">'Cache-Control: max-age=0'</span>);\r\n\r\n$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color:#a31515\">'Excel2007'</span>);\r\n$objWriter-&gt;save(<span style=\"color:#a31515\">'php://output'</span>);\r\n<span style=\"color:green\">//$objWriter-&gt;save(str_replace('.php', '.xlsx', __FILE__));</span>\r\n<span style=\"color:green\">//exit;</span>\r\n\t\t\t\t\r\n<span style=\"color:green\">/*\r\n// or save to disc..\r\n$writer = new PHPExcel_Writer_Excel2007($objPHPExcel);\r\n$writer-&gt;save('Reports/Report-'. date('dMY').'.xlsx');\r\n            \r\necho date('H:i:s') . &quot; Download Complete\\n&quot;;\r\n*/</span>\r\n<span style=\"color:green\">// clear workbook from memory...</span>\r\n$objPHPExcel-&gt;disconnectWorksheets();\r\n<span style=\"color:blue\">unset</span>($objPHPExcel);\r\n<span style=\"color:green\">//Delete the arrays</span>\r\n<span style=\"color:blue\">unset</span>($report);\r\n<span style=\"color:blue\">unset</span>($lookup_dictionary);\r\n<span style=\"color:blue\">unset</span>($student_lookup_dictionary);\r\n<span style=\"color:blue\">unset</span> ($student_statistics);\r\n<span style=\"color:blue\">exit</span>;\r\n?&gt;\r\n</pre>\r\n</div>\r\nI am a new user of this great library. &nbsp;The following is the code I have developed to output student data from a recordset to an xlsx file. &nbsp;I have a strange feeling that it is somewhat cumbersome for it takes sometime to download. &nbsp;Could anyone\r\n help to optimize it?\r\n<p></p>\r\n<p>&nbsp;</p>\r\n<p></p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>\r\n</pre>\r\n</div>\r\n<p></p>\r\n",
    "PostedDate": "2011-09-12T00:28:31.587-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "676401",
    "ThreadId": "272254",
    "Html": "<p>I may have placed the query at the end of the code snippet...reason for no reply so far. &nbsp;It takes a bit of time to download...could anyone help in optimizing it?</p>",
    "PostedDate": "2011-09-25T11:45:16.76-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]