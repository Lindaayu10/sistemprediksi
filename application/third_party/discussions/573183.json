[
  {
    "Id": "1326251",
    "ThreadId": "573183",
    "Html": "Please help. I've written some PHP excel to export some data to an excel file. This works perfectly fine. \r<br />\n<br />\nI then changed the code adding headers and output to export the data, but it is <strong>now outputting the webpage not the file</strong>. I'm completely new to this, and can't find any previous questions relevant to this. Here is my code: \r<br />\n<br />\nif(isset($_POST['esd']))\r<br />\n{<br />\n<pre><code>$sqlcust = &quot;SELECT * FROM compliance_customers WHERE Customer_ref = &quot; . $_REQUEST['cust'];\n$sqlcustresult = mysqli_query($conn, $sqlcust);\nwhile($row_sqlcustresult = mysqli_fetch_array($sqlcustresult))\n{\n    $name = $row_sqlcustresult['Customer_name'];\n}\nheader('Content-Type: application/vnd.ms-excel');\nheader('Content-Disposition: attachment;filename=&quot;'.$name.'_'.$date.'.xlsx&quot;');</code></pre>\n\n}<br />\n<h1>use php excel to create a spreadsheet of the customers current subscription</h1>\nif( (isset($_REQUEST['esd'])) &amp;&amp; (!isset($noEsd)) )\r<br />\n{<br />\n<pre><code>// Set properties for the excel file\n$objPHPExcel = new PHPExcel();\n\n$objPHPExcel-&gt;getProperties()-&gt;setCreator($_SESSION['username']);\n$objPHPExcel-&gt;getProperties()-&gt;setLastModifiedBy($_SESSION['username']);\n$objPHPExcel-&gt;getProperties()-&gt;setTitle(&quot;Office 2007 XLSX Customer export_&quot; . $customername);\n$objPHPExcel-&gt;getProperties()-&gt;setSubject(&quot;Office 2007 XLSX Customer export_&quot; . $customername);\n$objPHPExcel-&gt;getProperties()-&gt;setDescription($customername . &quot;_&quot; . $date);\n\n$cnt_current_record = 2;\n\n$objPHPExcel-&gt;getActiveSheet()-&gt;SetCellValue('A1', 'Content Name');\n$objPHPExcel-&gt;getActiveSheet()-&gt;SetCellValue('B1', 'Content Type');\n$objPHPExcel-&gt;getActiveSheet()-&gt;SetCellValue('C1', 'Content Description');\n\n$sql_excelfile = &quot;SELECT * FROM compliance_changes ORDER BY change_type&quot;;\n$result_sql_excelfile = mysqli_query($conn, $sql_excelfile);\nwhile($row_sql_excelfile = mysqli_fetch_array($result_sql_excelfile))\n{\n    if(in_array($row_sql_excelfile['change_name'], $excel_array))\n    {\n        #echo  &quot;&lt;tr class='subscriptiondetails'&gt;&lt;td&gt;&quot; .$row_sql_excel['change_name'].&quot;&lt;/td&gt;&lt;td&gt;&quot; .$row_sql_excel['change_type'].&quot;&lt;/td&gt;&lt;td&gt;&quot;. $row_sql_excel['change_description'].&quot;&lt;/td&gt;&lt;/tr&gt;&quot;;\n        #$objPHPExcel-&gt;setActiveSheetIndex($cnt_current_record);\n        $objPHPExcel-&gt;getActiveSheet()-&gt;SetCellValue('A' . $cnt_current_record, $row_sql_excelfile['change_name']);\n        $objPHPExcel-&gt;getActiveSheet()-&gt;SetCellValue('B' . $cnt_current_record, $row_sql_excelfile['change_type']);\n        $objPHPExcel-&gt;getActiveSheet()-&gt;SetCellValue('C' . $cnt_current_record, $row_sql_excelfile['change_description']);\n        $cnt_current_record++;\n    }\n}\n#rename sheet\n$sheet_title = $customername;\n$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle($sheet_title);\n\n#write the xls file\n#$objWriter = new PHPExcel_Writer_Excel2007($objPHPExcel);\n$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');\n$filename = $customername . &quot;_&quot; . $date . &quot;.xlsx&quot;;\n#$objWriter-&gt;save(str_replace('customerdetail2.php', $filename, __FILE__));\n\n$objWriter-&gt;save(str_replace('customerdetail2.php', $filename, 'php://output'));\n\n#echo the file has been written\necho $filename . &quot; has been created&quot;;\n\n#$noEsd = 'Yes';</code></pre>\n\n}    \r<br />\n",
    "PostedDate": "2014-11-26T01:04:33.287-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]