[
  {
    "Id": "1219785",
    "ThreadId": "538117",
    "Html": "Hello folks !<br />\n<br />\nI create an Excel file with PHPExcel. I need to insert a file for every line.<br />\nI first download the file from a third party web site. I record it on the current file system. <br />\nThen I insert it in the Excel file;<br />\n<pre><code>                $photoProd = getPhotoProduit($db, $planVenteCourant-&gt;id_produit);    \n                $objDrawingVignette = new PHPExcel_Worksheet_Drawing(); \n                $objDrawingVignette-&gt;setName('Logo'); \n                $objDrawingVignette-&gt;setDescription('Logo');\n                if(isset($photoProd)) {\n                    if($photoProd-&gt;path!=&quot;&quot;) {\n                        // Si la photo existe, on l'affiche\n                        $opts = array(\n                          'http'=&gt;array(\n                            'method'=&gt;&quot;GET&quot;,\n                            'header'=&gt;&quot;Accept-language: fr\\r\\n&quot; .\n                                      &quot;Cookie: foo=bar\\r\\n&quot;\n                          )\n                        );\n\n                        $context = stream_context_create($opts);\n\n                        // Accès à un fichier HTTP avec les entêtes HTTP indiqués ci-dessus\n                        if(!file_exists($tmpFilePath.'/'.$photoProd-&gt;attachmentsid.'_'.$photoProd-&gt;name)) {\n                            $file = file_get_contents('http://galy.preprod-evencom.fr/crm/'.$photoProd-&gt;path.$photoProd-&gt;attachmentsid.'_'.utf8_encode($photoProd-&gt;name), false, $context);\n\n                            if(!($file === FALSE)) {\n                                file_put_contents($tmpFilePath.'/'.$photoProd-&gt;attachmentsid.'_'.$photoProd-&gt;name, $file);\n'.$tmpFilePath.'/'.$photoProd-&gt;attachmentsid.'_'.$photoProd-&gt;name.&quot;\\n&quot;;\n                                $objDrawingVignette-&gt;setPath($tmpFilePath.'/'.$photoProd-&gt;attachmentsid.'_'.$photoProd-&gt;name);                      \n                            } else {\n                                $objDrawingVignette-&gt;setPath('./images/no-photo.gif');\n                            }\n                        } else {\n                            $objDrawingVignette-&gt;setPath($tmpFilePath.'/'.$photoProd-&gt;attachmentsid.'_'.$photoProd-&gt;name);\n                        }\n                        \n                    } else {\n                        $objDrawingVignette-&gt;setPath('./images/no-photo.gif');\n                    }\n                }else{\n                    $objDrawingVignette-&gt;setPath('./images/no-photo.gif');\n                }\n                \n                // Corrige l'alignement\n                $objDrawingVignette-&gt;setWidth(24);\n                $objDrawingVignette-&gt;setHeight(36);\n                $objDrawingVignette-&gt;setOffsetX(2);\n                $objDrawingVignette-&gt;setOffsetY(1);\n                $objDrawingVignette-&gt;setWorksheet($sheet);\n                                $objDrawingVignette-&gt;setCoordinates(PHPExcel_Cell::stringFromColumnIndex(1).$numLigne);\n</code></pre>\n\nI have some troubles when the file contains an accent. For exemple one file is called : 2349_nectar_pêche_2l.jpg.<br />\n<br />\nThere is not any error during the process. But I get a message when I open the Excel file : <br />\n<blockquote>\n&quot;Excel has met an unreadable content in the file. Do you want to restore the sheet ? If the sheet source is reliable, ckick on Yes&quot;.<br />\nThen I get the message : <br />\nExcel a terminé la validation et la réparation de niveau fichier. Certaines parties du classeur peuvent avoir été réparées ou abandonnées.<br />\nEnregistrements réparés: Dessin dans la partie /xl/drawings/drawing1.xml (Forme de dessin)<br />\nThe error log file is : <br />\n</blockquote>\n<pre><code>&lt;recoveryLog&gt;\n &lt;logFileName&gt;error037320_01.xml&lt;/logFileName&gt;\n &lt;summary&gt;Des erreurs ont été détectées dans le fichier « C:\\Users\\EVENCO~1\\AppData\\Local\\Temp\\Plan Ventes Gamme SCAOUEST 2014-03-06-5.xlsx »&lt;/summary&gt;\n&lt;additionalInfo&gt;\n &lt;info&gt;Excel a terminé la validation et la réparation de niveau fichier. Certaines parties du classeur peuvent avoir été réparées ou abandonnées.&lt;/info&gt;\n &lt;/additionalInfo&gt;\n&lt;repairedRecords summary=&quot;Liste des réparations :&quot;&gt;\n &lt;repairedRecord&gt;Enregistrements réparés: Dessin dans la partie /xl/drawings/drawing1.xml (Forme de dessin)&lt;/repairedRecord&gt;\n &lt;/repairedRecords&gt;\n &lt;/recoveryLog&gt;</code></pre>\n\nI have unzipped the Excel File.<br />\nIn the folder /xl/media, the file is renamed to :   2349_nectar_pÛche_2l45.jpg<br />\n<br />\nIn the folder / xl/drawings/_rels, the file drawing1.xml.rels containe the file name : 2349_nectar_pêche_2l45.jpg<br />\n<pre><code>&lt;Relationship Id=&quot;rId45&quot; Type=&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/image&quot; Target=&quot;../media/2349_nectar_pêche_2l45.jpg&quot;/&gt;</code></pre>\n\nHas anybody any idea to fix this problem ?<br />\n<br />\nThanks in advance for your help.<br />\n<br />\nRegard,<br />\n<br />\nXavier<br />\n",
    "PostedDate": "2014-03-06T01:09:15.967-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]