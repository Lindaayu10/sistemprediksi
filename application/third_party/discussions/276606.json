[
  {
    "Id": "686960",
    "ThreadId": "276606",
    "Html": "\r\n<p>Hi,&nbsp; I am was using version 1.7.5 and have a portion of my application were I need to create an excel file from a template, but add data to it from a MySQL database.&nbsp; The issue is that, once I get over 200 rows I get a timeout from the browser.&nbsp;\r\n Does anyone else create something that has maybe 1,000 new rows added to it without problems?&nbsp; I have been thinking of running it on a separate process, but before I try that, I wanted to see if maybe I was missing something.&nbsp; Here is the main function\r\n that I use:</p>\r\n<p>I recently tried to chunk (do{...}while() block) the query to see if that was the problem, but it also did not work.&nbsp; Any thoughts or suggestions?&nbsp;</p>\r\n<p></p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:blue\">function</span> run_excel($quoteId)\r\n\t{\r\n\t\tset_time_limit(0);\r\n\t\t\r\n\t\t$this-&gt;phpexcel-&gt;objReader = PHPExcel_IOFactory::createReader(<span style=\"color:#a31515\">'Excel2007'</span>);\r\n\t\t$this-&gt;phpexcel-&gt;objPHPExcel = $this-&gt;phpexcel-&gt;objReader-&gt;load(<span style=\"color:#a31515\">&quot;templates/quotetemplate.xlsx&quot;</span>);\r\n\t\t$sheet = $this-&gt;phpexcel-&gt;objPHPExcel-&gt;getActiveSheet();\r\n\t\t\r\n\t\t$rowCount = $this-&gt;get_quote_items_count($quoteId);\r\n\t\t\r\n\t\t\r\n\t\t<span style=\"color:green\">//----------------------------------</span>\r\n\t\t<span style=\"color:green\">//Header info</span>\r\n\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'G4'</span>, $data[<span style=\"color:#a31515\">'info'</span>]-&gt;quote_id);\r\n\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'B8'</span>, $data[<span style=\"color:#a31515\">'info'</span>]-&gt;company_name);\r\n\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'B9'</span>, $data[<span style=\"color:#a31515\">'info'</span>]-&gt;project_name);\r\n\t\t$fullName = $data[<span style=\"color:#a31515\">'info'</span>]-&gt;first_name . <span style=\"color:#a31515\">' '</span> . $data[<span style=\"color:#a31515\">'info'</span>]-&gt;last_name;\r\n\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'B10'</span>, $fullName);\r\n\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'A15'</span>, $data[<span style=\"color:#a31515\">'info'</span>]-&gt;project_rep);\r\n\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'B15'</span>, $data[<span style=\"color:#a31515\">'info'</span>]-&gt;project_number);\r\n\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'G6'</span>, $data[<span style=\"color:#a31515\">'info'</span>]-&gt;customer_id);\r\n\t\t$sheet-&gt;getStyle(<span style=\"color:#a31515\">'A14:G14'</span>)-&gt;applyFromArray(\r\n\t\t\t\t\t<span style=\"color:blue\">array</span>(\r\n\t\t\t\t\t\t<span style=\"color:#a31515\">'fill'</span> \t\t\t=&gt; <span style=\"color:blue\">array</span>(\r\n\t\t\t\t\t\t\t<span style=\"color:#a31515\">'type'</span>\t\t\t=&gt; PHPExcel_Style_Fill::FILL_SOLID,\r\n\t\t\t\t\t\t\t<span style=\"color:#a31515\">'color'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'argb'</span> =&gt; <span style=\"color:#a31515\">'000000'</span>)\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\t<span style=\"color:#a31515\">'font'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(\r\n\t\t\t\t\t\t\t<span style=\"color:#a31515\">'color'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'argb'</span> =&gt; <span style=\"color:#a31515\">'ffffff'</span>),\r\n\t\t\t\t\t\t\t<span style=\"color:#a31515\">'bold'</span>\t\t\t=&gt; true\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t  \t<span style=\"color:#a31515\">'borders'</span> \t\t=&gt; <span style=\"color:blue\">array</span>(\r\n\t\t\t\t\t\t\t<span style=\"color:#a31515\">'bottom'</span>\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),\r\n\t\t\t\t\t\t\t<span style=\"color:#a31515\">'right'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),\r\n\t\t\t\t\t\t\t<span style=\"color:#a31515\">'left'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),\r\n\t\t\t\t\t\t\t<span style=\"color:#a31515\">'top'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN)\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t);\r\n\t\t\r\n\t\t$sheet-&gt;getStyle(<span style=\"color:#a31515\">'A17:G17'</span>)-&gt;applyFromArray(\r\n\t\t\t\t\t<span style=\"color:blue\">array</span>(\r\n\t\t\t\t\t\t<span style=\"color:#a31515\">'fill'</span> \t\t\t=&gt; <span style=\"color:blue\">array</span>(\r\n\t\t\t\t\t\t\t<span style=\"color:#a31515\">'type'</span>\t\t\t=&gt; PHPExcel_Style_Fill::FILL_SOLID,\r\n\t\t\t\t\t\t\t<span style=\"color:#a31515\">'color'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'argb'</span> =&gt; <span style=\"color:#a31515\">'000000'</span>)\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\t<span style=\"color:#a31515\">'font'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(\r\n\t\t\t\t\t\t\t<span style=\"color:#a31515\">'color'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'argb'</span> =&gt; <span style=\"color:#a31515\">'ffffff'</span>),\r\n\t\t\t\t\t\t\t<span style=\"color:#a31515\">'bold'</span>\t\t\t=&gt; true\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t  \t<span style=\"color:#a31515\">'borders'</span> \t\t=&gt; <span style=\"color:blue\">array</span>(\r\n\t\t\t\t\t\t\t<span style=\"color:#a31515\">'bottom'</span>\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),\r\n\t\t\t\t\t\t\t<span style=\"color:#a31515\">'right'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),\r\n\t\t\t\t\t\t\t<span style=\"color:#a31515\">'left'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),\r\n\t\t\t\t\t\t\t<span style=\"color:#a31515\">'top'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN)\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t);\r\n\t\t\r\n\t\t\r\n\t\t<span style=\"color:green\">//Install &amp; Shipping</span>\r\n\t\t($data[<span style=\"color:#a31515\">'info'</span>]-&gt;ovr_install == 1) ? $sheet-&gt;setCellValue(<span style=\"color:#a31515\">'G22'</span>, $data[<span style=\"color:#a31515\">'info'</span>]-&gt;install_val) : $sheet-&gt;setCellValue(<span style=\"color:#a31515\">'G22'</span>, <span style=\"color:#a31515\">'=G21 * '</span>.$data[<span style=\"color:#a31515\">'info'</span>]-&gt;install_perc.<span style=\"color:#a31515\">'%'</span>);\r\n\t\t\r\n\t\t($data[<span style=\"color:#a31515\">'info'</span>]-&gt;ovr_ship == 1) ? $sheet-&gt;setCellValue(<span style=\"color:#a31515\">'G23'</span>, $data[<span style=\"color:#a31515\">'info'</span>]-&gt;ship_val) : $sheet-&gt;setCellValue(<span style=\"color:#a31515\">'G23'</span>, <span style=\"color:#a31515\">'=G21 * '</span>.$data[<span style=\"color:#a31515\">'info'</span>]-&gt;ship_perc.<span style=\"color:#a31515\">'%'</span>);\r\n\t\t\r\n\t\t<span style=\"color:green\">//--------------------------------------------------</span>\r\n\t\t<span style=\"color:green\">//Process data</span>\r\n\t\t$baseRow = 19;\t\r\n\t\t$row = $baseRow;\r\n\t\t$group = <span style=\"color:#a31515\">''</span>;\r\n\t\t$<span style=\"color:blue\">continue</span> = TRUE;\r\n\t\t$rowLimit = 50;\r\n\t\t\r\n\t\t<span style=\"color:blue\">do</span> {\r\n\t\t\t\r\n\t\t\t$data = $this-&gt;get_quote_items_xls($quoteId, 0, $rowLimit);\r\n\t\t\t\r\n\t\t\t<span style=\"color:blue\">foreach</span>($data[<span style=\"color:#a31515\">'rows'</span>] <span style=\"color:blue\">as</span> $r =&gt; $dataRow)\r\n\t\t\t{\r\n\t\t\t\tset_time_limit(30);\r\n\t\t\t\t<span style=\"color:blue\">if</span>($data[<span style=\"color:#a31515\">'combined'</span>] == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\t<span style=\"color:blue\">if</span>($group != $dataRow-&gt;groups)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$group = $dataRow-&gt;groups;\r\n\t\t\t\t\t\t$sheet-&gt;insertNewRowBefore($row,2);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'A'</span>.$row, strtoupper($dataRow-&gt;groups));\r\n\t\t\t\t\t\t$sheet-&gt;mergeCells(<span style=\"color:#a31515\">'A'</span>.$row.<span style=\"color:#a31515\">':G'</span>.$row);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t$sheet-&gt;getStyle(<span style=\"color:#a31515\">'A'</span>.$row.<span style=\"color:#a31515\">':G'</span>.$row)-&gt;applyFromArray(\r\n\t\t\t\t\t\t\t<span style=\"color:blue\">array</span>(\r\n\t\t\t\t\t\t\t\t<span style=\"color:#a31515\">'alignment'</span> \t=&gt; <span style=\"color:blue\">array</span>(\r\n\t\t\t\t\t\t\t\t\t<span style=\"color:#a31515\">'horizontal'</span>\t=&gt; PHPExcel_Style_Alignment::HORIZONTAL_LEFT\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\t<span style=\"color:#a31515\">'fill'</span> \t\t\t=&gt; <span style=\"color:blue\">array</span>(\r\n\t\t\t\t\t\t\t\t\t<span style=\"color:#a31515\">'type'</span>\t\t\t=&gt; PHPExcel_Style_Fill::FILL_SOLID,\r\n\t\t\t\t\t\t\t\t\t<span style=\"color:#a31515\">'color'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'argb'</span> =&gt; <span style=\"color:#a31515\">'000000'</span>)\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\t<span style=\"color:#a31515\">'font'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(\r\n\t\t\t\t\t\t\t\t\t<span style=\"color:#a31515\">'color'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'argb'</span> =&gt; <span style=\"color:#a31515\">'ffffff'</span>),\r\n\t\t\t\t\t\t\t\t\t<span style=\"color:#a31515\">'bold'</span>\t\t\t=&gt; true\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\t<span style=\"color:#a31515\">'borders'</span> \t\t=&gt; <span style=\"color:blue\">array</span>(\r\n\t\t\t\t\t\t\t\t\t<span style=\"color:#a31515\">'bottom'</span>\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),\r\n\t\t\t\t\t\t\t\t\t<span style=\"color:#a31515\">'right'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),\r\n\t\t\t\t\t\t\t\t\t<span style=\"color:#a31515\">'left'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN),\r\n\t\t\t\t\t\t\t\t\t<span style=\"color:#a31515\">'top'</span>\t\t\t=&gt; <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'style'</span> =&gt; PHPExcel_Style_Border::BORDER_THIN)\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\t$row = $row &#43; 2;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\t$sheet-&gt;insertNewRowBefore($row,1);\r\n\t\t\t\t\r\n\t\t\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'A'</span>.$row, $dataRow-&gt;qty);\r\n\t\t\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'B'</span>.$row, $dataRow-&gt;catalog_number);\r\n\t\t\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'C'</span>.$row, $dataRow-&gt;long_description);\r\n\t\t\t\t$sheet-&gt;mergeCells(<span style=\"color:#a31515\">'C'</span>.$row.<span style=\"color:#a31515\">':D'</span>.$row);\r\n\t\t\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'E'</span>.$row, <span style=\"color:#a31515\">'=M'</span>.$row);\r\n\t\t\t\t\r\n\t\t\t\t$lineTotal = <span style=\"color:#a31515\">'=E'</span>.$row.<span style=\"color:#a31515\">'*A'</span>.$row;\r\n\t\t\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'G'</span>.$row, $lineTotal);\r\n\t\t\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'J'</span>.$row, $dataRow-&gt;base_cost);\r\n\t\t\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'K'</span>.$row, 1.0); <span style=\"color:green\">//escalation</span>\r\n\t\t\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'L'</span>.$row, $dataRow-&gt;margin);\r\n\t\t\t\t\r\n\t\t\t\t$sell = <span style=\"color:#a31515\">'=((J'</span>.$row.<span style=\"color:#a31515\">'*K'</span>.$row.<span style=\"color:#a31515\">')/(1-L'</span>.$row.<span style=\"color:#a31515\">'))'</span>;\r\n\t\t\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'M'</span>.$row, $sell);\r\n\t\t\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'N'</span>.$row, ($dataRow-&gt;commission_prc &lt;= 0)? 0 : <span style=\"color:#a31515\">'='</span>.$dataRow-&gt;commission_prc.<span style=\"color:#a31515\">'/100'</span>);\r\n\t\t\t\t\r\n\t\t\t\t$finMargin = <span style=\"color:#a31515\">'=(M'</span>.$row.<span style=\"color:#a31515\">'-((M'</span>.$row.<span style=\"color:#a31515\">'*N'</span>.$row.<span style=\"color:#a31515\">')&#43;J'</span>.$row.<span style=\"color:#a31515\">'))/M'</span>.$row;\r\n\t\t\t\t$sheet-&gt;setCellValue(<span style=\"color:#a31515\">'O'</span>.$row, $finMargin);\r\n\t\t\t\t\r\n\t\t\t\t<span style=\"color:green\">//increment row</span>\r\n\t\t\t\t$row = $row &#43; 1;\r\n\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t<span style=\"color:blue\">if</span>($rowLimit &gt; $rowCount)\r\n\t\t\t{\r\n\t\t\t\t$<span style=\"color:blue\">continue</span> = FALSE;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t$rowLimit = $rowLimit &#43; 50;\r\n\t\t\t\r\n\t\t\t\r\n\t\t} <span style=\"color:blue\">while</span> ($<span style=\"color:blue\">continue</span> == TRUE);\r\n\t\t\r\n\t\t\t\r\n\t\t$sheet-&gt;removeRow(18,1);\r\n\t\t\r\n\t\t$printRow = $row &#43; 8;\r\n\t\t$sheet-&gt;getPageSetup()-&gt;setPrintArea(<span style=\"color:#a31515\">&quot;A1:G&quot;</span>.$printRow);\r\n\t\t$sheet-&gt;getPageSetup()-&gt;setFitToWidth(1, true);\r\n\t\t\r\n\t\t\r\n\t\t$fileName = $quoteId.<span style=\"color:#a31515\">'-'</span>.date(<span style=\"color:#a31515\">'Y-m-d'</span>).<span style=\"color:#a31515\">'.xlsx'</span>;\r\n\t\t$<span style=\"color:blue\">file</span> = <span style=\"color:#a31515\">'uploads/quotes/'</span>.$fileName;\r\n\t\t<span style=\"color:blue\">if</span>(file_exists($<span style=\"color:blue\">file</span>))\r\n\t\t{\r\n\t\t\tunlink($<span style=\"color:blue\">file</span>);\r\n\t\t}\r\n\t\t\t\r\n\t\t$this-&gt;phpexcel-&gt;objWriter = PHPExcel_IOFactory::createWriter($this-&gt;phpexcel-&gt;objPHPExcel, <span style=\"color:#a31515\">'Excel2007'</span>);\r\n\t\t$this-&gt;phpexcel-&gt;objWriter-&gt;save($<span style=\"color:blue\">file</span>);\r\n\t\t$this-&gt;phpexcel-&gt;objPHPExcel-&gt;disconnectWorksheets();\r\n\t\t\r\n\t\t<span style=\"color:blue\">unset</span>($this-&gt;objWriter);\r\n\t\t<span style=\"color:blue\">unset</span>($this-&gt;objReader);\r\n\t\t<span style=\"color:blue\">unset</span>($this-&gt;objPHPExcel);\r\n\t\t\r\n\t\t$response = <span style=\"color:blue\">array</span>(\r\n\t\t\t<span style=\"color:#a31515\">'success'</span> =&gt; TRUE,\r\n\t\t\t<span style=\"color:#a31515\">'file'</span> =&gt; $fileName\r\n\t\t);\r\n\t\t\r\n\t\t<span style=\"color:blue\">return</span> $response;\r\n\t\t\r\n\t}\r\n</pre>\r\n</div>\r\n<p></p>\r\n",
    "PostedDate": "2011-10-20T09:15:37.81-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1257843",
    "ThreadId": "276606",
    "Html": "Adding borders to cells can significantly increase the time to generate the Excel file. I had a script that was generating a file containing 15 column and 1500 rows - it took 150sec to build with borders on the cells, only 25 secs without the borders.<br />\n",
    "PostedDate": "2014-06-19T04:50:28.78-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1257862",
    "ThreadId": "276606",
    "Html": "It's also possible to benefit by applying <code>allborders</code> to a range of cells, rather than applying borders to individual cells<br />\n",
    "PostedDate": "2014-06-19T05:48:47.797-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]