[
  {
    "Id": "705184",
    "ThreadId": "281289",
    "Html": "<p>Hello!</p>\n<p>I have a problem with the nested grouping in the last row. I am reading a tree from the database which should be exported to excel using grouping.</p>\n<p>The problem is, that the last row in the third level is not showing a collapsable/expandable grouping area at the third level. But using the numbers above (1 / 2 / 3 /4) will show/hide the correct nodes in the tree.</p>\n<p>I also tried an isolation of the problem with a smaller example but the  same problem occurs. The fact is that the layer dots at the place of the  grouping are in the correct column (see under layer 4 screenshot on the  left side) but there is no expander.</p>\n<p>I am trying since hours to fix the problem. Is there someone who can help me?</p>\n<p><img src=\"http://img254.imageshack.us/img254/4250/nogroupingatlastrow.jpg\" alt=\"\" /></p>\n<p>Small compressed isolated example:</p>\n<p>\n<div style=\"color: black; background-color: white;\">\n<pre>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color: #a31515;\">'A1'</span>, <span style=\"color: #a31515;\">\"test1\"</span>);\t\n$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension(1)-&gt;setOutlineLevel(0);\n$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension(1)-&gt;setVisible(true);\n$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension(1)-&gt;setCollapsed(false);\n\n$i=2;\n<span style=\"color: blue;\">while</span>($i&lt;1000)\n{\n\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color: #a31515;\">'A'</span> . $i, <span style=\"color: #a31515;\">\"test\"</span>.$i);\t\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($i)-&gt;setOutlineLevel(1);\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($i)-&gt;setVisible(true);\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($i)-&gt;setCollapsed(false);\n\t$i++;\n\t\n\t<span style=\"color: blue;\">for</span>($j=0;$j&lt;5;$j++)\n\t{\n\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color: #a31515;\">'A'</span> . $i, <span style=\"color: #a31515;\">\"test\"</span>.$i);\t\n\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($i)-&gt;setOutlineLevel(2);\n\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($i)-&gt;setVisible(true);\n\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($i)-&gt;setCollapsed(false);\t\t\n\t\t$i++;\n\t\t\n\t\t<span style=\"color: blue;\">for</span>($k=0;$k&lt;5;$k++)\n\t\t{\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color: #a31515;\">'A'</span> . $i, <span style=\"color: #a31515;\">\"test\"</span>.$i);\t\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($i)-&gt;setOutlineLevel(3);\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($i)-&gt;setVisible(true);\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($i)-&gt;setCollapsed(false);\t\t\t\n\t\t\t$i++;\n\t\t}\n\t}\n}\n\n</pre>\n</div>\n</p>\n<p>The complete code:</p>\n<div style=\"background-color: white; color: black;\">\n<pre>&lt;?php\n<span style=\"color: green;\">/**\n * PHPExcel\n *\n * Copyright (C) 2006 - 2011 PHPExcel\n *\n * This library is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 2.1 of the License, or (at your option) any later version.\n *\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this library; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n *\n * @category   PHPExcel\n * @package    PHPExcel\n * @copyright  Copyright (c) 2006 - 2011 PHPExcel (http://www.codeplex.com/PHPExcel)\n * @license    http://www.gnu.org/licenses/old-licenses/lgpl-2.1.txt\tLGPL\n * @version    1.7.6, 2011-02-27\n */</span>\n\n<span style=\"color: green;\">/** Error reporting */</span>\nerror_reporting(E_ALL);\n\ndate_default_timezone_set(<span style=\"color: #a31515;\">'Europe/London'</span>);\n\n<span style=\"color: green;\">/** PHPExcel */</span>\n<span style=\"color: blue;\">require_once</span> <span style=\"color: #a31515;\">'../Classes/PHPExcel.php'</span>;\n\n<span style=\"color: blue;\">include</span> <span style=\"color: #a31515;\">'../global/globalfunctions.php'</span>;\n\n$rowdimensiongap=0;\n\n\n<span style=\"color: green;\">// Create new PHPExcel object</span>\n$objPHPExcel = <span style=\"color: blue;\">new</span> PHPExcel();\n\n<span style=\"color: green;\">// Set properties</span>\n$objPHPExcel-&gt;getProperties()-&gt;setCreator(<span style=\"color: #a31515;\">\"Bjoern Karpenstein\"</span>)\n\t\t\t\t\t\t\t -&gt;setLastModifiedBy(<span style=\"color: #a31515;\">\"Bjoern Karpenstein\"</span>)\n\t\t\t\t\t\t\t -&gt;setTitle(<span style=\"color: #a31515;\">\"4Sight Report for country \"</span>.$_GET[<span style=\"color: #a31515;\">\"country\"</span>])\n\t\t\t\t\t\t\t -&gt;setSubject(<span style=\"color: #a31515;\">\"4Sight Report for country \"</span>.$_GET[<span style=\"color: #a31515;\">\"country\"</span>])\n\t\t\t\t\t\t\t -&gt;setDescription(<span style=\"color: #a31515;\">\"This report has been generated using 4Sight Reporting\"</span>)\n\t\t\t\t\t\t\t -&gt;setKeywords(<span style=\"color: #a31515;\">\"4Sight Reporting APO Bjoern Karpenstein Daniela Sennert\"</span>)\n\t\t\t\t\t\t\t -&gt;setCategory(<span style=\"color: #a31515;\">\"4Sight Report for country \"</span>.$_GET[<span style=\"color: #a31515;\">\"country\"</span>]);\n\n        set_time_limit (1000);\n    \tdatabase_connect();\n \t    $result = mssql_query(<span style=\"color: #a31515;\">\"SELECT DISTINCT countryname FROM [compcodetocountryregion] WHERE countryname='\"</span>.$_GET[<span style=\"color: #a31515;\">\"country\"</span>].<span style=\"color: #a31515;\">\"'\"</span>);\n \t    \n \t    $zeile=4;\n \t    $outlinelevel=0;\n \t    \n \t    <span style=\"color: green;\">// Ebene 1 L&auml;nderauswahl</span>\n    \t<span style=\"color: blue;\">while</span> (($row = mssql_fetch_array($result, MSSQL_BOTH))) \n    \t{ \n    \t\t$country=$row[0];\n    \t\t\n    \t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color: #a31515;\">'A'</span> . $zeile, $country);\n    \t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color: #a31515;\">'M'</span> . $zeile, $outlinelevel);\n    \t\t\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setOutlineLevel($outlinelevel);\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setVisible(true);\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setCollapsed(false);\n\n\t\t\t$result2 = mssql_query(<span style=\"color: #a31515;\">\"SELECT DISTINCT businessunit FROM [gruppe]\"</span>);\n    \t\t\n    \t\t$zeile++;\n    \t\t$outlinelevel++;\n\t    \t\n\t    \t\n\t    \t<span style=\"color: green;\">// Ebene 2 Businessunits</span>\n\t    \t<span style=\"color: blue;\">while</span> (($row2 = mssql_fetch_array($result2, MSSQL_BOTH))) \n    \t\t{ \n    \t\t\t$businessunit=$row2[0];\n    \t\t\t\n    \t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color: #a31515;\">'B'</span> . $zeile, $businessunit);\n    \t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color: #a31515;\">'M'</span> . $zeile, $outlinelevel);\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setOutlineLevel($outlinelevel);\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setVisible(true);\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setCollapsed(false);\n    \t\t\n\t    \t\t<span style=\"color: green;\">// Ebene 3 Produktgruppe zu Businessunit</span>\n    \t\t   \t$result3 = mssql_query(<span style=\"color: #a31515;\">\"SELECT description FROM [gruppe] WHERE [businessunit]='\"</span>.$businessunit.<span style=\"color: #a31515;\">\"'\"</span>);\n    \t\t   \t\n     \t\t\t$zeile++;    \t\t\n     \t\t\t$outlinelevel++;\t\n\t    \t\n\t\t    \t<span style=\"color: blue;\">while</span> (($row3 = mssql_fetch_array($result3, MSSQL_BOTH))) \n    \t\t\t{ \n    \t\t\t\t$productgroup=$row3[0];\n    \t\t\t\t\n    \t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color: #a31515;\">'C'</span> . $zeile, $productgroup);\n    \t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color: #a31515;\">'M'</span> . $zeile, $outlinelevel);\n\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setOutlineLevel($outlinelevel);\n\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setVisible(true);\n\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setCollapsed(false);\n    \t\t\n    \t\t\t\t$zeile++;\n    \t\t\t\t$outlinelevel++;    \t\t\n\n\t\t    \t\t<span style=\"color: green;\">/********************** An dieser Stelle beginnen die Planwerte ****************************/</span>\n    \t\t\t\t\n    \t\t\t\t\n    \t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color: #a31515;\">'D'</span> . $zeile, <span style=\"color: #a31515;\">\"Geht\"</span>);\n\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setOutlineLevel($outlinelevel);\n\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setVisible(true);\n\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setCollapsed(false);\n\t\t\t\t\t    \t\t\t\t\n    \t\t\t\t$zeile++;\n    \t\t\t\t\n    \t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color: #a31515;\">'D'</span> . $zeile, <span style=\"color: #a31515;\">\"Das?\"</span>);\n\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setOutlineLevel($outlinelevel);\n\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setVisible(true);\n\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setCollapsed(false);    \t\t\t\t\n    \t\t\t\t$zeile++;\n\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setOutlineLevel($outlinelevel);\n\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setVisible(true);\n\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setCollapsed(false);        \t\t\t\t    \t\t\t\t\n\n\t\t\t\t\t\n\t\t\t\t\t<span style=\"color: green;\">/**************************************** ENDE DER PLANWERTE ******************************************************/</span>\n    \t\t\t\t$outlinelevel--;\n    \t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setOutlineLevel($outlinelevel);\n\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setVisible(true);  \n\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setCollapsed(false);\n\n    \t\t\t}\n    \t\t\t\n    \t\t\t$outlinelevel--;\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setOutlineLevel($outlinelevel);\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setVisible(true);\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($zeile)-&gt;setCollapsed(false);\n    \t\t}\t\t\t\n    \t} \n\n\t    mssql_free_result($result);\n    \tdatabase_close();\n            \n\n<span style=\"color: green;\">// Rename sheet</span>\n$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle(<span style=\"color: #a31515;\">'Simple'</span>);\n\n\n<span style=\"color: green;\">// Set active sheet index to the first sheet, so Excel opens this as the first sheet</span>\n$objPHPExcel-&gt;setActiveSheetIndex(0);\n\n\n<span style=\"color: green;\">// Redirect output to a client&acirc;&euro;&trade;s web browser (Excel2007)</span>\nheader(<span style=\"color: #a31515;\">'Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'</span>);\nheader(<span style=\"color: #a31515;\">'Content-Disposition: attachment;filename=\"bier.xlsx\"'</span>);\nheader(<span style=\"color: #a31515;\">'Cache-Control: max-age=0'</span>);\n\n$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color: #a31515;\">'Excel2007'</span>);\n$objWriter-&gt;save(<span style=\"color: #a31515;\">'php://output'</span>);\n<span style=\"color: blue;\">exit</span>;\n\n<br /></pre>\n</div>",
    "PostedDate": "2011-11-30T01:41:40.737-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]