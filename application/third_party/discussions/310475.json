[
  {
    "Id": "760573",
    "ThreadId": "310475",
    "Html": "\r\n<p>Hello,</p>\r\n<p>Well, first, sorry for my English and sorry also for my low level in program.</p>\r\n<p>I post here, because it's my last chance to find a solution. I have spent days and days on it.</p>\r\n<p>I'm looking for solution that will export a mysql query formated in utf-8 into Excel.</p>\r\n<p>My code (below) is working for small result. But when I try to export a result of 28 columns x 60000 rows, it doesn't work.</p>\r\n<p>May be that my code is not the best also. I know that there are many post about lack of memory also. Before, 1 year ago, as far as I can remember, when the result was too big, I had a error message about memory. Today, the message is that The file cannot\r\n be found or nothing appears.</p>\r\n<p>Anyway, is someone have a general code that take a query in argument that works well ?</p>\r\n<p>The server uses PHP Version 5.2.5. I cannot modify parameters.</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>/** PHPExcel */</p>\r\n<p>require_once 'ClassesPHPExcel/PHPExcel.php';</p>\r\n<p>require_once (&quot;include/ParametresConnexion.php&quot;);</p>\r\n<p>$db = mysql_connect(SERVEUR, NOM,PASSE) or die(mysql_error());</p>\r\n<p>mysql_select_db(BASE,$db) or die(mysql_error());</p>\r\n<p>mysql_query(&quot;SET NAMES utf8&quot;);</p>\r\n<p>&nbsp;</p>\r\n<p>$reqExcel = &quot;SELECT * FROM My TABLE WHERE id_contact&lt;'2500' &quot;;</p>\r\n<p>$resultat = mysql_query($reqExcel);</p>\r\n<p>$numoffields=mysql_num_fields($resultat);</p>\r\n<p>$entete_champs =1;</p>\r\n<p>&nbsp;</p>\r\n<p>function col2chr($a){</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $a=$a&#43;1;</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if($a&lt;27){</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return strtoupper(chr($a&#43;96));&nbsp;&nbsp;</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }else{</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while($a &gt; 26){</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $b&#43;&#43;;</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $a = $a-26;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $b = strtoupper(chr($b&#43;96));&nbsp;&nbsp;</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $a = strtoupper(chr($a&#43;96));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return $b.$a;</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>\r\n<p>&nbsp;&nbsp; }</p>\r\n<p>&nbsp;</p>\r\n<p>// Create new PHPExcel object</p>\r\n<p>$objPHPExcel = new PHPExcel();</p>\r\n<p>&nbsp;</p>\r\n<p>//$cacheMethod = PHPExcel_CachedObjectStorageFactory:: cache_to_phpTemp;</p>\r\n<p>//$cacheSettings = array( ' memoryCacheSize ' =&gt; '4GB');</p>\r\n<p>//PHPExcel_Settings::setCacheStorageMethod($cacheMethod, $cacheSettings);</p>\r\n<p>&nbsp;</p>\r\n<p>// Set properties</p>\r\n<p>$objPHPExcel-&gt;getProperties()-&gt;setCreator(&quot;Maarten Balliauw&quot;)</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n -&gt;setLastModifiedBy(&quot;Maarten Balliauw&quot;)</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n -&gt;setTitle(&quot;Office 2007 XLSX Test Document&quot;)</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n -&gt;setSubject(&quot;Office 2007 XLSX Test Document&quot;)</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n -&gt;setDescription(&quot;Test document for Office 2007 XLSX, generated using PHP classes.&quot;)</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n -&gt;setKeywords(&quot;office 2007 openxml php&quot;)</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n -&gt;setCategory(&quot;Test result file&quot;);</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>// Add some data</p>\r\n<p>&nbsp;</p>\r\n<p>for ($entete_champs=0; $entete_champs&lt;$numoffields;$entete_champs&#43;&#43;){</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;setActiveSheetIndex(0)-&gt;setCellValueByColumnAndRow($entete_champs,1, mysql_field_name($resultat,$entete_champs));</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $lettre_colonne = col2chr($entete_champs).'1';</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $lettre_colonne = $entete_champs.'1';</p>\r\n<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle($lettre_colonne)-&gt;getFont()-&gt;getColor()-&gt;setARGB(PHPExcel_Style_Color::COLOR_BLUE);</p>\r\n<p>}</p>\r\n<p>&nbsp;</p>\r\n<p>$i = 2; // on d&eacute;marre &agrave; la ligne 2, car ligne 1 correspond au entete de colonne</p>\r\n<p>while($row = mysql_fetch_array($resultat))</p>\r\n<p>{</p>\r\n<p>for ($j=0; $j&lt;$numoffields;$j&#43;&#43;){</p>\r\n<p>&nbsp;&nbsp; $objPHPExcel-&gt;setActiveSheetIndex(0)-&gt;setCellValueByColumnAndRow($j,$i, $row[$j]);&nbsp;&nbsp;</p>\r\n<p>&nbsp;&nbsp; }$i&#43;&#43;;</p>\r\n<p>}</p>\r\n<p>&nbsp;</p>\r\n<p>// Rename sheet</p>\r\n<p>$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle('Simple');</p>\r\n<p>&nbsp;</p>\r\n<p>// Set active sheet index to the first sheet, so Excel opens this as the first sheet</p>\r\n<p>$objPHPExcel-&gt;setActiveSheetIndex(0);</p>\r\n<p>&nbsp;</p>\r\n<p>// Redirect output to a client&rsquo;s web browser (Excel5)</p>\r\n<p>header('Content-Type: application/vnd.ms-excel');</p>\r\n<p>header('Content-Disposition: attachment;filename=&quot;01simple.xls&quot;');</p>\r\n<p>header('Cache-Control: max-age=0');</p>\r\n<p>&nbsp;</p>\r\n<p>$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');</p>\r\n<p>$objWriter-&gt;save('php://output');</p>\r\n<p>exit;</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n",
    "PostedDate": "2012-02-13T06:03:51.647-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "760642",
    "ThreadId": "310475",
    "Html": "<p>are you aware that ph 5.2 has been end of life for some time now?</p>\r\n<p>&nbsp;</p>\r\n<p>Check your error logs, because I suspect it is still an out of memory error. With this amount of data, I would suspect your php script to use somewhere around 8GB of memory.</p>",
    "PostedDate": "2012-02-13T06:46:04.8-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "760692",
    "ThreadId": "310475",
    "Html": "<p>Hello Borft,</p>\n<p>Well, I have no choice about php version.&nbsp; Even if you would suspect my php script to use somewhere around 8GB of memory, what can I do ?</p>\n<p>I try to add this code, but it doesn't improve the problem :</p>\n<p>// Initiate cache<br />$cacheMethod = PHPExcel_CachedObjectStorageFactory::cache_to_phpTemp;<br />$cacheSettings = array( 'memoryCacheSize' =&gt; '8GB');<br />PHPExcel_Settings::setCacheStorageMethod($cacheMethod, $cacheSettings);</p>\n<p>Maybe I can ask to the manager of the php server to do something, but what ? What can I ask ?</p>",
    "PostedDate": "2012-02-13T07:11:19.94-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "765328",
    "ThreadId": "310475",
    "Html": "<p>You must enable cell caching <em><strong>before </strong></em>instantiating the PHPExcel object.. the lines commented out in your original code appear <em><strong>after </strong></em>the</p>\n<div style=\"background-color: white; color: black;\">\n<pre>$objPHPExcel = <span style=\"color: blue;\">new</span> PHPExcel();\r\n</pre>\n</div>\n<p>line.</p>\n<p>&nbsp;</p>\n<p>When working with very large files, phpTemp caching may not be sufficient, because it stil retains an index to the cells \"in memory\". APC, WinCache or memCache&nbsp;only hold a \"cell exists\" index \"in memory\", so they offer the best memory usage, though slower execution speed. The latest SVN code introduces SqLite as a caching option, which is the best memory usage because it holds no \"in memory\" index at all, but again at a cost in execution speed. There's a summary of some of the caching methods at the bottom of <a href=\"http://phpexcel.codeplex.com/discussions/234150?ProjectName=phpexcel\">this thread</a>.</p>\n<p>Note that your col2chr($a) function is already available in PHPExcel (and faster when columns exceed Z) as PHPExcel_Cell::stringFromColumnIndex($a)</p>",
    "PostedDate": "2012-02-14T15:00:19.18-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]