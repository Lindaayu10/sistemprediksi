[
  {
    "Id": "876264",
    "ThreadId": "376035",
    "Html": "\r\n<p>Hi !</p>\r\n<p>I'm trying to use cachingMethod to reduce memory using.</p>\r\n<p>But I tried to use any method and i'd never seen any change about memory using.</p>\r\n<p>My .xlsx file is around 60Mo, I know it's hudge...</p>\r\n<p>Below some pieces of my code :&nbsp;</p>\r\n<p></p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>$cacheMethod = PHPExcel_CachedObjectStorageFactory::cache_to_sqlite3;\r\n<span style=\"color:blue\">if</span> (PHPExcel_Settings::setCacheStorageMethod($cacheMethod) === FALSE) {\r\n\t<span style=\"color:blue\">echo</span> <span style=\"color:#a31515\">'ERROR caching method'</span>;\r\n\t<span style=\"color:blue\">return</span>;\r\n}\r\n\r\n<span style=\"color:blue\">class</span> chunkReadFilter <span style=\"color:blue\">implements</span> PHPExcel_Reader_IReadFilter\r\n{\r\n\t<span style=\"color:blue\">private</span> $_startRow = 0;\r\n\r\n\t<span style=\"color:blue\">private</span> $_endRow = 0;\r\n\r\n\t<span style=\"color:green\">/**  Set the list of rows that we want to read  */</span>\r\n\t<span style=\"color:blue\">public</span> <span style=\"color:blue\">function</span> __construct($startRow, $chunkSize) {\r\n\t\t$this-&gt;_startRow\t= $startRow;\r\n\t\t$this-&gt;_endRow\t\t= $startRow &#43; $chunkSize;\r\n\t}\r\n\r\n\t<span style=\"color:blue\">public</span> <span style=\"color:blue\">function</span> readCell($column, $row, $worksheetName = <span style=\"color:#a31515\">''</span>) {\r\n\t\t<span style=\"color:green\">//  Only read the heading row, and the rows that are configured in $this-&gt;_startRow and $this-&gt;_endRow</span>\r\n\t\t<span style=\"color:blue\">if</span> (($row == 1) || ($row &gt;= $this-&gt;_startRow &amp;&amp; $row &lt; $this-&gt;_endRow)) {\r\n\t\t\t<span style=\"color:blue\">return</span> true;\r\n\t\t}\r\n\t\t<span style=\"color:blue\">return</span> false;\r\n\t}\r\n}\r\n\r\n<span style=\"color:green\">/**  Identify the type of $inputFileName  **/</span>\r\n$inputFileType = PHPExcel_IOFactory::identify($inputFileName);\r\n<span style=\"color:blue\">echo</span> <span style=\"color:#a31515\">'File type is : '</span>;\r\n<span style=\"color:blue\">print</span>($inputFileType . <span style=\"color:#a31515\">&quot;\\n&quot;</span>) ;\r\n$objReader = PHPExcel_IOFactory::createReader($inputFileType);\r\n$filter1 = <span style=\"color:blue\">new</span> MyReadFilter(1,2);\r\n$objReader-&gt;setReadFilter($filter1);\r\n$objPHPExcel = $objReader-&gt;load($inputFileName);\r\n$objWorksheet = $objPHPExcel-&gt;getActiveSheet();\r\n\r\n[SQL actions...]\r\n\r\n$objPHPExcel-&gt;disconnectWorksheets();\r\n\r\n<span style=\"color:blue\">for</span> ($startRow = $beginLine; $startRow &lt;= $nbLigne; $startRow &#43;= $chunkSize) {\r\n\t\r\n\t<span style=\"color:green\">/**  Create a new Instance of our Read Filter, passing in the limits on which rows we want to read  **/</span>\r\n\t$chunkFilter = <span style=\"color:blue\">new</span> chunkReadFilter($startRow, $chunkSize);\r\n\t\r\n\t<span style=\"color:green\">/**  Tell the Reader that we want to use the new Read Filter that we've just Instantiated  **/</span>\r\n\t$objReader-&gt;setReadFilter($chunkFilter);\r\n\t<span style=\"color:green\">/**  Load only the rows that match our filter from $inputFileName to a PHPExcel Object  **/</span>\r\n\t$objPHPExcel = $objReader-&gt;load($inputFileName);\r\n\r\n\t<span style=\"color:green\">//\tDo some processing here</span>\r\n\r\n\t$sheetData = $objPHPExcel-&gt;getActiveSheet()-&gt;toArray(null,true,true,true);\r\n\t<span style=\"color:blue\">print</span>(<span style=\"color:#a31515\">&quot;\\n\\n\\n\\n&quot;</span>);\r\n\t$mySqlWriter-&gt;InsertValue($title, preparInsert($sheetData, $startRow, $startRow &#43; $chunkSize));\r\n\t$objPHPExcel-&gt;disconnectWorksheets();\r\n}\r\n\r\n</pre>\r\n</div>\r\n<p></p>\r\n<p>Any idea about my error ?</p>\r\n<p>&nbsp;</p>\r\n<p>Thank</p>\r\n",
    "PostedDate": "2012-07-19T03:08:46.673-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]