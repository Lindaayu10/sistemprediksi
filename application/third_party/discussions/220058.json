[
  {
    "Id": "469535",
    "ThreadId": "220058",
    "Html": "<p>Hi</p>\r\n<p>I wrote a script which is generating Excel 2007 file that contains SUMPRODUCT calcuations in second worksheet refering to first worksheet and since two days I am trying to find out how to make it working.</p>\r\n<p>Unfortunately script finishes with one of two errors:</p>\r\n<p>Uncaught exception 'Exception' with message '<strong>Cyclic Reference in Formula</strong>' in C:\\php\\Classes\\PHPExcel\\Calculation.php:2088 Stack trace:<br>#0 C:\\php\\Classes\\PHPExcel\\Cell.php(285): PHPExcel_Calculation-&gt;calculateCellValue(Object(PHPExcel_Cell), true)<br>#1 C:\\php\\Classes\\PHPExcel\\Writer\\Excel2007\\Worksheet.php(969): PHPExcel_Cell-&gt;getCalculatedValue()<br>#2 C:\\php\\Classes\\PHPExcel\\Writer\\Excel2007\\Worksheet.php(910): PHPExcel_Writer_Excel2007_Worksheet-&gt;_writeCell(Object(PHPExcel_Shared_XMLWriter), Object(PHPExcel_Worksheet), 'C2', Array, Array)<br>#3 C:\\php\\Classes\\PHPExcel\\Writer\\Excel2007\\Worksheet.php(82): PHPExcel_Writer_Excel2007_Worksheet-&gt;_writeSheetData(Object(PHPExcel_Shared_XMLWriter), Object(PHPExcel_Worksheet), Array)<br>#4 C:\\php\\Classes\\PHPExcel\\Writer\\Excel2007.php(258): PHPExcel_Writer_Excel2007_Worksheet-&gt;writeWorksheet(Object(PHPExcel_Worksheet), Array)<br>#5 E:\\Scripts\\sumprod_crf.php(120): PHPExcel_Writer_Excel2007-&gt;save('E:\\Scripts\\...')<br>#6 {main}<br>thrown in C:\\php\\Classes\\PHPExcel\\Calculation.php on line 2088</p>\r\n<p>When I changed addressing from range C to D (for  values to add) in first worksheet in script then the script returned <strong>Invalid  cell coordinate</strong> (the rest of error message was the same like above).</p>\r\n<p>I have no clue why it is not calculating, the formula generated by scripts works perfectly when I copy it to Excel manualy.</p>\r\n<p>I would be gratefful if you could have a look on this problem.</p>\r\n<p>PHP ver 5.2.8 @ Apache @ Windows2003, PHPExcel ver 1.7.3 c (also tested with SVN 56728).</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:black;background-color:white\">\r\n<pre>&lt;?php\r\n\r\n<span style=\"color:green\">/** Error reporting */</span>\r\nerror_reporting(E_ALL);\r\nini_set(<span style=\"color:#a31515\">'display_errors'</span>, 1);\r\n\r\n<span style=\"color:green\">/** Include path **/</span>\r\nini_set(<span style=\"color:#a31515\">'include_path'</span>, ini_get(<span style=\"color:#a31515\">'include_path'</span>).<span style=\"color:#a31515\">';C:\\php\\PHPExcel\\Classes'</span>);\r\n\r\n<span style=\"color:green\">/** PHPExcel */</span>\r\n<span style=\"color:blue\">include</span> <span style=\"color:#a31515\">'PHPExcel.php'</span>;\r\n\r\n\r\n<span style=\"color:green\">// Create new PHPExcel object</span>\r\n$objPHPExcel = <span style=\"color:blue\">new</span> PHPExcel();\r\n\r\n$wks0 = <span style=\"color:#a31515\">'Invoices'</span>;\r\n$wks1= <span style=\"color:#a31515\">'Sums'</span>;\r\n\r\n$objPHPExcel-&gt;setActiveSheetIndex(0);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle($wks0);\r\n\r\n<span style=\"color:green\">// Add some data</span>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A1'</span>, <span style=\"color:#a31515\">'Names'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A2'</span>, <span style=\"color:#a31515\">'Alpha'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A3'</span>, <span style=\"color:#a31515\">'Beta'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A4'</span>, <span style=\"color:#a31515\">'Gamma'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A5'</span>, <span style=\"color:#a31515\">'Delta'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A6'</span>, <span style=\"color:#a31515\">'Alpha'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A7'</span>, <span style=\"color:#a31515\">'Alpha'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A8'</span>, <span style=\"color:#a31515\">'Gamma'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A9'</span>, <span style=\"color:#a31515\">'Delta'</span>);\r\n\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B1'</span>, <span style=\"color:#a31515\">'Values to check'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B2'</span>, -1);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B3'</span>, 1);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B4'</span>, 7);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B5'</span>, -2);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B6'</span>, -3);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B7'</span>, 2);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B8'</span>, 19);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B9'</span>, 2);\r\n\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C1'</span>, <span style=\"color:#a31515\">'Values to add'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C2'</span>, 200);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C3'</span>, 150);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C4'</span>, 100);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C5'</span>, 250);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C6'</span>, 100);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C7'</span>, 200);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C8'</span>, 150);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C9'</span>, 50);\r\n\r\n<span style=\"color:green\">// Create a new worksheet, after the default sheet</span>\r\n$objPHPExcel-&gt;createSheet();\r\n$objPHPExcel-&gt;setActiveSheetIndex(1);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle($wks1);\r\n\r\n<span style=\"color:green\">// Add some data</span>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A1'</span>, <span style=\"color:#a31515\">'Names'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A2'</span>, <span style=\"color:#a31515\">'Alpha'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A3'</span>, <span style=\"color:#a31515\">'Alpha'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A4'</span>, <span style=\"color:#a31515\">'Beta'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A5'</span>, <span style=\"color:#a31515\">'Beta'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A6'</span>, <span style=\"color:#a31515\">'Gamma'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A7'</span>, <span style=\"color:#a31515\">'Gamma'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A8'</span>, <span style=\"color:#a31515\">'Delta'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A9'</span>, <span style=\"color:#a31515\">'Delta'</span>);\r\n\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B1'</span>, <span style=\"color:#a31515\">'Groups'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B2'</span>, <span style=\"color:#a31515\">'Positive'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B3'</span>, <span style=\"color:#a31515\">'Negative'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B4'</span>, <span style=\"color:#a31515\">'Positive'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B5'</span>, <span style=\"color:#a31515\">'Negative'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B6'</span>, <span style=\"color:#a31515\">'Positive'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B7'</span>, <span style=\"color:#a31515\">'Negative'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B8'</span>, <span style=\"color:#a31515\">'Positive'</span>);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B9'</span>, <span style=\"color:#a31515\">'Negative'</span>);\r\n\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C1'</span>, <span style=\"color:#a31515\">'Result'</span>);\r\n\r\n$start_row = 1;    <span style=\"color:green\">//for $wks0</span>\r\n$rown = 10;        <span style=\"color:green\">//for $wks0</span>\r\n$start_row_2 = 1;  <span style=\"color:green\">//for $wks1</span>\r\n$rown_2 = 10;      <span style=\"color:green\">//for $wks1</span>\r\n\r\n<span style=\"color:green\">// Add SUMPRODUCT calculations</span>\r\n<span style=\"color:blue\">for</span> ($i=$start_row_2 + 1; $i&lt;$rown_2; $i++) {\r\n\r\n<span style=\"color:green\">///*</span>\r\n  <span style=\"color:blue\">if</span> ($i % 2) {\r\n      $cFormula = <span style=\"color:#a31515\">&quot;=SUMPRODUCT(('&quot;</span> . $wks0 . <span style=\"color:#a31515\">&quot;'&quot;</span> . <span style=\"color:#a31515\">'!$A$'</span> . ($start_row+1) . <span style=\"color:#a31515\">':$A$'</span> . ($rown-1) . <span style=\"color:#a31515\">&quot;='&quot;</span> . $wks1 . <span style=\"color:#a31515\">&quot;'&quot;</span> . <span style=\"color:#a31515\">'!$A'</span> . $i . <span style=\"color:#a31515\">&quot;)*('&quot;</span> . $wks0 . <span style=\"color:#a31515\">&quot;'&quot;</span> . <span style=\"color:#a31515\">'!$B$'</span> . ($start_row+1) . <span style=\"color:#a31515\">':$B$'</span> . ($rown-1) . <span style=\"color:#a31515\">&quot;&lt;0)*('&quot;</span> . $wks0 . <span style=\"color:#a31515\">&quot;'&quot;</span> . <span style=\"color:#a31515\">'!C$'</span> . ($start_row+1) . <span style=\"color:#a31515\">':C$'</span> . ($rown-1) . <span style=\"color:#a31515\">'))'</span>;    \r\n    } <span style=\"color:blue\">else</span> {\r\n      $cFormula = <span style=\"color:#a31515\">&quot;=SUMPRODUCT(('&quot;</span> . $wks0 . <span style=\"color:#a31515\">&quot;'&quot;</span> . <span style=\"color:#a31515\">'!$A$'</span> . ($start_row+1) . <span style=\"color:#a31515\">':$A$'</span> . ($rown-1) . <span style=\"color:#a31515\">&quot;='&quot;</span> . $wks1 . <span style=\"color:#a31515\">&quot;'&quot;</span> . <span style=\"color:#a31515\">'!$A'</span> . $i . <span style=\"color:#a31515\">&quot;)*('&quot;</span> . $wks0 . <span style=\"color:#a31515\">&quot;'&quot;</span> . <span style=\"color:#a31515\">'!$B$'</span> . ($start_row+1) . <span style=\"color:#a31515\">':$B$'</span> . ($rown-1) . <span style=\"color:#a31515\">&quot;&gt;=0)*('&quot;</span> . $wks0 . <span style=\"color:#a31515\">&quot;'&quot;</span> . <span style=\"color:#a31515\">'!C$'</span> . ($start_row+1) . <span style=\"color:#a31515\">':C$'</span> . ($rown-1) . <span style=\"color:#a31515\">'))'</span>;\r\n  }\r\n<span style=\"color:green\">//*/</span>\r\n\r\n<span style=\"color:green\">/* This is parsed but last substract which is not conditional in formula is refering to null cells.\r\n  if ($i % 2) {\r\n      $cFormula = &quot;=SUMPRODUCT(('&quot; . $wks0 . &quot;'&quot; . '!$A$' . ($start_row+1) . ':$A$' . ($rown-1) . &quot;='&quot; . $wks1 . &quot;'&quot; . '!$A' . $i . &quot;)*('&quot; . $wks0 . &quot;'&quot; . '!$B$' . ($start_row+1) . ':$B$' . ($rown-1) . &quot;&lt;0)*('&quot; . $wks0 . &quot;'&quot; . '!D$' . ($start_row+1) . ':D$' . ($rown-1) . '))';\r\n    } else {\r\n      $cFormula = &quot;=SUMPRODUCT(('&quot; . $wks0 . &quot;'&quot; . '!$A$' . ($start_row+1) . ':$A$' . ($rown-1) . &quot;='&quot; . $wks1 . &quot;'&quot; . '!$A' . $i . &quot;)*('&quot; . $wks0 . &quot;'&quot; . '!$B$' . ($start_row+1) . ':$B$' . ($rown-1) . &quot;&gt;=0)*('&quot; . $wks0 . &quot;'&quot; . '!D$' . ($start_row+1) . ':D$' . ($rown-1) . '))';\r\n  }\r\n*/</span>\r\n\r\n<span style=\"color:green\">/* This is not parsed - here last substract is conditionalized and returns always TRUE so it multiplies previous substracts by 1.\r\n  if ($i % 2) {\r\n$cFormula = &quot;=SUMPRODUCT(('&quot; . $wks0 . &quot;'&quot; . '!$A$' . ($start_row+1) . ':$A$' . ($rown-1) . &quot;='&quot; . $wks1 . &quot;'&quot; . '!$A' . $i . &quot;)*('&quot; . $wks0 . &quot;'&quot; . '!$B$' . ($start_row+1) . ':$B$' . ($rown-1) . &quot;&lt;0)*('&quot; . $wks0 . &quot;'&quot; . '!C$' . ($start_row+1) . ':C$' . ($rown-1) . &quot;='&quot; . $wks0 . &quot;'&quot; . '!C$' . ($start_row+1) . ':C$' . ($rown-1) . '))';\r\n    } else {\r\n$cFormula = &quot;=SUMPRODUCT(('&quot; . $wks0 . &quot;'&quot; . '!$A$' . ($start_row+1) . ':$A$' . ($rown-1) . &quot;='&quot; . $wks1 . &quot;'&quot; . '!$A' . $i . &quot;)*('&quot; . $wks0 . &quot;'&quot; . '!$B$' . ($start_row+1) . ':$B$' . ($rown-1) . &quot;&gt;=0)*('&quot; . $wks0 . &quot;'&quot; . '!C$' . ($start_row+1) . ':C$' . ($rown-1) . &quot;='&quot; . $wks0 . &quot;'&quot; . '!C$' . ($start_row+1) . ':C$' . ($rown-1) . '))';\r\n  }\r\n*/</span>\r\n\r\n  <span style=\"color:blue\">echo</span> $cFormula. <span style=\"color:#a31515\">&quot;&lt;BR /&gt;&quot;</span>;\r\n  $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C'</span> . $i, $cFormula);\r\n}\r\n\r\n<span style=\"color:green\">// Save Excel 2007 file</span>\r\n$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color:#a31515\">'Excel2007'</span>);\r\n$objWriter-&gt;save(str_replace(<span style=\"color:#a31515\">'.php'</span>, <span style=\"color:#a31515\">'.xlsx'</span>, <span style=\"color:blue\">__FILE__</span>));\r\n<span style=\"color:blue\">echo</span> date(<span style=\"color:#a31515\">'H:i:s'</span>) . <span style=\"color:#a31515\">&quot; Writing to Excel2007 format done&quot;</span> . <span style=\"color:#a31515\">&quot;&lt;BR /&gt;&quot;</span>;\r\n\r\n\r\n<span style=\"color:green\">// Echo memory peak usage</span>\r\n<span style=\"color:blue\">echo</span> date(<span style=\"color:#a31515\">'H:i:s'</span>) . <span style=\"color:#a31515\">&quot; Peak memory usage: &quot;</span> . (memory_get_peak_usage(true) / 1024 / 1024) . <span style=\"color:#a31515\">&quot; MB&quot;</span> . <span style=\"color:#a31515\">&quot;&lt;BR /&gt;&quot;</span>;\r\n\r\n\r\n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2010-07-20T03:57:31.88-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "469891",
    "ThreadId": "220058",
    "Html": "<p>Like Excel itself, PHPExcel provides two methods for handling cyclic references in formulae.</p>\r\n<p>The default is to throw an exception whenever a cyclic reference is found.</p>\r\n<p>The alternative is to set a limit for the number of iterations before the calculation engine will return a calculated value.<br>You can set this limit using:</p>\r\n<div style=\"color:black;background-color:white\">\r\n<pre>PHPExcel_Calculation::getInstance()-&gt;cyclicFormulaCount = 10;</pre>\r\n</div>\r\n<p>Setting this value to 0 will revert to the default of throwing an exception</p>",
    "PostedDate": "2010-07-20T13:55:57.46-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "470075",
    "ThreadId": "220058",
    "Html": "<p>Thank you MarkBaker for this suggestion but it doesn't work.<br><br><span style=\"text-decoration:underline\">The point is that there is no cycle reference in my formula</span>.<br><br>PHP converts it to following string:<br><br><strong>=SUMPRODUCT(('Invoices'!$A$2:$A$9='Sums'!$A2)*('Invoices'!$B$2:$B$9&gt;=0)*('Invoices'!C$2:C$9))</strong></p>\r\n<p><span style=\"text-decoration:underline\">&nbsp;</span>This formula is not raising  cycle reference warning when I paste it into Excel. It works exactly as I need.</p>\r\n<p>&nbsp;</p>\r\n<p>The PHP code attached in my first post is complete Excel 2007 test sample, so you can just copy-paste-run it to see how PHP is building formulas and errors thrown from it.</p>\r\n<p>Commented sets of formulas in for... loop are my attempts to diagnose other mentioned error: <strong>Invalid  cell coordinate</strong>. You can also easily trigger it by replacing in <span style=\"color:green\">// Add some data</span> following section:</p>\r\n<pre>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C1'</span>, <span style=\"color:#a31515\">'Values to add'</span>);<br>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C2'</span>, 200);<br>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C3'</span>, 150);<br>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C4'</span>, 100);<br>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C5'</span>, 250);<br>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C6'</span>, 100);<br>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C7'</span>, 200);<br>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C8'</span>, 150);<br>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C9'</span>, 50);<br><br>into:<br><pre>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'D1'</span>, <span style=\"color:#a31515\">'Values to add'</span>);<br>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'D2'</span>, 200);<br>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'D3'</span>, 150);<br>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'D4'</span>, 100);<br>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'D5'</span>, 250);<br>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'D6'</span>, 100);<br>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'D7'</span>, 200);<br>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'D8'</span>, 150);<br>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'D9'</span>, 50);<br></pre>\r\n<br>and uncommenting this:<br><br>\r\n<div style=\"color:black;background-color:white\">\r\n<pre>  <span style=\"color:blue\">if</span> ($i % 2) {\r\n      $cFormula = <span style=\"color:#a31515\">&quot;=SUMPRODUCT(('&quot;</span> . $wks0 . <span style=\"color:#a31515\">&quot;'&quot;</span> . <span style=\"color:#a31515\">'!$A$'</span> . ($start_row+1) . <span style=\"color:#a31515\">':$A$'</span> . ($rown-1) . <span style=\"color:#a31515\">&quot;='&quot;</span> . $wks1 . <span style=\"color:#a31515\">&quot;'&quot;</span> . <span style=\"color:#a31515\">'!$A'</span> . $i . <span style=\"color:#a31515\">&quot;)*('&quot;</span> . $wks0 . <span style=\"color:#a31515\">&quot;'&quot;</span> . <span style=\"color:#a31515\">'!$B$'</span> . ($start_row+1) . <span style=\"color:#a31515\">':$B$'</span> . ($rown-1) . <span style=\"color:#a31515\">&quot;&lt;0)*('&quot;</span> . $wks0 . <span style=\"color:#a31515\">&quot;'&quot;</span> . <span style=\"color:#a31515\">'!D$'</span> . ($start_row+1) . <span style=\"color:#a31515\">':D$'</span> . ($rown-1) . <span style=\"color:#a31515\">'))'</span>;\r\n    } <span style=\"color:blue\">else</span> {\r\n      $cFormula = <span style=\"color:#a31515\">&quot;=SUMPRODUCT(('&quot;</span> . $wks0 . <span style=\"color:#a31515\">&quot;'&quot;</span> . <span style=\"color:#a31515\">'!$A$'</span> . ($start_row+1) . <span style=\"color:#a31515\">':$A$'</span> . ($rown-1) . <span style=\"color:#a31515\">&quot;='&quot;</span> . $wks1 . <span style=\"color:#a31515\">&quot;'&quot;</span> . <span style=\"color:#a31515\">'!$A'</span> . $i . <span style=\"color:#a31515\">&quot;)*('&quot;</span> . $wks0 . <span style=\"color:#a31515\">&quot;'&quot;</span> . <span style=\"color:#a31515\">'!$B$'</span> . ($start_row+1) . <span style=\"color:#a31515\">':$B$'</span> . ($rown-1) . <span style=\"color:#a31515\">&quot;&gt;=0)*('&quot;</span> . $wks0 . <span style=\"color:#a31515\">&quot;'&quot;</span> . <span style=\"color:#a31515\">'!D$'</span> . ($start_row+1) . <span style=\"color:#a31515\">':D$'</span> . ($rown-1) . <span style=\"color:#a31515\">'))'</span>;\r\n  }\r\n</pre>\r\n</div>\r\nThe difference is now that data are populated in first worksheet in A, B and D column. C column is empty. Selection of last substract is from column D in such situation. <br>So logically the same situation but error is diffrent.<br></pre>",
    "PostedDate": "2010-07-20T23:41:50.53-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "472307",
    "ThreadId": "220058",
    "Html": "<p>Will take a closer look. It may be that the cyclic reference trap is misreading the worksheet reference</p>",
    "PostedDate": "2010-07-25T05:09:52.11-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "474619",
    "ThreadId": "220058",
    "Html": "<p>Hi</p>\r\n<pre><pre>error_reporting(E_ALL); </pre>\r\nor even <br>\r\n<pre>error_reporting(2048); </pre>\r\n<br>corrupts xls file on my box.<br><br>I assume that PHPExcel is relying on php exceptions to create a valid file.<br></pre>",
    "PostedDate": "2010-07-30T01:16:01.84-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "474706",
    "ThreadId": "220058",
    "Html": "<blockquote style=\"border:solid .1em #ccc;font-style:italic;margin:.25em 1em 0 1em;padding:0 .25em 0 .25em\"><strong>JohnGriffiths2 wrote:</strong><br>\r\n<p>I assume that PHPExcel is relying on php exceptions to create a valid file.</p>\r\n</blockquote>\r\n<p>&nbsp;Yes, PHPExcel throws exceptions when it encounters a problem, and your code needs to catch these and handle them in an appropriate&nbsp;manner. e.g.</p>\r\n<div style=\"color:black;background-color:white\">\r\n<pre><span style=\"color:blue\">try</span> {\r\n   $objPHPExcel = PHPExcel_IOFactory::load($fileName);\r\n} <span style=\"color:blue\">catch</span> (Exception $e) {\r\n   <span style=\"color:blue\">die</span>(<span style=\"color:#a31515\">'Error reading '</span>.$fileName.<span style=\"color:#a31515\">': '</span>.$e-&gt;getMessage());\r\n}\r\n</pre>\r\n</div>",
    "PostedDate": "2010-07-30T05:12:14.937-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "474765",
    "ThreadId": "220058",
    "Html": "<p>You're too right, the error handling was added to find some information regarding an error.</p>\r\n<p>Unfortunatly the act of adding error handling changes exception handling so that the output file was corrupt therefore no information about the original error.</p>\r\n<p>Adding exception handling changes nothing because with it I get a valid file but still no information about the original error.</p>\r\n<p>Heisenbugs</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2010-07-30T07:50:45.223-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "474793",
    "ThreadId": "220058",
    "Html": "<p>@Slapi</p>\r\n<p>I believe this is the same problem as leosilvarj's problem with SUMIF <a href=\"http://phpexcel.codeplex.com/Thread/View.aspx?ThreadId=221732\">http://phpexcel.codeplex.com/Thread/View.aspx?ThreadId=221732</a></p>\r\n<p>Both reference a range in another worksheet; and searching through the code logic, it's treating the start cell of the range correctly as being in Invoices, but the end cell of the range as being in the current worksheet (Sums) when it should also be in Invoices.... and this is causing conflicts in the calculation engine.</p>\r\n<p>I've made a code change to the calculation engine to ensure that it picks up the correct worksheet for the end of range, and it should be available in the <a href=\"http://phpexcel.codeplex.com/SourceControl/list/changesets\">daily downloads </a>tomorrow (check date to be sure you have the latest version after today). Can you please try running your script against this patched code to see if it resolves your problem.</p>",
    "PostedDate": "2010-07-30T08:53:26.713-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]