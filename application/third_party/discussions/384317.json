[
  {
    "Id": "885324",
    "ThreadId": "384317",
    "Html": "\r\n<p>Hello,</p>\r\n<p>Have following piece of code, but the <strong>YEARFRAC</strong> formulas are not shown up in the created excel file, rest of the formulas are imported. The formulas are working direct in excel.</p>\r\n<p>Have someone a clear moment, what is happening.</p>\r\n<p><span style=\"color:green\">// set timezone</span><br>\r\ndate_default_timezone_set(<span style=\"color:#a31515\">'Europe/London'</span>);<br>\r\n<br>\r\n<span style=\"color:green\">// include</span><br>\r\n<span style=\"color:blue\">require_once</span> <span style=\"color:#a31515\">'phpexcel/Classes/PHPExcel.php'</span>;<br>\r\n<br>\r\n<span style=\"color:green\">// create object</span><br>\r\n$objPHPExcel = <span style=\"color:blue\">new</span> PHPExcel();<br>\r\n<br>\r\n<span style=\"color:green\">// set active sheet</span><br>\r\n$objPHPExcel-&gt;setActiveSheetIndex(0);<br>\r\n<br>\r\n<span style=\"color:green\">// create sheet object</span><br>\r\n$objSheet = $objPHPExcel-&gt;getActiveSheet();<br>\r\n<br>\r\n<span style=\"color:green\">// set title</span><br>\r\n$objSheet-&gt;setTitle(<span style=\"color:#a31515\">'Step 1'</span>);<br>\r\n<br>\r\n<span style=\"color:green\">// check date</span><br>\r\n$objSheet-&gt;setCellValue(<span style=\"color:#a31515\">'C8'</span>, <span style=\"color:#a31515\">\r\n'2012-06-31'</span>);<br>\r\n<br>\r\n<span style=\"color:green\">// create new sheet</span><br>\r\n$objPHPExcel-&gt;createSheet(); <br>\r\n<br>\r\n<span style=\"color:green\">// set active sheet</span><br>\r\n$objPHPExcel-&gt;setActiveSheetIndex(1);<br>\r\n<br>\r\n<span style=\"color:green\">// create sheet object</span><br>\r\n$objSheet = $objPHPExcel-&gt;getActiveSheet();<br>\r\n<br>\r\n<span style=\"color:green\">// set title</span><br>\r\n$objSheet-&gt;setTitle(<span style=\"color:#a31515\">'Step 2'</span>);<br>\r\n<br>\r\n<span style=\"color:green\">// parameter</span><br>\r\n$objSheet-&gt;setCellValue(<span style=\"color:#a31515\">'C10'</span>, <span style=\"color:#a31515\">\r\n'A'</span>);<br>\r\n<br>\r\n<span style=\"color:green\">// start date</span><br>\r\n$objSheet-&gt;setCellValue(<span style=\"color:#a31515\">'G10'</span>, <span style=\"color:#a31515\">\r\n'2008-09-01'</span>);<br>\r\n<br>\r\n<span style=\"color:green\">// end date</span><br>\r\n$objSheet-&gt;setCellValue(<span style=\"color:#a31515\">'H10'</span>, <span style=\"color:#a31515\">\r\n''</span>);<br>\r\n<br>\r\n<span style=\"color:green\">// this line is a problem is not added</span><br>\r\n$objSheet-&gt;setCellValue(<span style=\"color:#a31515\">'O10'</span>, <span style=\"color:#a31515\">\r\n'=IF(OR(C10=&quot;A&quot;,C10=&quot;B&quot;),IF(YEARFRAC(G10,\\'Step 1\\'!$C$8-365)&gt;3,0,MIN(YEARFRAC((\\'Step 1\\'!$C$8-365),(G10&#43;1095)),1)),1)'</span>);<br>\r\n<br>\r\n<span style=\"color:green\">// this is working and added</span><br>\r\n$objSheet-&gt;setCellValue(<span style=\"color:#a31515\">'P10'</span>, <span style=\"color:#a31515\">\r\n'=IF(OR(YEAR(G10) = 1900,G10&lt;=TODAY()),1,0)'</span>);<br>\r\n<br>\r\n<span style=\"color:green\">// this is working and added</span><br>\r\n$objSheet-&gt;setCellValue(<span style=\"color:#a31515\">'Q10'</span>, <span style=\"color:#a31515\">\r\n'=IF(OR(YEAR(H10) = 1900,H10&gt;=\\'Step 1\\'!$C$8),1,0)'</span>);<br>\r\n<br>\r\n<span style=\"color:green\">// this line is a problem is not added</span><br>\r\n$objSheet-&gt;setCellValue(<span style=\"color:#a31515\">'R10'</span>, <span style=\"color:#a31515\">\r\n'=YEARFRAC(MAX((\\'Step 1\\'!$C$8-365),G10),MIN(\\'Step 1\\'!$C$8,H10),1)'</span>);<br>\r\n<br>\r\n<span style=\"color:green\">// save as excel 2007</span><br>\r\n$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color:#a31515\">\r\n'Excel2007'</span>);<br>\r\n<br>\r\n<span style=\"color:green\">// no calculation</span><br>\r\n$objWriter-&gt;setPreCalculateFormulas(false);<br>\r\n<br>\r\n<span style=\"color:green\">// save</span><br>\r\n$objWriter-&gt;save(str_replace(<span style=\"color:#a31515\">'.php'</span>, <span style=\"color:#a31515\">\r\n'.xlsx'</span>, <span style=\"color:blue\">__FILE__</span>));</p>\r\n<p>TIA,</p>\r\n<p>Martijn</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n",
    "PostedDate": "2012-07-22T01:46:24.963-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "885534",
    "ThreadId": "384317",
    "Html": "<p>Your problem is not YEARFRAC</p>\r\n<p>$objSheet-&gt;setCellValue(<span style=\"color: #a31515;\">'G10'</span>, <span style=\"color: #a31515;\">'2008-09-01'</span>);</p>\r\n<p>You're setting G10 as a string, not as a date. If you use the advanced value binder, or convert '2008-09-01' to a date using either the PHPExcel date conversion functions, or Excel's own Date conversion functions, your problem should be resolved.</p>",
    "PostedDate": "2012-07-22T03:28:28.96-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]