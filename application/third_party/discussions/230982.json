[
  {
    "Id": "507510",
    "ThreadId": "230982",
    "Html": "<p>I get a &quot;Allowed memory size of 33554432 bytes exhausted&quot; error after my script has been running for about 15 seconds. I wil check if the apache/php timeout/limit settings can be changed, but anyways I will occationally have to render very big files. Efficiency is a key.</p>\r\n<p>I am not very experienced in PHP and PHPEcxel, so my code may be cumbersome. In that case I hope someone can give me some advice on how it can be done more resource-friendly!</p>\r\n<p>Here goes:</p>\r\n<div style=\"color:black;background-color:#f1f1f1;padding:5px 5px 5px 20px;font-size:11px\">\r\n<pre><span style=\"color:blue\">print</span> <span style=\"color:#a31515\">'&lt;pre&gt;'</span>;\r\n\r\n<span style=\"color:blue\">echo</span> date(<span style=\"color:#a31515\">'H:i:s'</span>) . <span style=\"color:#a31515\">&quot; Create new PHPExcel object\\n&quot;</span>;\r\n$objPHPExcel = <span style=\"color:blue\">new</span> PHPExcel();\r\n\r\n<span style=\"color:blue\">echo</span> date(<span style=\"color:#a31515\">'H:i:s'</span>) . <span style=\"color:#a31515\">&quot; Set properties\\n&quot;</span>;\r\n$objPHPExcel-&gt;getProperties()-&gt;setCreator(<span style=\"color:#a31515\">&quot;Tester&quot;</span>);\r\n$objPHPExcel-&gt;getProperties()-&gt;setCreator(<span style=\"color:#a31515\">&quot;John Doe&quot;</span>)\r\n\t-&gt;setLastModifiedBy(<span style=\"color:#a31515\">&quot;John Doe&quot;</span>)\r\n\t-&gt;setTitle(<span style=\"color:#a31515\">&quot;Test file&quot;</span>);\r\n\t  \r\n<span style=\"color:blue\">echo</span> date(<span style=\"color:#a31515\">'H:i:s'</span>) . <span style=\"color:#a31515\">&quot; Set active sheet index\\n&quot;</span>;\r\n$objPHPExcel-&gt;setActiveSheetIndex(0);\r\n\r\n\r\n<span style=\"color:blue\">echo</span> date(<span style=\"color:#a31515\">'H:i:s'</span>) . <span style=\"color:#a31515\">&quot; Set row 1 - headers\\n&quot;</span>;\r\n$objPHPExcel-&gt;getActiveSheet()\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'A1'</span>, <span style=\"color:#a31515\">'ClaimNo'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'B1'</span>, <span style=\"color:#a31515\">'Date Incident'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'C1'</span>, <span style=\"color:#a31515\">'Date Recieved'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'D1'</span>, <span style=\"color:#a31515\">'Date Processed'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'E1'</span>, <span style=\"color:#a31515\">'Days I-&gt;R'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'F1'</span>, <span style=\"color:#a31515\">'Days R-&gt;P'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'G1'</span>, <span style=\"color:#a31515\">'Name'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'H1'</span>, <span style=\"color:#a31515\">'District'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'I1'</span>, <span style=\"color:#a31515\">'Club'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'J1'</span>, <span style=\"color:#a31515\">'SportNo'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'K1'</span>, <span style=\"color:#a31515\">'Licence'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'L1'</span>, <span style=\"color:#a31515\">'Area'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'M1'</span>, <span style=\"color:#a31515\">'Side'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'N1'</span>, <span style=\"color:#a31515\">'Type'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'O1'</span>, <span style=\"color:#a31515\">'Sport'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'P1'</span>, <span style=\"color:#a31515\">'Location'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'Q1'</span>, <span style=\"color:#a31515\">'Surface'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'R1'</span>, <span style=\"color:#a31515\">'Status'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'S1'</span>, <span style=\"color:#a31515\">'Date Closed'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'T1'</span>, <span style=\"color:#a31515\">'Reserve'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'U1'</span>, <span style=\"color:#a31515\">'Paid'</span>)\r\n\t-&gt;setCellValue(<span style=\"color:#a31515\">'V1'</span>, <span style=\"color:#a31515\">'Paid Projection'</span>)\r\n;\r\n\r\n\r\n<span style=\"color:blue\">echo</span> date(<span style=\"color:#a31515\">'H:i:s'</span>) . <span style=\"color:#a31515\">&quot; Set sheet title\\n&quot;</span>;\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle(<span style=\"color:#a31515\">'Test file'</span>);\r\n\r\n\r\n<span style=\"color:blue\">echo</span> date(<span style=\"color:#a31515\">'H:i:s'</span>) . <span style=\"color:#a31515\">&quot; Starting iteration for cell population\\n&quot;</span>;\r\n<span style=\"color:blue\">for</span> ($i = 2; $i &lt;= 2000; $i += 1) {\r\n\r\n$celltype_plain_text = PHPExcel_Cell_DataType::TYPE_STRING;\r\n\r\n<span style=\"color:blue\">echo</span> date(<span style=\"color:#a31515\">'H:i:s'</span>) . <span style=\"color:#a31515\">&quot; Setting cell values for row $i\\n&quot;</span>;\r\n$objPHPExcel-&gt;getActiveSheet()\r\n\t\t-&gt;setCellValueExplicit(<span style=\"color:#a31515\">'A'</span>.$i, <span style=\"color:#a31515\">'12345'</span>, $celltype_plain_text)\r\n\t\t-&gt;setCellValue(<span style=\"color:#a31515\">'B'</span>.$i, <span style=\"color:#a31515\">'2010-10-15'</span>)\r\n\t\t-&gt;setCellValue(<span style=\"color:#a31515\">'C'</span>.$i, <span style=\"color:#a31515\">'2010-10-15'</span>)\r\n\t\t-&gt;setCellValue(<span style=\"color:#a31515\">'D'</span>.$i, <span style=\"color:#a31515\">'2010-10-15'</span>)\r\n\t\t-&gt;setCellValue(<span style=\"color:#a31515\">'E'</span>.$i, <span style=\"color:#a31515\">'1,11'</span>)\r\n\t\t-&gt;setCellValue(<span style=\"color:#a31515\">'F'</span>.$i, <span style=\"color:#a31515\">'10,50'</span>)\r\n\t\t-&gt;setCellValueExplicit(<span style=\"color:#a31515\">'G'</span>.$i, <span style=\"color:#a31515\">'John Doe'</span>, $celltype_plain_text)\r\n\t\t-&gt;setCellValueExplicit(<span style=\"color:#a31515\">'H'</span>.$i, <span style=\"color:#a31515\">'Lorem ipsum'</span>, $celltype_plain_text)\r\n\t\t-&gt;setCellValueExplicit(<span style=\"color:#a31515\">'I'</span>.$i, <span style=\"color:#a31515\">'Lorem ipsum'</span>, $celltype_plain_text)\r\n\t\t-&gt;setCellValueExplicit(<span style=\"color:#a31515\">'j'</span>.$i, <span style=\"color:#a31515\">'Lorem ipsum'</span>, $celltype_plain_text)\r\n\t\t-&gt;setCellValueExplicit(<span style=\"color:#a31515\">'K'</span>.$i, <span style=\"color:#a31515\">'Lorem ipsum'</span>, $celltype_plain_text)\r\n\t\t-&gt;setCellValueExplicit(<span style=\"color:#a31515\">'L'</span>.$i, <span style=\"color:#a31515\">'Lorem ipsum'</span>, $celltype_plain_text)\r\n\t\t-&gt;setCellValueExplicit(<span style=\"color:#a31515\">'M'</span>.$i, <span style=\"color:#a31515\">'Lorem ipsum'</span>, $celltype_plain_text)\r\n\t\t-&gt;setCellValueExplicit(<span style=\"color:#a31515\">'N'</span>.$i, <span style=\"color:#a31515\">'Lorem ipsum'</span>, $celltype_plain_text)\r\n\t\t-&gt;setCellValueExplicit(<span style=\"color:#a31515\">'O'</span>.$i, <span style=\"color:#a31515\">'Lorem ipsum'</span>, $celltype_plain_text)\r\n\t\t-&gt;setCellValueExplicit(<span style=\"color:#a31515\">'P'</span>.$i, <span style=\"color:#a31515\">'Lorem ipsum'</span>, $celltype_plain_text)\r\n\t\t-&gt;setCellValueExplicit(<span style=\"color:#a31515\">'Q'</span>.$i, <span style=\"color:#a31515\">'Lorem ipsum'</span>, $celltype_plain_text)\r\n\t\t-&gt;setCellValueExplicit(<span style=\"color:#a31515\">'R'</span>.$i, <span style=\"color:#a31515\">'Lorem ipsum'</span>, $celltype_plain_text)\r\n\t\t-&gt;setCellValue(<span style=\"color:#a31515\">'S'</span>.$i, <span style=\"color:#a31515\">'2010-10-15'</span>)\r\n\t\t-&gt;setCellValue(<span style=\"color:#a31515\">'T'</span>.$i, <span style=\"color:#a31515\">'100,00'</span>)\r\n\t\t-&gt;setCellValue(<span style=\"color:#a31515\">'U'</span>.$i, <span style=\"color:#a31515\">'200,50'</span>)\r\n\t\t-&gt;setCellValue(<span style=\"color:#a31515\">'V'</span>.$i, <span style=\"color:#a31515\">'300,80'</span>)\r\n;\r\n\r\n<span style=\"color:blue\">echo</span> date(<span style=\"color:#a31515\">'H:i:s'</span>) . <span style=\"color:#a31515\">&quot; Set cell formats for row $i\\n&quot;</span>;\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'A'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'B'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_DATE_DATETIME);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'C'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_DATE_DATETIME);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'D'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_DATE_DATETIME);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'E'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_NUMBER_00);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'F'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_NUMBER_00);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'G'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'H'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'I'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'J'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'K'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'L'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'M'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'N'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'O'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'P'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'Q'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'R'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'S'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_DATE_YYYYMMDDSLASH);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'T'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_NUMBER_00);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'U'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_NUMBER_00);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'V'</span>.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_NUMBER_00);\r\n  \r\n}\r\n\t\t  \r\n\r\n<span style=\"color:blue\">echo</span> date(<span style=\"color:#a31515\">'H:i:s'</span>) . <span style=\"color:#a31515\">&quot; Starting iteration for all columns auto-size\\n&quot;</span>;\r\n$columnID = <span style=\"color:#a31515\">'A'</span>;\r\n$lastColumn = $objPHPExcel-&gt;getActiveSheet()-&gt;getHighestColumn();\r\n<span style=\"color:blue\">do</span> {\r\n\t<span style=\"color:blue\">echo</span> date(<span style=\"color:#a31515\">'H:i:s'</span>) . <span style=\"color:#a31515\">&quot; Set auto-size for column $columnID\\n&quot;</span>;\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension($columnID)-&gt;setAutoSize(true);\r\n\t$columnID++;\r\n} <span style=\"color:blue\">while</span> ($columnID != $lastColumn);\r\n\t\t\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle(<span style=\"color:#a31515\">'Testing testing'</span>);\r\n\r\n$objPHPExcel-&gt;setActiveSheetIndex(0);\t  \r\n\r\n<span style=\"color:green\">// save to file</span>\r\n\r\n<span style=\"color:blue\">echo</span> date(<span style=\"color:#a31515\">'H:i:s'</span>) . <span style=\"color:#a31515\">&quot; Write to Excel2007 format\\n&quot;</span>;\r\n$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color:#a31515\">'Excel2007'</span>);\r\n$objWriter-&gt;save(<span style=\"color:#a31515\">'test'</span> . time() . <span style=\"color:#a31515\">'.xlsx'</span>);\r\n\r\n<span style=\"color:green\">// Echo memory peak usage</span>\r\n<span style=\"color:blue\">echo</span> date(<span style=\"color:#a31515\">'H:i:s'</span>) . <span style=\"color:#a31515\">&quot; Peak memory usage: &quot;</span> . (memory_get_peak_usage(true) / 1024 / 1024) . <span style=\"color:#a31515\">&quot; MB\\r\\n&quot;</span>;\r\n\r\n<span style=\"color:blue\">print</span> <span style=\"color:#a31515\">'&lt;/pre&gt;'</span>;\r\n</pre>\r\n</div>",
    "PostedDate": "2010-10-14T17:43:56.987-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "508005",
    "ThreadId": "230982",
    "Html": "<p>RTFM! ;)</p>\r\n<p>I solved my issues by:</p>\r\n<ul>\r\n<li>Moving the cell formatting from each iteration to after the loop using cell ranges:<br><br>$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('A2:A'.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);<br> $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('B2:D'.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_DATE_DATETIME);<br> $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('E2:F'.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_NUMBER_00);<br> $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('G2:R'.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);<br> $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('S2:S'.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_DATE_YYYYMMDDSLASH);<br> $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('T2:V'.$i)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_NUMBER_00);<br> <br></li>\r\n<li>Caching using phpTemp for storage exceeding memory size:<br><br>$cacheMethod = PHPExcel_CachedObjectStorageFactory:: cache_to_phpTemp; <br>&nbsp;$cacheSettings = array( ' memoryCacheSize ' =&gt; '30MB');&nbsp;<br>&nbsp;if (!PHPExcel_Settings::setCacheStorageMethod($cacheMethod,$cacheSettings)) die('PHPExcel caching error');</li>\r\n</ul>\r\n<p>Generating the files still takes a lot of time, but that's no problem since this is a report-generator for internal use. The important part is that it works.</p>\r\n<p>Thanks to the developers for a great product!</p>\r\n<ul>\r\n<li><br><br></li>\r\n</ul>",
    "PostedDate": "2010-10-15T13:30:18.39-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]