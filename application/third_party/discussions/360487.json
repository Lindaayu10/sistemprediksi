[
  {
    "Id": "852161",
    "ThreadId": "360487",
    "Html": "\r\n<div>\r\n<p>I'm using PHPExcel to update an eshop's items prices and stock, passing the data to a mysql query and updating the DB. I'm having a problem with some of the cells containing numbers with the format of 123,45 (using comma as a decimal separator). Although\r\n all cells contain the same format, only some are being read correctly. Please have a look for yourselves and let me know what I'm missing.</p>\r\n<ul>\r\n<li>Excel sample data: <a rel=\"nofollow\" href=\"http://dl.dropbox.com/u/25322282/data.xlsx\">\r\nhttp://dl.dropbox.com/u/25322282/data.xlsx</a> </li><li>Log from looping through the data and printing out what it's reading where you can see that prices are read only past row 66.\r\n<a rel=\"nofollow\" href=\"http://dl.dropbox.com/u/25322282/log.htm\">http://dl.dropbox.com/u/25322282/log.htm</a>\r\n</li></ul>\r\n<p>And finally, my code:</p>\r\n<pre><code><div style=\"color:black; background-color:white\"><pre>&nbsp;&nbsp;&nbsp; <div style=\"color:black; background-color:white\"><pre>    $objPHPExcel = PHPExcel_IOFactory::load($path);\n    $objWorksheet = $objPHPExcel-&gt;setActiveSheetIndex(0);\n\n        $highestRow = $objWorksheet-&gt;getHighestRow();\n        $highestColumn = $objWorksheet-&gt;getHighestColumn();\n        $highestColumnIndex = PHPExcel_Cell::columnIndexFromString($highestColumn);\n        $nrColumns = ord($highestColumn) - 64;\n       \n        $rowsadded=0;\n        $begin_row=2; <span style=\"color:green\">// 1st line of data in excel file</span>\n        <span style=\"color:blue\">for</span> ($row = $begin_row; $row &lt;= $highestRow; &#43;&#43; $row) {\n            $val=<span style=\"color:blue\">array</span>();\n            <span style=\"color:blue\">for</span> ($col=0; $col &lt; $highestColumnIndex; $col&#43;&#43;) {\n                $cell = $objWorksheet-&gt;getCellByColumnAndRow($col, $row);\n                $val[] = $cell-&gt;getCalculatedValue();\n            }\n           \n            <span style=\"color:blue\">if</span> (($val[0]&lt;&gt;<span style=\"color:#a31515\">''</span>) &amp;&amp; ($val[6]&gt;0)) { <span style=\"color:green\">//check that row contains data before inserting</span>\n                $rowsadded&#43;&#43;;\n                $sql = sprintf(<span style=\"color:#a31515\">&quot;update productsizes set price=%s, stock=%s where auxcode=%s&quot;</span>,\n                       GetSQLValueString($val[6], <span style=\"color:#a31515\">&quot;float&quot;</span>),\n                       GetSQLValueString($val[4], <span style=\"color:#a31515\">&quot;int&quot;</span>),\n                       GetSQLValueString($val[0], <span style=\"color:#a31515\">&quot;int&quot;</span>));\n                $result = mysql_query($sql) <span style=\"color:blue\">or</span> <span style=\"color:blue\">die</span>(mysql_error());\n            } <span style=\"color:green\">//end of checking that row contains data before inserting</span>\n           \n        } <span style=\"color:blue\">echo</span> <span style=\"color:#a31515\">'&lt;h2&gt;'</span>.$rowsadded. <span style=\"color:#a31515\">' rows updated successfully&lt;/h2&gt;'</span>;\n\n</pre>\n</div>\n</pre>\n</div>\n<span><br></span></code></pre>\r\n</div>\r\n",
    "PostedDate": "2012-06-21T08:14:58.257-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]