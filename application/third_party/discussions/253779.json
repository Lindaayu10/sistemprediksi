[
  {
    "Id": "596807",
    "ThreadId": "253779",
    "Html": "\r\n<p>I am getting an error generated by Microsoft Excel when I try to open the file I am creating with PHPExcel. I get a pop-up that says:</p>\r\n<p>&quot;Excel cannot open the file 'capacity_report[1].xlsx' because the file format or file extension is not valid. Verify that the file has not been corrupted and that the file extension matches the format of the file.&quot;</p>\r\n<p>The headers and other file definitions are the same as another file that I already have had working, so I don't know what the problem is. When I save teh file to a folder and open it with a text editor, it contains a whole bunch of gobble-de-gook, so I know\r\n it's generating something.</p>\r\n<p>Here's the code I wrote (it's a method inside a class that pulls the data from the db and sets up arrays of data that this method uses to create the display):</p>\r\n<pre>//CREATE EXCEL FILE WITH PHPEXCEL\r\n\tpublic function create_excel_cap_table(){\r\n\t\t$direction = array('up','down');\r\n\t\t$output = &quot;&quot;;\r\n\t\t$i = 0;\r\n\t\tinclude('../Classes/PHPExcel.php');\r\n\t\t$objPHPExcel = new PHPExcel();\r\n\t\t//START EXCEL OUPUT\r\n\t\t$title = $this-&gt;level_name_selected . &quot;XLSX document&quot;;\r\n\t\t$objPHPExcel-&gt;getProperties()-&gt;setCreator(&quot;David Newey&quot;)\r\n\t\t\t\t\t\t\t\t\t -&gt;setLastModifiedBy(&quot;David Newey&quot;)\r\n\t\t\t\t\t\t\t\t\t -&gt;setTitle($title)\r\n\t\t\t\t\t\t\t\t\t -&gt;setSubject($title)\r\n\t\t\t\t\t\t\t\t\t -&gt;setDescription(&quot;Office 2007 XLSX document for &quot;. $this-&gt;level_name_selected)\r\n\t\t\t\t\t\t\t\t\t -&gt;setKeywords(&quot;office 2007 openxml php capacity &quot; . $this-&gt;level_name_selected)\r\n\t\t\t\t\t\t\t\t\t -&gt;setCategory($this-&gt;level_name_selected);\r\n\t\t//SET THE ACTIVE SHEET\t\t\t\t\t\t\t \r\n\t\t$objPHPExcel-&gt;setActiveSheetIndex(0);\r\n\t\t//GET AND DISPLAY THE DATA FOR EACH DIRECTION UP AND DOWN\r\n\t\twhile($i &lt; count($direction)){\r\n\t\t\t$dbname = 'capacity';\r\n\t\t\trequire('db_connect.php');\r\n\t\t\t$this-&gt;up_down = $direction[$i];\t\r\n\t\t\t$this-&gt;get_all_weeks_pct();\r\n\t\t\t$this-&gt;get_level_names();\r\n\t\t\t$this-&gt;get_percents();\r\n\t\t\t\t\t\t\r\n\t\t\tif (count($this-&gt;each_week_ending) &lt; $this-&gt;nbr_col){\r\n\t\t\t\t$this-&gt;nbr_col = count($this-&gt;each_week_ending);\r\n\t\t\t\t}\r\n\t\t\t//CREATE THE HEADER ROW\r\n\t\t\t$col = 'B';\r\n\t\t\t$this-&gt;set_row_nbr();\r\n\t\t\t$row = $this-&gt;excel_row_nbr;\r\n\t\t\tif ($this-&gt;up_down == &quot;down&quot;){\r\n\t\t\t\t$up_d = &quot;Downstream &gt; 75%&quot;;\r\n\t\t\t\t}\r\n\t\t\telseif($this-&gt;up_down == &quot;up&quot;){\r\n\t\t\t\t$up_d = &quot;Upstream &gt; 75%&quot;;\r\n\t\t\t\t}\r\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($col . $row, $up_d);\r\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension($col)-&gt;setAutoSize(true);\r\n\t\t\t$col&#43;&#43;;\r\n\t\t\tfor($x = 0;$x&lt;$this-&gt;nbr_col;$x&#43;&#43;){\t\t\r\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($col . $row, $this-&gt;each_week_ending[$x]);\r\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension($col)-&gt;setAutoSize(true);\r\n\t\t\t\t$col&#43;&#43;;\r\n\t\t\t\t}\r\n\t\t\t//GIVE THE HEADER ROW A BACKGROUND OF LIGHT BLUE\r\n\t\t\t$last_col = $col;\r\n\t\t\t$range = 'B'.$row.':'.$last_col.$row;\r\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle($range)-&gt;getFill()-&gt;setFillType(PHPExcel_Style_Fill::FILL_SOLID)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t -&gt;getStartColor()-&gt;setARGB('FF99ccff');\r\n\t\t\t//PUT TOGETHER THE TABLE BODY\t\t\t\t\t\t\t\t\t\t\t\t \r\n\t\t\t$y=0;\r\n\t\t\t$n=$row&#43;1;\r\n\t\t\t$this-&gt;excel_row_nbr = $n;\r\n\t\t\t$side_range = &quot;B&quot;.$row.&quot;:&quot;;\r\n\t\t\t$body_range = &quot;C&quot;.$row.&quot;:&quot;;\r\n\t\t\t$col='C';\r\n\t\t\tforeach ($this-&gt;level_names as $lev_name){\r\n\t\t\t\tif ($lev_name != &quot;&quot; &amp;&amp; $lev_name != &quot;&quot;){\r\n\t\t\t\t\tif ($i == 0){\r\n\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($col . $n, $lev_name);\r\n\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle($col . $n)-&gt;getFill()-&gt;setFillType(PHPExcel_Style_Fill::FILL_SOLID)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t -&gt;getStartColor()-&gt;setARGB('FF000000');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($col . $n, $lev_name);\r\n\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle($col . $n)-&gt;getFill()-&gt;setFillType(PHPExcel_Style_Fill::FILL_SOLID)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t -&gt;getStartColor()-&gt;setARGB('FF99ccff');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t$col&#43;&#43;;\r\n\t\t\t\t\t$this-&gt;get_color_set(1);\r\n\t\t\t\t\tfor($j=0;$j&lt;$this-&gt;nbr_col;$j&#43;&#43;){\r\n\t\t\t\t\t\t$cell_nbr = $this-&gt;set_number($this-&gt;all_pcts[$y][$j]);\r\n\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($col . $n, $cell_nbr);\r\n\t\t\t\t\t\t$color = $this-&gt;set_excel_color($this-&gt;all_pcts[$y][$j],$this-&gt;colors);\r\n\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle($col . $n)-&gt;getFill()-&gt;setFillType(PHPExcel_Style_Fill::FILL_SOLID)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   -&gt;getStartColor()-&gt;setARGB($color);\r\n\t\t\t\t\t\t$col&#43;&#43;;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t$n&#43;&#43;;\r\n\t\t\t\t\t$this-&gt;excel_row_nbr&#43;&#43;;\r\n\t\t\t\t\t$col='C';\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t$y&#43;&#43;;\t\r\n\t\t\t\t}\r\n\t\t\t$side_range .= &quot;B&quot;. $this-&gt;excel_row_nbr;\r\n\t\t\t$body_range .= $last_col. $this-&gt;excel_row_nbr;\r\n\t\t\t\r\n\t\t\t//SET THE STYLE FOR THE LEFT COLUMN WITH THE LEVEL NAMES\r\n\t\t\t$styleArray = array(\r\n\t\t\t\t'alignment' =&gt; array(\r\n\t\t\t\t\t'horizontal' =&gt; PHPExcel_Style_Alignment::HORIZONTAL_RIGHT,\r\n\t\t\t\t\t),\r\n\t\t\t\t'borders'=&gt; array(\r\n\t\t\t\t\t'outline' =&gt; array(\r\n\t\t\t\t\t\t'color' =&gt; array('argb' =&gt; 'FFF5F5F5'),\r\n\t\t\t\t\t),\r\n\t\t\t\t),\r\n\t\t\t);\r\n\t\t\t//APPLY THE STYLE\r\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle($side_range)-&gt;applyFromArray($styleArray);\t\r\n\t\t\t//SET THE STYLE FOR THE REST OF THE TABLE\r\n\t\t\t$styleArray = array(\r\n\t\t\t\t'alignment' =&gt; array(\r\n\t\t\t\t\t'horizontal' =&gt; PHPExcel_Style_Alignment::HORIZONTAL_CENTER,\r\n\t\t\t\t\t),\r\n\t\t\t\t'borders'=&gt; array(\r\n\t\t\t\t\t'outline' =&gt; array(\r\n\t\t\t\t\t\t'color' =&gt; array('argb' =&gt; 'FFF5F5F5'),\r\n\t\t\t\t\t),\r\n\t\t\t\t),\r\n\t\t\t);\r\n\t\t\t//APPLY THE STYLE\r\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle($body_range)-&gt;applyFromArray($styleArray);\r\n\t\t\t$i&#43;&#43;;\r\n\t\t}\r\n\t\theader('Content-Type: application/vnd.openXMLformats-officedocument.spreadsheetml.sheet');\r\n\t\theader('Content-Disposition: attachment;filename=&quot;capacity_report.xlsx&quot;');\r\n\t\theader('Cache-Control: max-age=0');\t\r\n\t\t\r\n\t\t$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');\r\n\t\t$objWriter-&gt;save('php://output'); \r\n\t\t}</pre>\r\n",
    "PostedDate": "2011-04-13T13:07:42.283-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "600018",
    "ThreadId": "253779",
    "Html": "<p>Does that bunch of gobbledegook contain anything readable, such as error messages, leading white space, etc?</p>",
    "PostedDate": "2011-04-19T14:27:44.69-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "600055",
    "ThreadId": "253779",
    "Html": "\r\n<p>I resolved this. Discovered I was echoing something just before the Excel output and you can't do that.</p>\r\n",
    "PostedDate": "2011-04-19T15:46:18.733-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]