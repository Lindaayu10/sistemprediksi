[
  {
    "Id": "948762",
    "ThreadId": "404972",
    "Html": "\r\n<p>Hi!</p>\r\n<p>I try to parse PNG from Excel sheet. The Excel file has one list (01_Body_Graph_Daily) and going to PHP-script from Microsoft SQL Reporting Services by e-mail and/or SMB-share, in any case, the error is the same:</p>\r\n<p>PHP Fatal error: &nbsp;Call to a member function getBlipType() on a non-object in /var/www/mail-edge.mil.zs/Classes/PHPExcel/Reader/Excel5.php on line 995</p>\r\n<p>PHP code:</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:blue\">function</span> getBodyImages($dataDir, $parseFile, $reporting_type)\n{\n    <span style=\"color:blue\">try</span> {\n        $objPHPExcel = PHPExcel_IOFactory::load($dataDir . $reporting_type . <span style=\"color:#a31515\">'/'</span> . $parseFile);\n    } <span style=\"color:blue\">catch</span> (Exception $e) {\n        <span style=\"color:blue\">die</span>(<span style=\"color:#a31515\">'Error loading file: '</span> . $e-&gt;getMessage());\n    }\n    $worksheet = $objPHPExcel-&gt;getActiveSheet();\n    <span style=\"color:blue\">foreach</span> ($worksheet-&gt;getDrawingCollection() <span style=\"color:blue\">as</span> $i =&gt; $drawing) {\n        <span style=\"color:blue\">if</span> ($drawing <span style=\"color:blue\">instanceof</span> PHPExcel_Worksheet_MemoryDrawing) {\n            ob_start();\n            call_user_func(\n                $drawing-&gt;getRenderingFunction(),\n                $drawing-&gt;getImageResource()\n            );\n            $imageContents = ob_get_contents();\n            ob_end_clean();\n\n            $myFileName = $dataDir . $reporting_type . <span style=\"color:#a31515\">'/graph_'</span> . &#43;&#43;$i . <span style=\"color:#a31515\">'.png'</span>;\n            $trueFileName = <span style=\"color:#a31515\">'graph_'</span> . $i . <span style=\"color:#a31515\">'.png'</span>;\n            file_put_contents($myFileName, $imageContents);\n            $files[] = $trueFileName;\n        }\n    }\n    <span style=\"color:blue\">return</span> $files;\n}\n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<div style=\"color:black; background-color:white\">Ok, I download file from server to my Mac, opened it in MS Office 2011 for Mac, just save it (Cmd&#43;S) and upload to server again, then run script - and voila - all drawings parsed successfuly.</div>\r\n<p>&nbsp;</p>\r\n<p>Sometimes, this error is not appears, but script going to the infinite loop of Notices on this lines:</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>    <span style=\"color:blue\">try</span> {\n        $objPHPExcel = PHPExcel_IOFactory::load($dataDir . $reporting_type . <span style=\"color:#a31515\">'/'</span> . $parseFile);\n    } <span style=\"color:blue\">catch</span> (Exception $e) {\n        <span style=\"color:blue\">die</span>(<span style=\"color:#a31515\">'Error loading file: '</span> . $e-&gt;getMessage());\n    }\n   \n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p>I cannot post Notices now, but when it appear again I'll do it.</p>\r\n<p>So - the question - where is the problem?</p>\r\n<p>Two files (broken.xls and okay.xls) in attch.</p>\r\n<p>Uh, and so strange - MacOS doesn't render preview in file icon for&nbsp;broken.xls and render for&nbsp;okay.xls (this file I saved in Excel by hands), screenshot in attch too.</p>\r\n<p>Attch:</p>\r\n<p>http://phpexcel.codeplex.com/Download/AttachmentDownload.ashx?ProjectName=phpexcel&amp;WorkItemId=10749&amp;FileAttachmentId=6718</p>\r\n<p>http://phpexcel.codeplex.com/Download/AttachmentDownload.ashx?ProjectName=phpexcel&amp;WorkItemId=10749&amp;FileAttachmentId=6719</p>\r\n<p>Thanx!</p>\r\n<p>p.s. sorry for my english.</p>\r\n",
    "PostedDate": "2012-11-28T22:55:20.2-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]