[
  {
    "Id": "149937",
    "ThreadId": "44991",
    "Html": "I am running a Sybase database and using PHPExcel to generate report documents. Anytime I try to run multiple sybase queries only the results from the last query ran are returned, even if I try to put the results from the query into a variable before running a new query. Does anyone have any idea why this might be happening? I know it has to be something with PHPExcel, because I run the same queries on a pure PHP output and everything works properly.<br>\r\n",
    "PostedDate": "2009-01-22T13:50:04.677-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "149959",
    "ThreadId": "44991",
    "Html": "Can you show us some code? Maybe we can better tell what the problem is.<br>\r\n<br>\r\n",
    "PostedDate": "2009-01-22T14:40:25.9-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "150203",
    "ThreadId": "44991",
    "Html": "Code is as follows:<br>\r\n<br>\r\n&lt;?php<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; $Home_dir = &quot;../&quot;;<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; //Information needed to run report query<br>\r\n&nbsp;&nbsp;&nbsp; $Approp_ID = $_COOKIE['approp_info'];<br>\r\n&nbsp;&nbsp;&nbsp; $Fiscal_year = $_COOKIE['fy_info'];<br>\r\n&nbsp;&nbsp;&nbsp; $User_id = $_COOKIE['submission_user_id'];<br>\r\n&nbsp;&nbsp;&nbsp; $User_org = $_COOKIE['user_org'];<br>\r\n&nbsp;&nbsp;&nbsp; $Org_title_query = &quot;SELECT org_title FROM ORG_TITLE WHERE org_id = &quot; . $User_org;<br>\r\n&nbsp;&nbsp;&nbsp; $Org_title_result = sybase_query($Org_title_query);<br>\r\n&nbsp;&nbsp;&nbsp; $Org_title = sybase_result($Org_title_result, 0, 0);<br>\r\n&nbsp;&nbsp;&nbsp; $Approp_query = &quot;SELECT approp FROM APPROPRIATION WHERE approp_id = &quot; . $Approp_ID;<br>\r\n&nbsp;&nbsp;&nbsp; $Approp_result = sybase_query($Approp_query);<br>\r\n&nbsp;&nbsp;&nbsp; $Approp = sybase_result($Approp_result, 0, 0);<br>\r\n&nbsp;&nbsp; &nbsp;<br>\r\n&nbsp;&nbsp;&nbsp; //Connect to the database<br>\r\n&nbsp;&nbsp;&nbsp; include (&quot;../include/dbconnect.php&quot;);<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; //Include PHPExcel information to build Excel document<br>\r\n&nbsp;&nbsp;&nbsp; $Include_path = &quot;../include/PHPExcel/Classes/&quot;;<br>\r\n&nbsp;&nbsp;&nbsp; include ($Include_path . &quot;PHPExcel.php&quot;);<br>\r\n&nbsp;&nbsp;&nbsp; include ($Include_path . &quot;PHPExcel/Writer/Excel2007.php&quot;);<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; //Create the Excel document object<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel = new PHPExcel();<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; //Set the document properties for the document<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getProperties()-&gt;setCreator('Jeremy Twidt');<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getProperties()-&gt;setTitle('Change Report');<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getProperties()-&gt;setSubject('Change Report');<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; //Set up the document for display<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;setActiveSheetIndex(0);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getPageSetup()-&gt;setHorizontalCentered(true);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getPageSetup()-&gt;setVerticalCentered(false);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setTitle('Change Report');<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getDefaultStyle()-&gt;getFont()-&gt;setName('Calibri');<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getDefaultStyle()-&gt;getFont()-&gt;setSize(10);<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; //Format the column widths for the report<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('A')-&gt;setWidth(13);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('B')-&gt;setWidth(13);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('C')-&gt;setWidth(13);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('D')-&gt;setWidth(13);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('E')-&gt;setWidth(13);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('F')-&gt;setWidth(13);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('G')-&gt;setWidth(13);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension('H')-&gt;setWidth(13);<br>\r\n&nbsp;&nbsp; &nbsp;<br>\r\n&nbsp;&nbsp;&nbsp; //Set the report title information<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C1', 'Upward Obligation Adjustments (Within Scope Adjustments) ' . $Org_title);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C2', 'Appropriation: ' . $Approp . ' As of Fiscal Year ' . $Fiscal_year);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('C1')-&gt;getFont()-&gt;setSize(12);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('C1')-&gt;getFont()-&gt;setBold(true);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('C2')-&gt;getFont()-&gt;setSize(12);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('C2')-&gt;getFont()-&gt;setBold(true);<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; //Set the column headers<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A4', 'PPA');<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B4', '1ST EXP FY');<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C4', '2ND EXP FY');<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('D4', '3RD EXP FY');<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('E4', '4TH EXP FY');<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('F4', '5TH EXP FY');<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('G4', 'CANCELED FY');<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('H4', 'TOTAL');<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; //Set the styles for the column header<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('A4')-&gt;getAlignment()-&gt;setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('A4')-&gt;getFont()-&gt;setBold(true);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;duplicateStyle($objPHPExcel-&gt;getActiveSheet()-&gt;getStyle('A4'), 'B4:H4');<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; $Row_count = 1;<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; $Report_Query = &quot;EXEC getWSCCReport2 @ORG_ID = &quot; . $User_org . &quot;, @APPROVAL_YEAR = &quot; . $Fiscal_year . &quot;, @APPROP_ID = &quot; . $Approp_ID;<br>\r\n&nbsp;&nbsp; &nbsp;$Report = sybase_query($Report_Query);<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; //Goes through each organization<br>\r\n&nbsp;&nbsp; &nbsp;for ($Org_counter = 0; $Org_counter &lt; sybase_num_rows($Report); $Org_counter+=6)<br>\r\n&nbsp;&nbsp; &nbsp;{<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Adds up the total value for each of the organizations return years<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for ($Col_counter = 0; $Col_counter &lt; 6; $Col_counter++)<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$Sum = $Sum + sybase_result($Report, $Org_counter + $Col_counter, 3);<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //If the organization had activity in any of the six years selected, add it to the report<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if ($Sum &lt;&gt; 0)<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ($Row_count % 2 ==0)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(0, $Row_count + 5)-&gt;getFill()-&gt;setFillType(PHPExcel_Style_Fill::FILL_SOLID);<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(0, $Row_count + 5)-&gt;getFill()-&gt;getStartColor()-&gt;setARGB('00C8C8C8');<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $Start_cell = 'A' . strval($Row_count + 5);<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $End_cell = 'H' . strval($Row_count + 5);<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;duplicateStyle($objPHPExcel-&gt;getActiveSheet()-&gt;getStyle($Start_cell), $Start_cell . ':' . $End_cell);<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow(0, $Row_count + 5, strval(sybase_result($Report, $Org_counter, 1)));<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //If there is a dollar amount for the year output it to the report<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for ($Col_counter = 0; $Col_counter &lt; 6; $Col_counter++)<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if (sybase_result($Report, $Org_counter + $Col_counter, 3) &lt;&gt; 0)<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow($Col_counter + 1 , $Row_count + 5, number_format(round(sybase_result($Report, $Org_counter + $Col_counter, 3)), 0, '', ''));<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow($Col_counter + 1, $Row_count + 5)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_USD);<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch (sybase_result($Report, $Org_counter + $Col_counter, 2))<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 1:<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $First_exp_FY_total += sybase_result($Report, $Org_counter + $Col_counter, 3);<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 2:<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $Second_exp_FY_total += sybase_result($Report, $Org_counter + $Col_counter, 3);<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 3:<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $Third_exp_FY_total += sybase_result($Report, $Org_counter + $Col_counter, 3);<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 4:<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $Fourth_exp_FY_total += sybase_result($Report, $Org_counter + $Col_counter, 3);<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 5:<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $Fifth_exp_FY_total += sybase_result($Report, $Org_counter + $Col_counter, 3);<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 6:<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $Cancelled_FY_total += sybase_result($Report, $Org_counter + $Col_counter, 3);<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Otherwise put a zero in place<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;else<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow($Col_counter + 1 , $Row_count + 5, '0');<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow($Col_counter + 1, $Row_count + 5)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_USD);<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Add the organizations total UOA values for the six years to the report<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow(7 , $Row_count + 5, round($Sum, 0));<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(7,&nbsp; $Row_count + 5)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_USD);<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $Sum_total += $Sum;<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$Sum = 0;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $Row_count += 1;<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;else<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;{<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$Sum = 0;<br>\r\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br>\r\n&nbsp;&nbsp; &nbsp;}<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; //Add the totals row to the report, which is a total for all organizations for each year<br>\r\n&nbsp;&nbsp;&nbsp; $Total_row = $Row_count + 6;<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow(0, $Total_row, 'Total');<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(0, $Total_row)-&gt;getFont()-&gt;setBold(true);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow(1, $Total_row, round($First_exp_FY_total));<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow(2, $Total_row, round($Second_exp_FY_total));<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow(3, $Total_row, round($Third_exp_FY_total));<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow(4, $Total_row, round($Fourth_exp_FY_total));<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow(5, $Total_row, round($Fifth_exp_FY_total));<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow(6, $Total_row, round($Cancelled_FY_total));<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow(7, $Total_row, round($Sum_total));<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(1, $Total_row)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_USD);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(1, $Total_row)-&gt;getFont()-&gt;setBold(true);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(2, $Total_row)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_USD);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(2, $Total_row)-&gt;getFont()-&gt;setBold(true);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(3, $Total_row)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_USD);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(3, $Total_row)-&gt;getFont()-&gt;setBold(true);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(4, $Total_row)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_USD);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(4, $Total_row)-&gt;getFont()-&gt;setBold(true);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(5, $Total_row)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_USD);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(5, $Total_row)-&gt;getFont()-&gt;setBold(true);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(6, $Total_row)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_USD);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(6, $Total_row)-&gt;getFont()-&gt;setBold(true);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(7, $Total_row)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_USD);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow(7, $Total_row)-&gt;getFont()-&gt;setBold(true);<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; //Set the print area for the document<br>\r\n&nbsp;&nbsp;&nbsp; $Last_cell = 'H' . strval($Total_row);<br>\r\n&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getPageSetup()-&gt;setPrintArea('A1:' . $Last_cell);<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; //Set the header information so that file is sent to users Excel<br>\r\n&nbsp;&nbsp;&nbsp; header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');<br>\r\n&nbsp;&nbsp;&nbsp; header('Content-Disposition: attachment;filename=&quot;WSCCReport.xlsx&quot;');<br>\r\n&nbsp;&nbsp;&nbsp; header('Cache-Control: max-age=0');<br>\r\n<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; //Prepare the file for output and output it<br>\r\n&nbsp;&nbsp;&nbsp; $objWriter = new PHPExcel_Writer_Excel2007($objPHPExcel);<br>\r\n&nbsp;&nbsp;&nbsp; $objWriter-&gt;save('php://output');<br>\r\n?&gt;<br>\r\n",
    "PostedDate": "2009-01-23T04:51:54.853-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "150458",
    "ThreadId": "44991",
    "Html": "Uh... your script is a bit long, and I'm still not sure if I understand the problem correctly.<br>\r\n<br>\r\nUsually, I solve this kind of problem by injecting some <code>echo</code> statement to see where things go wrong. For example:<br>\r\n<br>\r\n<code>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow(1, $Total_row, round($First_exp_FY_total));<br>\r\necho 'Inserting :';<br>\r\nvar_dump(round($First_exp_FY_total));<br>\r\necho 'in column 1, row ';<br>\r\nvar_dump($Total_row);<br>\r\n</code>\r\n<br>\r\nUsually some variable is not what you would expect. This technique for debugging has never failed for me!<br>\r\n<br>\r\n",
    "PostedDate": "2009-01-23T19:39:36.823-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "150524",
    "ThreadId": "44991",
    "Html": "I know that all of the code itself works because if I re-arrange the order of the database queries I always get results from the last query but none of the others. That is what my problem is<br>\r\n",
    "PostedDate": "2009-01-24T07:31:42.967-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "150525",
    "ThreadId": "44991",
    "Html": "It is possible that your queries are working, but maybe you are overriding the cells? Try my suggestion to see where things go wrong, echo statements always do the trick!<br>\r\n<br>\r\n",
    "PostedDate": "2009-01-24T07:40:16.98-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "151065",
    "ThreadId": "44991",
    "Html": "I figured out what that problem was, but now I get a corrupt file whenever I have a database connection in my php script. I know it isn't the corrupt zip extension because if there isn't a database connection the excel sheet downloads fine. Any ideas?<br>\r\n",
    "PostedDate": "2009-01-26T12:20:09.73-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "151215",
    "ThreadId": "44991",
    "Html": "In that case, first try to save Excel file on disk instead of sending directly to client browser.<br>\r\n<br>\r\nI'm guessing that your include script for database connection has some white space before opening <code>&lt;?php</code> tag or closing <code>?&gt;</code> tag.<br>\r\n<br>\r\n",
    "PostedDate": "2009-01-26T22:22:14.673-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "151289",
    "ThreadId": "44991",
    "Html": "I thought about something being wrong with the include script, but I still get a corrupted file when I copy the code directly into my script, even when I trim it down to just the line that establishes the database connection.&nbsp; When I save the file to disk, the file comes out fine.&nbsp; On that note if I use fpassthru do i still need the download headers or how does that work?<br>\r\n",
    "PostedDate": "2009-01-27T04:57:24.267-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "151311",
    "ThreadId": "44991",
    "Html": "Can you try to compare the two files (saved to disk vs. send to browser) in a HEX editor. File sizes in bytes are supposed to be exactly the same.<br>\r\n<br>\r\nLook for differences especially at the beginning of the file, and post back what you find.<br>\r\n<br>\r\n",
    "PostedDate": "2009-01-27T05:40:16.53-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]