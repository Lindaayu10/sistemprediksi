[
  {
    "Id": "733129",
    "ThreadId": "288005",
    "Html": "\r\n<p>Hi<br>\r\n<br>\r\ni have a problem with a while loop through the sheets in the exporting Workbook.<br>\r\nThe first part ($abfrage0) works well and i get the correct records in all sheets. Also the name of the sheets are correctly taken from the datarecords, but the last query ($abfrage4) doesn't get the correct datarecords and i don't know why.<br>\r\nHere the code:</p>\r\n<p></p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>\t<span style=\"color:green\">/*------------------------------------------------------------------------------------------------------\r\n\t  Les variables de la demande par date\r\n\t-------------------------------------------------------------------------------------------------------*/</span>\r\n\t$id_acores \t\t= $_GET[<span style=\"color:#a31515\">'id'</span>];\r\n\t$date_demande \t= $_GET[<span style=\"color:#a31515\">'date_demande'</span>];\r\n\t$code_acores \t= $_GET[<span style=\"color:#a31515\">'codeAcore'</span>];\r\n\t$codeRegate \t= $_GET[<span style=\"color:#a31515\">'codeRegate'</span>];\r\n\t<span style=\"color:green\">/*------------------------------------------------------------------------------------------------------\r\n\t  La premier requete pour obtenir les enregistrements par la date de demande\r\n\t-------------------------------------------------------------------------------------------------------*/</span>\r\n\r\n\t$abfrage0 = &quot;SELECT DISTINCT acores.id_acores...\r\n\t\t\t\t\t\r\n\t$ergebnis0 = mysql_query($abfrage0) <span style=\"color:blue\">or</span> <span style=\"color:blue\">die</span>(<span style=\"color:#a31515\">&quot;Query failed with error: &quot;</span>.mysql_error());\r\n\r\n\t<span style=\"color:blue\">if</span>( mysql_numrows($ergebnis0) &lt; 0)\r\n\t{\r\n\t\t$codeRegate\t \t\t= mysql_result($ergebnis0 , 0 , <span style=\"color:#a31515\">&quot;code_regate&quot;</span>);\r\n\t\t$libBureau\t \t\t= mysql_result($ergebnis0 , 0 , <span style=\"color:#a31515\">&quot;libelle&quot;</span>);\r\n\t\t$acoreTelephone\t\t= mysql_result($ergebnis0 , 0 , <span style=\"color:#a31515\">&quot;telephone&quot;</span>);\r\n\t\t$acoreEmail\t \t\t= mysql_result($ergebnis0 , 0 , <span style=\"color:#a31515\">&quot;mail&quot;</span>);\r\n\t\t$date_demande\t \t= mysql_result($ergebnis0 , 0 , <span style=\"color:#a31515\">&quot;date_demande&quot;</span>);\r\n\t\t$agent\t\t\t\t= mysql_result($ergebnis0 , 0 , <span style=\"color:#a31515\">&quot;agent&quot;</span>);\r\n\t\t$Nom\t\t\t\t= mysql_result($ergebnis0 , 0 , <span style=\"color:#a31515\">&quot;nom_agent&quot;</span>);\r\n\t\t$Prenom\t\t\t\t= mysql_result($ergebnis0 , 0 , <span style=\"color:#a31515\">&quot;prenom_agent&quot;</span>);\r\n\t}\r\n\t<span style=\"color:blue\">else</span>\r\n\t{\r\n\t\t$codeRegate\t \t= <span style=\"color:#a31515\">&quot;&quot;</span>;\r\n\t\t$libBureau\t \t= <span style=\"color:#a31515\">&quot;&quot;</span>;\r\n\t\t$acoreTelephone\t= <span style=\"color:#a31515\">&quot;&quot;</span>;\r\n\t\t$acoreEmail\t\t= <span style=\"color:#a31515\">&quot;&quot;</span>;\r\n\t\t$date_demande\t= <span style=\"color:#a31515\">&quot;&quot;</span>;\r\n\t\t$agent\t\t \t= <span style=\"color:#a31515\">&quot;&quot;</span>;\r\n\t\t$Nom\t\t\t= <span style=\"color:#a31515\">&quot;&quot;</span>;\r\n\t\t$Prenom\t\t\t= <span style=\"color:#a31515\">&quot;&quot;</span>;\r\n\t}\r\n\t<span style=\"color:green\">/*------------------------------------------------------------------------------------------------------\r\n\t  Debout du boucle\r\n\t-------------------------------------------------------------------------------------------------------*/</span>\r\n\r\n\t<span style=\"color:blue\">while</span>($abfrage0 = mysql_fetch_assoc($ergebnis0))\t\t\t \r\n\t{\r\n\r\n\t$cr \t\t= \t$abfrage0[<span style=\"color:#a31515\">'code_regate'</span>];\r\n\t$lib \t\t= \t$abfrage0[<span style=\"color:#a31515\">'libelle'</span>];\r\n\t$tel \t\t= \t$abfrage0[<span style=\"color:#a31515\">'telephone'</span>];\r\n\t$email \t\t= \t$abfrage0[<span style=\"color:#a31515\">'mail'</span>];\r\n\t$ddem \t\t= \t$abfrage0[<span style=\"color:#a31515\">'date_demande'</span>];\r\n\t$newA\t\t=\t$abfrage0[<span style=\"color:#a31515\">'agent'</span>];\r\n\t$newN\t\t= \t$abfrage0[<span style=\"color:#a31515\">'nom_agent'</span>];\r\n\t$newP\t\t=\t$abfrage0[<span style=\"color:#a31515\">'prenom_agent'</span>];\r\n\r\n\r\n\t$objWorksheet = <span style=\"color:blue\">new</span> PHPExcel_Worksheet($objPHPExcel);\r\n\t$objPHPExcel-&gt;addSheet($objWorksheet);\r\n\t$abfrage1 \t= <span style=\"color:#a31515\">&quot;select distinct devises from details_coupures order by devises&quot;</span>;\r\n\t$ergebnis1 \t= mysql_query($abfrage1) <span style=\"color:blue\">or</span> <span style=\"color:blue\">die</span>(<span style=\"color:#a31515\">&quot;Query failed with error: &quot;</span>.mysql_error());\r\n\r\n\t$rows=7;\r\n\t<span style=\"color:blue\">while</span>($row = mysql_fetch_row($ergebnis1))\r\n\t{\r\n\r\n\t$abfrage2 \t= <span style=\"color:#a31515\">&quot;select count(coupure) as 'ncoupures' from details_coupures where devises = '&quot;</span>.$row[0].<span style=\"color:#a31515\">&quot;'&quot;</span>;\r\n\t$ergebnis2 \t= mysql_query($abfrage2) <span style=\"color:blue\">or</span> <span style=\"color:blue\">die</span>(<span style=\"color:#a31515\">&quot;Query failed with error: &quot;</span>.mysql_error());\r\n\r\n\t$ncoupures\t \t= mysql_result($ergebnis2 , 0 , <span style=\"color:#a31515\">&quot;ncoupures&quot;</span>);\r\n\t\t\r\n\t\t$abfrage3 \t= <span style=\"color:#a31515\">&quot;select coupure from details_coupures where devises = '&quot;</span>.$row[0].<span style=\"color:#a31515\">&quot;' order by coupure&quot;</span>;\r\n\t\t$ergebnis3 \t= mysql_query($abfrage3) <span style=\"color:blue\">or</span> <span style=\"color:blue\">die</span>(<span style=\"color:#a31515\">&quot;Query failed with error: &quot;</span>.mysql_error());\r\n\r\n\t\t<span style=\"color:blue\">while</span>($row1 = mysql_fetch_row($ergebnis3))\r\n\t\t{\r\n\t\t$abfrage4 = &quot; SELECT DISTINCT detail_demande_appro_devise.quantite\r\n\t\t\t\t\t\tFROM demande_appro_devise, acores, infos_bureau, detail_demande_appro_devise \r\n\t\t\t\t\t\tWHERE acores.id_acores = <span style=\"color:#a31515\">'&quot;.$id_acores.&quot;'</span> \r\n\t\t\t\t\t\tAND demande_appro_devise.date_demande = <span style=\"color:#a31515\">'&quot;.$date_demande.&quot;'</span> \r\n\t\t\t\t\t\tAND demande_appro_devise.code_acores = <span style=\"color:#a31515\">'&quot;.$codeAcores.&quot;'</span> \r\n\t\t\t\t\t\tAND detail_demande_appro_devise.coupure = <span style=\"color:#a31515\">'&quot;.$row1[0].&quot;'</span> \r\n\t\t\t\t\t\tAND demande_appro_devise.code_devise = <span style=\"color:#a31515\">'&quot;.$row[0].&quot;'</span> \r\n\t\t\t\t\t\tAND demande_appro_devise.num_demande = detail_demande_appro_devise.num_demande&quot;;\r\n\t\t$ergebnis4 \t= mysql_query($abfrage4) <span style=\"color:blue\">or</span> <span style=\"color:blue\">die</span>(<span style=\"color:#a31515\">&quot;Query failed with error: &quot;</span>.mysql_error());\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t<span style=\"color:blue\">if</span>( mysql_numrows($ergebnis4) &gt; 0)\r\n\t\t\t{\r\n\t\t\t\t$nombre_coupures\t \t= mysql_result($ergebnis4 [<span style=\"color:#a31515\">'quantite'</span>]);\r\n\t\t\t}\r\n\t\t\t<span style=\"color:blue\">else</span>\r\n\t\t\t{\r\n\t\t\t\t$nombre_coupures\t \t= <span style=\"color:#a31515\">&quot;0&quot;</span>;\r\n\t\t\t}\r\n\t\t\t\t$objWorksheet-&gt;setCellValue(<span style=\"color:#a31515\">'A'</span>. $rows, $row[0]);\r\n\t\t\t\t$objWorksheet-&gt;setCellValue(<span style=\"color:#a31515\">'B'</span>. $rows, $row1[0]);\r\n\t\t\t\t$objWorksheet-&gt;setCellValue(<span style=\"color:#a31515\">'C'</span>. $rows, $nombre_coupures, $row1[0], $row[0]);\r\n\t\t\t\t$objWorksheet-&gt;setCellValue(<span style=\"color:#a31515\">'D'</span>. $rows, ( $nombre_coupures * $row1[0] ));\r\n\t\t\t\t$rows&#43;&#43;;\t\r\n\t\t}\r\n\t}\r\n</pre>\r\n</div>\r\n<p></p>\r\n<p>If anybody has an idea?</p>\r\n<p>&nbsp;</p>\r\n<p>Thanks in advance</p>\r\n<p>Achillix</p>\r\n",
    "PostedDate": "2012-01-31T03:16:40.373-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "733154",
    "ThreadId": "288005",
    "Html": "<p>Hmm, i think mysql_numrows() is not a valid function, should be mysql_num_rows(). Furthermore, have you checked that the query actually gives any results?&nbsp;</p>\r\n<p>Some general notes:</p>\r\n<p>- fix your indentation</p>\r\n<p>- why are you not using the object oriented interface for mysqli?</p>\r\n<p>- if you use mysql_fetch_assoc() you can use the field aliasses from your select as array keys, this makes your code much easier to read</p>\r\n<p>- write your queries as 1 query using appropriate joins/group by's</p>\r\n<p>- use 1 language instead of 3 ;)</p>",
    "PostedDate": "2012-01-31T04:36:21.357-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "733201",
    "ThreadId": "288005",
    "Html": "<p>Hi</p>\r\n<p>thank you for reply</p>\r\n<p>Yes i get some results for the column A and B but C and D stays on \"0\".</p>\r\n<p>The same result i get with mysql_numrows() and mysql_num_rows().</p>\r\n<p>I can't&nbsp; take join, because i will get much more results that i need, the results must be identically.</p>\r\n<p>What do you mean about this:</p>\r\n<p>- if you use mysql_fetch_assoc() you can use the field aliasses from  your select as array keys, this makes your code much easier to read</p>\r\n<p>&nbsp;</p>\r\n<p>Which language? French or German ? ;-)</p>\r\n<p>&nbsp;</p>\r\n<p>Thanks</p>",
    "PostedDate": "2012-01-31T06:04:38.137-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "733220",
    "ThreadId": "288005",
    "Html": "<p>D is always going to be 0, if your query mysql_num_rows() returns 0 or false. What I mean by aliases:</p>\r\n<p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre>$query = <span style=\"color: #a31515;\">'SELECT id,name FROM users'</span>\r\n\r\n$result = $db-&gt;query($query);\r\n$row = $result-&gt;fetch_assoc();\r\n\r\nprint_r($row);\r\n\r\nArray\r\n(\r\n    [id] =&gt; 1\r\n    [name] =&gt; mike\r\n)\r\n\r\n</pre>\r\n</div>\r\n</p>\r\n<p>You can then use $row['name'] in stead of $row[1], which makes your code much easier to read. Another tip, if you want to know the numer of rows in a result, you can also do:</p>\r\n<p>SELECT &nbsp;COUNT(*) as total FROM your_table;</p>",
    "PostedDate": "2012-01-31T06:41:15.317-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "733243",
    "ThreadId": "288005",
    "Html": "<p>I have the same query for a single Sheet Export and it works great. But here it shows me on the rows C &amp; D only '0' when i put it in a while.</p>\r\n<p>It is strange.</p>\r\n<p>i will try it by arrays</p>\r\n<p>thx</p>",
    "PostedDate": "2012-01-31T07:14:37.47-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "734880",
    "ThreadId": "288005",
    "Html": "<p>Hi</p>\r\n<p>I have found the problem, it was the wrong variables in my last query.</p>\r\n<p>I changed only this part:</p>\r\n<p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre>WHERE acores.id_acores = <span style=\"color: #a31515;\">'\".$id_acores.\"'</span> \r\nAND demande_appro_devise.date_demande = <span style=\"color: #a31515;\">'\".$date_demande.\"'</span> \r\nAND demande_appro_devise.code_acores = <span style=\"color: #a31515;\">'\".$codeAcores.\"'</span> \r\n</pre>\r\n</div>\r\n</p>\r\n<p>with this:</p>\r\n<p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre>WHERE acores.id_acores = <span style=\"color: #a31515;\">'\".$idA.\"'</span> \r\nAND demande_appro_devise.date_demande = <span style=\"color: #a31515;\">'\".$ddem.\"'</span> \r\nAND demande_appro_devise.code_acores = <span style=\"color: #a31515;\">'\".$cora.\"'</span> \r\n</pre>\r\n</div>\r\n</p>\r\n<p>But i've don't tried with an Array, i don't know how ;-)</p>\r\n<p>Thank you and greetings</p>\r\n<p>Achillix</p>",
    "PostedDate": "2012-02-01T08:42:29.237-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]