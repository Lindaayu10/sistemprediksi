[
  {
    "Id": "550087",
    "ThreadId": "241978",
    "Html": "\r\n<p>I have an odd exception I cannot trace the root of, Using version 1.7.4: System runs nicely through part of the equation in the cell then just gives up throwing an exception.</p>\r\n<p>Having played around quite a bit with this I wonder if its a problem recalculating the same cell value for a second time as the problem seems to occur when the system is about to recalc the Course_leadership_min for the second time in the final clause of\r\n the second IF underlined / bold below. Alternatively have I just hit the nesting limit or some stack problem?</p>\r\n<p>Any thoughts anyone?</p>\r\n<p>&nbsp;</p>\r\n<p>Mike Sharp</p>\r\n<p>Details:</p>\r\n<p>This is the equation:</p>\r\n<p>=IF(C12&lt;&gt;0,((V2TM_lecture_points*E12&#43;(((INT(C12/(V2TM_seminar_Split_count&#43;(V2TM_seminar_Split_count/5)))&#43;1))*V2TM_lecture_points*F12)&#43;(C12*V2TM_individual_student_assessment_points)*G12)*(D12/Base_credit_value))&#43;IF(B12&lt;&gt;0,(B12*(<span style=\"text-decoration:underline\"><strong><span style=\"color:#888888\">Course_Leadership_min</span></strong></span>&#43;(((Course_Leadership_max-Course_Leadership_min)/Max_group_size_for_scale_calcs)*C12))),0),0)</p>\r\n<p>and here is the output from the getCalculatedvalue() echo's</p>\r\n<p>Cell J12 value is a f with a value of =IF(C12&lt;&gt;0,((V2TM_lecture_points*E12&#43;(((INT(C12/(V2TM_seminar_Split_count&#43;(V2TM_seminar_Split_count/5)))&#43;1))*V2TM_lecture_points*F12)&#43;(C12*V2TM_individual_student_assessment_points)*G12)*(D12/Base_credit_value))&#43;IF(B12&lt;&gt;0,(B12*(Course_Leadership_min&#43;(((Course_Leadership_max-Course_Leadership_min)/Max_group_size_for_scale_calcs)*C12))),0),0)<br>\r\n<span style=\"color:blue; font-family:Arial\"></p>\r\n<p>Cell value for J12 is a formula: Calculating value <br>\r\nCell C12 value is a n with a value of 50<br>\r\nCell value for C12 is not a formula: Returning data value of 50<br>\r\nCell E12 value is a n with a value of 0.5<br>\r\nCell value for E12 is not a formula: Returning data value of 0.5<br>\r\nCell C12 value is a n with a value of 50<br>\r\nCell value for C12 is not a formula: Returning data value of 50<br>\r\nCell F12 value is a n with a value of 0.5<br>\r\nCell value for F12 is not a formula: Returning data value of 0.5<br>\r\nCell C12 value is a n with a value of 50<br>\r\nCell value for C12 is not a formula: Returning data value of 50<br>\r\nCell G12 value is a n with a value of 0.5<br>\r\nCell value for G12 is not a formula: Returning data value of 0.5<br>\r\nCell D12 value is a n with a value of 15<br>\r\nCell value for D12 is not a formula: Returning data value of 15<br>\r\nCell C26 value is a f with a value of =IF(B26&lt;&gt;1,D26,(INT(100*D26*ScaleFactor)/100))<br>\r\nCell value for C26 is a formula: Calculating value<br>\r\nCell B26 value is a n with a value of 0<br>\r\nCell value for B26 is not a formula: Returning data value of 0<br>\r\nCell D26 value is a n with a value of 30<br>\r\nCell value for D26 is not a formula: Returning data value of 30<br>\r\nCell D26 value is a n with a value of 30<br>\r\nCell value for D26 is not a formula: Returning data value of 30<br>\r\nCell B3 value is a n with a value of 10<br>\r\nCell value for B3 is not a formula: Returning data value of 10<br>\r\nC26 calculation result is 30<br>\r\nReturning calculated value of 30 for cell C26<br>\r\nCell B12 value is a n with a value of 1<br>\r\nCell value for B12 is not a formula: Returning data value of 1<br>\r\nCell B12 value is a n with a value of 1<br>\r\nCell value for B12 is not a formula: Returning data value of 1<br>\r\nCell C78 value is a f with a value of =IF(B78&lt;&gt;1,D78,(INT(100*D78*ScaleFactor)/100))<br>\r\nCell value for C78 is a formula: Calculating value<br>\r\nCell B78 value is a n with a value of 1<br>\r\nCell value for B78 is not a formula: Returning data value of 1<br>\r\nCell D78 value is a n with a value of 0.5<br>\r\nCell value for D78 is not a formula: Returning data value of 0.5<br>\r\nCell D78 value is a n with a value of 0.5<br>\r\nCell value for D78 is not a formula: Returning data value of 0.5<br>\r\nCell B3 value is a n with a value of 10<br>\r\nCell value for B3 is not a formula: Returning data value of 10<br>\r\nC78 calculation result is 5<br>\r\nReturning calculated value of 5 for cell C78<br>\r\nCell C79 value is a f with a value of =IF(B79&lt;&gt;1,D79,(INT(100*D79*ScaleFactor)/100))<br>\r\nCell value for C79 is a formula: Calculating value<br>\r\nCell B79 value is a n with a value of 1<br>\r\nCell value for B79 is not a formula: Returning data value of 1<br>\r\nCell D79 value is a n with a value of 2<br>\r\nCell value for D79 is not a formula: Returning data value of 2<br>\r\nCell D79 value is a n with a value of 2<br>\r\nCell value for D79 is not a formula: Returning data value of 2<br>\r\nCell B3 value is a n with a value of 10<br>\r\nCell value for B3 is not a formula: Returning data value of 10<br>\r\nC79 calculation result is 20<br>\r\nReturning calculated value of 20 for cell C79<br>\r\nCell C78 value is a f with a value of =IF(B78&lt;&gt;1,D78,(INT(100*D78*ScaleFactor)/100))<br>\r\nCell value for C78 is a formula: Calculating value<br>\r\nC78 calculation result is 5<br>\r\nReturning calculated value of 5 for cell C78<br>\r\nCell C12 value is a f with a value of =IF(B12&lt;&gt;1,D12,(INT(100*D12*ScaleFactor)/100))<br>\r\nCell value for C12 is a formula: Calculating value<br>\r\nCell B12 value is a n with a value of 0<br>\r\nCell value for B12 is not a formula: Returning data value of 0<br>\r\nCell D12 value is a n with a value of 200<br>\r\nCell value for D12 is not a formula: Returning data value of 200<br>\r\nCell D12 value is a n with a value of 200<br>\r\nCell value for D12 is not a formula: Returning data value of 200<br>\r\nCell B3 value is a n with a value of 10<br>\r\nCell value for B3 is not a formula: Returning data value of 10<br>\r\nC12 calculation result is 200<br>\r\nReturning calculated value of 200 for cell C12<br>\r\nCell C12 value is a n with a value of 50<br>\r\nCell value for C12 is not a formula: Returning data value of 50<br>\r\nCalculation Exception: internal error<br>\r\n<br>\r\n<strong>Fatal error</strong>: Uncaught exception 'Exception' with message 'Individual worksheet!J12 -&gt; internal error' in /home/sm11/public_html/BAWS/PHPExcel/Classes/PHPExcel/Cell.php:272 Stack trace: #0 /home/sm11/public_html/BAWS/class_lib.php(125): PHPExcel_Cell-&gt;getCalculatedValue()\r\n #1 /home/sm11/public_html/BAWS/class_lib.php(72): spreadsheetFileManager-&gt;transferSheet(Object(PHPExcel), '10047') #2 /home/sm11/public_html/BAWS/index.php(16): spreadsheetFileManager-&gt;uploadSheet('SED_10047_??? ...', 'Uploads/') #3 {main} thrown in\r\n<strong>/home/sm11/public_html/BAWS/PHPExcel/Classes/PHPExcel/Cell.php</strong> on line\r\n<strong>272</strong></p>\r\n</span>\r\n<p></p>\r\n<p>Using version 1.7.4</p>\r\n",
    "PostedDate": "2011-01-16T04:24:43.097-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "550537",
    "ThreadId": "241978",
    "Html": "\r\n<p>You'd normally only get this exception with a formula that hasn't parsed correctly, but it's the fallback error, where the parser can't identify what the problem actually is.</p>\r\n<p></p>\r\n<div style=\"color:black; background-color:yellow\">Having played around quite a bit with this I wonder if its a problem recalculating the same cell value for a second time as the problem seems to occur when the system is about to recalc the Course_leadership_min\r\n for the second time in the final clause of the second IF underlined / bold below. Alternatively have I just hit the nesting limit or some stack problem?</div>\r\n<p></p>\r\n<p>This wouldn't normally be an issue. The default setting is that PHPExcel will cache the calculation results for each cell, so subsequent requests that reference the same cell will read the cache rather than recalculate. There is a time limit for this cache,\r\n but I don't think that's likely to cause&nbsp;this problem.</p>\r\n<p>Is it possible for you to try this with the latest SVN code? It provides better logging information&nbsp;within the Calculation Engine.</p>\r\n",
    "PostedDate": "2011-01-17T06:13:15.497-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "550662",
    "ThreadId": "241978",
    "Html": "\r\n<p>Hi Mark.</p>\r\n<p>Many thanks for the reply. Tried it with the latest version of cell.php and calculation.php as the full new version gives me other headaches. I restored the remmed out echo / print lines and added MWS at end of error call in calculation function to be sure\r\n it was the source of the error and by the looks of it the line 3300 is indeed where the problem is spotted:</p>\r\n<p>3300 if ($stack-&gt;count() != 1) return $this-&gt;_raiseFormulaError(&quot;internal error MWS&quot;);</p>\r\n<p>Here is the final portion of the output I get when I run it all:</p>\r\n<p><span style=\"color:blue; font-family:Arial\"></p>\r\n<p>....</p>\r\n<p>Array ( [type] =&gt; Binary Operator [value] =&gt; / [reference] =&gt; ) <br>\r\nToken is a binary operator<br>\r\nArray ( [type] =&gt; Cell Reference [value] =&gt; C12 [reference] =&gt; C12 ) <br>\r\nReference is a single Cell<br>\r\n$cellRef=C12 in current worksheet<br>\r\nArray ( [type] =&gt; Binary Operator [value] =&gt; * [reference] =&gt; ) <br>\r\nToken is a binary operator<br>\r\nArray ( [type] =&gt; Binary Operator [value] =&gt; &#43; [reference] =&gt; ) <br>\r\nToken is a binary operator<br>\r\nArray ( [type] =&gt; Binary Operator [value] =&gt; * [reference] =&gt; ) <br>\r\nToken is a binary operator<br>\r\nArray ( [type] =&gt; Value [value] =&gt; 0 [reference] =&gt; ) <br>\r\nArray ( [type] =&gt; Operand Count for Function IF() [value] =&gt; 3 [reference] =&gt; )\r\n<br>\r\nArray ( [type] =&gt; Function [value] =&gt; IF( [reference] =&gt; ) <br>\r\nToken is a function<br>\r\nFunction IF expects 3 arguments<br>\r\nArguments are: Array ( [2] =&gt; Array ( [12] =&gt; Array ( [B] =&gt; 1 ) ) [1] =&gt; #DIV/0! [0] =&gt; 0 )\r\n<br>\r\n<br>\r\n<strong>Warning</strong>: call_user_func_array() expects parameter 1 to be a valid callback, class 'PHPExcel_Calculation_Logical' not found in\r\n<strong>/home/sm11/public_html/BAWS/PHPExcel/Classes/PHPExcel/Calculation.php</strong> on line\r\n<strong>3259</strong><span style=\"color:#ff0000\"> [This warning appears often in the preceding text (not shown) seems not to damage the eventual outcome.]\r\n</span><br>\r\nArray ( [type] =&gt; Binary Operator [value] =&gt; &#43; [reference] =&gt; ) <br>\r\nToken is a binary operator<br>\r\nArray ( [type] =&gt; Value [value] =&gt; 0 [reference] =&gt; ) <br>\r\nArray ( [type] =&gt; Operand Count for Function IF() [value] =&gt; 3 [reference] =&gt; )\r\n<br>\r\nArray ( [type] =&gt; Function [value] =&gt; IF( [reference] =&gt; ) <br>\r\nToken is a function<br>\r\nFunction IF expects 3 arguments<br>\r\nArguments are: Array ( [2] =&gt; #REF! [1] =&gt; #REF! [0] =&gt; 0 ) <br>\r\n<br>\r\n<strong>Warning</strong>: call_user_func_array() expects parameter 1 to be a valid callback, class 'PHPExcel_Calculation_Logical' not found in\r\n<strong>/home/sm11/public_html/BAWS/PHPExcel/Classes/PHPExcel/Calculation.php</strong> on line\r\n<strong>3259</strong> <span style=\"color:blue; font-family:Arial\"><span style=\"color:#ff0000\">[This warning appears often in the preceding text (not shown) seems not to damage the eventual outcome.]\r\n</span></span><br>\r\n<br>\r\n<strong>Fatal error</strong>: Uncaught exception 'Exception' with message 'Individual worksheet!J12 -&gt; internal error MWS' in /home/sm11/public_html/BAWS/PHPExcel/Classes/PHPExcel/Cell.php:284 Stack trace: #0 /home/sm11/public_html/BAWS/class_lib.php(130):\r\n PHPExcel_Cell-&gt;getCalculatedValue() #1 /home/sm11/public_html/BAWS/class_lib.php(72): spreadsheetFileManager-&gt;transferSheet(Object(PHPExcel), '10047') #2 /home/sm11/public_html/BAWS/index.php(16): spreadsheetFileManager-&gt;uploadSheet('SED_10047_Jim\r\n G...', 'Uploads/') #3 {main} thrown in <strong>/home/sm11/public_html/BAWS/PHPExcel/Classes/PHPExcel/Cell.php</strong> on line\r\n<strong>284</strong></p>\r\n<p><strong><span style=\"color:#000000\">Just to confirm the actual spreadsheet works fine so at least as far as Excel is concerned the equation is well formed enough, but there may be a wrinkle I have missed.</span></strong></p>\r\n<p><strong><span style=\"color:#000000\">Not sure this helps any further thoughts?</span></strong></p>\r\n<p><strong><span style=\"color:#000000\">Mike S<br>\r\n</span></strong></p>\r\n<p><strong><span style=\"color:#000000\"><br>\r\n</span></strong></p>\r\n</span>\r\n<p></p>\r\n",
    "PostedDate": "2011-01-17T09:53:48.72-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]