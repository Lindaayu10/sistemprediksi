[
  {
    "Id": "569469",
    "ThreadId": "246871",
    "Html": "<p>Hello,</p>\n<p>I want to insert data into an existing XLS layout. For that reason I want to read an existing xls file, insert some data and write it to a destination file.<br /> This is working fine so far except for one thing:</p>\n<p>Every field that is not empty should have a border around the field. So I have insert a conditional formatting formula which is working fine. But this conditional formatting is not transfered from source to destination file (at destination the formula is  not existing any longer). Is it possible to copy conditional formatting?</p>\n<p>Then I have tried to do the same with VBA (Visual Basic for Applications). At source file this is working fine but the VBA code is not transfered to destination too. Is it possible to copy VBA code?</p>\n<p>It would be great to use all formatting from source file because the user can change the file without programming php code.</p>\n<p>&nbsp;</p>\n<div style=\"color: black; background-color: white;\">\n<pre><span style=\"color: green;\">//This function copy an excel sheet from source to destination filename and insert a given</span>\n<span style=\"color: green;\">//array at a (optional) given sheet and start row into destination file</span>\n<span style=\"color: blue;\">function</span> ArrayAddToExcel($sourceFilename, $destinationFilename, $arr, $sheetIndex = 0, $startAtRowNum = 1) {\n\t<span style=\"color: green;\">/** Error reporting */</span>\n\terror_reporting(E_ALL);\n\n\tdate_default_timezone_set(<span style=\"color: #a31515;\">'Europe/Berlin'</span>);\n\n\t<span style=\"color: green;\">/** PHPExcel_IOFactory */</span>\n\t<span style=\"color: blue;\">require_once</span> <span style=\"color: #a31515;\">'../Classes/PHPExcel/IOFactory.php'</span>;\n\n\t<span style=\"color: blue;\">if</span> (!file_exists($sourceFilename)) {\n\t\t<span style=\"color: blue;\">exit</span>(<span style=\"color: #a31515;\">\"Can't find \"</span> . $sourceFilename . <span style=\"color: #a31515;\">\".\\n\"</span>);\n\t}\n\n\t<span style=\"color: blue;\">echo</span> date(<span style=\"color: #a31515;\">'H:i:s'</span>) . <span style=\"color: #a31515;\">\" Load from Excel file\\n\"</span>;\n\t<span style=\"color: blue;\">if</span> (!<span style=\"color: blue;\">isset</span>($GLOBALS[<span style=\"color: #a31515;\">\"objPHPExcel\"</span>])) {\n\t\t$GLOBALS[<span style=\"color: #a31515;\">\"objPHPExcel\"</span>] = PHPExcel_IOFactory::load($sourceFilename);\n\t}\n\n\t<span style=\"color: green;\">//Fetch row-names and write to target xls</span>\n\t$csvTableColumns = <span style=\"color: #a31515;\">\"\"</span>;\n\t$countcol = 0;\n\t<span style=\"color: blue;\">foreach</span> ($arr[0] <span style=\"color: blue;\">as</span> $key =&gt; $value) {\n\t\t\t\t$GLOBALS[<span style=\"color: #a31515;\">\"objPHPExcel\"</span>]-&gt;setActiveSheetIndex($sheetIndex)\n\t\t\t\t\t\t\t-&gt;setCellValue(chr(65 + $countcol) . $startAtRowNum, $key);\n\t\t\t\t$countcol++;\n\t}\n\n\t$countrow = 0;\n\t<span style=\"color: green;\">//Fetch all values</span>\n\t<span style=\"color: blue;\">foreach</span> ($arr <span style=\"color: blue;\">as</span> $key =&gt; $arrRow) {\n\t\t$countcol = 0;\n\t\t<span style=\"color: blue;\">foreach</span> ($arrRow <span style=\"color: blue;\">as</span> $value) {\n\t\t\t$GLOBALS[<span style=\"color: #a31515;\">\"objPHPExcel\"</span>]-&gt;setActiveSheetIndex($sheetIndex)\n\t\t\t\t\t\t-&gt;setCellValue(chr(65 + $countcol) . strval(($startAtRowNum + 1) + $countrow), $value);\n\t\t\t$countcol++;\n\t\t}\n\t\t$countrow++;\n\t}\n\t\n\t<span style=\"color: blue;\">echo</span> date(<span style=\"color: #a31515;\">'H:i:s'</span>) . <span style=\"color: #a31515;\">\" Write to Excel format\\n\"</span>;\n\t$objWriter = PHPExcel_IOFactory::createWriter($GLOBALS[<span style=\"color: #a31515;\">\"objPHPExcel\"</span>], <span style=\"color: #a31515;\">'Excel5'</span>);\n\t$objWriter-&gt;save($destinationFilename);\n\n\t<span style=\"color: green;\">// Echo memory peak usage</span>\n\t<span style=\"color: blue;\">echo</span> date(<span style=\"color: #a31515;\">'H:i:s'</span>) . <span style=\"color: #a31515;\">\" Peak memory usage: \"</span> . (memory_get_peak_usage(true) / 1024 / 1024) . <span style=\"color: #a31515;\">\" MB\\r\\n\"</span>;\n\n\t<span style=\"color: green;\">// Echo done</span>\n\t<span style=\"color: blue;\">echo</span> date(<span style=\"color: #a31515;\">'H:i:s'</span>) . <span style=\"color: #a31515;\">\" Done reading file.\\r\\n\"</span>;\n}\n</pre>\n</div>\n<p>&nbsp;</p>\n<p>Thanks,<br /> Pete</p>\n<div id=\"x__mcePaste\" style=\"left: -10000px; top: 0px; width: 1px; height: 1px; overflow: hidden;\"><a href=\"http://dict.leo.org/ende?lp=ende&amp;p=Ci4HO3kMAA&amp;search=for&amp;trestr=0x8004\">for</a> <a href=\"http://dict.leo.org/ende?lp=ende&amp;p=Ci4HO3kMAA&amp;search=that&amp;trestr=0x8004\"> that</a> <a href=\"http://dict.leo.org/ende?lp=ende&amp;p=Ci4HO3kMAA&amp;search=reason&amp;trestr=0x8004\"> reason</a></div>",
    "PostedDate": "2011-02-21T00:19:50.287-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]