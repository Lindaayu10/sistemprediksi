[
  {
    "Id": "1249015",
    "ThreadId": "546407",
    "Html": "Hi guys,<br />\n<br />\nI am trying to write a little PHP program that will loop through all the Excel spreadsheets in a certain folder and open them and read them (and eventually import their data into a database).<br />\n<br />\nI think I have everything set up correctly, PHPExcel 1.8 seems to be installed correctly, and the server is running PHP 5.3.<br />\n<br />\nWhat's happening is that it opens and reads the the first *.xlsx file just fine and prints out some cell values, but then when it gets to the second spreadsheet it seems like the reader dies and the PHPExcel object just bombs out.<br />\n<br />\nThis seems to have something to do with the XLSX format. If all my spreadsheets are XLS format, it seems to work correctly...But there's got to be a way to get it to work with XLSX, right? XLSX support is one of PHPExcel's defining charms...<br />\n<br />\nI couldn't find anything that caught my attention in the logs, so I was wondering if anyone had any tips to get this working?<br />\n<br />\nThanks!<br />\n<br />\nHere's my current code:<br />\n<pre><code>&lt;?php\n\n/** Error reporting */\nerror_reporting(E_ALL);\nini_set('display.errors', 1);\n\n/** Include PHPExcel */\nrequire dirname(__FILE__) . '/Classes/PHPExcel.php';\nrequire dirname(__FILE__) . '/Classes/PHPExcel/IOFactory.php';  \n\n$directory = dirname(dirname(__FILE__));    \n$files = scandir($directory);\n\nforeach($files as $file)\n{\n    //echo 'Checking file: &quot;' . $file . '&quot;...&lt;br&gt;';\n\n    if(endsWith($file, &quot;.xls&quot;) || endsWith($file, &quot;.xlsx&quot;))\n    {\n        try\n        {\n            processSpreadSheet($directory, $file);\n        }\n        catch(Exception $e)\n        {\n            echo $e;\n            die($e);\n        }\n    }\n}   \n\nfunction endsWith($haystack, $needle)\n{\n    return $needle === &quot;&quot; || substr($haystack, -strlen($needle)) === $needle;\n}\n\nfunction processSpreadSheet($directory, $file)\n{\n    echo 'Now importing &quot;' . $file . '&quot;...&lt;br&gt;';            \n    $fullFilePath = $directory . '/' . $file;   \n    echo $fullFilePath . &quot;&lt;br&gt;&quot;;\n    y\n    $inputFileType = PHPExcel_IOFactory::identify($fullFilePath);\n    echo 'File Type :  ' . $inputFileType . '&lt;br&gt;';\n\n    //Seems to blow up here on the second pass through\n    $objReader = PHPExcel_IOFactory::createReader($inputFileType);\n    $objReader-&gt;setReadDataOnly(true);\n    $objPHPExcel = $objReader-&gt;load($fullFilePath);\n    $objPHPExcel-&gt;setActiveSheetIndex(0);\n\n    $worksheet = $objPHPExcel-&gt;getActiveSheet();\n\n    $highestRow         = $worksheet-&gt;getHighestRow(); // e.g. 10\n    $highestColumn      = $worksheet-&gt;getHighestColumn(); // e.g 'F'\n    $highestColumnIndex = PHPExcel_Cell::columnIndexFromString($highestColumn);\n    $nrColumns = ord($highestColumn) - 64;\n\n    echo &quot;The worksheet has &quot;;\n    echo $nrColumns . ' columns, A-' . $highestColumn . ', ';\n    echo ' and ' . $highestRow . ' rows.&lt;br&gt;';\n\n    echo $worksheet-&gt;getCell('A1')-&gt;getValue() . '&lt;br&gt;';\n    echo $worksheet-&gt;getCell('A2')-&gt;getValue() . '&lt;br&gt;';\n\n    PHPExcel_Calculation::getInstance()-&gt;clearCalculationCache();\n    $objPHPExcel-&gt;disconnectWorksheets();\n    unset($objPHPExcel);\n}\n?&gt;</code></pre>\n\n",
    "PostedDate": "2014-05-23T12:04:20.65-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]