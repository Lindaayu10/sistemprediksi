[
  {
    "Id": "570184",
    "ThreadId": "247066",
    "Html": "\r\n<p>Hello,</p>\r\n<p>For my masters thesis I need to process a huge dataset of stock information. This data is being output in excel and I need to prepare this data for usage in a statistical tool. I want to use a php script to prepare my dataset but unfortunately apache crashes\r\n on my fairly simple script...</p>\r\n<p></p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>&lt;?php\r\n\r\n<span style=\"color:green\">// thesis: verwerking dataset</span>\r\n\r\n<span style=\"color:green\">/** Error reporting */</span>\r\nerror_reporting(E_ALL);\r\n\r\ndate_default_timezone_set(<span style=\"color:#a31515\">'Europe/London'</span>);\r\n\r\n<span style=\"color:green\">/** PHPExcel */</span>\r\n<span style=\"color:blue\">require_once</span> <span style=\"color:#a31515\">'./Classes/PHPExcel.php'</span>;\r\n\r\n\r\n<span style=\"color:blue\">echo</span> <span style=\"color:#a31515\">'&lt;form action=&quot;'</span>.$_SERVER[<span style=\"color:#a31515\">'PHP_SELF'</span>].'<span style=\"color:#a31515\">&quot; method=&quot;</span>POST<span style=\"color:#a31515\">&quot; enctype=&quot;</span>multipart/form-data&quot;&gt;\r\nExcel document: &lt;input type=<span style=\"color:#a31515\">&quot;file&quot;</span> name=<span style=\"color:#a31515\">&quot;dataset&quot;</span>&gt;&lt;br /&gt;&lt;input type=<span style=\"color:#a31515\">&quot;submit&quot;</span> value=<span style=\"color:#a31515\">&quot;Verwerk&quot;</span>&gt;&lt;/form&gt;&lt;hr&gt;';\r\n\r\n<span style=\"color:blue\">if</span>(!<span style=\"color:blue\">empty</span>($_FILES[<span style=\"color:#a31515\">'dataset'</span>][<span style=\"color:#a31515\">'tmp_name'</span>]))\r\n{\r\n\t<span style=\"color:green\">// read original dataset</span>\r\n\t$objReader = <span style=\"color:blue\">new</span> PHPExcel_Reader_Excel2007();\r\n\t$objReader-&gt;setReadDataOnly(true);\r\n\t$input = $objReader-&gt;load($_FILES[<span style=\"color:#a31515\">'dataset'</span>][<span style=\"color:#a31515\">'tmp_name'</span>]);\r\n\r\n\t<span style=\"color:green\">// Create new PHPExcel object</span>\r\n\t$output = <span style=\"color:blue\">new</span> PHPExcel();\t\r\n\t$output-&gt;setActiveSheetIndex(0);\r\n\t$output-&gt;getProperties()-&gt;setCreator(<span style=\"color:#a31515\">&quot;Jerome Kleinen&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setLastModifiedBy(<span style=\"color:#a31515\">&quot;Jerome Kleinen&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setTitle(<span style=\"color:#a31515\">&quot;Thesis Commonality in Liquidity&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setSubject(<span style=\"color:#a31515\">&quot;dataset&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setDescription(<span style=\"color:#a31515\">&quot;Dataset for thesis&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setKeywords(<span style=\"color:#a31515\">&quot;thesis dataset liquidity&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setCategory(<span style=\"color:#a31515\">&quot;dataset&quot;</span>);\r\n\r\n\t$highestRow = $input-&gt;getHighestRow();\r\n\t$highestColumn = $input-&gt;getHighestColumn();\r\n\t$highestColumnIndex = PHPExcel_Cell::columnIndexFromString($highestColumn);\r\n\t\r\n\t$newcolumn = 1;\r\n\t\r\n\t<span style=\"color:blue\">for</span>($i = 1; $i &lt;= $highestColumnIndex; $i&#43;&#43;)\r\n\t{\r\n\t\t<span style=\"color:blue\">if</span>(stripos($input-&gt;getActiveSheet()-&gt;getCellByColumnAndRow($i, 2)-&gt;getValue(), <span style=\"color:#a31515\">&quot;(P)&quot;</span>) === FALSE) <span style=\"color:green\">// not a price column</span>\r\n\t\t{\r\n\t\t\t<span style=\"color:blue\">for</span>($j = 1; $j &lt;= $highestRow; $j&#43;&#43;)\r\n\t\t\t{\r\n\t\t\t\t$output-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow($newcolumn, $j, $input-&gt;getActiveSheet()-&gt;getCellByColumnAndRow($i, $j)-&gt;getValue());\r\n\t\t\t}\r\n\t\t\t$newcolumn&#43;&#43;;\r\n\t\t}\r\n\t\t<span style=\"color:blue\">else</span>\r\n\t\t{\r\n\t\t\t<span style=\"color:blue\">for</span>($j = 1; $j &lt;= $highestRow; $j&#43;&#43;)\r\n\t\t\t{\r\n\t\t\t\t$output-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow($newcolumn, $j, $input-&gt;getActiveSheet()-&gt;getCellByColumnAndRow($i, $j)-&gt;getValue());\r\n\t\t\t}\t\t\t\r\n\t\t\t\r\n\t\t\t$newcolumn&#43;&#43;;\r\n\t\t\t\r\n\t\t\t$output-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow($newcolumn, 1, $input-&gt;getActiveSheet()-&gt;getCellByColumnAndRow($i, 1)-&gt;getValue()); <span style=\"color:green\">// copy name of stock</span>\r\n\t\t\t$output-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow($newcolumn, 2, <span style=\"color:#a31515\">&quot;return&quot;</span>);\r\n\t\t\t\r\n\t\t\t<span style=\"color:blue\">for</span>($j = 3; $j &lt; $highestRow; $j&#43;&#43;)\r\n\t\t\t{\r\n\t\t\t\t\r\n\t\t\t\t$pt1 = $input-&gt;getActiveSheet()-&gt;getCellByColumnAndRow($i, $j)-&gt;getValue();\r\n\t\t\t\t$pt2 = $input-&gt;getActiveSheet()-&gt;getCellByColumnAndRow($i, $j &#43; 1)-&gt;getValue();\r\n\t\t\t\t<span style=\"color:blue\">if</span>(!<span style=\"color:blue\">empty</span>($pt1) &amp;&amp; is_numeric($pt1) &amp;&amp; !<span style=\"color:blue\">empty</span>($pt2) &amp;&amp; is_numeric($pt2))\r\n\t\t\t\t{\r\n\t\t\t\t\t$<span style=\"color:blue\">return</span> = ($pt2 - $pt1) / $pt1;\r\n\t\t\t\t}\r\n\t\t\t\t<span style=\"color:blue\">else</span>\r\n\t\t\t\t{\r\n\t\t\t\t\t$<span style=\"color:blue\">return</span> = <span style=\"color:#a31515\">&quot;NA&quot;</span>;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$output-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow($newcolumn, $j, $<span style=\"color:blue\">return</span>);\r\n\t\t\t}\r\n\r\n\t\t\t$newcolumn&#43;&#43;;\r\n\t\t}\r\n\t}\r\n\r\n\t<span style=\"color:green\">// write to outfile file</span>\r\n\t$objWriter = PHPExcel_IOFactory::createWriter($output, <span style=\"color:#a31515\">'Excel2007'</span>);\r\n\t$objWriter-&gt;save(<span style=\"color:#a31515\">'php://output'</span>);\r\n}\r\n\r\n\r\n?&gt;\r\n</pre>\r\n</div>\r\nThis is just a test file with 1 calculation of the daily return if the column is a price column. I have uploaded a piece of my dataset here: http://www.2shared.com/file/3sHq0DYC/BEL20.html so you guys can see the structure of the file. basically, for every\r\n stock there are 4 columns, one being the price of the stock (P). For each price column it should copy the price column and add the daily return right after it (I should put this in the same for loop, this is just a test file), for other columns it should just\r\n copy the original data. I am using apache as webserver in a winxp virtualbox install using xampp. I run win7 64bit on my system (if that matters). Does anyone see what's going wrong???\r\n<p></p>\r\n",
    "PostedDate": "2011-02-22T06:52:05.98-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "570403",
    "ThreadId": "247066",
    "Html": "<p>Are any errors being generated, either by PHP (you should have PHP error logging enabled when developing) or in the web server logs?</p>\r\n<p>You're also echoing html markup before outputting the Excel file directly to the browser (which will corrupt the output), and you're not setting any headers to tell the browser that you're going to be sending it an Excel file.</p>",
    "PostedDate": "2011-02-22T13:15:00.51-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "570535",
    "ThreadId": "247066",
    "Html": "<p>No PHP errors. I will check the apache error log tomorrow on my laptop. I was afraid that the saving of the file would fuck it up but it also crashes when I commented it out so that can't be the primary issue. Tomorrow I'll rewrite the script and try to debug it 1 more time, else I'll be forced to look for a different solution to my problem (but I would really like to use php cause that's the language I am most familiar with). I am kinda guessing my for loops are causing apache to run out of memory. I noticed that phpexcel has built in functions for iterations, but not for columns?</p>",
    "PostedDate": "2011-02-22T17:32:51.063-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "570761",
    "ThreadId": "247066",
    "Html": "<p>Ok, I solved it. I forgot to use GetActiveSheet on the GetHighestRow() and GetHighestColumn and thats why my loops ran forever exhausting the memory. Strange that it didnt throw any php errors but ok, I solved it...</p>",
    "PostedDate": "2011-02-23T05:49:09.863-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "571803",
    "ThreadId": "247066",
    "Html": "<p>I'm surprised that PHP didn't throw any \"method doesn't exist\" errors myself, but glad you were able to resolve the problem.</p>",
    "PostedDate": "2011-02-24T14:22:02.253-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]