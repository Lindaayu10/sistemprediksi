[
  {
    "Id": "1008242",
    "ThreadId": "434871",
    "Html": "Hello,\r<br />\nI started using your library (great work!), and I think I have found a bug when copying worksheets from one workbook to another. Below I present the code of the script.<br />\n<pre><code>$template = new excel_reader(&quot;a.xlsx&quot;);\n$logic_spec = new excel_writer();\n\nfor($sheet = 1; $sheet &lt;= $template-&gt;get_sheet_count(); $sheet++)\n{\n  $template-&gt;debug();\n\n  $sheet_to_clone_1 = $template-&gt;clone_sheet(&quot;OnOff&quot;);\n  $logic_spec-&gt;add_external_sheet($sheet_to_clone_1, 'siallal'.$sheet);\n\n  $template-&gt;debug();\n}\n\n$logic_spec-&gt;save('logic_spec');</code></pre>\n\nThe output I get is:<br />\n<pre><code>Array\n(\n    [0] =&gt; AI\n    [1] =&gt; AO\n    [2] =&gt; DI\n    [3] =&gt; DO\n    [4] =&gt; OnOff\n)\nArray\n(\n    [0] =&gt; AO\n    [1] =&gt; DI\n    [2] =&gt; DO\n    [3] =&gt; OnOff\n)\nArray\n(\n    [0] =&gt; AO\n    [1] =&gt; DI\n    [2] =&gt; DO\n    [3] =&gt; OnOff\n)\nArray\n(\n    [0] =&gt; DI\n    [1] =&gt; DO\n    [2] =&gt; OnOff\n)\nArray\n(\n    [0] =&gt; DI\n    [1] =&gt; DO\n    [2] =&gt; OnOff\n)\nArray\n(\n    [0] =&gt; DO\n    [1] =&gt; OnOff\n)\nArray\n(\n    [0] =&gt; DO\n    [1] =&gt; OnOff\n)\nArray\n(\n    [0] =&gt; OnOff\n)\nArray\n(\n    [0] =&gt; OnOff\n)\nArray\n(\n)</code></pre>\n\nWhen I run a script with modified line responsible for adding cloned sheet:<br />\n<pre><code>$template = new excel_reader(&quot;a.xlsx&quot;);\n$logic_spec = new excel_writer();\n\nfor($sheet = 1; $sheet &lt;= $template-&gt;get_sheet_count(); $sheet++)\n{\n  $template-&gt;debug();\n\n  $sheet_to_clone_1 = $template-&gt;clone_sheet(&quot;OnOff&quot;);\n  //  $logic_spec-&gt;add_external_sheet($sheet_to_clone_1, 'siallal'.$sheet); // &lt;----- modified\n\n  $template-&gt;debug();\n}\n\n$logic_spec-&gt;save('logic_spec');\n</code></pre>\n\nI got correct, not modified output:<br />\n<pre><code>Array\n(\n    [0] =&gt; AI\n    [1] =&gt; AO\n    [2] =&gt; DI\n    [3] =&gt; DO\n    [4] =&gt; OnOff\n)\nArray\n(\n    [0] =&gt; AI\n    [1] =&gt; AO\n    [2] =&gt; DI\n    [3] =&gt; DO\n    [4] =&gt; OnOff\n)\nArray\n(\n    [0] =&gt; AI\n    [1] =&gt; AO\n    [2] =&gt; DI\n    [3] =&gt; DO\n    [4] =&gt; OnOff\n)\nArray\n(\n    [0] =&gt; AI\n    [1] =&gt; AO\n    [2] =&gt; DI\n    [3] =&gt; DO\n    [4] =&gt; OnOff\n)\nArray\n(\n    [0] =&gt; AI\n    [1] =&gt; AO\n    [2] =&gt; DI\n    [3] =&gt; DO\n    [4] =&gt; OnOff\n)\nArray\n(\n    [0] =&gt; AI\n    [1] =&gt; AO\n    [2] =&gt; DI\n    [3] =&gt; DO\n    [4] =&gt; OnOff\n)\nArray\n(\n    [0] =&gt; AI\n    [1] =&gt; AO\n    [2] =&gt; DI\n    [3] =&gt; DO\n    [4] =&gt; OnOff\n)\nArray\n(\n    [0] =&gt; AI\n    [1] =&gt; AO\n    [2] =&gt; DI\n    [3] =&gt; DO\n    [4] =&gt; OnOff\n)\nArray\n(\n    [0] =&gt; AI\n    [1] =&gt; AO\n    [2] =&gt; DI\n    [3] =&gt; DO\n    [4] =&gt; OnOff\n)\nArray\n(\n    [0] =&gt; AI\n    [1] =&gt; AO\n    [2] =&gt; DI\n    [3] =&gt; DO\n    [4] =&gt; OnOff\n)</code></pre>\n\nsources of the methods &quot;clone_sheet&quot; and &quot;add_external_sheet&quot; are below:<br />\n<pre><code>class excel_reader\n{\n  protected $excel_object;\n  protected $excel_sheet_count;\n  protected $excel_sheet_active;\n  protected $excel_sheet_names;\n\n  public function __construct($file_path)\n  {\n    if(file_exists($file_path))\n    {\n      try\n      {\n        $this-&gt;excel_object = PHPExcel_IOFactory::load($file_path);\n        //      $objReader = PHPExcel_IOFactory::createReader('Excel2007');\n        //      $objReader-&gt;setReadDataOnly(true);\n        //      $this-&gt;excel_object = $objReader-&gt;load($file_path);;\n      }\n\n      catch(Exception $exception)\n      {\n        exit('error loading file: '.$exception-&gt;getMessage().&quot;\\n&quot;);\n      }\n\n      $this-&gt;excel_sheet_active = 0;\n      $this-&gt;excel_object-&gt;getSheet($this-&gt;excel_sheet_active);\n      $this-&gt;excel_object-&gt;setActiveSheetIndex($this-&gt;excel_sheet_active);\n      $this-&gt;excel_sheet_count = $this-&gt;excel_object-&gt;getSheetCount();\n      $this-&gt;excel_sheet_names = $this-&gt;excel_object-&gt;getSheetNames();\n    }\n    else\n    {\n      exit('file '.$file_path.' does not exist!'.&quot;\\n&quot;);\n    }\n  }\n\n  public function __destruct()\n  {\n    $this-&gt;excel_object-&gt;disconnectWorksheets();\n    unset($this-&gt;excel_object);\n  }\n\n  public function next_sheet()\n  {\n    $next_sheet = $this-&gt;excel_sheet_active + 1;\n\n    if($next_sheet &lt; $this-&gt;excel_sheet_count)\n    {\n      $this-&gt;excel_sheet_active = $next_sheet;\n      $this-&gt;excel_object-&gt;getSheet($this-&gt;excel_sheet_active);\n    }\n    else\n    {\n      $this-&gt;excel_sheet_active = 0;\n      $this-&gt;excel_object-&gt;getSheet(0);\n    }\n\n    $this-&gt;excel_object-&gt;setActiveSheetIndex($this-&gt;excel_sheet_active);\n  }\n\n  public function clone_sheet($sheet_name) // &lt;-------- here\n  {\n    return clone $this-&gt;excel_object-&gt;getSheetByName($sheet_name);\n  }\n\n  public function get_sheet_count()\n  {\n    return $this-&gt;excel_sheet_count;\n  }\n\n  public function get_active_sheet_name()\n  {\n    return $this-&gt;excel_sheet_names[$this-&gt;excel_sheet_active];\n  }\n\n  public function debug()\n  {\n    $sheet_names = $this-&gt;excel_object-&gt;getSheetNames();\n    print_r($sheet_names);\n  }\n}\n\n//----------------------------------------------------------------------\n// class responsible for creating and writing excel file\n\nclass excel_writer\n{\n  protected $excel_object;\n\n  public function __construct()\n  {\n    $this-&gt;excel_object = new PHPExcel();\n  }\n\n  public function __destruct()\n  {\n    $this-&gt;excel_object-&gt;disconnectWorksheets();\n    unset($this-&gt;excel_object);\n  }\n\n  public function add_external_sheet($cloned_sheet, $new_sheet_name) // &lt;-------- here\n  {\n    $cloned_sheet-&gt;setTitle($new_sheet_name);\n    $this-&gt;excel_object-&gt;addExternalSheet($cloned_sheet);\n  }\n\n  public function save($file_name)\n  {\n    $excel_object_writer = PHPExcel_IOFactory::createWriter($this-&gt;excel_object, 'Excel2007');\n    $excel_object_writer-&gt;save($file_name.'.xlsx');\n  }\n}</code></pre>\n\nAs you see, it the first example every iteration I am loosing a original worksheet from the workbook. Am I doing something wrong?  I am using:<br />\n<pre><code>PHP 5.3.3 (cli) (built: Jun 28 2012 11:20:32)\nCopyright (c) 1997-2010 The PHP Group\nZend Engine v2.3.0, Copyright (c) 1998-2010 Zend Technologies\n\nand PHPExcel 1.7.8</code></pre>\n\nP.S I also created a new issue in issue tracker, if you think it is not useful please remove it.<br />\n",
    "PostedDate": "2013-02-28T07:27:50.003-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]