[
  {
    "Id": "92740",
    "ThreadId": "27797",
    "Html": "I am running into a problem with my script timing out when I try running it. Now before I jump too far into it I realize that I am doing a lot of things in this script that are processor intensive, so I don't expect a miracle by any means. I also want to point out that I have used a built-in php function to extend the php script timeout to 10 minutes. However I am getting timeouts now from the web server, which is set to a 5 minute timeout (IIS 5.3, this is for a customer, so no comments about switching to Apache).<br>\r\n<br>\r\nFurther notes: In the end this will be run by a Windows batch process, not through the web server (and I know, that will change this a bit, bear with me please).<br>\r\n<br>\r\nWhat I am doing is scanning through a series of directories to check for silicon wafer testing files. When I find a folder without an Excel file in it, but with the test files in it I begin the process.<br>\r\nIt scans through the test results of these wafer tests and builds image map data to generate an image and legend image of the wafer that is on a color-coded grid. Currently it is generating a png image for the wafer results and a png image for the legend.<br>\r\n<br>\r\nI then take these generated images and output a text label to column A, the wafer image to column B, and the legend to column C. Each test file in the folder represents a wafer and contains multiple tests (with an image for each test). Each wafer in the folder gets an individual worksheet in the Excel file. There is one Excel file per folder.<br>\r\n<br>\r\nAfter adding each image to the worksheet I destroy the image object. After saving each file I destroy the PHPExcel object. Both situations using unset().&nbsp; Is there a more efficient way to clear each xls fille in memory than destroying and recreating the object each time?<br>\r\n<br>\r\nOne other note, I have to create the files in the old BIFF format, so I am using the ExcelWriter5 class.<br>\r\n<br>\r\nWhat I would like to know is are there any tricks you can suggest for improving the speed and performance of the script? I am considering creating the images as gifs instead of png files. I am also considering using no compression for the png format. Also I am running the latest PHP (5.2.6), which should help things along. I have all the latest libraries installed with it as well. Any ideas, tricks, suggestions, etc. are welcome. Thanks for your time.<br>\r\n<br>\r\nThanks,<br>\r\nPatrick<br>\r\n",
    "PostedDate": "2008-05-15T10:14:51.11-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "92867",
    "ThreadId": "27797",
    "Html": "Do you know what proportion of the time is directory scanning, image creation and PHPExcel.<br>\r\n<br>\r\nDirectory scanning is notoriously slow because of the disk access.<br>\r\nIf you're using logic like:<br>\r\n<span style=\"font-family:courier new\"><span style=\"color:#007700\">if (</span><span style=\"color:#0000bb\">$dh </span><span style=\"color:#007700\">= </span><span style=\"color:#0000bb\">opendir</span><span style=\"color:#007700\">(</span><span style=\"color:#0000bb\">$dir</span></span><span style=\"font-family:courier new\"><span style=\"color:#007700\">)) {<br>\r\n   while ((</span><span style=\"color:#0000bb\">$file </span><span style=\"color:#007700\">= </span><span style=\"color:#0000bb\">readdir</span><span style=\"color:#007700\">(</span><span style=\"color:#0000bb\">$dh</span><span style=\"color:#007700\">)) !== </span><span style=\"color:#0000bb\">false</span></span><span style=\"font-family:courier new\"><span style=\"color:#007700\">) {<br>\r\n         ...file processing code in here...</span></span><span style=\"font-family:courier new\"><span style=\"color:#007700\"><br>\r\n   }<br>\r\n   </span><span style=\"color:#0000bb\">closedir</span><span style=\"color:#007700\">(</span><span style=\"color:#0000bb\">$dh</span></span><span style=\"color:#007700\"><span style=\"font-family:courier new\">);<br>\r\n<span style=\"color:#007700;font-family:courier new\">}</span><br>\r\n<br>\r\n<span style=\"color:#000000;font-family:times new roman\">Try switching to use scandir instead.<br>\r\n</span><span style=\"color:#007700\"><span style=\"font-family:courier new\"><span style=\"color:#007700\"><br>\r\n<span style=\"font-family:courier new\">if ((</span><span style=\"color:#0000bb\">$filelist </span><span style=\"color:#007700\">= </span><span style=\"color:#0000bb\">scandir</span><span style=\"color:#007700\">(</span><span style=\"color:#0000bb\">$dir</span><span style=\"color:#007700\">)) !== </span><span style=\"color:#0000bb\">false</span></span><span style=\"color:#007700\"><span style=\"font-family:courier new\">) {<br>\r\n</span></span>   foreach (<span style=\"color:#0000bb\"><span style=\"font-family:courier new\">$filelist <span style=\"color:#007700\"><span style=\"font-family:courier new\"><span style=\"color:#007700\">as </span></span></span></span></span><span style=\"color:#0000bb\">$file</span></span></span><span style=\"color:#007700\"><span style=\"font-family:courier new\">) {<br>\r\n      ...file processing code in here...</span></span><span style=\"color:#007700\"><br>\r\n<span style=\"font-family:courier new\">   }<br>\r\n</span></span><span style=\"color:#007700\"><span style=\"font-family:courier new\"><span style=\"color:#007700\">}</span><br>\r\n</span></span></span></span>\r\n",
    "PostedDate": "2008-05-16T01:42:23.697-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "93243",
    "ThreadId": "27797",
    "Html": "Hello Mark, thanks for the reply. I have been finding that opening and reading&nbsp; a directory zips along pretty quickly. <br>\r\nWhere I seem to be running into a problem is when PHPExcel goes to save the xls file. That is when it drastically slows down. Image creation seems to be nearly instantaneous. Granted the files it is creating range from 8MB to 109MB. So it has a lot of work to do, but sometimes it takes more than 10 minutes for it to save one file.<br>\r\n<br>\r\nHere is some sample code:<br>\r\n<br>\r\n// Create new PHPExcel object<br>\r\n$objPHPExcel = new PHPExcel();<br>\r\n<br>\r\n&nbsp; //Looping code<br>\r\n&nbsp; $images = make_png($label);<br>\r\n<br>\r\n&nbsp; //Set the height of the second row.<br>\r\n&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;getRowDimension($row_idx)-&gt;setRowHeight(380);<br>\r\n&nbsp; $objPHPExcel-&gt;getActiveSheet()-&gt;duplicateStyleArray(array_merge($cellformat), 'A'.$row_idx.':B'.$row_idx);<br>\r\n&nbsp; <br>\r\n&nbsp; <br>\r\n&nbsp; //Add wafer map image<br>\r\n&nbsp; $objDrawing1 = new PHPExcel_Worksheet_Drawing();<br>\r\n&nbsp; $objDrawing1-&gt;setName('Wafer Map');<br>\r\n&nbsp; $objDrawing1-&gt;setDescription('Wafer Map');<br>\r\n&nbsp; $objDrawing1-&gt;setPath($images['wafer_map']);<br>\r\n&nbsp; $objDrawing1-&gt;setWidthAndHeight(500, 500);<br>\r\n&nbsp; $objDrawing1-&gt;setCoordinates('A'.$row_idx);<br>\r\n&nbsp; <br>\r\n&nbsp; $objDrawing1-&gt;setWorksheet($objPHPExcel-&gt;getActiveSheet());<br>\r\n&nbsp; unset($objDrawing1);<br>\r\n&nbsp; <br>\r\n&nbsp; <br>\r\n&nbsp; //Add the legend image<br>\r\n&nbsp; $objDrawing2 = new PHPExcel_Worksheet_Drawing();<br>\r\n&nbsp; $objDrawing2-&gt;setName('Wafer Map Legend');<br>\r\n&nbsp; $objDrawing2-&gt;setDescription('Wafer Map');<br>\r\n&nbsp; $objDrawing2-&gt;setPath($images['bin_table']);<br>\r\n&nbsp; $objDrawing2-&gt;setWidthAndHeight(244, 224);<br>\r\n&nbsp; $objDrawing2-&gt;setCoordinates('B'.$row_idx);<br>\r\n&nbsp; <br>\r\n&nbsp; $objDrawing2-&gt;setWorksheet($objPHPExcel-&gt;getActiveSheet());<br>\r\n&nbsp; unset($objDrawing2);<br>\r\n&nbsp; <br>\r\n$objWriter = new PHPExcel_Writer_Excel5($objPHPExcel);<br>\r\n$objWriter-&gt;save($dir.$lotdir.'/'.$lotdir.'_MAP.xls');<br>\r\n",
    "PostedDate": "2008-05-18T09:37:32.88-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]