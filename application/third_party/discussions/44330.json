[
  {
    "Id": "147553",
    "ThreadId": "44330",
    "Html": "I am writing an excel workbook with 5 sheets in it.  I am able to create the sheets with no problem.  The last sheet is where I have the problem.  I am pulling data from a mysql database to populate the cells.  Works great on all sheets except the last one.  I can succesfully insert 800 records into the last sheet with no problem.  Once I go above that, the excel dies on me.  I can open the file created but the last sheet has no records in it and there is an excel error that says that the file is currupted.  The amount of records I need to import into the last sheet is around 1500.  The table is only 3 cells long. So, 1500 records with three columns.<br>\r\n<br>\r\nHere is my code.  Anyone know what is wrong?<br>\r\n<br>\r\n<br>\r\n<br>\r\n//////////////////////////////////////////////////////////////////////////////////////////////////////<br>\r\n<p>&lt;?php<br>\r\n/**<br>\r\n * PHPExcel<br>\r\n *<br>\r\n * Copyright (C) 2006 - 2009 PHPExcel<br>\r\n *<br>\r\n * This library is free software; you can redistribute it and/or<br>\r\n * modify it under the terms of the GNU Lesser General Public<br>\r\n * License as published by the Free Software Foundation; either<br>\r\n * version 2.1 of the License, or (at your option) any later version.<br>\r\n * <br>\r\n * This library is distributed in the hope that it will be useful,<br>\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of<br>\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU<br>\r\n * Lesser General Public License for more details.<br>\r\n * <br>\r\n * You should have received a copy of the GNU Lesser General Public<br>\r\n * License along with this library; if not, write to the Free Software<br>\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA<br>\r\n *<br>\r\n * @category   PHPExcel<br>\r\n * @package    PHPExcel<br>\r\n * @copyright  Copyright (c) 2006 - 2009 PHPExcel (<a href=\"http://www.codeplex.com/PHPExcel\">http://www.codeplex.com/PHPExcel</a>)<br>\r\n * @license    <a href=\"http://www.gnu.org/licenses/old-licenses/lgpl-2.1.txt\">http://www.gnu.org/licenses/old-licenses/lgpl-2.1.txt</a> LGPL<br>\r\n * @version    1.6.5, 2009-01-05<br>\r\n */</p>\r\n<p>/** Error reporting */<br>\r\nerror_reporting(E_ALL);</p>\r\n<p>/** Include path **/<br>\r\nset_include_path(get_include_path() . PATH_SEPARATOR . '../Classes/');</p>\r\n<p>/** PHPExcel */<br>\r\nrequire_once 'PHPExcel.php';</p>\r\n<p>/** PHPExcel_RichText */<br>\r\nrequire_once 'PHPExcel/RichText.php';</p>\r\n<p>// Create new PHPExcel object<br>\r\necho date('H:i:s') . &quot; Create new PHPExcel object\\n&quot;;<br>\r\n$objPHPExcel = new PHPExcel();</p>\r\n<p>// Set properties<br>\r\necho date('H:i:s') . &quot; Set properties\\n&quot;;<br>\r\n$objPHPExcel-&gt;getProperties()-&gt;setCreator(&quot;IBM&quot;);<br>\r\n$objPHPExcel-&gt;getProperties()-&gt;setLastModifiedBy(&quot;IBM&quot;);<br>\r\n$objPHPExcel-&gt;getProperties()-&gt;setTitle(&quot;Office 2007 XLSX ISP RX Upgrade Document&quot;);<br>\r\n$objPHPExcel-&gt;getProperties()-&gt;setSubject(&quot;Office 2007 XLSX ISP RX Upgrade Document&quot;);<br>\r\n$objPHPExcel-&gt;getProperties()-&gt;setDescription(&quot;Document for ISP - RX Upgrade Data and Chart.&quot;);<br>\r\n$objPHPExcel-&gt;getProperties()-&gt;setKeywords(&quot;office 2007 openxml php&quot;);<br>\r\n$objPHPExcel-&gt;getProperties()-&gt;setCategory(&quot;Report result file&quot;);</p>\r\n<p>////////////////////////////////////////////////////////////////////////////////////////<br>\r\n// Create a first sheet, <br>\r\n//echo date('H:i:s') . &quot; Add some data\\n&quot;;<br>\r\n$objPHPExcel-&gt;setActiveSheetIndex(0);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A1', 'Completed');<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B1', 20);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C1', 'ISP Weekly Projected');</p>\r\n<p>//now add second row<br>\r\n$objPHPExcel-&gt;setActiveSheetIndex(0);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A2', '');<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B2', '');<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C2', 55);</p>\r\n<p>$cnt=3;<br>\r\n$query = &quot;SELECT <br>\r\n              completed,<br>\r\n              twenty,<br>\r\n              ispprojected <br>\r\n          FROM reportisp<br>\r\n          &quot;;<br>\r\n     $isp = mysql_query($query);<br>\r\n     while ($row = mysql_fetch_array($isp))<br>\r\n   {<br>\r\n       <br>\r\n            <br>\r\n     <br>\r\n//now add data<br>\r\n$objPHPExcel-&gt;setActiveSheetIndex(0);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A'.$cnt, $row[completed]);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B'.$cnt, $row[twenty]);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C'.$cnt, $row[ispprojected]);</p>\r\n<p>$cnt++;<br>\r\n}</p>\r\n<p>// Rename sheet<br>\r\n//echo date('H:i:s') . &quot; Rename sheet\\n&quot;;<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle('ISP');</p>\r\n<p>/////////////////////////////////////////////////////////////////////////////////////////<br>\r\n// Create a new worksheet, after the default sheet<br>\r\n//echo date('H:i:s') . &quot; Create new Worksheet object\\n&quot;;<br>\r\n$objPHPExcel-&gt;createSheet();</p>\r\n<p>$objPHPExcel-&gt;setActiveSheetIndex(1);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A1', 'Completed');<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B1', 62);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C1', 'SAPS1 Weekly Projected');</p>\r\n<p>//now add second row<br>\r\n$objPHPExcel-&gt;setActiveSheetIndex(1);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A2', '');<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B2', '');<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C2', 304);</p>\r\n<p>$cnt=3;<br>\r\n$query = &quot;SELECT <br>\r\n              complete,<br>\r\n              sixtytwo,<br>\r\n              sapsweeklyprojected <br>\r\n          FROM reportsap<br>\r\n          &quot;;<br>\r\n     $sap = mysql_query($query);<br>\r\n     while ($row = mysql_fetch_array($sap))<br>\r\n   {<br>\r\n       <br>\r\n            <br>\r\n     <br>\r\n//now add data<br>\r\n$objPHPExcel-&gt;setActiveSheetIndex(1);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A'.$cnt, $row[complete]);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B'.$cnt, $row[sixtytwo]);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C'.$cnt, $row[sapsweeklyprojected]);</p>\r\n<p>$cnt++;<br>\r\n}</p>\r\n<p>// Rename sheet<br>\r\n//echo date('H:i:s') . &quot; Rename sheet\\n&quot;;<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle('SAPS1');<br>\r\n////////////////////////////////////////////////////////////////////////////////////////////////</p>\r\n<p>// Create a new worksheet, after the default sheet<br>\r\n//echo date('H:i:s') . &quot; Create new Worksheet object\\n&quot;;<br>\r\n$objPHPExcel-&gt;createSheet();</p>\r\n<p>$objPHPExcel-&gt;setActiveSheetIndex(2);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A1', 'Completed');<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B1', 54);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C1', 'SAPS2 Weekly Projected');</p>\r\n<p>//now add second row<br>\r\n$objPHPExcel-&gt;setActiveSheetIndex(2);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A2', '');<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B2', '');<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C2', 300);</p>\r\n<p>$cnt=3;<br>\r\n$query = &quot;SELECT <br>\r\n              complete,<br>\r\n              sixtytwo,<br>\r\n              sapsweeklyprojected <br>\r\n          FROM reportsap1<br>\r\n          &quot;;<br>\r\n     $sap = mysql_query($query);<br>\r\n     while ($row = mysql_fetch_array($sap))<br>\r\n   {<br>\r\n       <br>\r\n            <br>\r\n     <br>\r\n//now add data<br>\r\n$objPHPExcel-&gt;setActiveSheetIndex(2);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A'.$cnt, $row[complete]);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B'.$cnt, $row[sixtytwo]);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C'.$cnt, $row[sapsweeklyprojected]);</p>\r\n<p>$cnt++;<br>\r\n}</p>\r\n<p>// Rename sheet<br>\r\n//echo date('H:i:s') . &quot; Rename sheet\\n&quot;;<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle('SAPS2');<br>\r\n//////////////////////////////////////////////////////////////////////////////////////////////////</p>\r\n<p>// Create a new worksheet, after the default sheet<br>\r\n//echo date('H:i:s') . &quot; Create new Worksheet object\\n&quot;;<br>\r\n$objPHPExcel-&gt;createSheet();</p>\r\n<p>$objPHPExcel-&gt;setActiveSheetIndex(3);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A1', 'Completed');<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B1', 0);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C1', 'RXP Weekly Projected');</p>\r\n<p>//now add second row<br>\r\n$objPHPExcel-&gt;setActiveSheetIndex(3);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A2', '');<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B2', '');<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C2', 464);</p>\r\n<p>$cnt=3;<br>\r\n$query = &quot;SELECT <br>\r\n              complete,<br>\r\n              sixtytwo,<br>\r\n              rxpweeklyprojected <br>\r\n          FROM reportrxp<br>\r\n          &quot;;<br>\r\n     $rxp = mysql_query($query);<br>\r\n     while ($row = mysql_fetch_array($rxp))<br>\r\n   {<br>\r\n       <br>\r\n            <br>\r\n     <br>\r\n//now add data<br>\r\n$objPHPExcel-&gt;setActiveSheetIndex(3);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A'.$cnt, $row[complete]);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B'.$cnt, $row[sixtytwo]);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C'.$cnt, $row[rxpweeklyprojected]);</p>\r\n<p>$cnt++;<br>\r\n}</p>\r\n<p>// Rename sheet<br>\r\n//echo date('H:i:s') . &quot; Rename sheet\\n&quot;;<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle('RXP');</p>\r\n<p>//////////////////////////////////////////////////////////////////////////////////////////</p>\r\n<p>// Create a new worksheet, after the default sheet<br>\r\n//echo date('H:i:s') . &quot; Create new Worksheet object\\n&quot;;<br>\r\n$objPHPExcel-&gt;createSheet();</p>\r\n<p>$objPHPExcel-&gt;setActiveSheetIndex(4);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A1', 'Completed');<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B1', 0);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C1', 'Filter Weekly Projected');</p>\r\n<p>//now add second row<br>\r\n$objPHPExcel-&gt;setActiveSheetIndex(4);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A2', '');<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B2', '');<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C2', 1557);</p>\r\n<p>$cnt=3;<br>\r\n$query = &quot;SELECT <br>\r\n              complete,<br>\r\n              sixtytwo,<br>\r\n              filterweeklyprojected <br>\r\n          FROM reportfilter<br>\r\n          limit 800<br>\r\n          &quot;;<br>\r\n     $rxp = mysql_query($query);<br>\r\n     while ($row = mysql_fetch_array($rxp))<br>\r\n   {<br>\r\n       <br>\r\n            <br>\r\n     <br>\r\n//now add data<br>\r\n$objPHPExcel-&gt;setActiveSheetIndex(4);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('A'.$cnt, $row[complete]);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('B'.$cnt, $row[sixtytwo]);<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue('C'.$cnt, $row[filterweeklyprojected]);</p>\r\n<p>$cnt++;<br>\r\n}</p>\r\n<p>// Rename sheet<br>\r\n//echo date('H:i:s') . &quot; Rename sheet\\n&quot;;<br>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle('Filters');</p>\r\n<p> </p>\r\n<p>// Set active sheet index to the first sheet, so Excel opens this as the first sheet<br>\r\n$objPHPExcel-&gt;setActiveSheetIndex(0);</p>\r\n",
    "PostedDate": "2009-01-15T18:00:20.04-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "147556",
    "ThreadId": "44330",
    "Html": "These are the symptoms for exhausted memory. Check you <code>memory_limit</code>.<br>\r\n<br>\r\nPlease look at this related thread:<br>\r\n<a href=\"http://www.codeplex.com/PHPExcel/Thread/View.aspx?ThreadId=36847\">http://www.codeplex.com/PHPExcel/Thread/View.aspx?ThreadId=36847</a><br>\r\n<br>\r\n",
    "PostedDate": "2009-01-15T18:08:47.353-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "147557",
    "ThreadId": "44330",
    "Html": "It says Peak memory usage 7MB.  I am guessing they have alocated more than 7mb to me.  Anyway in script that I could find out how much memory they have allocated me?\r\n",
    "PostedDate": "2009-01-15T18:14:25.403-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "147565",
    "ThreadId": "44330",
    "Html": "That sounds unlikely for workbooks of this size. Put this at the end of your script (not the beginning if that was what you did):<br>\r\n<br>\r\n<code>// Echo memory peak usage<br>\r\necho &quot;Peak memory usage: &quot; . (memory_get_peak_usage(true) / 1024 / 1024) . &quot; MB&quot;;</code><br>\r\n<br>\r\nThen check also the <code>memory_limit</code> value by looking what it says when you use <code>phpinfo()</code>.<br>\r\n<br>\r\nIf you are close to the limit, raise to appropriate level by putting e.g. this at the beginning of your script:<br>\r\n<code><br>\r\nini_set('memory_limit', '512M');</code> <br>\r\n<br>\r\n",
    "PostedDate": "2009-01-15T18:26:17.53-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "147567",
    "ThreadId": "44330",
    "Html": "You hit it right on the head.  the \r\n<p style=\"margin:0in 0in 12pt\"><code><span style=\"font-size:10pt\">ini_set('memory_limit', '512M');</span></code><span style=\"font-size:9pt;font-family:'verdana','sans-serif'\"> <br>\r\n&lt;o:p&gt;<br>\r\nWorked perfectly.  <br>\r\n<br>\r\nGreat job and great support.<br>\r\n<br>\r\nThanks a bunch!&lt;/o:p&gt;</span></p>\r\n",
    "PostedDate": "2009-01-15T18:33:28.86-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "148745",
    "ThreadId": "44330",
    "Html": "Hi!<div><br></div><div>I'm also having fun with MySQL and phpexccel. You should consider using ini_set('max_execution_time', '120')  too! </div><div>I made &quot;stress test&quot; which write's values from A0 to Z200 in 50 worksheets.... It takes almost 7 minutes and uses 1,2G memory...</div><div><br></div><div>So what i'm trying say is that if your server has some other tasks running it may take long time and max exection time isn't enough anymore.</div><div><br></div><div>-Jarkko</div><div><br></div><div><br></div><div><br></div><div><br></div>",
    "PostedDate": "2009-01-20T07:34:24.3-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]