[
  {
    "Id": "613953",
    "ThreadId": "257934",
    "Html": "<p>I'm using PHPExcel to generate a number of rather complex worksheets from external datasources (Oracle, CSV and Salesforce.com in fact) - which, by the way, is going to be fantastic once it's done, since it will save me around an hour each morning generating  these files using Excel macros...</p>\n<p>Once the data is retrieved, I create 4 separate reports, each in a separate worksheet, all as one large workbook.&nbsp; This works fine.</p>\n<p>However, I'd also like to save each worksheet as a separate Excel file, so that I can email them out automatically to the appropriate recipients (saving me another 10 minutes of work in the morning).&nbsp; I don't want to just send the full file to everyone,  as only 1 of the 4 reports is of any interest to any one person...</p>\n<p>So, my idea was to copy the Worksheet object, and save that in a new PHPExcel object... but doing that has proved rather complicated!&nbsp; What I've got so far works, but seems rather inelegant:</p>\n<p><span style=\"color: blue;\">&nbsp;</span></p>\n<div style=\"color: black; background-color: white;\">\n<pre><span style=\"color: blue;\">function</span> saveWorksheetToFile(PHPExcel_Worksheet $worksheet, $filename) {\n\t<span style=\"color: green;\">/* Create a new workbook with just the supplied sheet */</span>\n\t$objPHPExcel = <span style=\"color: blue;\">new</span> PHPExcel();\n\t$objPHPExcel-&gt;removeSheetByIndex(0);\n\t<span style=\"color: green;\">/* We use \"clone\" to ensure that the sheet is not removed from the old workbook */</span>\n\t$cloned_sheet = <span style=\"color: blue;\">clone</span> $worksheet;\n\t<span style=\"color: green;\">/* Rename the cloned sheet, and add it to the original workbook */</span>\n\t$sheet_title = $worksheet-&gt;getTitle();\n\t$cloned_sheet-&gt;setTitle(<span style=\"color: #a31515;\">'~'</span>.$sheet_title);\n\t$worksheet-&gt;getParent()-&gt;addSheet($cloned_sheet);\n\t<span style=\"color: green;\">/* We use \"addExternalSheet\" to ensure the styles are copied to the new workbook */</span>\n\t$objPHPExcel-&gt;addExternalSheet($cloned_sheet);\n\t<span style=\"color: green;\">/* Restore the original sheet title */</span>\n\t$cloned_sheet-&gt;setTitle($sheet_title);\n\t<span style=\"color: green;\">/* Write the sheet to a file */</span>\n\t$objWriter = <span style=\"color: blue;\">new</span> PHPExcel_Writer_Excel2007($objPHPExcel);\n\t$objWriter-&gt;save($filename);\n}\n</pre>\n</div>\n<p>&nbsp;</p>\n<p>As you can see, I first clone the sheet and add it to my original workbook (with a different name), then move it to the new workbook and rename it back, then write it to the file...</p>\n<p>If I don't add the cloned sheet to the original workbook first, when I do \"addExternalSheet\" it appears to remove the original sheet from that workbook too!</p>\n<p>Two questions, if the more experienced users here would be so kind:</p>\n<ol>\n<li>Is there a more efficient/elegant way to do this? </li>\n<li>What objects can I or should I \"unset\" in order to save as much memory as possible, without breaking my original sheets in the original workbook? </li>\n</ol>\n<p>Thanks in advance for your help,</p>\n<p>Nick</p>\n<p>Addendum: PHPExcel 1.7.6, PHP 5.2.6 with Suhosin-Patch 0.9.6.2 (cli), AIX 5.3</p>",
    "PostedDate": "2011-05-17T07:32:23.577-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]