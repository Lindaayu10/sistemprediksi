[
  {
    "Id": "994191",
    "ThreadId": "431424",
    "Html": "\r\n<p>Hi All,</p>\r\n<p>&nbsp;</p>\r\n<p>I'm using, based on example:&nbsp;01simple-download-xls.php</p>\r\n<p>&nbsp;</p>\r\n<p>This:</p>\r\n<p></p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>&lt;?php \r\n<span style=\"color:blue\">require_once</span>(<span style=\"color:#a31515\">&quot;includes/session.php&quot;</span>); \r\n<span style=\"color:blue\">require_once</span>(<span style=\"color:#a31515\">&quot;includes/connection.php&quot;</span>); \r\n<span style=\"color:blue\">require_once</span>(<span style=\"color:#a31515\">&quot;includes/functions.php&quot;</span>);\r\n\r\n$filter = $_SESSION[<span style=\"color:#a31515\">'registry'</span>];\r\n$query = &quot;SELECT registry.registry_num, registry.name, registry.sent_date,\r\n        \t\t\tregistry.nin, rne.lgm.d_ctrl_fil, \r\n        \t\t\t(CASE  WHEN (rne.lgm.resultado1&#43;rne.lgm.resultado2 &gt; 0)  THEN 1 ELSE 0 END) AS resolved, registry.ln_number,\r\n        \t\t\tregistry.la_number, registry.resolved_abpsl\r\n        \t\t\tFROM registry\r\n        \t\t\tLEFT JOIN rne.lgm ON rne.lgm.nsc_f = registry.nin\r\n        \t\t\tWHERE ((<span style=\"color:#a31515\">''</span> = <span style=\"color:#a31515\">'{$filter}'</span>) OR (CAST(registry.nin <span style=\"color:blue\">as</span> char) = <span style=\"color:#a31515\">'{$filter}'</span>)\r\n                  \tOR (<span style=\"color:#a31515\">''</span> = <span style=\"color:#a31515\">'{$filter}'</span>) OR (registry.name LIKE <span style=\"color:#a31515\">'%{$filter}%'</span>)\r\n                  \tOR (<span style=\"color:#a31515\">''</span> = <span style=\"color:#a31515\">'{$filter}'</span>) OR (registry.registry_num LIKE <span style=\"color:#a31515\">'%{$filter}%'</span>)) &quot;;\r\n\t\t\t\t\t\t<span style=\"color:blue\">if</span> ($_SESSION[<span style=\"color:#a31515\">'rne_resolved'</span>] == 1) { $query = $query.<span style=\"color:#a31515\">&quot; AND (rne.lgm.resultado1 &#43; rne.lgm.resultado2 &gt; 0) &quot;</span>; }\r\n\t      \t\t\t\t<span style=\"color:blue\">if</span> ($_SESSION[<span style=\"color:#a31515\">'rne_resolved'</span>] == 0) { $query = $query.<span style=\"color:#a31515\">&quot; AND (rne.lgm.resultado1 &#43; rne.lgm.resultado2 = 0) &quot;</span>; }\r\n\t      \t\t\t\t<span style=\"color:blue\">if</span> ($_SESSION[<span style=\"color:#a31515\">'associations_resolved'</span>] == 1) { $query = $query.<span style=\"color:#a31515\">&quot; AND (registry.resolved_abpsl = 1) &quot;</span>; }\r\n\t      \t\t\t\t<span style=\"color:blue\">if</span> ($_SESSION[<span style=\"color:#a31515\">'associations_resolved'</span>] == 0) { $query = $query.<span style=\"color:#a31515\">&quot; AND (registry.resolved_abpsl = 0) &quot;</span>; }\r\n        \t\t\t$query .=  <span style=\"color:#a31515\">&quot;ORDER BY &quot;</span>.$_SESSION[<span style=\"color:#a31515\">'orderby'</span>];\r\n        \r\n            $result_set = mysql_query($query);\r\n\t\t\texport($result_set);\r\n\r\n<span style=\"color:blue\">function</span> export ($export = NULL){\r\n\t<span style=\"color:blue\">if</span> ($export =!NULL) {\r\n\t\t<span style=\"color:blue\">require_once</span> <span style=\"color:#a31515\">'/classes/PHPExcel.php'</span>;\r\n\t\t$objPHPExcel = <span style=\"color:blue\">new</span> PHPExcel();\r\n\r\n\t\t$objPHPExcel-&gt;setActiveSheetIndex(0)\r\n\t\t            -&gt;setCellValue(<span style=\"color:#a31515\">'A1'</span>, <span style=\"color:#a31515\">'N�Registo'</span>)\r\n\t\t            -&gt;setCellValue(<span style=\"color:#a31515\">'B1'</span>, <span style=\"color:#a31515\">'Nome'</span>)\r\n\t\t            -&gt;setCellValue(<span style=\"color:#a31515\">'C1'</span>, <span style=\"color:#a31515\">'Data Pedido'</span>)\r\n\t\t            -&gt;setCellValue(<span style=\"color:#a31515\">'D1'</span>, <span style=\"color:#a31515\">'NIN/NSC'</span>)\r\n\t\t\t\t\t-&gt;setCellValue(<span style=\"color:#a31515\">'E1'</span>, <span style=\"color:#a31515\">'Data ROGD/LGM'</span>)\r\n\t\t\t\t\t-&gt;setCellValue(<span style=\"color:#a31515\">'F1'</span>, <span style=\"color:#a31515\">'Resolvido RNE'</span>)\r\n\t\t            -&gt;setCellValue(<span style=\"color:#a31515\">'G1'</span>, <span style=\"color:#a31515\">'N� LN'</span>)\r\n\t\t            -&gt;setCellValue(<span style=\"color:#a31515\">'H1'</span>, <span style=\"color:#a31515\">'N� LA'</span>)\r\n\t\t            -&gt;setCellValue(<span style=\"color:#a31515\">'I1'</span>, <span style=\"color:#a31515\">'Finalizado pela Associa��o'</span>);\r\n\t\t            \r\n        <span style=\"color:green\">//FILL With DATA</span>\r\n\t\t            \r\n\t\t         \r\n\t\theader(<span style=\"color:#a31515\">'Content-Type: application/vnd.ms-excel'</span>);\r\n\t\theader(<span style=\"color:#a31515\">'Content-Disposition: attachment;filename=&quot;ROGDList.xls&quot;'</span>);\r\n\t\theader(<span style=\"color:#a31515\">'Cache-Control: max-age=0'</span>);\r\n\r\n\t\t$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color:#a31515\">'Excel5'</span>);\r\n\t\t$objWriter-&gt;save(<span style=\"color:#a31515\">'php://output'</span>);\r\n\t\t<span style=\"color:blue\">exit</span>;\r\n\t}\r\n}\r\n?&gt;\r\n</pre>\r\n</div>\r\n<p></p>\r\n<p>&nbsp;</p>\r\n<p>But some how, is giving me corrupt file. What am i doing wrong. I've tested the query. I don't know how to populate the excel.</p>\r\n<p>&nbsp;</p>\r\n<p>Any help ?</p>\r\n",
    "PostedDate": "2013-01-30T08:01:11.04-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "994236",
    "ThreadId": "431424",
    "Html": "\r\n<p>Now Working, but the file goes to root folder of my site.</p>\r\n<p>&nbsp;</p>\r\n<p>using this</p>\r\n<p></p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color:#a31515\">'Excel5'</span>);\r\n$objWriter-&gt;save(str_replace(<span style=\"color:#a31515\">'.php'</span>, <span style=\"color:#a31515\">'.xls'</span>, <span style=\"color:blue\">__FILE__</span>));\r\n</pre>\r\n</div>\r\n<p></p>\r\n<p>&nbsp;</p>\r\n<p>How can i send it to user as download file.</p>\r\n",
    "PostedDate": "2013-01-30T09:20:24.393-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "994243",
    "ThreadId": "431424",
    "Html": "\r\n<p>You send it to the user as in your original post.... if you're getting a corrupt file, then open it in a text editor and look for leading/trailing whitespace; BOM marker, or any obvious PHP error messages in the content of the file.</p>\r\n<p>&nbsp;</p>\r\n<p>And I think</p>\r\n<p>&nbsp;<span style=\"color:blue\">if</span> ($export =!NULL) {</p>\r\n<p>should be a comparison rather than an assignment</p>\r\n",
    "PostedDate": "2013-01-30T09:29:43.957-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "994258",
    "ThreadId": "431424",
    "Html": "\r\n<p>Hi MarkBaker,</p>\r\n<p>&nbsp;</p>\r\n<p>Tks for the reply, i've changed the code,</p>\r\n<p>In my registry_list.php page i have a link &quot;export to excel&quot; that points to xls.php and in xls.php file i've got this</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>&lt;?php\n<span style=\"color:blue\">require_once</span>(<span style=\"color:#a31515\">&quot;includes/session.php&quot;</span>); \n<span style=\"color:blue\">require_once</span>(<span style=\"color:#a31515\">&quot;includes/connection.php&quot;</span>); \n<span style=\"color:blue\">require_once</span>(<span style=\"color:#a31515\">&quot;includes/functions.php&quot;</span>);\n\nerror_reporting(E_ALL);\nini_set(<span style=\"color:#a31515\">'display_errors'</span>, TRUE);\nini_set(<span style=\"color:#a31515\">'display_startup_errors'</span>, TRUE);\ndate_default_timezone_set(<span style=\"color:#a31515\">'Europe/London'</span>);\n\ndefine(<span style=\"color:#a31515\">'EOL'</span>,(PHP_SAPI == <span style=\"color:#a31515\">'cli'</span>) ? PHP_EOL : <span style=\"color:#a31515\">'<br>'</span>);\n\n<span style=\"color:green\">/** Include PHPExcel */</span>\n<span style=\"color:blue\">require_once</span> <span style=\"color:#a31515\">'/Classes/PHPExcel.php'</span>;\n\n\n<span style=\"color:green\">// Create new PHPExcel object</span>\n$objPHPExcel = <span style=\"color:blue\">new</span> PHPExcel();\n\n$filter = $_SESSION[<span style=\"color:#a31515\">'registry'</span>];\n$query = &quot;SELECT registry.registry_num, registry.name, registry.sent_date,\n        \t\t\tregistry.nin, rne.lgm.d_ctrl_fil, \n        \t\t\t(CASE  WHEN (rne.lgm.resultado1&#43;rne.lgm.resultado2 &gt; 0)  THEN 1 ELSE 0 END) AS resolved, registry.ln_number,\n        \t\t\tregistry.la_number, registry.resolved_abpsl\n        \t\t\tFROM registry\n        \t\t\tLEFT JOIN rne.lgm ON rne.lgm.nsc_f = registry.nin\n        \t\t\tWHERE ((<span style=\"color:#a31515\">''</span> = <span style=\"color:#a31515\">'{$filter}'</span>) OR (CAST(registry.nin <span style=\"color:blue\">as</span> char) = <span style=\"color:#a31515\">'{$filter}'</span>)\n                  \tOR (<span style=\"color:#a31515\">''</span> = <span style=\"color:#a31515\">'{$filter}'</span>) OR (registry.name LIKE <span style=\"color:#a31515\">'%{$filter}%'</span>)\n                  \tOR (<span style=\"color:#a31515\">''</span> = <span style=\"color:#a31515\">'{$filter}'</span>) OR (registry.registry_num LIKE <span style=\"color:#a31515\">'%{$filter}%'</span>)) &quot;;\n\t\t\t\t\t\t<span style=\"color:blue\">if</span> ($_SESSION[<span style=\"color:#a31515\">'rne_resolved'</span>] == 1) { $query = $query.<span style=\"color:#a31515\">&quot; AND (rne.lgm.resultado1 &#43; rne.lgm.resultado2 &gt; 0) &quot;</span>; }\n\t      \t\t\t\t<span style=\"color:blue\">if</span> ($_SESSION[<span style=\"color:#a31515\">'rne_resolved'</span>] == 0) { $query = $query.<span style=\"color:#a31515\">&quot; AND (rne.lgm.resultado1 &#43; rne.lgm.resultado2 = 0) &quot;</span>; }\n\t      \t\t\t\t<span style=\"color:blue\">if</span> ($_SESSION[<span style=\"color:#a31515\">'associations_resolved'</span>] == 1) { $query = $query.<span style=\"color:#a31515\">&quot; AND (registry.resolved_abpsl = 1) &quot;</span>; }\n\t      \t\t\t\t<span style=\"color:blue\">if</span> ($_SESSION[<span style=\"color:#a31515\">'associations_resolved'</span>] == 0) { $query = $query.<span style=\"color:#a31515\">&quot; AND (registry.resolved_abpsl = 0) &quot;</span>; }\n        \t\t\t$query .=  <span style=\"color:#a31515\">&quot;ORDER BY &quot;</span>.$_SESSION[<span style=\"color:#a31515\">'orderby'</span>];\n        \n            $result_set = mysql_query($query);\n\t\t\tconfirm_query($result_set);\n\n<span style=\"color:green\">// Add some data</span>\n$objPHPExcel-&gt;setActiveSheetIndex(0)\n            -&gt;setCellValue(<span style=\"color:#a31515\">'A1'</span>, <span style=\"color:#a31515\">'N� Registo'</span>)\n            -&gt;setCellValue(<span style=\"color:#a31515\">'B1'</span>, <span style=\"color:#a31515\">'Nome'</span>)\n            -&gt;setCellValue(<span style=\"color:#a31515\">'C1'</span>, <span style=\"color:#a31515\">'Data Pedido'</span>)\n            -&gt;setCellValue(<span style=\"color:#a31515\">'D1'</span>, <span style=\"color:#a31515\">'NIN/NSC'</span>)\n            -&gt;setCellValue(<span style=\"color:#a31515\">'E1'</span>, <span style=\"color:#a31515\">'Data ROGD/LGM'</span>)\n            -&gt;setCellValue(<span style=\"color:#a31515\">'F1'</span>, <span style=\"color:#a31515\">'Resolvido RNE'</span>)\n            -&gt;setCellValue(<span style=\"color:#a31515\">'G1'</span>, <span style=\"color:#a31515\">'N� LN'</span>)\n            -&gt;setCellValue(<span style=\"color:#a31515\">'H1'</span>, <span style=\"color:#a31515\">'N� LA'</span>)\n            -&gt;setCellValue(<span style=\"color:#a31515\">'I1'</span>, <span style=\"color:#a31515\">'Finalizado pela Associa��o'</span>);\n            \n            $row = 2;\n           <span style=\"color:blue\">while</span> ($data = mysql_fetch_array($result_set)) {\n           \t$objPHPExcel-&gt;setActiveSheetIndex(0)\n            -&gt;setCellValue(<span style=\"color:#a31515\">'A'</span> . $row, $data[<span style=\"color:#a31515\">'registry_num'</span>])\n            -&gt;setCellValue(<span style=\"color:#a31515\">'B'</span>. $row, $data[<span style=\"color:#a31515\">'name'</span>])\n            -&gt;setCellValue(<span style=\"color:#a31515\">'C'</span>. $row, $data[<span style=\"color:#a31515\">'sent_date'</span>])\n            -&gt;setCellValue(<span style=\"color:#a31515\">'D'</span>. $row, $data[<span style=\"color:#a31515\">'nin'</span>])\n            -&gt;setCellValue(<span style=\"color:#a31515\">'E'</span>. $row, $data[<span style=\"color:#a31515\">'d_ctrl_fil'</span>])\n            -&gt;setCellValue(<span style=\"color:#a31515\">'F'</span>. $row, getbool($data[<span style=\"color:#a31515\">'resolved'</span>]))\n            -&gt;setCellValue(<span style=\"color:#a31515\">'G'</span>. $row, $data[<span style=\"color:#a31515\">'ln_number'</span>])\n            -&gt;setCellValue(<span style=\"color:#a31515\">'H'</span>. $row, $data[<span style=\"color:#a31515\">'la_number'</span>])\n            -&gt;setCellValue(<span style=\"color:#a31515\">'I'</span>. $row, getbool($data[<span style=\"color:#a31515\">'resolved_abpsl'</span>]));\n            $row&#43;&#43;;\n           }\n\n<span style=\"color:green\">// Set active sheet index to the first sheet, so Excel opens this as the first sheet</span>\n$objPHPExcel-&gt;setActiveSheetIndex(0);\n\n\n$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color:#a31515\">'Excel2007'</span>);\n$objWriter-&gt;save(str_replace(<span style=\"color:#a31515\">'.php'</span>, <span style=\"color:#a31515\">'.xlsx'</span>, <span style=\"color:blue\">__FILE__</span>));\n\n?&gt;\n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p>Which is working with &nbsp;the data from the query. But my main goal here is:</p>\r\n<p>instead of sending the file into one folder (fine is working ok) is send the file via download on browser...</p>\r\n<p>i've tried</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>$objPHPExcel-&gt;setActiveSheetIndex(0);\nheader(<span style=\"color:#a31515\">'Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'</span>);\nheader(<span style=\"color:#a31515\">'Content-Disposition: attachment;filename=&quot;01simple.xlsx&quot;'</span>);\nheader(<span style=\"color:#a31515\">'Cache-Control: max-age=0'</span>);\n\n$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color:#a31515\">'Excel2007'</span>);\n$objWriter-&gt;save(<span style=\"color:#a31515\">'php://output'</span>);\n<span style=\"color:blue\">exit</span>;\n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p>But is giving me an error ... can not open file 01simple.xlsx<span style=\"font-family:Consolas,'Courier New',Courier,monospace\">&nbsp;because the format or extension is not valid...</span></p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"font-family:Consolas,'Courier New',Courier,monospace\">Any idea ?</span></p>\r\n<p><span style=\"font-family:Consolas,'Courier New',Courier,monospace\">TY in advance</span></p>\r\n",
    "PostedDate": "2013-01-30T09:51:53.253-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "994261",
    "ThreadId": "431424",
    "Html": "\r\n<p>if you're getting a corrupt file, then open it in a text editor and look for leading/trailing whitespace; BOM marker, or any obvious PHP error messages in the content of the file.</p>\r\n",
    "PostedDate": "2013-01-30T10:02:23.89-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "994346",
    "ThreadId": "431424",
    "Html": "\r\n<p>4728 lines.</p>\r\n<p><span style=\"font-size:10pt\"></p>\r\n<pre>6d6c 2e72 656c 7350 4b05 0600 0000 000b\n000b 00d1 0200 0093 2401 0000 00</pre>\r\n&nbsp;last line, is missing some bytes ?</span>\r\n<p></p>\r\n",
    "PostedDate": "2013-01-30T13:01:00.313-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "994363",
    "ThreadId": "431424",
    "Html": "I don't understand. when i'm using this header: <br />\n<pre><code>$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');\n$objWriter-&gt;save(str_replace('.php', '.xls', __FILE__));</code></pre>\n\nI can open the file with no warning or error and every thing is ok.\r<br />\n<br />\nWhen i change the headers to this:<br />\n<pre><code>header('Content-Type: application/vnd.ms-excel');\n        header('Content-Disposition: attachment;filename=&quot;ROGDList.xls&quot;');\n        header('Cache-Control: max-age=0');\n\n        $objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');\n        $objWriter-&gt;save('php://output');\n        exit;</code></pre>\n\nBAM, error!<br />\n",
    "PostedDate": "2013-01-30T13:30:34.077-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "994374",
    "ThreadId": "431424",
    "Html": "This is now Working,<br />\n<pre><code>&lt;?php            \nerror_reporting(E_ALL);\nini_set('display_errors', TRUE);\nini_set('display_startup_errors', TRUE);\ndate_default_timezone_set('Europe/London');\n\ndefine('EOL',(PHP_SAPI == 'cli') ? PHP_EOL : '&lt;br /&gt;');\n\n/** Include PHPExcel */\nrequire_once '/Classes/PHPExcel.php';\n\n$objPHPExcel = new PHPExcel();\n$objPHPExcel-&gt;getProperties()-&gt;setCreator(&quot;Maarten Balliauw&quot;)\n                             -&gt;setLastModifiedBy(&quot;Maarten Balliauw&quot;)\n                             -&gt;setTitle(&quot;Office 2007 XLSX Test Document&quot;)\n                             -&gt;setSubject(&quot;Office 2007 XLSX Test Document&quot;)\n                             -&gt;setDescription(&quot;Test document for Office 2007 XLSX, generated using PHP classes.&quot;)\n                             -&gt;setKeywords(&quot;office 2007 openxml php&quot;)\n                             -&gt;setCategory(&quot;Test result file&quot;);\n\n$objPHPExcel-&gt;setActiveSheetIndex(0)\n            -&gt;setCellValue('A1', 'Nº Registo')\n            -&gt;setCellValue('B1', 'Nome')\n            -&gt;setCellValue('C1', 'Data Pedido')\n            -&gt;setCellValue('D1', 'NIN/NSC')\n            -&gt;setCellValue('E1', 'Data ROGD/LGM')\n            -&gt;setCellValue('F1', 'Resolvido RNE')\n            -&gt;setCellValue('G1', 'Nº LN')\n            -&gt;setCellValue('H1', 'Nº LA')\n            -&gt;setCellValue('I1', 'Finalizado pela Associação');\n\n$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle('Simple');\n\n$objPHPExcel-&gt;setActiveSheetIndex(0);\n// Set active sheet index to the first sheet, so Excel opens this as the first sheet\n\nheader('Content-Type: application/vnd.ms-excel');\n        header('Content-Disposition: attachment;filename=&quot;ROGDList.xls&quot;');\n        header('Cache-Control: max-age=0');\n\n        $objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');\n        $objWriter-&gt;save('php://output');\n        exit;\n?&gt;</code></pre>\n\nNow i just add the php includes on top of the file. And again. error :(\r<br />\n<br />\nSorry by &quot;spamming&quot; i'm desesparated =(<br />\n",
    "PostedDate": "2013-01-30T13:42:21.66-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "994387",
    "ThreadId": "431424",
    "Html": "Solved!\r<br />\nThe problem i think was the loop..\r<br />\n<br />\nFound out this\r<br />\n<a href=\"http://phpexcel.codeplex.com/discussions/359829\" rel=\"nofollow\">http://phpexcel.codeplex.com/discussions/359829</a>\r<br />\n<br />\nAnd again,\r<br />\nTks MarkBaker you solve it :D \r<br />\nAnd without replying to my posts <br />\n",
    "PostedDate": "2013-01-30T14:03:38.387-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]