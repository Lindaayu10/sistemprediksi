[
  {
    "Id": "853726",
    "ThreadId": "360958",
    "Html": "\r\n<p>I want to generate a report (.xlsx) from database&nbsp;</p>\r\n<p>I am getting corrupted xlsx files when saving/pushing to browser. i.e. using</p>\r\n<p><strong>$objWriter-&gt;save('php://output');</strong></p>\r\n<p>But if I save the file locally on the disk&nbsp;&nbsp;i.e. using</p>\r\n<p><strong>$objWriter-&gt;save(&quot;Bidding Report $excel_title.xlsx&quot;);</strong></p>\r\n<p>&nbsp;then it results perfect .xlsx</p>\r\n<p>I have checked there is no whitespace</p>\r\n<p>even it was working good , many days ago. but now it stuck. here is my code.</p>\r\n<p>Please look into the code and tell me where i am wrong. it really very complex to debug</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>?php\n<span style=\"color:blue\">require_once</span>(<span style=\"color:#a31515\">&quot;../config.inc.php&quot;</span>);\n<span style=\"color:blue\">require_once</span> <span style=\"color:#a31515\">'excel/PHPExcel.php'</span>;\n<span style=\"color:blue\">require_once</span> <span style=\"color:#a31515\">'excel/PHPExcel/Writer/Excel2007.php'</span>;\n<span style=\"color:blue\">global</span> $db;\n<span style=\"color:green\">//var_dump($db);</span>\n$from = $_GET[<span style=\"color:#a31515\">'f'</span>];\n$to = $_GET[<span style=\"color:#a31515\">'t'</span>];\n<span style=\"color:green\">//$f=1322780400;</span>\n<span style=\"color:green\">//$t=1331938800;</span>\n$excel_title = date(<span style=\"color:#a31515\">'d.M.y'</span>,$from) . <span style=\"color:#a31515\">&quot;--&quot;</span> . date(<span style=\"color:#a31515\">'d.M.y'</span>,$to);\n<span style=\"color:green\">//$input = array(&quot;red&quot;, &quot;green&quot;, &quot;blue&quot;, &quot;yellow&quot;);</span>\n<span style=\"color:green\">//var_dump(array_splice($input, -2));</span>\n$stmt =<span style=\"color:#a31515\">&quot;SELECT * FROM bid_view WHERE bidDate BETWEEN FROM_UNIXTIME($from) AND FROM_UNIXTIME($to)&quot;</span>;\n$arr_bid = $db-&gt;get_results($stmt,ARRAY_A);\n<span style=\"color:green\">//var_dump($arr_bid);</span>\n\n<span style=\"color:blue\">if</span>( !<span style=\"color:blue\">empty</span>($arr_bid) ) {\n    <span style=\"color:blue\">foreach</span> ($arr_bid <span style=\"color:blue\">as</span> &amp; $bid) {\n       <span style=\"color:green\">//loop though each sub array and slice off the first 6 to a new multidimensional array</span>\n        <span style=\"color:green\">//$arr_report[]=array_slice($bv,6,count($bv),true);</span>\n        array_splice($bid,0,6);\n    }\n}\n<span style=\"color:green\">//@note : unset() is must if using  rray_splice() to remove  `&amp;` in foreach</span>\n<span style=\"color:blue\">unset</span>($bid);\n<span style=\"color:green\">//@note : use $arr_report array  if we use array_slice()</span>\n<span style=\"color:green\">//var_dump($arr_report);</span>\n\nvar_dump($arr_bid);\n\n<span style=\"color:blue\">exit</span>;\n$cellHeader = <span style=\"color:blue\">array</span>(<span style=\"color:#a31515\">'Auction Number'</span>,\n                <span style=\"color:#a31515\">'Bidder Name'</span>, <span style=\"color:#a31515\">'Address'</span>, <span style=\"color:#a31515\">'City'</span>, <span style=\"color:#a31515\">'State'</span>, <span style=\"color:#a31515\">'Zip Code'</span>, <span style=\"color:#a31515\">'E-mail'</span>,\n                <span style=\"color:#a31515\">'Donator Name'</span>, <span style=\"color:#a31515\">'Address'</span>, <span style=\"color:#a31515\">'City'</span>, <span style=\"color:#a31515\">'State'</span>, <span style=\"color:#a31515\">'Zip Code'</span>, <span style=\"color:#a31515\">'E-mail'</span>, \n                <span style=\"color:#a31515\">'Charity Name'</span>, <span style=\"color:#a31515\">'Address'</span>, <span style=\"color:#a31515\">'City'</span>, <span style=\"color:#a31515\">'State'</span>, <span style=\"color:#a31515\">'Zip Code'</span>,<span style=\"color:#a31515\">'E.I.N'</span>);\n\n            <span style=\"color:green\">// Create new PHPExcel object</span>\n            <span style=\"color:green\">//echo date('H:i:s') . &quot; Create new PHPExcel object\\n&quot;;</span>\n            $objPHPExcel = <span style=\"color:blue\">new</span> PHPExcel();\n            <span style=\"color:green\">// Set properties</span>\n            <span style=\"color:green\">//echo date('H:i:s') . &quot; Set properties\\n&quot;;</span>\n            $objPHPExcel-&gt;getProperties()-&gt;setCreator(<span style=\"color:#a31515\">&quot;Brian Schneider&quot;</span>);\n            $objPHPExcel-&gt;getProperties()-&gt;setLastModifiedBy(<span style=\"color:#a31515\">&quot;Brian Schneider&quot;</span>);\n            $objPHPExcel-&gt;getProperties()-&gt;setTitle(<span style=\"color:#a31515\">&quot;Charity Rummage Bidding Report&quot;</span>);\n            $objPHPExcel-&gt;getProperties()-&gt;setSubject(<span style=\"color:#a31515\">&quot;Charity Rummage Bidding Report&quot;</span>);\n            $objPHPExcel-&gt;getProperties()-&gt;setDescription(<span style=\"color:#a31515\">&quot;History of all bids placed on charityrummage generated By Admmin&quot;</span>);\n            <span style=\"color:green\">// Add some data</span>\n            $objPHPExcel-&gt;setActiveSheetIndex(0);\n            $i = 0;\n            <span style=\"color:blue\">foreach</span> ($cellHeader <span style=\"color:blue\">as</span> $v) {\n                $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow($i, 1, $v);\n                <span style=\"color:green\">//set width of each column</span>\n                $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimensionByColumn($i)-&gt;setWidth(strlen($v) &#43; 5);\n                <span style=\"color:green\">//set heading row to bold </span>\n                $objPHPExcel-&gt;getActiveSheet()-&gt;getStyleByColumnAndRow($i)-&gt;getFont()-&gt;setBold(true);\n                $i&#43;&#43;;\n            }\n            <span style=\"color:green\">//__print($arr_bid);</span>\n            \n            <span style=\"color:blue\">if</span>( !<span style=\"color:blue\">empty</span>($arr_bid) )\n            {\n                $j=1;\n                <span style=\"color:blue\">foreach</span> ($arr_bid <span style=\"color:blue\">as</span> $row)\n                {\n                    &#43;&#43;$j;\n                    $c=0;\n                    <span style=\"color:blue\">foreach</span>($row <span style=\"color:blue\">as</span> $col)\n                    {\n                       <span style=\"color:green\">// echo &quot;&lt;br/&gt;Column:&quot;.$c;</span>\n                       <span style=\"color:green\">// echo &quot;&amp;nbsp;&amp;nbsp;Row:&quot;.$j;</span>\n                       <span style=\"color:green\">// var_dump($col);</span>\n                          $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimensionByColumn($c)-&gt;setWidth(strlen($col) &#43; 6);\n                          $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow($c, $j, $col);\n                          $c&#43;&#43;;\n                     }\n                }\n            }\n            <span style=\"color:blue\">else</span> {\n                $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueByColumnAndRow(0, 2, <span style=\"color:#a31515\">'No Bidding History'</span>);\n            }\n            <span style=\"color:green\">//die;</span>\n            <span style=\"color:green\">// Rename sheet</span>\n            $objPHPExcel-&gt;getActiveSheet()-&gt;setTitle(<span style=\"color:#a31515\">'Bidding Report'</span>);\n            <span style=\"color:green\">// Set active sheet index to the first sheet, so Excel opens this as the first sheet</span>\n            $objPHPExcel-&gt;setActiveSheetIndex(0);\n            <span style=\"color:green\">// Redirect output to a clientï¿½s web browser (Excel2007)</span>\n            $objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color:#a31515\">'Excel2007'</span>);\n            <span style=\"color:green\">//$objWriter-&gt;save(&quot;Bidding Report $excel_title.xlsx&quot;);</span>\n            <span style=\"color:green\">// ask user to save on his system</span>\n            <span style=\"color:green\">// This is MUST to write, otherwise corrupt xlsx will be generated</span>\n            <span style=\"color:green\">//ob_end_clean();</span>\n            header(<span style=\"color:#a31515\">&quot;Last-Modified: &quot;</span> . gmdate(<span style=\"color:#a31515\">&quot;D, d M Y H:i:s&quot;</span>) . <span style=\"color:#a31515\">&quot; GMT&quot;</span>);\n            header(<span style=\"color:#a31515\">&quot;Cache-Control: no-store, no-cache, must-revalidate&quot;</span>);\n            header(<span style=\"color:#a31515\">&quot;Cache-Control: post-check=0, pre-check=0&quot;</span>, false);\n            header(<span style=\"color:#a31515\">'Cache-Control: max-age=0'</span>);\n            header(<span style=\"color:#a31515\">&quot;Pragma: no-cache&quot;</span>);\n            header(<span style=\"color:#a31515\">'Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'</span>);\n            header(<span style=\"color:#a31515\">'Content-Disposition: attachment;filename=BiddingReport'</span>.$excel_title.<span style=\"color:#a31515\">'.xlsx'</span>);\n           \n            <span style=\"color:green\">//var_dump($objWriter); </span>\n            $objWriter-&gt;save(<span style=\"color:#a31515\">'php://output'</span>);\n            <span style=\"color:green\">// Save Excel 2007 file           </span>\n            $objPHPExcel-&gt;disconnectWorksheets();\n            <span style=\"color:blue\">unset</span>($objPHPExcel);\n            <span style=\"color:blue\">exit</span>;\n            <span style=\"color:green\">//echo date('H:i:s') . &quot; Report sheet generated.\\r\\n&quot;;</span>\n?&gt;</pre>\r\nbelow is final `$arr_bid` structure :\r\n<pre><div style=\"color:black; background-color:white\"><pre>$arr_bid =<span style=\"color:blue\">array</span>\n  0 =&gt; \n    <span style=\"color:blue\">array</span>\n      <span style=\"color:#a31515\">'auctionNumber'</span> =&gt; string <span style=\"color:#a31515\">'AU790854'</span> (length=8)\n      <span style=\"color:#a31515\">'bidderName'</span> =&gt; string <span style=\"color:#a31515\">'Adman Smith'</span> (length=11)\n      <span style=\"color:#a31515\">'bidderAddress'</span> =&gt; string <span style=\"color:#a31515\">'test'</span> (length=4)\n      <span style=\"color:#a31515\">'bidderCity'</span> =&gt; string <span style=\"color:#a31515\">'jaipur'</span> (length=6)\n      <span style=\"color:#a31515\">'bidderState'</span> =&gt; string <span style=\"color:#a31515\">'rajasthan'</span> (length=9)\n      <span style=\"color:#a31515\">'bidderZip'</span> =&gt; string <span style=\"color:#a31515\">'302014'</span> (length=6)\n      <span style=\"color:#a31515\">'bidderEmail'</span> =&gt; string <span style=\"color:#a31515\">'adam.smth@test.com'</span> (length=18)\n      <span style=\"color:#a31515\">'donorName'</span> =&gt; string <span style=\"color:#a31515\">'Steve Jobs'</span> (length=13)\n      <span style=\"color:#a31515\">'donorAddress'</span> =&gt; string <span style=\"color:#a31515\">'test'</span> (length=4)\n      <span style=\"color:#a31515\">'donorCity'</span> =&gt; string <span style=\"color:#a31515\">'jaipur'</span> (length=6)\n      <span style=\"color:#a31515\">'donorState'</span> =&gt; string <span style=\"color:#a31515\">'rajasthan'</span> (length=9)\n      <span style=\"color:#a31515\">'donorZip'</span> =&gt; string <span style=\"color:#a31515\">'302014'</span> (length=6)\n      <span style=\"color:#a31515\">'donorEmail'</span> =&gt; string <span style=\"color:#a31515\">'again@test.com'</span> (length=28)\n      <span style=\"color:#a31515\">'churchName'</span> =&gt; string <span style=\"color:#a31515\">'ACE COMMUNITY PARK INC'</span> (length=22)\n      <span style=\"color:#a31515\">'churchAddress'</span> =&gt; string <span style=\"color:#a31515\">'PO BOX 321'</span> (length=10)\n      <span style=\"color:#a31515\">'churchCity'</span> =&gt; string <span style=\"color:#a31515\">'ACE'</span> (length=3)\n      <span style=\"color:#a31515\">'churchState'</span> =&gt; string <span style=\"color:#a31515\">'TX'</span> (length=2)\n      <span style=\"color:#a31515\">'churchZip'</span> =&gt; string <span style=\"color:#a31515\">'77326-0321'</span> (length=10)\n      <span style=\"color:#a31515\">'churchCode'</span> =&gt; string <span style=\"color:#a31515\">'760133257'</span> (length=9)\n  1 =&gt; \n    <span style=\"color:blue\">array</span>\n      <span style=\"color:#a31515\">'auctionNumber'</span> =&gt; string <span style=\"color:#a31515\">'AU769810'</span> (length=8)\n      <span style=\"color:#a31515\">'bidderName'</span> =&gt; string <span style=\"color:#a31515\">'testuser testing'</span> (length=16)\n      <span style=\"color:#a31515\">'bidderAddress'</span> =&gt; string <span style=\"color:#a31515\">'zckknk'</span> (length=6)\n      <span style=\"color:#a31515\">'bidderCity'</span> =&gt; string <span style=\"color:#a31515\">'kknkj'</span> (length=5)\n      <span style=\"color:#a31515\">'bidderState'</span> =&gt; string <span style=\"color:#a31515\">'knknk'</span> (length=5)\n      <span style=\"color:#a31515\">'bidderZip'</span> =&gt; string <span style=\"color:#a31515\">'knkkn'</span> (length=5)\n      <span style=\"color:#a31515\">'bidderEmail'</span> =&gt; string <span style=\"color:#a31515\">'test@test123.com'</span> (length=15)\n      <span style=\"color:#a31515\">'donorName'</span> =&gt; string <span style=\"color:#a31515\">'Keshav Mohta'</span> (length=12)\n      <span style=\"color:#a31515\">'donorAddress'</span> =&gt; string <span style=\"color:#a31515\">'101/91,Pratap nagar'</span> (length=19)\n      <span style=\"color:#a31515\">'donorCity'</span> =&gt; string <span style=\"color:#a31515\">'Jaipur'</span> (length=6)\n      <span style=\"color:#a31515\">'donorState'</span> =&gt; string <span style=\"color:#a31515\">'Rajasthan'</span> (length=9)\n      <span style=\"color:#a31515\">'donorZip'</span> =&gt; string <span style=\"color:#a31515\">'302022'</span> (length=6)\n      <span style=\"color:#a31515\">'donorEmail'</span> =&gt; string <span style=\"color:#a31515\">'keshav.mohta@test.com'</span> (length=21)\n      <span style=\"color:#a31515\">'churchName'</span> =&gt; string <span style=\"color:#a31515\">'ACE COMMUNITY PARK INC'</span> (length=22)\n      <span style=\"color:#a31515\">'churchAddress'</span> =&gt; string <span style=\"color:#a31515\">'PO BOX 321'</span> (length=10)\n      <span style=\"color:#a31515\">'churchCity'</span> =&gt; string <span style=\"color:#a31515\">'ACE'</span> (length=3)\n      <span style=\"color:#a31515\">'churchState'</span> =&gt; string <span style=\"color:#a31515\">'TX'</span> (length=2)\n      <span style=\"color:#a31515\">'churchZip'</span> =&gt; string <span style=\"color:#a31515\">'77326-0321'</span> (length=10)\n      <span style=\"color:#a31515\">'churchCode'</span> =&gt; string <span style=\"color:#a31515\">'760133257'</span> (length=9)\n);</pre>\n</div>\n</pre>\r\n</div>\r\n",
    "PostedDate": "2012-06-26T04:35:16.05-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "853757",
    "ThreadId": "360958",
    "Html": "<p>The standard answer to this question:</p>\r\n<p>Open the file in a text editor, and look for any whitespace characters at the beginning or end of the file, or any obvious PHP error messages in the file... in which case your script is echoing something.</p>",
    "PostedDate": "2012-06-26T05:21:43.447-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "853758",
    "ThreadId": "360958",
    "Html": "<p>I solved the issue.</p>\r\n<p>Actually I&nbsp;called above file(`generate.php`) from another page where action is given like this</p>\r\n<p><strong>action =\"page.php?page=generate&amp;f=123&amp;t=456\"</strong></p>\r\n<p>and &nbsp;in page.php , file we manipulate with query string , also there is many JS and CSS files included. that why i was getting corrupt file</p>\r\n<p>&nbsp;</p>\r\n<p>now resolved just by changing</p>\r\n<p><strong>action = \"generate.php?&amp;f=123&amp;t=456\"</strong></p>\r\n<p>&nbsp;</p>\r\n<p><strong>Sorry to bother you.</strong></p>\r\n<p><strong><br /></strong></p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>\r\n<pre>\r\n<br /></pre>\r\n</p>",
    "PostedDate": "2012-06-26T05:24:09.747-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]