[
  {
    "Id": "535937",
    "ThreadId": "238416",
    "Html": "\r\n<p>hi,&nbsp;</p>\r\n<p>I need to produce an excel file with data from mysql&nbsp;</p>\r\n<p>There is name , id code, email and a picture which is store in a blob in mysql</p>\r\n<p>problem is that i cannot use a setpath that change with every entry of the bd. so i get a file without image when i get a file.&nbsp;</p>\r\n<p>so in my script, when i use $lien to set info inside setpath($lien), nothing goes out, if i change it for &nbsp;setpath('portrait.jpg') it's work but every time with the same image which isn't what &nbsp;i need, image need to be different for each entry....\r\n &nbsp;</p>\r\n<p>here is the code :</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:green\">//---- r�cup�ration des �tudiants ayant fait le choix de cette activit� ----// </span>\r\n$sql2 = <span style=\"color:#a31515\">&quot;SELECT * FROM participants WHERE code_act='$act' AND  code_semestre='S11011' ORDER BY participants.id ASC&quot;</span> ; \r\n$req2 = mysql_query($sql2) <span style=\"color:blue\">or</span> <span style=\"color:blue\">die</span>(<span style=\"color:#a31515\">'Erreur SQL !&lt;br&gt;'</span>.$sql2.<span style=\"color:#a31515\">'&lt;br&gt;'</span>.mysql_error());\r\n<span style=\"color:green\">//---- Affichage des informations ----//</span>\r\n<span style=\"color:blue\">for</span>($e = 0 ; $e &lt; mysql_num_rows($req2) ; $e&#43;&#43;) {\r\n$row2 = mysql_fetch_assoc($req2);\r\n$id = $row2[<span style=\"color:#a31515\">'identifiant'</span>];\r\n$sql3 = <span style=\"color:#a31515\">&quot;SELECT * FROM tmp_ETU_A_JOUR WHERE COD_ETU='$id' &quot;</span>; \r\n$req3 = mysql_query($sql3); \r\n$row3 = mysql_fetch_assoc($req3); \r\n$nom = utf8_encode($row3[<span style=\"color:#a31515\">'LIB_NOM_PAT_IND'</span>]);\r\n$prenom = utf8_encode($row3[<span style=\"color:#a31515\">'LIB_PR1_IND'</span>]);\r\n$mel = $row3[<span style=\"color:#a31515\">'MAIL_UVSQ'</span>];\r\n$sexe = $row3[<span style=\"color:#a31515\">'COD_SEX_ETU'</span>];\r\n$img = $row3[<span style=\"color:#a31515\">'IMG_ETU'</span>];\r\n$image = imagecreatefromstring($img);\r\n$temp = tmpfile(); \r\n$lien =<span style=\"color:#a31515\">'trombi/'</span>.$id.<span style=\"color:#a31515\">'.jpg'</span>;\r\nimagejpeg($image, $lien, <span style=\"color:#a31515\">'100'</span>);\r\n$ligne = $e&#43;1;\r\n$B= <span style=\"color:#a31515\">'B'</span>.$ligne;\r\n$C= <span style=\"color:#a31515\">'C'</span>.$ligne;\r\n$D= <span style=\"color:#a31515\">'D'</span>.$ligne;\r\n$E= <span style=\"color:#a31515\">'E'</span>.$ligne;\r\n$F= <span style=\"color:#a31515\">'F'</span>.$ligne;\r\n$G= <span style=\"color:#a31515\">'G'</span>.$ligne;\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($B,$id);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($C,$nom);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($D,$prenom);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($E,$mel);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($F,$sexe);\r\n$objDrawing = <span style=\"color:blue\">new</span> PHPExcel_Worksheet_Drawing();\r\n$objDrawing-&gt;setName(<span style=\"color:#a31515\">'img'</span>);\r\n$objDrawing-&gt;setDescription(<span style=\"color:#a31515\">'img'</span>);\r\n$objDrawing-&gt;setPath($lien);\r\n$objDrawing-&gt;setHeight(36);\r\n$objDrawing-&gt;setCoordinates($G);\r\n$objDrawing-&gt;setOffsetX(-10);\r\n$objDrawing-&gt;setWorksheet($sheet);\r\n<span style=\"color:green\">/*$objDrawing = new PHPExcel_Worksheet_MemoryDrawing();\r\n$objDrawing-&gt;setName('test');\r\n$objDrawing-&gt;setDescription('');\r\n$objDrawing-&gt;setImageResource($lien);\r\n$objDrawing-&gt;setRenderingFunction(PHPExcel_Worksheet_MemoryDrawing::RENDERING_JPEG);\r\n$objDrawing-&gt;setMimeType(PHPExcel_Worksheet_MemoryDrawing::MIMETYPE_DEFAULT);\r\n$objDrawing-&gt;setHeight(36);\r\n$objDrawing-&gt;setWorksheet($sheet);*/</span>\r\n<span style=\"color:green\">//$ligne&#43;&#43;;</span>\r\nimagedestroy($image);\r\n\r\n}\r\n</pre>\r\n</div>\r\n<p>hop you can help me&nbsp;</p>\r\n<p>thanks&nbsp;</p>\r\n",
    "PostedDate": "2010-12-14T22:10:48.967-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]