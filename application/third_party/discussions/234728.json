[
  {
    "Id": "522108",
    "ThreadId": "234728",
    "Html": "\r\n<p>I have a template file that I wish to enter data in to then save.&nbsp;</p>\r\n<p>There are a number of complex formulas in my template which I think are causing PHPExcel to go in to an infinite loop and crash Apache. I am not sure what formula might be the issue though - there are quite a few to go through and having only just started\r\n with PHPExcel hoping someone might know what might be the problem.&nbsp;</p>\r\n<p>I have seen this previous discussion:</p>\r\n<p>http://phpexcel.codeplex.com/Thread/View.aspx?ThreadId=206923</p>\r\n<p>However I am trying to save to Excel 2007 and don't have any Named Formulas.</p>\r\n<p>The template file can be downloaded here:&nbsp;</p>\r\n<p>http://www.mikej.co.uk/template.xlsx</p>\r\n<p>The code that I am using to save is fairly simple:</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>$objPHPExcel = <span style=\"color:blue\">new</span> PHPExcel();\r\n\r\n$objPHPexcel = PHPExcel_IOFactory::load(<span style=\"color:#a31515\">'template.xlsx'</span>);\r\n\r\n$objWorksheet = $objPHPexcel-&gt;getActiveSheet();\r\n$objWorksheet-&gt;getCell(<span style=\"color:#a31515\">'A1'</span>)-&gt;setValue(<span style=\"color:#a31515\">'John'</span>);\r\n$objWorksheet-&gt;getCell(<span style=\"color:#a31515\">'A2'</span>)-&gt;setValue(<span style=\"color:#a31515\">'Smith'</span>);\r\n\r\n$objWriter = PHPExcel_IOFactory::createWriter($objPHPexcel, <span style=\"color:#a31515\">'Excel2007'</span>);\r\n\r\n$objWriter-&gt;save(<span style=\"color:#a31515\">'write.xlsx'</span>);</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n",
    "PostedDate": "2010-11-15T06:06:48.93-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "522120",
    "ThreadId": "234728",
    "Html": "\r\n<p>Looking at your template, it contains formulae with links to other worksheets. There were a number of issues with this in the 1.7.4 release that have since been fixed. Can you please try again with the latest SVN code (accessible through the &quot;Source Code&quot;\r\n tab on this page, then just click on the download link against the &quot;Latest Version&quot; panel on the right of the page)</p>\r\n",
    "PostedDate": "2010-11-15T06:35:28.283-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "522146",
    "ThreadId": "234728",
    "Html": "\r\n<p>Just downloaded the latest version and it is still crashing the Apache server.</p>\r\n",
    "PostedDate": "2010-11-15T07:14:59.56-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "522149",
    "ThreadId": "234728",
    "Html": "\r\n<p>This is the error that I am getting from the Apache error log:</p>\r\n<p>&nbsp;</p>\r\n<p>[Mon Nov 15 15:23:41 2010] [notice] Parent: child process exited with status 3221225477 -- Restarting.</p>\r\n",
    "PostedDate": "2010-11-15T07:24:15.263-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "522244",
    "ThreadId": "234728",
    "Html": "\r\n<blockquote style=\"border:solid .1em #ccc; font-style:italic; margin:.25em 1em 0 1em; padding:0 .25em 0 .25em\">\r\n<strong>Ekim wrote:</strong><br>\r\n<p>This is the error that I am getting from the Apache error log:</p>\r\n<p>&nbsp;</p>\r\n<p>[Mon Nov 15 15:23:41 2010] [notice] Parent: child process exited with status 3221225477 -- Restarting.</p>\r\n</blockquote>\r\n<p>&nbsp;The most common cause for this particular error,&nbsp;which is normally only generated when running on a Windows platform) is that the libmysql.dll file is in the wrong directory --&nbsp;See\r\n<a href=\"http://www.java-samples.com/showtutorial.php?tutorialid=1050\">this link </a>\r\nfor a potential fix -- although it can generated by a buggy version of any PHP module.</p>\r\n",
    "PostedDate": "2010-11-15T10:02:36.073-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "522582",
    "ThreadId": "234728",
    "Html": "\r\n<p>Ok tried that fix but it didn't help. Apache still crashes - although not every time. I wasn't sure that the above would help as I wasn't using/running MySQL at all.</p>\r\n<p>When Apache did run PHPExcel would still throw back an error, in relation to some of the formulas in the speadsheet. I tried deleting the formulas as I went to see if I could at least get the sheet written to, but once I get to a certain point Apache will\r\n crash every time with out fail - using the same error number as before.</p>\r\n<p>I have listed out each of the formulas and the PHPExcel error that is thrown back on each before they are removed from the sheet:</p>\r\n<p>FORMULA 1:<br>\r\n=INDEX(rolesrates!$1:$1048576, MATCH($A71, rolesrates!$A:$A,FALSE), MATCH($A$2, rolesrates!$1:$1,FALSE))</p>\r\n<pre><strong>Fatal error</strong>:  Uncaught exception 'Exception' with message 'frontsheet!F11 -&gt; info!F104 -&gt; info!F90 -&gt; info!F85 -&gt; info!F76 -&gt; info!D76 -&gt; estimate!C71 -&gt; estimate!C5 -&gt; Formula Error: An unexpected error occured' in C:\\xampp\\htdocs\\inc\\PHPExcel\\Cell.php:272<br>Stack trace:<br>#0 C:\\xampp\\htdocs\\inc\\PHPExcel\\Writer\\Excel2007\\Worksheet.php(964): PHPExcel_Cell-&gt;getCalculatedValue()<br>#1 C:\\xampp\\htdocs\\inc\\PHPExcel\\Writer\\Excel2007\\Worksheet.php(910): PHPExcel_Writer_Excel2007_Worksheet-&gt;_writeCell(Object(PHPExcel_Shared_XMLWriter), Object(PHPExcel_Worksheet), 'F11', Array, Array)<br>#2 C:\\xampp\\htdocs\\inc\\PHPExcel\\Writer\\Excel2007\\Worksheet.php(82): PHPExcel_Writer_Excel2007_Worksheet-&gt;_writeSheetData(Object(PHPExcel_Shared_XMLWriter), Object(PHPExcel_Worksheet), Array)<br>#3 C:\\xampp\\htdocs\\inc\\PHPExcel\\Writer\\Excel2007.php(264): PHPExcel_Writer_Excel2007_Worksheet-&gt;writeWorksheet(Object(PHPExcel_Worksheet), Array)<br>#4 C:\\xampp\\htdocs\\index.php(33): PHPExcel_Writer_Excel2007-&gt;save('write.xlsx')<br>#5 {main}<br>  thrown in <strong>C:\\xampp\\htdocs\\inc\\PHPExcel\\Cell.php</strong> on line <strong>272</strong></pre>\r\n<p>FORMULA 2:<br>\r\n=IF(data!$B$2&#43;data!$C$2 &gt; 0, SUMPRODUCT((INDIRECT(&quot;data!B&quot;&amp;data!$B$2&amp;&quot;:B&quot;&amp;data!$C$2)=$C94)*(INDIRECT(&quot;data!C&quot;&amp;data!$B$2&amp;&quot;:C&quot;&amp;data!$C$2))), 0)</p>\r\n<pre><strong>Fatal error</strong>:  Uncaught exception 'Exception' with message 'frontsheet!F12 -&gt; info!H104 -&gt; info!H102 -&gt; info!H94 -&gt; Formula Error: Unexpected ,' in C:\\xampp\\htdocs\\inc\\PHPExcel\\Cell.php:272<br>Stack trace:<br>#0 C:\\xampp\\htdocs\\inc\\PHPExcel\\Writer\\Excel2007\\Worksheet.php(964): PHPExcel_Cell-&gt;getCalculatedValue()<br>#1 C:\\xampp\\htdocs\\inc\\PHPExcel\\Writer\\Excel2007\\Worksheet.php(910): PHPExcel_Writer_Excel2007_Worksheet-&gt;_writeCell(Object(PHPExcel_Shared_XMLWriter), Object(PHPExcel_Worksheet), 'F12', Array, Array)<br>#2 C:\\xampp\\htdocs\\inc\\PHPExcel\\Writer\\Excel2007\\Worksheet.php(82): PHPExcel_Writer_Excel2007_Worksheet-&gt;_writeSheetData(Object(PHPExcel_Shared_XMLWriter), Object(PHPExcel_Worksheet), Array)<br>#3 C:\\xampp\\htdocs\\inc\\PHPExcel\\Writer\\Excel2007.php(264): PHPExcel_Writer_Excel2007_Worksheet-&gt;writeWorksheet(Object(PHPExcel_Worksheet), Array)<br>#4 C:\\xampp\\htdocs\\index.php(33): PHPExcel_Writer_Excel2007-&gt;save('write.xlsx')<br>#5 {main}<br>  thrown in <strong>C:\\xampp\\htdocs\\inc\\PHPExcel\\Cell.php</strong> on line <strong>272</strong></pre>\r\n<p>FORMULA 3:<br>\r\n=IF(data!$B$1&#43;data!$C$1 &gt; 0, SUMPRODUCT((INDIRECT(&quot;data!B&quot;&amp;data!$B$1&amp;&quot;:B&quot;&amp;data!$C$1)=$C76)*(INDIRECT(&quot;data!C&quot;&amp;data!$B$1&amp;&quot;:C&quot;&amp;data!$C$1))), 0)</p>\r\n<pre><strong>Fatal error</strong>:  Uncaught exception 'Exception' with message 'frontsheet!F12 -&gt; info!H104 -&gt; info!H90 -&gt; info!H85 -&gt; info!H76 -&gt; info!G76 -&gt; Formula Error: Unexpected ,' in C:\\xampp\\htdocs\\inc\\PHPExcel\\Cell.php:272<br>Stack trace:<br>#0 C:\\xampp\\htdocs\\inc\\PHPExcel\\Writer\\Excel2007\\Worksheet.php(964): PHPExcel_Cell-&gt;getCalculatedValue()<br>#1 C:\\xampp\\htdocs\\inc\\PHPExcel\\Writer\\Excel2007\\Worksheet.php(910): PHPExcel_Writer_Excel2007_Worksheet-&gt;_writeCell(Object(PHPExcel_Shared_XMLWriter), Object(PHPExcel_Worksheet), 'F12', Array, Array)<br>#2 C:\\xampp\\htdocs\\inc\\PHPExcel\\Writer\\Excel2007\\Worksheet.php(82): PHPExcel_Writer_Excel2007_Worksheet-&gt;_writeSheetData(Object(PHPExcel_Shared_XMLWriter), Object(PHPExcel_Worksheet), Array)<br>#3 C:\\xampp\\htdocs\\inc\\PHPExcel\\Writer\\Excel2007.php(264): PHPExcel_Writer_Excel2007_Worksheet-&gt;writeWorksheet(Object(PHPExcel_Worksheet), Array)<br>#4 C:\\xampp\\htdocs\\index.php(33): PHPExcel_Writer_Excel2007-&gt;save('write.xlsx')<br>#5 {main}<br>  thrown in <strong>C:\\xampp\\htdocs\\inc\\PHPExcel\\Cell.php</strong> on line <strong>272</strong><br></pre>\r\n<p>FORMULA 4:<br>\r\n=INDEX(rolesrates!$1:$1048576, MATCH($B2, rolesrates!$A:$A,FALSE), MATCH(estimate!$A$2, rolesrates!$1:$1,FALSE))</p>\r\n<pre><strong>Fatal error</strong>:  Uncaught exception 'Exception' with message 'people!C2 -&gt; Formula Error: An unexpected error occured' in C:\\xampp\\htdocs\\inc\\PHPExcel\\Cell.php:272<br>Stack trace:<br>#0 C:\\xampp\\htdocs\\inc\\PHPExcel\\Writer\\Excel2007\\Worksheet.php(964): PHPExcel_Cell-&gt;getCalculatedValue()<br>#1 C:\\xampp\\htdocs\\inc\\PHPExcel\\Writer\\Excel2007\\Worksheet.php(910): PHPExcel_Writer_Excel2007_Worksheet-&gt;_writeCell(Object(PHPExcel_Shared_XMLWriter), Object(PHPExcel_Worksheet), 'C2', Array, Array)<br>#2 C:\\xampp\\htdocs\\inc\\PHPExcel\\Writer\\Excel2007\\Worksheet.php(82): PHPExcel_Writer_Excel2007_Worksheet-&gt;_writeSheetData(Object(PHPExcel_Shared_XMLWriter), Object(PHPExcel_Worksheet), Array)<br>#3 C:\\xampp\\htdocs\\inc\\PHPExcel\\Writer\\Excel2007.php(264): PHPExcel_Writer_Excel2007_Worksheet-&gt;writeWorksheet(Object(PHPExcel_Worksheet), Array)<br>#4 C:\\xampp\\htdocs\\index.php(33): PHPExcel_Writer_Excel2007-&gt;save('write.xlsx')<br>#5 {main}<br>  thrown in <strong>C:\\xampp\\htdocs\\inc\\PHPExcel\\Cell.php</strong> on line <strong>272</strong></pre>\r\n<p>After this Apache crashes every time without fail - although a file is being written. The file looks right, apart from each of the worksheets has been duplicated and the name appended with a '1'.</p>\r\n<p>Any ideas what the issue might be?</p>\r\n<p>Thanks</p>\r\n<p>&nbsp;</p>\r\n",
    "PostedDate": "2010-11-16T02:09:49.99-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "522588",
    "ThreadId": "234728",
    "Html": "\r\n<p>Just tried it again with all of the above formulas removed. It didn't crash, the file that was written still had the duplicate sheets but this was output on the page:</p>\r\n<pre>Token is a named range<br>Named Range is PEOPLE<br>Token is a named range<br>Named Range is PEOPLE<br>Token is a named range<br>Named Range is PEOPLE<br>Token is a named range<br>Named Range is PEOPLE</pre>\r\n",
    "PostedDate": "2010-11-16T02:31:16.66-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "522942",
    "ThreadId": "234728",
    "Html": "\r\n<p>&lt;blush&gt;</p>\r\n<pre>Token is a named range\r\nNamed Range is PEOPLE</pre>\r\n<p>is some diagnostics that I inadvertently left in the code while testing named ranges in multibyte character sets. I've commented it out now in the SVN code.</p>\r\n<p>Using $1:$1048576 as a range won't be good for the system: PHPExcel will check every single cell between rows 1 and 1048576 (whether it exists or not) which is both a big processing and a big memory overhead, which could well cripple the web server. It might\r\n be better to restrict the range to rows that you are actually using.</p>\r\n",
    "PostedDate": "2010-11-16T14:08:29.6-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "522946",
    "ThreadId": "234728",
    "Html": "\r\n<p>I thought it might be something to do with that. I can tweak the formula to not be so heavy, will that fix all of the above formula issues do you think?</p>\r\n<p>Any ideas on why it might be producing duplicate sheets?</p>\r\n",
    "PostedDate": "2010-11-16T14:13:04.523-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "522950",
    "ThreadId": "234728",
    "Html": "\r\n<blockquote style=\"border:solid .1em #ccc; font-style:italic; margin:.25em 1em 0 1em; padding:0 .25em 0 .25em\">\r\n<strong>Ekim wrote:</strong><br>\r\n<p>I thought it might be something to do with that. I can tweak the formula to not be so heavy, will that fix all of the above formula issues do you think?</p>\r\n</blockquote>\r\n<p>&nbsp;No guarantees, but eliminating the &quot;volume of data&quot; problem would make it easier to diagnose any other problems that might exist.</p>\r\n<blockquote style=\"border:solid .1em #ccc; font-style:italic; margin:.25em 1em 0 1em; padding:0 .25em 0 .25em\">\r\n<strong>Ekim wrote:</strong><br>\r\n<p>Any ideas on why it might be producing duplicate sheets?</p>\r\n</blockquote>\r\n<p>&nbsp;No ideas at all. There is a&nbsp;<a href=\"http://phpexcel.codeplex.com/workitem/14261\">work item&nbsp;(14261)</a> raised for this, but I have never managed to replicate the problem on any of my test servers.</p>\r\n",
    "PostedDate": "2010-11-16T14:29:26.69-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "523120",
    "ThreadId": "234728",
    "Html": "\r\n<p>Ok, I did some testing. I removed all of the forumlas and it was still crashing. I think the issue was coming on some data validation that I had on one of the sheets. The next issue however was that all of the sheets were being duplicated.</p>\r\n<p>I removed all of the sheets from the template and added them one by one. The first two went in ok (although without formulas) I added in one sheet which was blank, barring they cells were filled with white, after it had been run through the script however\r\n the first row would be filled with black - which was odd.</p>\r\n<p>After I add the fifth sheet however it started duplicating all of the sheets again. I think there is something in the sheet that is creating the error. I can't find what it is yet though. Would you be interested in me sending you the file to see if you can\r\n replicate it? It's odd as although the sheet looks empty - if you try and delete the sheet excel complains that there is something you are about to delete.</p>\r\n<p>I am going to start my template from scratch I think - will make life easier.</p>\r\n<p>Thanks for your help.</p>\r\n",
    "PostedDate": "2010-11-17T02:10:03.317-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]