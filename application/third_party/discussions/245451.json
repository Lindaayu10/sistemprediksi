[
  {
    "Id": "563972",
    "ThreadId": "245451",
    "Html": "\r\n<p>Good Morning Mark;</p>\r\n<p>I read in an xls file, modify a field, and save it. This file then gets handed to a java program that tries to read the file. The java program is choking on it. (yes, I can open the modified xls file in excel and using a excel reader)</p>\r\n<p>First off, here is the php code snippet&nbsp;used to read/modify/save the xls file (pretty straightforward). Following the php snippet is 4 or 5 lines details the java complaint. It feels like some sort of&nbsp; xml file structure issue.</p>\r\n<p>Any help/guidance would be appreciated.</p>\r\n<p>thanks,<br>\r\nWalter</p>\r\n<p>===================================================================</p>\r\n<p><span style=\"font-size:x-small\"><span style=\"font-size:x-small\"><span lang=\"EN\"></p>\r\n<p>$inputFileType = PHPExcel_IOFactory::identify($newXlsFilename);</p>\r\n<p>echo &quot;XLS file is of type &quot;.$inputFileType.&quot;\\n&quot;;</p>\r\n<p>/** Create a new Reader of the type defined in $inputFileType **/</p>\r\n<p>$objReader = PHPExcel_IOFactory::createReader($inputFileType);</p>\r\n<p>/** Advise the Reader of which WorkSheets we want to load **/</p>\r\n<p>//$objReader-&gt;setLoadSheetsOnly($sheetName);</p>\r\n<p>/** Load $inputFileName to a PHPExcel Object **/</p>\r\n<p>$objPHPExcel = $objReader-&gt;load($newXlsFilename);</p>\r\n<p>//time to perform the xls modifications</p>\r\n<p>foreach($numtimes-&gt;sheetMod as $sheetMod)</p>\r\n<p>{</p>\r\n<p>$operation = strtolower($sheetMod-&gt;sheetOp[&quot;value&quot;]);</p>\r\n<p>if ($operation == &quot;chngtitle&quot;)</p>\r\n<p>{</p>\r\n<p>//cellPos has type SimpleXmlElement, so we</p>\r\n<p>//need to type cast before using it since</p>\r\n<p>//PHPExcel will take only a string</p>\r\n<p>$cellPos = $sheetMod-&gt;cellPos[&quot;value&quot;];</p>\r\n<p>settype($cellPos,&quot;string&quot;);</p>\r\n<p>$curCellVal = $objPHPExcel-&gt;getActiveSheet()-&gt;getCell($cellPos)-&gt;getValue();</p>\r\n<p>settype($curCellVal,&quot;string&quot;);</p>\r\n<p>$cellTxt = getUniqueCellVal($curCellVal);</p>\r\n<p>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($cellPos, $cellTxt);</p>\r\n<p>echo &quot;change Title Field to:&quot;.$cellTxt.&quot;\\n&quot;;</p>\r\n<p>}</p>\r\n<p>else if ($operation == &quot;insertcol&quot;)</p>\r\n<p>{</p>\r\n<p>$cellPos = $sheetMod-&gt;cellPos[&quot;value&quot;];</p>\r\n<p>settype($cellPos,&quot;string&quot;);</p>\r\n<p>$objPHPExcel-&gt;getActiveSheet()-&gt;insertNewColumnBefore($cellPos,1);</p>\r\n<p>echo &quot;column insertion:&quot;.$cellPos.&quot;\\n&quot;;</p>\r\n<p>}</p>\r\n<p>}//end foreach numtimes</p>\r\n<p>//save the modified xls file</p>\r\n<p>$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, $inputFileType);</p>\r\n<p>$objWriter-&gt;save($newXlsFilename);</p>\r\n<p>//disengage the worksheet so that it can be used</p>\r\n<p>$objPHPExcel-&gt;disconnectWorksheets();</p>\r\n<p>unset($objPHPExcel);</p>\r\n</span></span></span>\r\n<p></p>\r\n<p>==========================================================================</p>\r\n<p>The java program registers the following complaint:</p>\r\n<p><span style=\"color:#3333ff\"><span style=\"font-size:x-small\"><span style=\"font-family:georgia,serif\"><span style=\"color:#000000; font-size:13px\">&nbsp;\r\n<span style=\"font-family:Arial; font-size:x-small\"><span style=\"font-size:10pt\">[2/9/11 15:08:45:135 GMT&#43;05:30] 000024f3 SystemErr&nbsp;&nbsp;&nbsp;&nbsp; R [Fatal Error] :11:11: XML document structures must start and end within the same entity.</span></span>\r\n</p>\r\n<p><span style=\"font-family:Arial; font-size:x-small\"><span style=\"font-size:10pt\">[2/9/11 15:09:19:613 GMT&#43;05:30] 00000145 SystemErr&nbsp;&nbsp;&nbsp;&nbsp; R java.io.IOException: block[ 0 ] already removed</span></span></p>\r\n<p><span style=\"font-family:Arial; font-size:x-small\"><span style=\"font-size:10pt\">[2/9/11 15:09:19:613 GMT&#43;05:30] 00000145 SystemErr&nbsp;&nbsp;&nbsp;&nbsp; R&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.apache.poi.poifs.storage.BlockListImpl.remove(BlockListImpl.java:97)</span></span></p>\r\n<p><span style=\"font-family:Arial; font-size:x-small\"><span style=\"font-size:10pt\">[2/9/11 15:09:19:613 GMT&#43;05:30] 00000145 SystemErr&nbsp;&nbsp;&nbsp;&nbsp; R&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at org.apache.poi.poifs.storage.BlockAllocationTableReader.fetchBlocks(BlockAllocationTableReader.java:190)</span></span></p>\r\n</span></span></span></span>\r\n<p></p>\r\n",
    "PostedDate": "2011-02-10T07:11:04.18-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "564065",
    "ThreadId": "245451",
    "Html": "\r\n<p>A little more detail on this....I changed my code slightly&nbsp;to read in the xls, and simply write it out. No modification, no nothing.</p>\r\n<p>The input .xls file is 12KB, the output .xls is 14KB.....Why would the file size be different ?? Is something be prepended/appended to the file ?</p>\r\n<p>thanks,<br>\r\nWalter</p>\r\n",
    "PostedDate": "2011-02-10T09:27:55.167-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "564253",
    "ThreadId": "245451",
    "Html": "\r\n<p>First off... you refer to this as an .xls file. Unless the file extension has been changed, then .xls files are the proprietary Microsoft BIFF format (using the Excel5 Reader and Writer), which is not XML-based. I might expect this error from an Excel2007\r\n .xlsx file (which is a collection of XML documents), though I'd hope that our XML is all valid; but not from a BIFF8 .xls file. Your script actually echoes out the file type identified by the IOFactory, what value is it echoing for $inputFileType.</p>\r\n<p>Secondly... can the java program read the original file?</p>\r\n<blockquote style=\"border:solid .1em #ccc; font-style:italic; margin:.25em 1em 0 1em; padding:0 .25em 0 .25em\">\r\n<blockquote style=\"border:solid .1em #ccc; font-style:italic; margin:.25em 1em 0 1em; padding:0 .25em 0 .25em\">\r\n<strong>wakelt wrote:</strong><br>\r\n<p>A little more detail on this....I changed my code slightly&nbsp;to read in the xls, and simply write it out. No modification, no nothing.</p>\r\n<p>The input .xls file is 12KB, the output .xls is 14KB.....Why would the file size be different ?? Is something be prepended/appended to the file ?</p>\r\n</blockquote>\r\n</blockquote>\r\n<p>&nbsp;PHPExcel does not &quot;edit files&quot;. It reads in the original file, converting it to its own internal representation of a &quot;generic spreadsheet&quot;, then writes that &quot;generic spreadsheet&quot; in the appropriate format. There are certainly going to be some differences\r\n then between the input and output files.... for example, an input .xls file is likely to be codepage ASCII or codepage CP437, but will always be written as UTF-8. Features like VBA or macros are discarded by the readers (because they cannot be represented\r\n in the &quot;generic spreadsheet&quot;, so they are not able to be written, while styles may not be as cleanly optimized when they are written. In the specific case of Excel2007 files, the zip methods may not be the same when written as they were in the original file.\r\n All this means that it is quite possible for a read file and a written file to be different sizes, even if you have made no changes and are saving them in the same format.</p>\r\n",
    "PostedDate": "2011-02-10T15:04:21.587-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "564267",
    "ThreadId": "245451",
    "Html": "\r\n<div style=\"font-family:Arial; font-size:12pt; color:#000000\">\r\n<p>The $inputFileType echo'd out is excel5. </p>\r\n<p></p>\r\n<p>Yes, the java can read the original file w/o issue.</p>\r\n<p></p>\r\n<p>Any tests/experiments I could try to get to the bottom</p>\r\n<p>of this ??</p>\r\n<p></p>\r\n<p>thanks,</p>\r\n<p>walter</p>\r\n<p></p>\r\n<p>p.s. Thanks for the filesize difference explanation !!</p>\r\n<p></p>\r\n<p><br>\r\n----- Original Message -----<br>\r\nFrom: &quot;MarkBaker&quot; &lt;notifications@codeplex.com&gt;<br>\r\nTo: [email removed]<br>\r\nSent: Thursday, February 10, 2011 6:04:23 PM<br>\r\nSubject: Re: phpexcel output to java excel reader issue [PHPExcel:245451]<br>\r\n<br>\r\n</p>\r\n<p>From: MarkBaker</p>\r\n<div id=\"x_x_ThreadNotificationPostBody\">\r\n<p>First off... you refer to this as an .xls file. Unless the file extension has been changed, then .xls files are the proprietary Microsoft BIFF format (using the Excel5 Reader and Writer), which is not XML-based. I might expect this error from an Excel2007\r\n .xlsx file (which is a collection of XML documents), though I'd hope that our XML is all valid; but not from a BIFF8 .xls file. Your script actually echoes out the file type identified by the IOFactory, what value is it echoing for $inputFileType.</p>\r\n<p>Secondly... can the java program read the original file?</p>\r\n<blockquote style=\"border-bottom:#ccc 0.1em solid; border-left:#ccc 0.1em solid; padding-bottom:0px; font-style:italic; margin:0.25em 1em 0px; padding-left:0.25em; padding-right:0.25em; border-top:#ccc 0.1em solid; border-right:#ccc 0.1em solid; padding-top:0px\">\r\n<blockquote style=\"border-bottom:#ccc 0.1em solid; border-left:#ccc 0.1em solid; padding-bottom:0px; font-style:italic; margin:0.25em 1em 0px; padding-left:0.25em; padding-right:0.25em; border-top:#ccc 0.1em solid; border-right:#ccc 0.1em solid; padding-top:0px\">\r\n<strong>wakelt wrote:</strong><br>\r\n<p>A little more detail on this....I changed my code slightly to read in the xls, and simply write it out. No modification, no nothing.</p>\r\n<p>The input .xls file is 12KB, the output .xls is 14KB.....Why would the file size be different ?? Is something be prepended/appended to the file ?</p>\r\n</blockquote>\r\n</blockquote>\r\n<p>PHPExcel does not &quot;edit files&quot;. It reads in the original file, converting it to its own internal representation of a &quot;generic spreadsheet&quot;, then writes that &quot;generic spreadsheet&quot; in the appropriate format. There are certainly going to be some differences\r\n then between the input and output files.... for example, an input .xls file is likely to be codepage ASCII or codepage CP437, but will always be written as UTF-8. Features like VBA or macros are discarded by the readers (because they cannot be represented\r\n in the &quot;generic spreadsheet&quot;, so they are not able to be written, while styles may not be as cleanly optimized when they are written. In the specific case of Excel2007 files, the zip methods may not be the same when written as they were in the original file.\r\n All this means that it is quite possible for a read file and a written file to be different sizes, even if you have made no changes and are saving them in the same format.</p>\r\n</div>\r\n</div>\r\n",
    "PostedDate": "2011-02-10T16:02:28.763-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "564292",
    "ThreadId": "245451",
    "Html": "<p>If the file is BIFF8, then the error you're getting is very confusing... BIFF8 is a pure binary format, that bears about as much resemblence to XML as a ziggurat does to an aardvark.</p>\n<p>The only similar case I've come across (when reading a file using apache poi) was with an xml error message actually embedded within the xls binary... in that particular case, the error had been triggered when the file was being checked out from an SVN repository, and the xml was a dump of the SVN error. If you open the file in a text editor, can you locate any \"human-readable\" xml within the file? If so, that might give some clues.</p>",
    "PostedDate": "2011-02-10T16:36:07.62-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "564699",
    "ThreadId": "245451",
    "Html": "\r\n<div style=\"font-family:Arial; font-size:12pt; color:#000000\">\r\n<p>I have attached the orig file for you to look at. I can see readable text, can't easily</p>\r\n<p>tell if its xml or not.</p>\r\n<p></p>\r\n<p>thanks,</p>\r\n<p>walter</p>\r\n<p></p>\r\n<p><br>\r\n----- Original Message -----<br>\r\nFrom: &quot;MarkBaker&quot; &lt;notifications@codeplex.com&gt;<br>\r\nTo: [email removed]<br>\r\nSent: Thursday, February 10, 2011 7:36:09 PM<br>\r\nSubject: Re: phpexcel output to java excel reader issue [PHPExcel:245451]<br>\r\n<br>\r\n</p>\r\n<p>From: MarkBaker</p>\r\n<div id=\"x_x_ThreadNotificationPostBody\">\r\n<p>If the file is BIFF8, then the error you're getting is very confusing... BIFF8 is a pure binary format, that bears about as much resemblence to XML as a ziggurat does to an aardvark.</p>\r\n<p>The only similar case I've come across was with an xml error message actually embedded within the xls binary... in that particular case, the error had been triggered when the file was being checked out from an SVN repository, and the xml was a dump of the\r\n SVN error. If you open the file in a text editor, can you locate any &quot;human-readable&quot; xml within the file? If so, that might give some clues.</p>\r\n</div>\r\n</div>\r\n",
    "PostedDate": "2011-02-11T08:28:48.92-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "564931",
    "ThreadId": "245451",
    "Html": "<p>@walter</p>\r\n<p>Can you send the file to:</p>\r\n<div style=\"color: black; background-color: white;\">\r\n<pre>define(<span style=\"color: #a31515;\">'XX'</span>,<span style=\"color: #a31515;\">'.'</span>);\r\ndefine(<span style=\"color: #a31515;\">'YY'</span>,<span style=\"color: #a31515;\">'@'</span>);\r\n<span style=\"color: blue;\">echo</span> strrev(str_rot13(<span style=\"color: #a31515;\">'xh'</span>).XX.str_rot13(<span style=\"color: #a31515;\">'bp'</span>).XX.str_rot13(<span style=\"color: #a31515;\">'abzrq'</span>).XX.str_rot13(<span style=\"color: #a31515;\">'rtany'</span>).YY.str_rot13(<span style=\"color: #a31515;\">'xenz'</span>));\r\n</pre>\r\n</div>",
    "PostedDate": "2011-02-11T14:49:14.687-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "565092",
    "ThreadId": "245451",
    "Html": "\r\n<div>hi Mark;</div>\r\n<div><br>\r\n</div>\r\n<div>do you want me to put the input file thru this routine, or the output file? should it be done line by line?</div>\r\n<div>i am curious as to why?</div>\r\n<div><br>\r\n</div>\r\n<div>thanks,</div>\r\n<div>walter<br>\r\n<br>\r\nSent from my iPad</div>\r\n<div><br>\r\nOn Feb 11, 2011, at 5:49 PM, &quot;MarkBaker&quot; &lt;<a href=\"mailto:notifications@codeplex.com\">notifications@codeplex.com</a>&gt; wrote:<br>\r\n<br>\r\n</div>\r\n<div></div>\r\n<blockquote type=\"cite\">\r\n<div>\r\n<p>From: MarkBaker</p>\r\n<div id=\"x_x_ThreadNotificationPostBody\">\r\n<p>@walter</p>\r\n<p>Can you send the file to:</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>define(<span style=\"color:#a31515\">'XX'</span>,<span style=\"color:#a31515\">'.'</span>);\r\ndefine(<span style=\"color:#a31515\">'YY'</span>,<span style=\"color:#a31515\">'@'</span>);\r\n<span style=\"color:blue\">echo</span> strrev(str_rot13(<span style=\"color:#a31515\">'xh'</span>).XX.str_rot13(<span style=\"color:#a31515\">'bp'</span>).XX.str_rot13(<span style=\"color:#a31515\">'abzrq'</span>).XX.str_rot13(<span style=\"color:#a31515\">'rtany'</span>).YY.str_rot13(<span style=\"color:#a31515\">'xenz'</span>));\r\n</pre>\r\n</div>\r\n</div>\r\n</div>\r\n</blockquote>\r\n",
    "PostedDate": "2011-02-12T04:58:48.057-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "565094",
    "ThreadId": "245451",
    "Html": "<p>That little routine will (if run as a PHP script) simply echo my e-mail address (I'm not going to write it in plain text... I don't want automated email address harvesters to pick it up so I get even more spam in my mailbox).</p>",
    "PostedDate": "2011-02-12T05:04:14.663-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "567936",
    "ThreadId": "245451",
    "Html": "TWFyaywgSSBzZW50IHRoZSAyIGZpbGVzIHRvIHlvdXIgcHJpdmF0ZSBlbWFpbCBhZGRyZXNzLiAg<br>\r\nVGh4IHdhbHRlcg0KLS0tLS0tT3JpZ2luYWwgTWVzc2FnZS0tLS0tLQ0KRnJvbTogTWFya0Jha2Vy<br>\r\nDQpUbzogd2FrZWx0QGNvbWNhc3QubmV0DQpSZXBseVRvOiBQSFBFeGNlbEBkaXNjdXNzaW9ucy5j<br>\r\nb2RlcGxleC5jb20NClN1YmplY3Q6IFJlOiBwaHBleGNlbCBvdXRwdXQgdG8gamF2YSBleGNlbCBy<br>\r\nZWFkZXIgaXNzdWUgW1BIUEV4Y2VsOjI0NTQ1MV0NClNlbnQ6IEZlYiAxMCwgMjAxMSA3OjM2IFBN<br>\r\nDQoNCkZyb206IE1hcmtCYWtlcg0KSWYgdGhlIGZpbGUgaXMgQklGRjgsIHRoZW4gdGhlIGVycm9y<br>\r\nIHlvdSdyZSBnZXR0aW5nIGlzIHZlcnkgY29uZnVzaW5nLi4uIEJJRkY4IGlzIGEgcHVyZSBiaW5h<br>\r\ncnkgZm9ybWF0LCB0aGF0IGJlYXJzIGFib3V0IGFzIG11Y2ggcmVzZW1ibGVuY2UgdG8gWE1MIGFz<br>\r\nIGEgemlnZ3VyYXQgZG9lcyB0byBhbiBhYXJkdmFyay4NClRoZSBvbmx5IHNpbWlsYXIgY2FzZSBJ<br>\r\nJ3ZlIGNvbWUgYWNyb3NzIHdhcyB3aXRoIGFuIHhtbCBlcnJvciBtZXNzYWdlIGFjdHVhbGx5IGVt<br>\r\nYmVkZGVkIHdpdGhpbiB0aGUgeGxzIGJpbmFyeS4uLiBpbiB0aGF0IHBhcnRpY3VsYXIgY2FzZSwg<br>\r\ndGhlIGVycm9yIGhhZCBiZWVuIHRyaWdnZXJlZCB3aGVuIHRoZSBmaWxlIHdhcyBiZWluZyBjaGVj<br>\r\na2VkIG91dCBmcm9tIGFuIFNWTiByZXBvc2l0b3J5LCBhbmQgdGhlIHhtbCB3YXMgYSBkdW1wIG9m<br>\r\nIHRoZSBTVk4gZXJyb3IuIElmIHlvdSBvcGVuIHRoZSBmaWxlIGluIGEgdGV4dCBlZGl0b3IsIGNh<br>\r\nbiB5b3UgbG9jYXRlIGFueSAiaHVtYW4tcmVhZGFibGUiIHhtbCB3aXRoaW4gdGhlIGZpbGU/IElm<br>\r\nIHNvLCB0aGF0IG1pZ2h0IGdpdmUgc29tZSBjbHVlcy4NClJlYWQgdGhlIGZ1bGwgZGlzY3Vzc2lv<br>\r\nbiBvbmxpbmUuDQpUbyBhZGQgYSBwb3N0IHRvIHRoaXMgZGlzY3Vzc2lvbiwgcmVwbHkgdG8gdGhp<br>\r\ncyBlbWFpbCAoUEhQRXhjZWxAZGlzY3Vzc2lvbnMuY29kZXBsZXguY29tKQ0KVG8gc3RhcnQgYSBu<br>\r\nZXcgZGlzY3Vzc2lvbiBmb3IgdGhpcyBwcm9qZWN0LCBlbWFpbCBQSFBFeGNlbEBkaXNjdXNzaW9u<br>\r\ncy5jb2RlcGxleC5jb20NCllvdSBhcmUgcmVjZWl2aW5nIHRoaXMgZW1haWwgYmVjYXVzZSB5b3Ug<br>\r\nc3Vic2NyaWJlZCB0byB0aGlzIGRpc2N1c3Npb24gb24gQ29kZVBsZXguIFlvdSBjYW4gdW5zdWJz<br>\r\nY3JpYmUgb24gQ29kZVBsZXguY29tLg0KUGxlYXNlIG5vdGU6IEltYWdlcyBhbmQgYXR0YWNobWVu<br>\r\ndHMgd2lsbCBiZSByZW1vdmVkIGZyb20gZW1haWxzLiBBbnkgcG9zdHMgdG8gdGhpcyBkaXNjdXNz<br>\r\naW9uIHdpbGwgYWxzbyBiZSBhdmFpbGFibGUgb25saW5lIGF0IENvZGVQbGV4LmNvbQ0KDQpTZW50<br>\r\nIHZpYSBCbGFja0JlcnJ5IGJ5IEFUJlQ=",
    "PostedDate": "2011-02-17T08:09:18.42-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "568243",
    "ThreadId": "245451",
    "Html": "<p>I can't see any problem with your file: there's certainly no XML messages embedded in it; so I don't understand why POI should be complaining about invalid XML. Is it possible to debug this from the java side?</p>",
    "PostedDate": "2011-02-17T16:01:20.793-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "568598",
    "ThreadId": "245451",
    "Html": "\r\n<div style=\"font-family:Arial; font-size:12pt; color:#000000\">\r\n<div style=\"font-family:Arial; color:#000000; font-size:12pt\">\r\n<p>Hi Mark;</p>\r\n<p></p>\r\n<p>unfortunately, I have NO exposure to the actual java code. </p>\r\n<p></p>\r\n<p>I have done a little homework on the POI library.. POI supports BIFF8 and OOXML.\r\n</p>\r\n<p>Perhaps I need to use a different PhpExcel writer so that my output file would be either</p>\r\n<p>of these. Does PhpExcel have a writer that puts out either of these formats ?? Perhaps</p>\r\n<p>the java implementation only supports OOXML ??</p>\r\n<p></p>\r\n<p>thanks,</p>\r\n<p>walter</p>\r\n<p><br>\r\n----- Original Message -----<br>\r\nFrom: &quot;MarkBaker&quot; &lt;notifications@codeplex.com&gt;<br>\r\nTo: [email removed]<br>\r\nSent: Thursday, February 17, 2011 7:01:28 PM<br>\r\nSubject: Re: phpexcel output to java excel reader issue [PHPExcel:245451]<br>\r\n<br>\r\n</p>\r\n<p>From: MarkBaker</p>\r\n<div id=\"x_x_ThreadNotificationPostBody\">\r\n<p>I can't see any problem with your file: there's certainly no XML messages embedded in it; so I don't understand why POI should be complaining about invalid XML. Is it possible to debug this from the java side?</p>\r\n</div>\r\n</div>\r\n</div>\r\n",
    "PostedDate": "2011-02-18T08:18:07.99-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "568610",
    "ThreadId": "245451",
    "Html": "<p>The Excel5 Writer generates a BIFF8 file by default (it could be configured to write BIFF5, but this has been disabled for some time). The Excel2007 Writer generates OOXML.</p>",
    "PostedDate": "2011-02-18T08:31:48.373-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "569792",
    "ThreadId": "245451",
    "Html": "\r\n<div style=\"font-family:Arial; font-size:12pt; color:#000000\">\r\n<p>Hi Mark;</p>\r\n<p></p>\r\n<p>I've decided to use the POI example code to read in the original xls final, and then</p>\r\n<p>to read in the xls output file of PhpExcel. I have this up and running in eclipse.</p>\r\n<p></p>\r\n<p>The original file reads in fine...All rows and field values are printed out correctly.</p>\r\n<p>No warnings, no Errors.</p>\r\n<p></p>\r\n<p>I then use the PHPexcel BIFF output file as a source file to the same java Excel reader.\r\n</p>\r\n<p>I do indeed get errors that cause the reader to throw exceptions. The warning message</p>\r\n<p>looks as follows:</p>\r\n<p></p>\r\n<font color=\"#ff0000\" size=\"2\"><font color=\"#ff0000\" size=\"2\">\r\n<p align=\"left\">Warning, incorrectly terminated empty data blocks in POIFS block listing (should end at -2, ended at 0)</p>\r\n</font></font><u><font color=\"#000080\" size=\"2\"><font color=\"#000080\" size=\"2\">\r\n<p align=\"left\">java.lang.NullPointerException</p>\r\n</u></font></font><font color=\"#ff0000\" size=\"2\"><font color=\"#ff0000\" size=\"2\">\r\n<p align=\"left\">at org.apache.poi.poifs.filesystem.DocumentInputStream.readUShort(</font></font><u><font color=\"#000080\" size=\"2\"><font color=\"#000080\" size=\"2\">DocumentInputStream.java:301</u></font></font><font color=\"#ff0000\" size=\"2\"><font color=\"#ff0000\" size=\"2\">)</p>\r\n<p align=\"left\">at org.apache.poi.hssf.record.RecordInputStream$SimpleHeaderInput.readRecordSID(</font></font><u><font color=\"#000080\" size=\"2\"><font color=\"#000080\" size=\"2\">RecordInputStream.java:98</u></font></font><font color=\"#ff0000\" size=\"2\"><font color=\"#ff0000\" size=\"2\">)</p>\r\n<p align=\"left\">at org.apache.poi.hssf.record.RecordInputStream.readNextSid(</font></font><u><font color=\"#000080\" size=\"2\"><font color=\"#000080\" size=\"2\">RecordInputStream.java:177</u></font></font><font color=\"#ff0000\" size=\"2\"><font color=\"#ff0000\" size=\"2\">)</p>\r\n<p align=\"left\">at org.apache.poi.hssf.record.RecordInputStream.&lt;init&gt;(</font></font><u><font color=\"#000080\" size=\"2\"><font color=\"#000080\" size=\"2\">RecordInputStream.java:115</u></font></font><font color=\"#ff0000\" size=\"2\"><font color=\"#ff0000\" size=\"2\">)</p>\r\n<p align=\"left\">at org.apache.poi.hssf.record.RecordInputStream.&lt;init&gt;(</font></font><u><font color=\"#000080\" size=\"2\"><font color=\"#000080\" size=\"2\">RecordInputStream.java:103</u></font></font><font color=\"#ff0000\" size=\"2\"><font color=\"#ff0000\" size=\"2\">)</p>\r\n<p align=\"left\">at org.apache.poi.hssf.record.RecordFactoryInputStream.&lt;init&gt;(</font></font><u><font color=\"#000080\" size=\"2\"><font color=\"#000080\" size=\"2\">RecordFactoryInputStream.java:165</u></font></font><font color=\"#ff0000\" size=\"2\"><font color=\"#ff0000\" size=\"2\">)</p>\r\n<p align=\"left\">at org.apache.poi.hssf.record.RecordFactory.createRecords(</font></font><u><font color=\"#000080\" size=\"2\"><font color=\"#000080\" size=\"2\">RecordFactory.java:439</u></font></font><font color=\"#ff0000\" size=\"2\"><font color=\"#ff0000\" size=\"2\">)</p>\r\n<p align=\"left\">at org.apache.poi.hssf.usermodel.HSSFWorkbook.&lt;init&gt;(</font></font><u><font color=\"#000080\" size=\"2\"><font color=\"#000080\" size=\"2\">HSSFWorkbook.java:263</u></font></font><font color=\"#ff0000\" size=\"2\"><font color=\"#ff0000\" size=\"2\">)</p>\r\n<p align=\"left\">at org.apache.poi.hssf.usermodel.HSSFWorkbook.&lt;init&gt;(</font></font><u><font color=\"#000080\" size=\"2\"><font color=\"#000080\" size=\"2\">HSSFWorkbook.java:188</u></font></font><font color=\"#ff0000\" size=\"2\"><font color=\"#ff0000\" size=\"2\">)</p>\r\n<p align=\"left\">at org.apache.poi.hssf.usermodel.HSSFWorkbook.&lt;init&gt;(</font></font><u><font color=\"#000080\" size=\"2\"><font color=\"#000080\" size=\"2\">HSSFWorkbook.java:305</u></font></font><font color=\"#ff0000\" size=\"2\"><font color=\"#ff0000\" size=\"2\">)</p>\r\n<p align=\"left\">at org.apache.poi.hssf.usermodel.HSSFWorkbook.&lt;init&gt;(</font></font><u><font color=\"#000080\" size=\"2\"><font color=\"#000080\" size=\"2\">HSSFWorkbook.java:286</u></font></font><font color=\"#ff0000\" size=\"2\"><font color=\"#ff0000\" size=\"2\">)</p>\r\n<p align=\"left\">at excel.ExcelReadWrite.readFile(</font></font><u><font color=\"#000080\" size=\"2\"><font color=\"#000080\" size=\"2\">ExcelReadWrite.java:33</u></font></font><font color=\"#ff0000\" size=\"2\"><font color=\"#ff0000\" size=\"2\">)</p>\r\n<p align=\"left\">at excel.ExcelReadWrite.main(</font></font><u><font color=\"#000080\" size=\"2\"><font color=\"#000080\" size=\"2\">ExcelReadWrite.java:140</u></font></font><font color=\"#ff0000\" size=\"2\"><font color=\"#ff0000\" size=\"2\">)</p>\r\n</font></font>\r\n<p></p>\r\n<p>At this point, we can debug in the Java world since I have the code up and running.</p>\r\n<p>However, I am not versed in the processing of Excel sheets, perhaps the warning</p>\r\n<p>message is meaningful to you ??</p>\r\n<p></p>\r\n<p>-Walter</p>\r\n<p></p>\r\n<p><br>\r\n----- Original Message -----<br>\r\nFrom: &quot;MarkBaker&quot; &lt;notifications@codeplex.com&gt;<br>\r\nTo: [email removed]<br>\r\nSent: Friday, February 18, 2011 11:31:58 AM<br>\r\nSubject: Re: phpexcel output to java excel reader issue [PHPExcel:245451]<br>\r\n<br>\r\n</p>\r\n<p>From: MarkBaker</p>\r\n<div id=\"x_x_ThreadNotificationPostBody\">\r\n<p>The Excel5 Writer generates a BIFF8 file by default (it could be configured to write BIFF5, but this has been disabled for some time). The Excel2007 Writer generates OOXML.</p>\r\n</div>\r\n</div>\r\n",
    "PostedDate": "2011-02-21T12:23:38.097-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "569850",
    "ThreadId": "245451",
    "Html": "<p>I'm going to have to accept that this has defeated me. I don't know what those messages mean.</p>\r\n<p>Without spending time wading through the java poi code to find out how that works, I don't believe I can do much about this... I just don't have that time.</p>",
    "PostedDate": "2011-02-21T14:11:46.233-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "569868",
    "ThreadId": "245451",
    "Html": "\r\n<div>no problem...i wish there was more i could do to help u get to the bottom of this. if there</div>\r\n<div>is legwork you'd like me to perform, please let me know. </div>\r\n<div><br>\r\n</div>\r\n<div>i really appreciate your efforts on this. now that i have the java poi library up and running, i can use it to make the spreadsheet mods. i've modified the example code to do what i need and things seem to look good.\r\n</div>\r\n<div><br>\r\n</div>\r\n<div>thanks</div>\r\n<div>walter</div>\r\n<div><br>\r\nSent from my iPad</div>\r\n<div><br>\r\nOn Feb 21, 2011, at 5:11 PM, &quot;MarkBaker&quot; &lt;<a href=\"mailto:notifications@codeplex.com\">notifications@codeplex.com</a>&gt; wrote:<br>\r\n<br>\r\n</div>\r\n<div></div>\r\n<blockquote type=\"cite\">\r\n<div>\r\n<p>From: MarkBaker</p>\r\n<div id=\"x_x_ThreadNotificationPostBody\">\r\n<p>I'm going to have to accept that this has defeated me. I don't know what those messages mean.</p>\r\n<p>Without spending time wading through the java poi code to find out how that works, I don't believe I can do much about this... I just don't have that time.</p>\r\n</div>\r\n</div>\r\n</blockquote>\r\n",
    "PostedDate": "2011-02-21T14:36:07.963-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "584951",
    "ThreadId": "245451",
    "Html": "<p>I found the same issue with a small sample program - The strange thing is that if I open the output file in MS Excel and save it that the file size doubles form 7 to 15 KB.</p>\r\n<p>Also the latest java library has the issue - but now the error message is different.<br />Warning, incorrectly terminated empty data blocks in POIFS block listing (should end at -2, ended at 0) - may be this helps</p>\r\n<p>Here the code if anybody wants to look at it:</p>\r\n<p>&lt;?php</p>\r\n<p>require_once('PHPExcel.php');<br />require_once('PHPExcel/IOFactory.php');</p>\r\n<p>// see also<br />// <a href=\"http://phpexcel.codeplex.com/discussions/209438\">http://phpexcel.codeplex.com/discussions/209438</a><br />// <a href=\"http://phpexcel.codeplex.com/discussions/245451\">http://phpexcel.codeplex.com/discussions/245451</a><br />// <a href=\"http://phpexcel.codeplex.com/discussions/235968\">http://phpexcel.codeplex.com/discussions/235968</a></p>\r\n<p>$objPHPExcel&nbsp; = new PHPExcel();</p>\r\n<p>$ExcelSheet = $objPHPExcel-&gt;getActiveSheet();</p>\r\n<p>$ExcelSheet-&gt;setTitle(\"2002\");</p>\r\n<p>$ExcelSheet-&gt;setCellValue(\"A1\", \"Code\");<br />$ExcelSheet-&gt;setCellValue(\"B1\", \"FooBar\");</p>\r\n<p>$objPHPExcel-&gt;setActiveSheetIndex(0);&nbsp;&nbsp;&nbsp;</p>\r\n<p>$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');&nbsp;&nbsp;</p>\r\n<p>$objWriter-&gt;save(\"Output.xls\");</p>\r\n<p>?&gt;</p>",
    "PostedDate": "2011-03-23T04:47:59.647-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "584966",
    "ThreadId": "245451",
    "Html": "On 23/03/2011 11:48, pircher wrote:<br>\r\n<blockquote type=\"cite\">I found the same issue with a small sample program - The strange thing is that if I open the output file in MS Excel and save it that the file size doubles form 7 to 15 KB.</blockquote>\r\nThe filesize change shouldn't be a worry: PHPExcel uses always certain optimisation techniques when writing the file, which aren't always used by Excel itself. These don't cause any problem in and of themselves. There are also certain blocks of data written\r\n by Excel itself that aren't supported by PHPExcel. Again, these should not cause any issues.<br>\r\n<br>\r\n<blockquote type=\"cite\">\r\n<div id=\"x_x_ThreadNotificationPostBody\">\r\n<p>Also the latest java library has the issue - but now the error message is different.<br>\r\nWarning, incorrectly terminated empty data blocks in POIFS block listing (should end at -2, ended at 0) - may be this helps</p>\r\n</div>\r\n</blockquote>\r\n<div id=\"x_x_ThreadNotificationPostBody\"><br>\r\nI believe that this may be related to the following issue recorded on the MS support site:<br>\r\n<a href=\"http://support.microsoft.com/kb/2411912\">http://support.microsoft.com/kb/2411912</a><br>\r\nwhich has been raised as Issue 15508 (<a href=\"http://phpexcel.codeplex.com/workitem/15508\">http://phpexcel.codeplex.com/workitem/15508</a>) in the PHPExcel Issue Tracker.<br>\r\n<br>\r\nBasically, the workbook data is written as a series of numbered &quot;blocks&quot; of data, with an index that lists each block. Most Excel library software (and most versions of Excel itself) simply reads the list of blocks from that index, then reads each listed block\r\n in turn; but Apache POI (and MS Excel2007&#43; on Windows 7) do an additional validation check on the actual block numbers.<br>\r\n<br>\r\nIt looks as though Apache POI has updated its error handling for this... at least the error is more meaningful now.<br>\r\n<br>\r\nI've traced this back to the underlying PHP_OLE library that actually writes the OLE directory/filestream structure for the Excel workbook substreams, but haven't yet managed to isolate exactly where in the code the fault lies, or how to fix it. However, this\r\n part of the PHPExcel xls Writer does need some refactoring<font color=\"#cc0000\">(1)</font> so that it can support multiple filestreams (e.g. the workbook properties streams, chart streams, etc)... the original PHP_OLE library only supported a single filestream,\r\n which is used for the actual workbook data.<br>\r\nI may find a solution to the block numbering soon: but if not, it will be fixed when I do that necessary rewrite of PHP_OLE.<br>\r\n<br>\r\n---<br>\r\nMark Baker<br>\r\n<br>\r\n<font color=\"#cc0000\">(1)</font> For &quot;some refactoring&quot;, read &quot;a total rewrite from scratch&quot;.<br>\r\n</div>\r\n",
    "PostedDate": "2011-03-23T05:39:51.257-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]