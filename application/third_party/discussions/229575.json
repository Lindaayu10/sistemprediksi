[
  {
    "Id": "502153",
    "ThreadId": "229575",
    "Html": "<p>Can someone please take a look and see if there is any way to improve this - it is taking&nbsp;a while&nbsp;to run&nbsp;and sometimes timing out</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:black;background-color:white\">\r\n<pre>&lt;?php\r\n\r\n\r\n<span style=\"color:green\">/** Error reporting */</span>\r\nerror_reporting(E_ALL);\r\nini_set(<span style=\"color:#a31515\">'display_errors'</span>,TRUE);\r\nini_set(<span style=\"color:#a31515\">&quot;memory_limit&quot;</span>,<span style=\"color:#a31515\">&quot;200M&quot;</span>);\r\n\r\ndate_default_timezone_set(<span style=\"color:#a31515\">'Europe/London'</span>);\r\n\r\n<span style=\"color:green\">/** PHPExcel */</span>\r\n<span style=\"color:blue\">require_once</span> <span style=\"color:#a31515\">'../../includes/PHPExcel.php'</span>;\r\n<span style=\"color:blue\">include</span> (<span style=\"color:#a31515\">&quot;../../../config.php&quot;</span>);\r\n\r\n<span style=\"color:green\">// Create new PHPExcel object</span>\r\n$objPHPExcel = <span style=\"color:blue\">new</span> PHPExcel();\r\n\r\n<span style=\"color:green\">// Set properties</span>\r\n$objPHPExcel-&gt;getProperties()-&gt;setCreator(<span style=\"color:#a31515\">&quot;David Morrison&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setLastModifiedBy(<span style=\"color:#a31515\">&quot;David Morrison&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setTitle(<span style=\"color:#a31515\">&quot;Bacs and Suspense Master&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setSubject(<span style=\"color:#a31515\">&quot;Bacs and Suspense Master&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setDescription(<span style=\"color:#a31515\">&quot;Contains a list of all allocated and unallocated payments.&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setKeywords(<span style=\"color:#a31515\">&quot;office 2007 openxml php&quot;</span>)\r\n\t\t\t\t\t\t\t -&gt;setCategory(<span style=\"color:#a31515\">&quot;Master Book&quot;</span>);\r\n\r\n$repInfo = mysql_query(<span style=\"color:#a31515\">&quot;SELECT * FROM unallData WHERE status = 'UNALLOCATED' AND companyNo = '1' AND type = 'SOM'&quot;</span>);\r\n\r\n$objPHPExcel-&gt;setActiveSheetIndex(0)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;A1&quot;</span>, <span style=\"color:#a31515\">'Date'</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;B1&quot;</span>, <span style=\"color:#a31515\">'Notes'</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;C1&quot;</span>, <span style=\"color:#a31515\">'Amount'</span>);\r\n\r\n<span style=\"color:green\">// Do the sql query and output</span>\r\n$i =2;\r\n<span style=\"color:blue\">while</span> ($info = mysql_fetch_array($repInfo, MYSQL_ASSOC)){\r\n$amount = $info[<span style=\"color:#a31515\">'amount'</span>];\r\n$objPHPExcel-&gt;setActiveSheetIndex(0)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;A$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info['date']}&quot;</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;B$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info['notes']}&quot;</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;C$i&quot;</span>, substr(<span style=\"color:#a31515\">&quot;$amount&quot;</span>,1));\r\n$i = $i + 1;\r\n}\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle(<span style=\"color:#a31515\">'SOM'</span>);\r\n\r\n<span style=\"color:green\">// Create new sheet and output</span>\r\n$objPHPExcel-&gt;createSheet();\r\n$objPHPExcel-&gt;setActiveSheetIndex(1);\r\n$objPHPExcel-&gt;getActiveSheet(1)-&gt;setTitle(<span style=\"color:#a31515\">'CHEQUES'</span>);\r\n\r\n$repInfo = mysql_query(<span style=\"color:#a31515\">&quot;SELECT * FROM unallData WHERE status = 'UNALLOCATED' AND companyNo = '1' AND type = 'CHEQUES'&quot;</span>);\r\n\r\n$objPHPExcel-&gt;setActiveSheetIndex(1)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;A1&quot;</span>, <span style=\"color:#a31515\">'Date'</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;B1&quot;</span>, <span style=\"color:#a31515\">'Notes'</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;C1&quot;</span>, <span style=\"color:#a31515\">'Amount'</span>);\r\n\r\n$i =2;\r\n\r\n<span style=\"color:blue\">while</span> ($info = mysql_fetch_array($repInfo, MYSQL_ASSOC)){\r\n\r\n$amount = $info[<span style=\"color:#a31515\">'amount'</span>];\r\n$objPHPExcel-&gt;setActiveSheetIndex(1)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;A$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info['date']}&quot;</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;B$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info['notes']}&quot;</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;C$i&quot;</span>, substr(<span style=\"color:#a31515\">&quot;$amount&quot;</span>,1));\r\n$i = $i + 1;\r\n}\r\n\r\n\r\n<span style=\"color:green\">// Create new sheet and output</span>\r\n$objPHPExcel-&gt;createSheet();\r\n$objPHPExcel-&gt;setActiveSheetIndex(2);\r\n$objPHPExcel-&gt;getActiveSheet(2)-&gt;setTitle(<span style=\"color:#a31515\">'BACS'</span>);\r\n\r\n$repInfo = mysql_query(<span style=\"color:#a31515\">&quot;SELECT * FROM unallData WHERE status = 'UNALLOCATED' AND companyNo = '1' AND type = 'BACS'&quot;</span>);\r\n\r\n$objPHPExcel-&gt;setActiveSheetIndex(2)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;A1&quot;</span>, <span style=\"color:#a31515\">'Date'</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;B1&quot;</span>, <span style=\"color:#a31515\">'Notes'</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;C1&quot;</span>, <span style=\"color:#a31515\">'Amount'</span>);\r\n\r\n$i =2;\r\n\r\n<span style=\"color:blue\">while</span> ($info = mysql_fetch_array($repInfo, MYSQL_ASSOC)){\r\n\r\n$amount = $info[<span style=\"color:#a31515\">'amount'</span>];\r\n$objPHPExcel-&gt;setActiveSheetIndex(2)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;A$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info['date']}&quot;</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;B$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info['notes']}&quot;</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;C$i&quot;</span>, substr(<span style=\"color:#a31515\">&quot;$amount&quot;</span>,1));\r\n$i = $i + 1;\r\n}\r\n\r\n\r\n<span style=\"color:green\">// Create new sheet and output</span>\r\n$objPHPExcel-&gt;createSheet();\r\n$objPHPExcel-&gt;setActiveSheetIndex(3);\r\n$objPHPExcel-&gt;getActiveSheet(3)-&gt;setTitle(<span style=\"color:#a31515\">'PO'</span>);\r\n\r\n$repInfo = mysql_query(<span style=\"color:#a31515\">&quot;SELECT * FROM unallData WHERE status = 'UNALLOCATED' AND companyNo = '1' AND type = 'PO'&quot;</span>);\r\n\r\n$objPHPExcel-&gt;setActiveSheetIndex(3)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;A1&quot;</span>, <span style=\"color:#a31515\">'Date'</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;B1&quot;</span>, <span style=\"color:#a31515\">'Notes'</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;C1&quot;</span>, <span style=\"color:#a31515\">'Amount'</span>);\r\n\r\n$i =2;\r\n<span style=\"color:blue\">while</span> ($info = mysql_fetch_array($repInfo, MYSQL_ASSOC)){\r\n\r\n$amount = $info[<span style=\"color:#a31515\">'amount'</span>];\r\n$objPHPExcel-&gt;setActiveSheetIndex(3)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;A$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info['date']}&quot;</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;B$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info['notes']}&quot;</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;C$i&quot;</span>, substr(<span style=\"color:#a31515\">&quot;$amount&quot;</span>,1));\r\n$i = $i + 1;\r\n}\r\n\r\n<span style=\"color:green\">// Create new sheet and output</span>\r\n$objPHPExcel-&gt;createSheet();\r\n$objPHPExcel-&gt;setActiveSheetIndex(4);\r\n$objPHPExcel-&gt;getActiveSheet(4)-&gt;setTitle(<span style=\"color:#a31515\">'CASH'</span>);\r\n\r\n$repInfo = mysql_query(<span style=\"color:#a31515\">&quot;SELECT * FROM unallData WHERE status = 'UNALLOCATED' AND companyNo = '1' AND type = 'CASH'&quot;</span>);\r\n\r\n$objPHPExcel-&gt;setActiveSheetIndex(4)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;A1&quot;</span>, <span style=\"color:#a31515\">'Date'</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;B1&quot;</span>, <span style=\"color:#a31515\">'Notes'</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;C1&quot;</span>, <span style=\"color:#a31515\">'Amount'</span>);\r\n\r\n$i =2;\r\n<span style=\"color:blue\">while</span> ($info = mysql_fetch_array($repInfo, MYSQL_ASSOC)){\r\n\r\n$amount = $info[<span style=\"color:#a31515\">'amount'</span>];\r\n$objPHPExcel-&gt;setActiveSheetIndex(4)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;A$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info['date']}&quot;</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;B$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info['notes']}&quot;</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;C$i&quot;</span>, substr(<span style=\"color:#a31515\">&quot;$amount&quot;</span>,1));\r\n$i = $i + 1;\r\n}\r\n\r\n<span style=\"color:green\">// Create new sheet and output</span>\r\n$objPHPExcel-&gt;createSheet();\r\n$objPHPExcel-&gt;setActiveSheetIndex(5);\r\n$objPHPExcel-&gt;getActiveSheet(5)-&gt;setTitle(<span style=\"color:#a31515\">'ALLPAY'</span>);\r\n\r\n$repInfo = mysql_query(<span style=\"color:#a31515\">&quot;SELECT * FROM unallData WHERE status = 'UNALLOCATED' AND companyNo = '1' AND type = 'ALLPAY'&quot;</span>);\r\n\r\n$objPHPExcel-&gt;setActiveSheetIndex(5)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;A1&quot;</span>, <span style=\"color:#a31515\">'Date'</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;B1&quot;</span>, <span style=\"color:#a31515\">'Notes'</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;C1&quot;</span>, <span style=\"color:#a31515\">'Amount'</span>);\r\n\r\n$i =2;\r\n<span style=\"color:blue\">while</span> ($info = mysql_fetch_array($repInfo, MYSQL_ASSOC)){\r\n\r\n$amount = $info[<span style=\"color:#a31515\">'amount'</span>];\r\n$objPHPExcel-&gt;setActiveSheetIndex(5)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;A$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info['date']}&quot;</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;B$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info['notes']}&quot;</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;C$i&quot;</span>, substr(<span style=\"color:#a31515\">&quot;$amount&quot;</span>,1));\r\n$i = $i + 1;\r\n}\r\n\r\n<span style=\"color:green\">// Create new sheet and output</span>\r\n$objPHPExcel-&gt;createSheet();\r\n$objPHPExcel-&gt;setActiveSheetIndex(6);\r\n$objPHPExcel-&gt;getActiveSheet(6)-&gt;setTitle(<span style=\"color:#a31515\">'CARD'</span>);\r\n\r\n$repInfo = mysql_query(<span style=\"color:#a31515\">&quot;SELECT * FROM unallData WHERE status = 'UNALLOCATED' AND companyNo = '1' AND type = 'CARD'&quot;</span>);\r\n\r\n$objPHPExcel-&gt;setActiveSheetIndex(6)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;A1&quot;</span>, <span style=\"color:#a31515\">'Date'</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;B1&quot;</span>, <span style=\"color:#a31515\">'Notes'</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;C1&quot;</span>, <span style=\"color:#a31515\">'Amount'</span>);\r\n\r\n$i =2;\r\n<span style=\"color:blue\">while</span> ($info = mysql_fetch_array($repInfo, MYSQL_ASSOC)){\r\n\r\n$amount = $info[<span style=\"color:#a31515\">'amount'</span>];\r\n$objPHPExcel-&gt;setActiveSheetIndex(6)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;A$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info['date']}&quot;</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;B$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info['notes']}&quot;</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;C$i&quot;</span>, substr(<span style=\"color:#a31515\">&quot;$amount&quot;</span>,1));\r\n$i = $i + 1;\r\n}\r\n\r\n\r\n<span style=\"color:green\">// Create new sheet and output</span>\r\n$objPHPExcel-&gt;createSheet();\r\n$objPHPExcel-&gt;setActiveSheetIndex(7);\r\n$objPHPExcel-&gt;getActiveSheet(7)-&gt;setTitle(<span style=\"color:#a31515\">'ALLOCATED'</span>);\r\n\r\n$repInfo = mysql_query(<span style=\"color:#a31515\">&quot;SELECT * FROM unallData WHERE status = 'ALLOCATED' AND companyNo = '1' AND order by type&quot;</span>);\r\n\r\n\r\n$objPHPExcel-&gt;setActiveSheetIndex(7)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;A1&quot;</span>, <span style=\"color:#a31515\">'Date'</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;B1&quot;</span>, <span style=\"color:#a31515\">'Notes'</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;C1&quot;</span>, <span style=\"color:#a31515\">'Amount'</span>)\r\n\t\t\t-&gt;setCellValue(<span style=\"color:#a31515\">&quot;D1&quot;</span>, <span style=\"color:#a31515\">'Collector'</span>)\r\n\t\t\t-&gt;setCellValue(<span style=\"color:#a31515\">&quot;E1&quot;</span>, <span style=\"color:#a31515\">'Allocated to'</span>)\r\n\t\t\t-&gt;setCellValue(<span style=\"color:#a31515\">&quot;F1&quot;</span>, <span style=\"color:#a31515\">'Type'</span>)\r\n\t\t\t-&gt;setCellValue(<span style=\"color:#a31515\">&quot;G1&quot;</span>, <span style=\"color:#a31515\">'Date allocation was requested'</span>);\r\n\r\n$i =2;\r\n<span style=\"color:blue\">while</span> ($info = mysql_fetch_array($repInfo, MYSQL_ASSOC)){\r\n$repInfo2 = mysql_query(<span style=\"color:#a31515\">&quot;SELECT * FROM susdata WHERE unallDataID = '{$info['id']}' AND companyNo = '1'&quot;</span>);\r\n$info2 = mysql_fetch_array($repInfo2, MYSQL_ASSOC);\r\n\r\n$amount = $info[<span style=\"color:#a31515\">'amount'</span>];\r\n$objPHPExcel-&gt;setActiveSheetIndex(7)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;A$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info['date']}&quot;</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;B$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info['notes']}&quot;</span>)\r\n            -&gt;setCellValue(<span style=\"color:#a31515\">&quot;C$i&quot;</span>, substr(<span style=\"color:#a31515\">&quot;$amount&quot;</span>,1))\r\n\t\t\t-&gt;setCellValue(<span style=\"color:#a31515\">&quot;D$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info2['yourname']}&quot;</span>)\r\n\t\t\t-&gt;setCellValue(<span style=\"color:#a31515\">&quot;E$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info2['allocate_to']}&quot;</span>)\r\n\t\t\t-&gt;setCellValue(<span style=\"color:#a31515\">&quot;F$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info2['type']}&quot;</span>)\r\n\t\t\t-&gt;setCellValue(<span style=\"color:#a31515\">&quot;G$i&quot;</span>, <span style=\"color:#a31515\">&quot;{$info2['date_submitted']}&quot;</span>);\r\n$i = $i + 1;\r\n}\r\n\r\n<span style=\"color:green\">// Redirect output to a client's web browser (Excel2007)</span>\r\nheader(<span style=\"color:#a31515\">'Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'</span>);\r\nheader(<span style=\"color:#a31515\">'Content-Disposition: attachment;filename=&quot;Suspense_Master.xlsx&quot;'</span>);\r\nheader(<span style=\"color:#a31515\">'Cache-Control: max-age=0'</span>);\r\n\r\n$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color:#a31515\">'Excel2007'</span>);\r\n$objWriter-&gt;save(<span style=\"color:#a31515\">'php://output'</span>);\r\n\r\n\r\n<span style=\"color:blue\">exit</span>;\r\n?&gt;\r\n\r\n</pre>\r\n</div>\r\n<p>&nbsp;</p>",
    "PostedDate": "2010-10-04T11:52:18.41-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]