[
  {
    "Id": "1417172",
    "ThreadId": "632462",
    "Html": "PHP 5.3, PHPExcel 1.7.6 or 1.8\r<br />\nFollowing is a test reuslt shows excel5 reader with excel5 xls file,  function getForamtCode() returns\r<br />\ncorrect format code. excel2007 reader with excel2007 file, getFormatCode() returns correct code for currency format $#,##0 and $#,##0;[Red]$#,##0. But it returns General for $#,##0_);($#,##0) or \r<br />\n$#,##0_);<a href=\"$#,##0\" rel=\"nofollow\">Red</a>.\r<br />\n<br />\nPlease explain it. <br />\n<h2>with reader Excel5</h2>\nSetting in Sheet\t \tResult in PHP reader\r<br />\nCurrency\tCustom detail\tReturned formatcode()\r<br />\n-$1,234\t $#,##0\t &quot;$&quot;#,##0\r<br />\n$1,234\t $#,##0;[Red]$#,##0\t $&quot;#,##0;[Red]&quot;$&quot;#,##0\r<br />\n($1,234)\t$#,##0_);($#,##0)\t$&quot;#,##0_);(&quot;$&quot;#,##0)\r<br />\n($1,234)\t$#,##0_);<a href=\"$#,##0\" rel=\"nofollow\">Red</a>\t$#,##0_);[Red](&quot;$&quot;#,##0)\r<br />\n \t \t \r<br />\nExcel2007\t \t\r<br />\nCurrency\tCustom detail\tReturned formatcode()\r<br />\n-$1,234\t$#,##0\t$#,##0\r<br />\n$1,234\t$#,##0;[Red]$#,##0\t$#,##0;[Red]&quot;$&quot;#,##0\r<br />\n($1,234)\t$#,##0_);($#,##0)\tGeneral\r<br />\n($1,234)\t$#,##0_);<a href=\"$#,##0\" rel=\"nofollow\">Red</a>\tGeneral<br />\n",
    "PostedDate": "2015-04-23T11:42:36.843-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1417182",
    "ThreadId": "632462",
    "Html": "I can't explain it because I don't understand what you're saying\r<br />\n<br />\nDo you have example spreadsheets in both formats to demonstrate the problem you've found?\r<br />\n<br />\nCan you provide some working code to help explain what it is that you're reading, and what exactly you expect to see?<br />\n",
    "PostedDate": "2015-04-23T12:21:43.887-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1417246",
    "ThreadId": "632462",
    "Html": "MarkBaker,\r<br />\n<br />\nThanks for post your comments\r<br />\n<br />\nI tested two excel files with same data. One save as Excel5 1997-2003 (xls). Other saved as Excel2007 xlsx.\r<br />\n<br />\nI set cells format as currecy,then move click &quot;custom&quot;. Then run PHPExcel to read and display the value of getFormatCode(). The results are:\r<br />\nFor Excel5 file, getFormatCode() returns expected format code such as   &quot;$&quot;#,##0, $&quot;#,##0;[Red]&quot;$&quot;#,##0, $&quot;#,##0_);(&quot;$&quot;#,##0), or $#,##0_);<a href=\"&quot;$&quot;#,##0\" rel=\"nofollow\">Red</a> \r<br />\nFor Excel2007, if cell format is  -$1,234 or $1,234, getFormatcode() returns $#,##0 or $#,##0;[Red]&quot;$&quot;#,##0 : which means &quot;Expected&quot;\r<br />\nif cell format is ($1,234), getFormatCode() returns  Generalã€‚<br />\n",
    "PostedDate": "2015-04-23T20:11:21.983-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1417870",
    "ThreadId": "632462",
    "Html": "<code>For Excel2007, if cell format is -$1,234 or $1,234,</code>\r<br />\n<br />\nNeither <code>-$1,234</code> nor <code>$1,234</code> are valid format masks.... they're formatted values.\r<br />\n<br />\nBut I really need a working example showing with the format masks..... I can't tell what the PHPExcel Reader is loading from file without a file to load.... and I need to see what's in the actual file before PHPExcel loads it<br />\n",
    "PostedDate": "2015-04-25T02:38:45.427-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1419111",
    "ThreadId": "632462",
    "Html": "MarkBaker,\r<br />\n<br />\nThanks for your response.\r<br />\nI wrote a test PHP script to test curreny fornat for Excel5 and Excel2007. And I create TestExcel 5.xls and TestExcel2007.xlsx for test.\r<br />\nIn each Exel file, I sent CELL 'I5' with currency format.  I tested with all currency foramt: -1234, 1234 with red color, (1234), and (1234) woth red color.\r<br />\nThe results tell me for Excel5, all returned formatcode are correct. For Excel2007, if format is  -1234 or  1234 with red color, return correct format code. But, if set as \r<br />\n(1234) or (1234) woth red color, it returns &quot;General&quot;.\r<br />\nBecasue I can not attahced the excel files,I copy part of the out put in the bottom. Please notes that first section of the out put is the test result for Ecel5, second is for Excel2007. \r<br />\n<br />\n&lt;?php //ShowFormatCode.php\r<br />\nsession_start(); <br />\n<pre><code>$shnum =0;</code></pre>\n\nset_include_path(get_include_path() . PATH_SEPARATOR . 'Classes/');<br />\n<pre><code>include 'PHPExcel/IOFactory.php';\n//echo 'IN pre_load_first20&lt;br&gt;';\n\n$inputFileName = &quot;./upload/TestExcel5.xls&quot;;\necho &quot;inputFileName***&quot; .$inputFileName .&quot;***&lt;br&gt;&quot;;\ndisplay_format($inputFileName,$shnum);\n\necho &quot;*******************------------------------**************************----------------------------*******************&lt;br&gt;***&quot;;\n\n$inputFileName = &quot;./upload/TestExcel2007.xlsx&quot;;\necho &quot;inputFileName***&quot; .$inputFileName .&quot;***&lt;br&gt;&quot;; \ndisplay_format($inputFileName,$shnum);\n</code></pre>\n\nfunction display_format($inputFileName,$shnum){\t<br />\n<pre><code>try {\n    $inputFileType = PHPExcel_IOFactory::identify($inputFileName);\n    $objReader = PHPExcel_IOFactory::createReader($inputFileType);\n    //$objReader = PHPExcel_IOFactory::createReader(&quot;Excel5&quot;);\n    $objPHPExcel = $objReader-&gt;load($inputFileName);\n    //$objPHPExcel = PHPExcel_IOFactory::load($inputFileName);\n    if (!$objPHPExcel){\n        echo 'objPHPExcel is null&lt;br&gt;';\n    }\n    else{\n      echo 'Excel type:***' .$inputFileType .'***&lt;br&gt;';\n      // echo 'objPHPExcel is NOT null&lt;br&gt;';\n       ;\n    }   \n} catch(Exception $e) {\n     $er = 'Error loading file &quot;'.pathinfo($inputFileName,PATHINFO_BASENAME).'&quot;: '.$e-&gt;getMessage();\n    echo $er; \n}\necho 'After try/catch **' .$shnum .'**&lt;br&gt;';\n$objPHPExcel-&gt;setActiveSheetIndex($shnum);\n//echo 'After setActiveSheetIndex**&lt;br&gt;';\n\n$highestColumm = $objPHPExcel-&gt;getActiveSheet()-&gt;getHighestColumn();\n\necho 'highestColumm***' .$highestColumm .'***&lt;br&gt;';\n$highestRow = $objPHPExcel-&gt;getActiveSheet()-&gt;getHighestRow(); \necho 'highestRow***' .$highestRow .'***&lt;br&gt;';\n\n$highestColumnIndex = PHPExcel_Cell::columnIndexFromString($highestColumm);  \n\necho 'highestColumnIndex***' .$highestColumnIndex .'***&lt;br&gt;';</code></pre>\n\n$dtcol = array();\r<br />\n   $nodtcol = array();\r<br />\n   $dtdex = array();\r<br />\n   $highestRow = 8;\r<br />\n   echo 'Only show first 7 rows---------------------&lt;br&gt;';<br />\n<pre><code>for($row =2; $row &lt; $highestRow; $row++) {   \n       for ($i = 0; $i &lt; $highestColumnIndex; $i++) {   \n             // echo 'in loop **' .$i  .'**column--';\n             $cell = $objPHPExcel-&gt;getActiveSheet()-&gt;getCellByColumnAndRow($i, $row);\n            $lt = get_col_letter($i+1); \n            $range = $lt .$row;\n\n             $frmcod = $objPHPExcel-&gt;getActiveSheet()-&gt;getCellByColumnAndRow($i, $row)-&gt;getStyle()-&gt;getNumberFormat()-&gt;getFormatCode();\n\n             $v = $cell-&gt;getValue();\n// echo $range .'*' .$frmnm .'**' .$frmcod .'**value**' .$v  .'**&lt;br&gt;';\n echo $range .'**' .$frmcod .'**value**' .$v  .'**&lt;br&gt;';  //check formatcode \n\n      }//for in loop    \n      echo  'End ' .$row .'th row-----------------------------------------------------&lt;br&gt;';\n }//for out loop</code></pre>\n\n}//end \tfunction display_format\r<br />\n<br />\n function get_col_letter($num){<br />\n<pre><code>$comp=0;    \n$pre='';\n$letters=array('A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z');\n//if the number is greater than 26, calculate to get the next letters\nif($num &gt; 26){\n    //divide the number by 26 and get rid of the decimal\n    $comp=floor($num/26);\n\n    //add the letter to the end of the result and return it\n     if($comp!=0)\n   // don't subtract 1 if the comparative variable is greater than 0\nreturn get_col_letter($comp).$letters[($num-$comp*26)];\n    else\n               return get_col_letter($comp).$letters[($num-$comp*26)-1];\n}\nelse\n//return the letter\n $num = $num -1;\n return $letters[$num];</code></pre>\n\n} \r<br />\n?&gt;\r<br />\n<br />\nPart of the out put as shown:\r<br />\ninputFileName***./upload/TestExcel5.xls***\r<br />\nExcel type:<strong><em>Excel5</em></strong>\r<br />\n<br />\n......\r<br />\nEnd 4th row-----------------------------------------------------\r<br />\nA5<strong>General<strong>value</strong>G00000759</strong>\r<br />\nB5<strong>General</strong>value<strong>F</strong>\r<br />\nC5<strong>General</strong>value<strong>UMTA</strong>\r<br />\nD5<strong>General</strong>value<strong>UNNY-03-0344</strong>\r<br />\nE5<strong>General</strong>value<strong>14.08.80</strong>\r<br />\nF5<strong>General</strong>value<strong>3456</strong>\r<br />\nG5<strong>#,##0.00</strong>value<strong>61438180.11</strong>\r<br />\nH5<strong>#,##0.00</strong>value<strong>61438180.11</strong>\r<br />\nI5**&quot;$&quot;#,##0_);[Red](&quot;$&quot;#,##0)<strong>value</strong>-1234.77**\r<br />\nJ5<strong>General</strong>value****\r<br />\nK5<strong>General</strong>value****\r<br />\nEnd 5th row-----------------------------------------------------\r<br />\n<br />\n<strong><strong><strong><strong><strong><strong><strong><strong><strong><em>------------------------</em></strong></strong></strong></strong></strong></strong></strong></strong></strong>*******----------------------------<strong><strong><strong><strong><strong><strong><strong><strong><strong><em>\r<br />\n<strong><em>inputFileName</em></strong>./upload/TestExcel2007.xlsx</em></strong>\r<br />\nExcel type:<strong><em>Excel2007</em></strong>\r<br />\n............\r<br />\n<br />\nA5</strong>General<strong>value</strong>G00000759</strong>\r<br />\nB5<strong>General</strong>value</strong>F</strong>\r<br />\nC5<strong>General</strong>value</strong>UMTA</strong>\r<br />\nD5<strong>General</strong>value</strong>UNNY-03-0344</strong>\r<br />\nE5<strong>General</strong>value<strong>14.08.80</strong>\r<br />\nF5<strong>General</strong>value<strong>3456</strong>\r<br />\nG5<strong>#,##0.00</strong>value<strong>61438180.11</strong>\r<br />\nH5<strong>#,##0.00</strong>value<strong>61438180.11</strong>\r<br />\nI5<strong>General</strong>value<strong>1234.77</strong>\r<br />\nJ5<strong>General</strong>value****\r<br />\nK5<strong>General</strong>value****\r<br />\nEnd 5th row-----------------------------------------------------<br />\n",
    "PostedDate": "2015-04-27T09:20:40.23-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1419114",
    "ThreadId": "632462",
    "Html": "MarkBaker,\r<br />\n<br />\nThanks for your response.\r<br />\nI wrote a test PHP script to test curreny fornat for Excel5 and Excel2007. And I create TestExcel 5.xls and TestExcel2007.xlsx for test.\r<br />\nIn each Exel file, I sent CELL 'I5' with currency format.  I tested with all currency foramt: -1234, 1234 with red color, (1234), and (1234) woth red color.\r<br />\nThe results tell me for Excel5, all returned formatcode are correct. For Excel2007, if format is  -1234 or  1234 with red color, return correct format code. But, if set as \r<br />\n(1234) or (1234) woth red color, it returns &quot;General&quot;.\r<br />\nBecasue I can not attahced the excel files,I copy part of the out put in the bottom. Please notes that first section of the out put is the test result for Ecel5, second is for Excel2007. \r<br />\n<br />\n&lt;?php //ShowFormatCode.php\r<br />\nsession_start(); <br />\n<pre><code>$shnum =0;</code></pre>\n\nset_include_path(get_include_path() . PATH_SEPARATOR . 'Classes/');<br />\n<pre><code>include 'PHPExcel/IOFactory.php';\n//echo 'IN pre_load_first20&lt;br&gt;';\n\n$inputFileName = &quot;./upload/TestExcel5.xls&quot;;\necho &quot;inputFileName***&quot; .$inputFileName .&quot;***&lt;br&gt;&quot;;\ndisplay_format($inputFileName,$shnum);\n\necho &quot;*******************------------------------**************************----------------------------*******************&lt;br&gt;***&quot;;\n\n$inputFileName = &quot;./upload/TestExcel2007.xlsx&quot;;\necho &quot;inputFileName***&quot; .$inputFileName .&quot;***&lt;br&gt;&quot;; \ndisplay_format($inputFileName,$shnum);\n</code></pre>\n\nfunction display_format($inputFileName,$shnum){\t<br />\n<pre><code>try {\n    $inputFileType = PHPExcel_IOFactory::identify($inputFileName);\n    $objReader = PHPExcel_IOFactory::createReader($inputFileType);\n    //$objReader = PHPExcel_IOFactory::createReader(&quot;Excel5&quot;);\n    $objPHPExcel = $objReader-&gt;load($inputFileName);\n    //$objPHPExcel = PHPExcel_IOFactory::load($inputFileName);\n    if (!$objPHPExcel){\n        echo 'objPHPExcel is null&lt;br&gt;';\n    }\n    else{\n      echo 'Excel type:***' .$inputFileType .'***&lt;br&gt;';\n      // echo 'objPHPExcel is NOT null&lt;br&gt;';\n       ;\n    }   \n} catch(Exception $e) {\n     $er = 'Error loading file &quot;'.pathinfo($inputFileName,PATHINFO_BASENAME).'&quot;: '.$e-&gt;getMessage();\n    echo $er; \n}\necho 'After try/catch **' .$shnum .'**&lt;br&gt;';\n$objPHPExcel-&gt;setActiveSheetIndex($shnum);\n//echo 'After setActiveSheetIndex**&lt;br&gt;';\n\n$highestColumm = $objPHPExcel-&gt;getActiveSheet()-&gt;getHighestColumn();\n\necho 'highestColumm***' .$highestColumm .'***&lt;br&gt;';\n$highestRow = $objPHPExcel-&gt;getActiveSheet()-&gt;getHighestRow(); \necho 'highestRow***' .$highestRow .'***&lt;br&gt;';\n\n$highestColumnIndex = PHPExcel_Cell::columnIndexFromString($highestColumm);  \n\necho 'highestColumnIndex***' .$highestColumnIndex .'***&lt;br&gt;';</code></pre>\n\n$dtcol = array();\r<br />\n   $nodtcol = array();\r<br />\n   $dtdex = array();\r<br />\n   $highestRow = 8;\r<br />\n   echo 'Only show first 7 rows---------------------&lt;br&gt;';<br />\n<pre><code>for($row =2; $row &lt; $highestRow; $row++) {   \n       for ($i = 0; $i &lt; $highestColumnIndex; $i++) {   \n             // echo 'in loop **' .$i  .'**column--';\n             $cell = $objPHPExcel-&gt;getActiveSheet()-&gt;getCellByColumnAndRow($i, $row);\n            $lt = get_col_letter($i+1); \n            $range = $lt .$row;\n\n             $frmcod = $objPHPExcel-&gt;getActiveSheet()-&gt;getCellByColumnAndRow($i, $row)-&gt;getStyle()-&gt;getNumberFormat()-&gt;getFormatCode();\n\n             $v = $cell-&gt;getValue();\n// echo $range .'*' .$frmnm .'**' .$frmcod .'**value**' .$v  .'**&lt;br&gt;';\n echo $range .'**' .$frmcod .'**value**' .$v  .'**&lt;br&gt;';  //check formatcode \n\n      }//for in loop    \n      echo  'End ' .$row .'th row-----------------------------------------------------&lt;br&gt;';\n }//for out loop</code></pre>\n\n}//end \tfunction display_format\r<br />\n<br />\n function get_col_letter($num){<br />\n<pre><code>$comp=0;    \n$pre='';\n$letters=array('A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z');\n//if the number is greater than 26, calculate to get the next letters\nif($num &gt; 26){\n    //divide the number by 26 and get rid of the decimal\n    $comp=floor($num/26);\n\n    //add the letter to the end of the result and return it\n     if($comp!=0)\n   // don't subtract 1 if the comparative variable is greater than 0\nreturn get_col_letter($comp).$letters[($num-$comp*26)];\n    else\n               return get_col_letter($comp).$letters[($num-$comp*26)-1];\n}\nelse\n//return the letter\n $num = $num -1;\n return $letters[$num];</code></pre>\n\n} \r<br />\n?&gt;\r<br />\n<br />\nPart of the out put as shown:\r<br />\ninputFileName***./upload/TestExcel5.xls***\r<br />\nExcel type:<strong><em>Excel5</em></strong>\r<br />\n<br />\n......\r<br />\nEnd 4th row-----------------------------------------------------\r<br />\nA5<strong>General<strong>value</strong>G00000759</strong>\r<br />\nB5<strong>General</strong>value<strong>F</strong>\r<br />\nC5<strong>General</strong>value<strong>UMTA</strong>\r<br />\nD5<strong>General</strong>value<strong>UNNY-03-0344</strong>\r<br />\nE5<strong>General</strong>value<strong>14.08.80</strong>\r<br />\nF5<strong>General</strong>value<strong>3456</strong>\r<br />\nG5<strong>#,##0.00</strong>value<strong>61438180.11</strong>\r<br />\nH5<strong>#,##0.00</strong>value<strong>61438180.11</strong>\r<br />\nI5**&quot;$&quot;#,##0_);[Red](&quot;$&quot;#,##0)<strong>value</strong>-1234.77**\r<br />\nJ5<strong>General</strong>value****\r<br />\nK5<strong>General</strong>value****\r<br />\nEnd 5th row-----------------------------------------------------\r<br />\n<br />\n<strong><strong><strong><strong><strong><strong><strong><strong><strong><em>------------------------</em></strong></strong></strong></strong></strong></strong></strong></strong></strong>*******----------------------------<strong><strong><strong><strong><strong><strong><strong><strong><strong><em>\r<br />\n<strong><em>inputFileName</em></strong>./upload/TestExcel2007.xlsx</em></strong>\r<br />\nExcel type:<strong><em>Excel2007</em></strong>\r<br />\n............\r<br />\n<br />\nA5</strong>General<strong>value</strong>G00000759</strong>\r<br />\nB5<strong>General</strong>value</strong>F</strong>\r<br />\nC5<strong>General</strong>value</strong>UMTA</strong>\r<br />\nD5<strong>General</strong>value</strong>UNNY-03-0344</strong>\r<br />\nE5<strong>General</strong>value<strong>14.08.80</strong>\r<br />\nF5<strong>General</strong>value<strong>3456</strong>\r<br />\nG5<strong>#,##0.00</strong>value<strong>61438180.11</strong>\r<br />\nH5<strong>#,##0.00</strong>value<strong>61438180.11</strong>\r<br />\nI5<strong>General</strong>value<strong>1234.77</strong>\r<br />\nJ5<strong>General</strong>value****\r<br />\nK5<strong>General</strong>value****\r<br />\nEnd 5th row-----------------------------------------------------<br />\n",
    "PostedDate": "2015-04-27T09:22:00.353-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]