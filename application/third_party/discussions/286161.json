[
  {
    "Id": "725260",
    "ThreadId": "286161",
    "Html": "\r\n<p>Bug: #REF! error when trying to calculate the value of a formula with a named reference.&nbsp; Ok in .XLSX, but not .XLS.</p>\r\n<p>PHP 5.3.8, PHPExcel 1.7.6, Windows XP and CentOS</p>\r\n<p>In this note:</p>\r\n<p>trace from xls</p>\r\n<p>trace from xlsx</p>\r\n<p>php source code to produce</p>\r\n<p>&nbsp;</p>\r\n<p>I'll attach an Excel file named PHPExcelBugNamedRange.xls and one named PHPExcelBugNamedRange.xlsx.</p>\r\n<p>with XLS not happy:<br>\r\ntrace output from testformula()&nbsp; (a function I found posted here somewhere...)</p>\r\n<p>&gt; php PHPExcel_176_BugNamedRange.php PHPExcelBugNamedRange.xls<br>\r\nPETest test1</p>\r\n<p>&lt;b&gt;A20 Value is &lt;/b&gt;=EXP(-mu*(1-rho)*(7/60))&lt;br /&gt;<br>\r\n&lt;b&gt;A20 Expected Value is &lt;/b&gt;0.3114032239146&lt;br /&gt;<br>\r\n&lt;b&gt;Parser Stack :-&lt;/b&gt;&lt;pre&gt;Array<br>\r\n(<br>\r\n&nbsp;&nbsp;&nbsp; [0] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Value<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; mu<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [1] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Unary Operator<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; ~<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [2] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Value<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; 1<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [3] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Value<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; rho<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [4] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Binary Operator<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; -<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [5] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Binary Operator<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; *<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [6] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Value<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; 7<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [7] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Value<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; 60<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [8] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Binary Operator<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; /<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [9] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Binary Operator<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; *<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [10] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Operand Count for Function EXP()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; 1<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [11] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Function<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; EXP(<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n)<br>\r\n&lt;/pre&gt;<br>\r\nWarning: exp() expects parameter 1 to be double, string given in C:\\Documents and Settings\\Brent\\My Documents\\data\\proje<br>\r\ncts\\Chexel 10\\PHPExcel\\c10\\harness\\PHPExcel\\Calculation.php on line 3343<br>\r\n&lt;b&gt;A20 Calculated Value is &lt;/b&gt;0&lt;br /&gt;<br>\r\n&lt;h3&gt;Evaluation Log:&lt;/h3&gt;&lt;pre&gt;Array<br>\r\n(<br>\r\n&nbsp;&nbsp;&nbsp; [0] =&gt; DS11-10ab!A20 -&gt; Evaluating Named Range mu<br>\r\n&nbsp;&nbsp;&nbsp; [1] =&gt; DS11-10ab!A20 -&gt; Evaluation Result for named range mu is a #REF! error<br>\r\n&nbsp;&nbsp;&nbsp; [2] =&gt; DS11-10ab!A20 -&gt; Evaluating Negation of #REF!<br>\r\n&nbsp;&nbsp;&nbsp; [3] =&gt; DS11-10ab!A20 -&gt; Evaluation Result is a #REF! error<br>\r\n&nbsp;&nbsp;&nbsp; [4] =&gt; DS11-10ab!A20 -&gt; Evaluating Named Range rho<br>\r\n&nbsp;&nbsp;&nbsp; [5] =&gt; DS11-10ab!A20 -&gt; Evaluation Result for named range rho is a #REF! error<br>\r\n&nbsp;&nbsp;&nbsp; [6] =&gt; DS11-10ab!A20 -&gt; Evaluating 1 - #REF!<br>\r\n&nbsp;&nbsp;&nbsp; [7] =&gt; DS11-10ab!A20 -&gt; Evaluation Result is a #REF! error<br>\r\n&nbsp;&nbsp;&nbsp; [8] =&gt; DS11-10ab!A20 -&gt; Evaluating #REF! * #REF!<br>\r\n&nbsp;&nbsp;&nbsp; [9] =&gt; DS11-10ab!A20 -&gt; Evaluation Result is a #REF! error<br>\r\n&nbsp;&nbsp;&nbsp; [10] =&gt; DS11-10ab!A20 -&gt; Evaluating 7 / 60<br>\r\n&nbsp;&nbsp;&nbsp; [11] =&gt; DS11-10ab!A20 -&gt; Evaluation Result is a floating point number with a value of 0.11666666666667<br>\r\n&nbsp;&nbsp;&nbsp; [12] =&gt; DS11-10ab!A20 -&gt; Evaluating #REF! * 0.11666666666667<br>\r\n&nbsp;&nbsp;&nbsp; [13] =&gt; DS11-10ab!A20 -&gt; Evaluation Result is a #REF! error<br>\r\n&nbsp;&nbsp;&nbsp; [14] =&gt; DS11-10ab!A20 -&gt; Evaluating Function EXP() with 1 argument<br>\r\n&nbsp;&nbsp;&nbsp; [15] =&gt; DS11-10ab!A20 -&gt; Evaluating EXP( #REF! )<br>\r\n&nbsp;&nbsp;&nbsp; [16] =&gt; DS11-10ab!A20 -&gt; Evaluation Result for EXP() function call is a NULL value<br>\r\n)<br>\r\n&lt;/pre&gt;<br>\r\n&gt;<br>\r\n<br>\r\n<br>\r\n<br>\r\nwith XLSX happy<br>\r\n<br>\r\n&lt;b&gt;A20 Value is &lt;/b&gt;=EXP(-mu * (1-rho) * (7/60))&lt;br /&gt;<br>\r\n&lt;b&gt;A20 Expected Value is &lt;/b&gt;0.31140322391459768&lt;br /&gt;<br>\r\n&lt;b&gt;Parser Stack :-&lt;/b&gt;&lt;pre&gt;Array<br>\r\n(<br>\r\n&nbsp;&nbsp;&nbsp; [0] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Value<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; mu<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [1] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Unary Operator<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; ~<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [2] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Value<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; 1<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [3] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Value<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; rho<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [4] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Binary Operator<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; -<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [5] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Binary Operator<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; *<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [6] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Value<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; 7<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [7] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Value<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; 60<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [8] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Binary Operator<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; /<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [9] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Binary Operator<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; *<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [10] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Operand Count for Function EXP()<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; 1<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n&nbsp;&nbsp;&nbsp; [11] =&gt; Array<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [type] =&gt; Function<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [value] =&gt; EXP(<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [reference] =&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<br>\r\n<br>\r\n)<br>\r\n&lt;/pre&gt;&lt;b&gt;A20 Calculated Value is &lt;/b&gt;0.3114032239146&lt;br /&gt;<br>\r\n&lt;h3&gt;Evaluation Log:&lt;/h3&gt;&lt;pre&gt;Array<br>\r\n(<br>\r\n&nbsp;&nbsp;&nbsp; [0] =&gt; DS11-10ab!A20 -&gt; Evaluating Named Range mu<br>\r\n&nbsp;&nbsp;&nbsp; [1] =&gt; DS11-10ab!A20 -&gt; Evaluation Result for named range A5 is a floating point number with a value of 40<br>\r\n&nbsp;&nbsp;&nbsp; [2] =&gt; DS11-10ab!A20 -&gt; Evaluating Negation of 40<br>\r\n&nbsp;&nbsp;&nbsp; [3] =&gt; DS11-10ab!A20 -&gt; Evaluation Result is a floating point number with a value of -40<br>\r\n&nbsp;&nbsp;&nbsp; [4] =&gt; DS11-10ab!A20 -&gt; Evaluating Named Range rho<br>\r\n&nbsp;&nbsp;&nbsp; [5] =&gt; DS11-10ab!A20 -&gt; DS11-10ab!A6 -&gt; Evaluating Named Range lambda<br>\r\n&nbsp;&nbsp;&nbsp; [6] =&gt; DS11-10ab!A20 -&gt; DS11-10ab!A6 -&gt; Evaluation Result for named range A4 is a floating point number with a value<br>\r\n&nbsp;of 30<br>\r\n&nbsp;&nbsp;&nbsp; [7] =&gt; DS11-10ab!A20 -&gt; DS11-10ab!A6 -&gt; Evaluating Named Range mu<br>\r\n&nbsp;&nbsp;&nbsp; [8] =&gt; DS11-10ab!A20 -&gt; DS11-10ab!A6 -&gt; Evaluation Result for named range A5 is a floating point number with a value<br>\r\n&nbsp;of 40<br>\r\n&nbsp;&nbsp;&nbsp; [9] =&gt; DS11-10ab!A20 -&gt; DS11-10ab!A6 -&gt; Evaluating 30 / 40<br>\r\n&nbsp;&nbsp;&nbsp; [10] =&gt; DS11-10ab!A20 -&gt; DS11-10ab!A6 -&gt; Evaluation Result is a floating point number with a value of 0.75<br>\r\n&nbsp;&nbsp;&nbsp; [11] =&gt; DS11-10ab!A20 -&gt; Evaluation Result for named range A6 is a floating point number with a value of 0.75<br>\r\n&nbsp;&nbsp;&nbsp; [12] =&gt; DS11-10ab!A20 -&gt; Evaluating 1 - 0.75<br>\r\n&nbsp;&nbsp;&nbsp; [13] =&gt; DS11-10ab!A20 -&gt; Evaluation Result is a floating point number with a value of 0.25<br>\r\n&nbsp;&nbsp;&nbsp; [14] =&gt; DS11-10ab!A20 -&gt; Evaluating -40 * 0.25<br>\r\n&nbsp;&nbsp;&nbsp; [15] =&gt; DS11-10ab!A20 -&gt; Evaluation Result is a floating point number with a value of -10<br>\r\n&nbsp;&nbsp;&nbsp; [16] =&gt; DS11-10ab!A20 -&gt; Evaluating 7 / 60<br>\r\n&nbsp;&nbsp;&nbsp; [17] =&gt; DS11-10ab!A20 -&gt; Evaluation Result is a floating point number with a value of 0.11666666666667<br>\r\n&nbsp;&nbsp;&nbsp; [18] =&gt; DS11-10ab!A20 -&gt; Evaluating -10 * 0.11666666666667<br>\r\n&nbsp;&nbsp;&nbsp; [19] =&gt; DS11-10ab!A20 -&gt; Evaluation Result is a floating point number with a value of -1.1666666666667<br>\r\n&nbsp;&nbsp;&nbsp; [20] =&gt; DS11-10ab!A20 -&gt; Evaluating Function EXP() with 1 argument<br>\r\n&nbsp;&nbsp;&nbsp; [21] =&gt; DS11-10ab!A20 -&gt; Evaluating EXP( -1.1666666666667 )<br>\r\n&nbsp;&nbsp;&nbsp; [22] =&gt; DS11-10ab!A20 -&gt; Evaluation Result for EXP() function call is a floating point number with a value of 0.3114<br>\r\n032239146<br>\r\n)<br>\r\n&lt;/pre&gt;</p>\r\n<p>&nbsp;</p>\r\n<p>&lt;?php<br>\r\n/**<br>\r\n&nbsp;* PHPExcel_176_BugNamedRange.php<br>\r\n&nbsp;*<br>\r\n&nbsp;* @author Brent Reeves &lt;brent@twinbear.com&gt;<br>\r\n&nbsp;* tests PHPExcel named range parsing / calculating<br>\r\n&nbsp;* seems to parse ok<br>\r\n&nbsp;*/ <br>\r\nerror_reporting(E_ALL);<br>\r\n<br>\r\nClass PETest<br>\r\n{<br>\r\n&nbsp; private $CLASSDIR = '';<br>\r\n<br>\r\n&nbsp; public function test1($aCell, $aSheetName, $aFileName)<br>\r\n&nbsp; {<br>\r\n&nbsp;&nbsp;&nbsp; print (&quot;PETest test1&quot;);<br>\r\n&nbsp;&nbsp;&nbsp; require_once ($this-&gt;CLASSDIR . 'PHPExcel.php');<br>\r\n&nbsp;&nbsp;&nbsp; $wkb = $this-&gt;readExcelFile($aFileName);<br>\r\n&nbsp;&nbsp;&nbsp; $wks = $wkb-&gt;getSheetByName($aSheetName);<br>\r\n&nbsp;&nbsp;&nbsp; <br>\r\n&nbsp;&nbsp;&nbsp; PHPExcel_Calculation::getInstance()-&gt;writeDebugLog = true;<br>\r\n&nbsp;&nbsp;&nbsp; <br>\r\n&nbsp;&nbsp;&nbsp; $this-&gt;testFormula($wks,$aCell);<br>\r\n&nbsp; }<br>\r\n<br>\r\n&nbsp; function testFormula($sheet,$cell) {<br>\r\n&nbsp;&nbsp;&nbsp; $formulaValue = $sheet-&gt;getCell($cell)-&gt;getValue();<br>\r\n&nbsp;&nbsp;&nbsp; echo '&lt;b&gt;'.$cell.' Value is &lt;/b&gt;'.$formulaValue.&quot;&lt;br /&gt;\\n&quot;;<br>\r\n&nbsp;&nbsp;&nbsp; $expectedValue = $sheet-&gt;getCell($cell)-&gt;getOldCalculatedValue();<br>\r\n&nbsp;&nbsp;&nbsp; echo '&lt;b&gt;'.$cell.' Expected Value is &lt;/b&gt;'.$expectedValue.&quot;&lt;br /&gt;\\n&quot;;<br>\r\n&nbsp;&nbsp;&nbsp; <br>\r\n&nbsp;&nbsp;&nbsp; $calculate = false;<br>\r\n&nbsp;&nbsp;&nbsp; try {<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $tokens = PHPExcel_Calculation::getInstance()-&gt;parseFormula($formulaValue,$sheet-&gt;getCell($cell));<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;b&gt;Parser Stack :-&lt;/b&gt;&lt;pre&gt;';<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print_r($tokens);<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;/pre&gt;';<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $calculate = true;<br>\r\n&nbsp;&nbsp;&nbsp; } catch (Exception $e) {<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo &quot;PARSER ERROR: &quot;.$e-&gt;getMessage().&quot;&lt;br /&gt;\\n&quot;;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;b&gt;Parser Stack :-&lt;/b&gt;&lt;pre&gt;';<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print_r($tokens);<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;/pre&gt;';<br>\r\n&nbsp;&nbsp;&nbsp; }<br>\r\n&nbsp;&nbsp;&nbsp; if ($calculate) {<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {<br>\r\n&nbsp;&nbsp;&nbsp; $cellValue = $sheet-&gt;getCell($cell)-&gt;getCalculatedValue();<br>\r\n&nbsp;&nbsp;&nbsp; echo '&lt;b&gt;'.$cell.' Calculated Value is &lt;/b&gt;'.$cellValue.&quot;&lt;br /&gt;\\n&quot;;<br>\r\n&nbsp;&nbsp;&nbsp; echo '&lt;h3&gt;Evaluation Log:&lt;/h3&gt;&lt;pre&gt;';<br>\r\n&nbsp;&nbsp;&nbsp; print_r(PHPExcel_Calculation::getInstance()-&gt;debugLog);<br>\r\n&nbsp;&nbsp;&nbsp; echo '&lt;/pre&gt;';<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (Exception $e) {<br>\r\n&nbsp;&nbsp;&nbsp; echo &quot;CALCULATION ENGINE ERROR: &quot;.$e-&gt;getMessage().&quot;&lt;br /&gt;\\n&quot;;<br>\r\n&nbsp;&nbsp;&nbsp; echo '&lt;h3&gt;Evaluation Log:&lt;/h3&gt;&lt;pre&gt;';<br>\r\n&nbsp;&nbsp;&nbsp; print_r(PHPExcel_Calculation::getInstance()-&gt;debugLog);<br>\r\n&nbsp;&nbsp;&nbsp; echo '&lt;/pre&gt;';<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>\r\n&nbsp;&nbsp;&nbsp; }<br>\r\n&nbsp; }<br>\r\n&nbsp; <br>\r\n&nbsp; function readExcelFile($file) {<br>\r\n&nbsp;&nbsp;&nbsp; $px = new PHPExcel();<br>\r\n&nbsp;&nbsp;&nbsp; try {<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $px = PHPExcel_IOFactory::load($file);<br>\r\n&nbsp;&nbsp;&nbsp; } catch (Exception $e) {<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print &quot;IOFactory::load had trouble: &quot;. $e-&gt;getMessage();<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return NULL;<br>\r\n&nbsp;&nbsp;&nbsp; }<br>\r\n&nbsp;&nbsp;&nbsp; PHPExcel_Calculation::getInstance()-&gt;clearCalculationCache();\r\n<br>\r\n&nbsp;&nbsp;&nbsp; return $px;<br>\r\n&nbsp; }<br>\r\n} <br>\r\n<br>\r\n$o1 = new PETest();<br>\r\nif (!empty($argc) &amp;&amp; $argc &gt; 1) {<br>\r\n&nbsp; $filename&nbsp; = $argv[1];<br>\r\n} else {<br>\r\n&nbsp; $filename&nbsp; = &quot;PHPExcelBugNamedRange.xls&quot;;<br>\r\n}<br>\r\n<br>\r\n$o1-&gt;test1('A20', &quot;DS11-10ab&quot;, $filename)<br>\r\n<br>\r\n?&gt;</p>\r\n",
    "PostedDate": "2012-01-14T11:39:01.303-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "725390",
    "ThreadId": "286161",
    "Html": "<p>Problem in the Excel5 Reader when the named range sheet reference is wrapped in quotes... PHPExcel assumes sheetname itself includes the quotes.</p>\n<p>&nbsp;</p>\n<p>Thanks for the detailed explanation of the bug... the sample workbooks, together with the stack trace and debug information made it easy to replicate and isolate the problem. I've copied this to a Work Item, and uploaded a fix to the Excel5 Reader to the SVN repository.</p>",
    "PostedDate": "2012-01-15T03:47:21.21-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "725391",
    "ThreadId": "286161",
    "Html": "This discussion has been copied to a work item. Click <a href=\"http://phpexcel.codeplex.com/workitem/17262\">here</a> to go to the work item and continue the discussion.",
    "PostedDate": "2012-01-15T03:48:10.103-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "725485",
    "ThreadId": "286161",
    "Html": "Awesome - nice work - thank you.<br>\r\n-brent<br>\r\n<br>\r\n<div>On Sun, Jan 15, 2012 at 5:48 AM, MarkBaker <span dir=\"ltr\">&lt;<a href=\"mailto:notifications@codeplex.com\">notifications@codeplex.com</a>&gt;</span> wrote:<br>\r\n<blockquote style=\"margin:0 0 0 .8ex; border-left:1px #ccc solid; padding-left:1ex\">\r\n<div>\r\n<p>From: MarkBaker</p>\r\n<div>This discussion has been copied to a work item. Click <a href=\"http://phpexcel.codeplex.com/workitem/17262\" target=\"_blank\">\r\nhere</a> to go to the work item and continue the discussion.</div>\r\n<div>\r\n<div>\r\n<p>Read the <a href=\"http://phpexcel.codeplex.com/discussions/286161#post725391\" target=\"_blank\">\r\nfull discussion online</a>.</p>\r\n<p>To add a post to this discussion, reply to this email (<a href=\"mailto:PHPExcel@discussions.codeplex.com?subject=[PHPExcel:286161]\" target=\"_blank\">PHPExcel@discussions.codeplex.com</a>)</p>\r\n<p>To start a new discussion for this project, email <a href=\"mailto:PHPExcel@discussions.codeplex.com\" target=\"_blank\">\r\nPHPExcel@discussions.codeplex.com</a></p>\r\n<p>You are receiving this email because you subscribed to this discussion on CodePlex. You can\r\n<a href=\"https://phpexcel.codeplex.com/discussions/286161/unsubscribe/\" target=\"_blank\">\r\nunsubscribe</a> on CodePlex.com.</p>\r\n<p>Please note: Images and attachments will be removed from emails. Any posts to this discussion will also be available online at CodePlex.com</p>\r\n</div>\r\n</div>\r\n</div>\r\n</blockquote>\r\n</div>\r\n<br>\r\n",
    "PostedDate": "2012-01-15T12:42:33.42-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]