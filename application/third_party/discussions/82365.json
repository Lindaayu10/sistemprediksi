[
  {
    "Id": "283000",
    "ThreadId": "82365",
    "Html": "<p>I'm generating a fairly small XLS file, about 32KB or so, and am reaching 32MB memory limit errors during my database loop to write to the Excel file. Here's the bulk of my code:</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre>ini_set(<span style=\"color:#A31515\">'include_path'</span>, ini_get(<span style=\"color:#A31515\">'include_path'</span>).PATH_SEPARATOR.$_SERVER[<span style=\"color:#A31515\">'DOCUMENT_ROOT'</span>].<span style=\"color:#A31515\">'/'</span>.APPPATH.<span style=\"color:#A31515\">'libraries/php-excel/'</span>);\r\n\r\n<span style=\"color:Green\">/** PHPExcel */</span>\r\n<span style=\"color:Blue\">include</span> <span style=\"color:#A31515\">'PHPExcel.php'</span>;\r\n\r\n<span style=\"color:Green\">/** Writer_Excel2007 */</span>\r\n<span style=\"color:Blue\">require_once</span> <span style=\"color:#A31515\">'PHPExcel/IOFactory.php'</span>;\r\n\r\n<span style=\"color:Green\">// Create new PHPExcel object</span>\r\n$objPHPExcel = <span style=\"color:Blue\">new</span> PHPExcel();\r\n\r\n<span style=\"color:Green\">// Set properties</span>\r\n$objPHPExcel-&gt;getProperties()-&gt;setCreator(<span style=\"color:#A31515\">'Brian DiChiara'</span>)\r\n\t\t\t\t-&gt;setLastModifiedBy(<span style=\"color:#A31515\">'Brian DiChiara'</span>)\r\n\t\t\t\t-&gt;setTitle(<span style=\"color:#A31515\">'Hibbett Vendor Report'</span>)\r\n\t\t\t\t-&gt;setSubject(<span style=\"color:#A31515\">'Hibbett Vendor'</span>)\r\n\t\t\t\t-&gt;setDescription(<span style=\"color:#A31515\">'Report generated online at HibbettVendor.com'</span>);\r\n\r\n\r\n$objPHPExcel-&gt;setActiveSheetIndex(0);\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle(<span style=\"color:#A31515\">'Report'</span>);\r\n\r\n<span style=\"color:Green\">/* document styles */</span>\r\n$<span style=\"color:Blue\">default</span> = <span style=\"color:Blue\">array</span>(\r\n\t<span style=\"color:#A31515\">'font'</span> =&gt; <span style=\"color:Blue\">array</span>(\r\n\t\t<span style=\"color:#A31515\">'name'</span> =&gt; <span style=\"color:#A31515\">'Lucida Sans Unicode'</span>,\r\n\t\t<span style=\"color:#A31515\">'size'</span> =&gt; 9\r\n\t)\r\n);\r\n$headers = $<span style=\"color:Blue\">default</span>;\r\n$headers[<span style=\"color:#A31515\">'font'</span>][<span style=\"color:#A31515\">'bold'</span>] = true;\r\n\r\n$alphabet = range(<span style=\"color:#A31515\">'A'</span>,<span style=\"color:#A31515\">'Z'</span>);\r\n\r\n$c = <span style=\"color:#A31515\">'A'</span>;\r\n$r = 1;\r\n$total_cols = count($cols);\r\n\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#A31515\">'A1:'</span>.$alphabet[$total_cols].<span style=\"color:#A31515\">'1'</span>)-&gt;applyFromArray($headers);\r\n\r\n<span style=\"color:Blue\">foreach</span>($cols <span style=\"color:Blue\">as</span> $col){\r\n\t$cell = $c.$r;\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;SetCellValue($cell, $col[<span style=\"color:#A31515\">'label'</span>]);\r\n\t$objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension($c)-&gt;setAutoSize(false)\r\n\t\t\t\t\t\t\t      -&gt;setWidth($col[<span style=\"color:#A31515\">'width'</span>]);\r\n\t$c++;\r\n}\r\n$r++;\r\n\r\n$coop = 0;\r\n$initiative = 0;\r\n$grand_total = 0;\r\n\r\n$c = <span style=\"color:#A31515\">'A'</span>;\r\n$total = $query-&gt;num_rows();\r\n$range = <span style=\"color:#A31515\">'A2:'</span>.$alphabet[$total_cols].$total+1;\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle($range)-&gt;applyFromArray($<span style=\"color:Blue\">default</span>);\r\n\r\n<span style=\"color:Green\">// set cols 9-16 to currency</span>\r\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#A31515\">'I:K'</span>)-&gt;getNumberFormat()-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_USD_SIMPLE);\r\n\r\n<span style=\"color:Blue\">foreach</span>($query-&gt;result_array() <span style=\"color:Blue\">as</span> $item){\r\n\t<span style=\"color:Blue\">foreach</span>($item <span style=\"color:Blue\">as</span> $k=&gt;$value){\r\n\t\t$cell = $c.$r;\r\n\t\t\r\n\t\t<span style=\"color:Blue\">if</span>($k == <span style=\"color:#A31515\">'cat_id'</span>){\r\n\t\t\t$cat_id = $value;\r\n\t\t\t<span style=\"color:Blue\">continue</span>;\r\n\t\t}\r\n\t\t<span style=\"color:Blue\">if</span>($k == <span style=\"color:#A31515\">'due'</span>){\r\n\t\t\t$due = $value;\r\n\t\t\t<span style=\"color:Blue\">continue</span>;\r\n\t\t}\r\n\t\t\r\n\t\t$value = trim($value);\r\n\t\t$value = str_replace(<span style=\"color:#A31515\">'&quot;'</span>, <span style=\"color:#A31515\">'&quot;&quot;'</span>, $value);\r\n\t\t$value = str_replace(<span style=\"color:#A31515\">'&amp;amp;'</span>, <span style=\"color:#A31515\">'&amp;'</span>, $value);\r\n\t\t$value = strip_tags($value);\r\n\t\t\r\n\t\t<span style=\"color:Blue\">if</span>($k == <span style=\"color:#A31515\">'category'</span>){\r\n\t\t\t$root_cat = $this-&gt;cms-&gt;get_root_category($cat_id);\r\n\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;SetCellValue($cell, $root_cat);\r\n\t\t\t$c++;\r\n\t\t\t$cell = $c.$r;\r\n\t\t} <span style=\"color:Blue\">elseif</span>($k == <span style=\"color:#A31515\">'due_date'</span>){\r\n\t\t\t<span style=\"color:Blue\">if</span>(strtotime($value) === false){\r\n\t\t\t\t$value = $due;\r\n\t\t\t}\r\n\t\t}\r\n\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;SetCellValue($cell, $value);\r\n\t\t$c++;\r\n\t}\r\n\t$c=<span style=\"color:#A31515\">'A'</span>;\r\n\t$r++;\r\n}\r\n\r\n<span style=\"color:Green\">// Save Excel 2007 file</span>\r\n$filename = ($data[<span style=\"color:#A31515\">'filename'</span>]) ? $data[<span style=\"color:#A31515\">'filename'</span>] : <span style=\"color:#A31515\">'master_report-'</span>.date(<span style=\"color:#A31515\">'YmdHis'</span>);\r\nheader(<span style=\"color:#A31515\">'Content-Type: application/vnd.ms-excel'</span>);\r\nheader(<span style=\"color:#A31515\">'Content-Disposition: attachment;filename=&quot;'</span>.$filename.<span style=\"color:#A31515\">'.xls&quot;'</span>);\r\nheader(<span style=\"color:#A31515\">'Cache-Control: max-age=0'</span>);\r\n$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color:#A31515\">'Excel5'</span>);\r\n$objWriter-&gt;save(<span style=\"color:#A31515\">'php://output'</span>);\r\n</pre>\r\n</div>\r\n<p>I had to up my memory_limit to 64 MB but seem to still be having memory issues. What exactly am I doing wrong here? Why does it take forever to generate this report when it didn't take near as long with Pear's Spreadsheet Writer? Please help! Thanks.</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2010-01-28T14:48:33.827-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "283292",
    "ThreadId": "82365",
    "Html": "<p>Excessive memory usage is a known problem with PHPExcel, and one that we are working hard to overcome. There are a number of threads here on the board discussing that very issue, which recommend a number of techniques to reduce the memory usage within your scripts: for example, using shared styles</p>",
    "PostedDate": "2010-01-29T04:17:02.097-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]