[
  {
    "Id": "845623",
    "ThreadId": "358604",
    "Html": "\r\n<p>Since my method was implemented into the new release I feel somewhat responsible for the code working correctly the first time out.&nbsp;</p>\r\n<p>I've been setting up a test bed for the new release and discovered that the listWorksheetInfo() method in the OOCalc reader does not return the array information expected (not sure how I missed this).</p>\r\n<p>Anyway, I delved into the code and changed it so it now returns the expected values.</p>\r\n<p>I'm posting the fixed method below for Mark Baker to correct the code and put it into the svn.</p>\r\n<p>Apologies for any grief this has caused.</p>\r\n<p>I've marked the lines that I had to change/replace so that editing should be quick and easy.</p>\r\n<p></p>\r\n<hr>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>  <span style=\"color:green\">/**\r\n   * Return worksheet info (Name, Last Column Letter, Last Column Index, Total Rows, Total Columns)\r\n   *\r\n   * @param   string     $pFilename\r\n   * @throws   Exception\r\n   */</span>\r\n  <span style=\"color:blue\">public</span> <span style=\"color:blue\">function</span> listWorksheetInfo($pFilename)\r\n  {\r\n    <span style=\"color:green\">// Check if file exists</span>\r\n    <span style=\"color:blue\">if</span> (!file_exists($pFilename)) {\r\n      <span style=\"color:blue\">throw</span> <span style=\"color:blue\">new</span> Exception(<span style=\"color:#a31515\">&quot;Could not open &quot;</span> . $pFilename . <span style=\"color:#a31515\">&quot; for reading! File does not exist.&quot;</span>);\r\n    }\r\n\r\n    $worksheetInfo = <span style=\"color:blue\">array</span>();\r\n\r\n    $zip = <span style=\"color:blue\">new</span> ZipArchive;\r\n    <span style=\"color:blue\">if</span> ($zip-&gt;open($pFilename) === true) {\r\n\r\n      $xml = simplexml_load_string($zip-&gt;getFromName(<span style=\"color:#a31515\">&quot;content.xml&quot;</span>));\r\n      $namespacesContent = $xml-&gt;getNamespaces(true);\r\n\r\n      $workbook = $xml-&gt;children($namespacesContent[<span style=\"color:#a31515\">'office'</span>]);\r\n      <span style=\"color:blue\">foreach</span>($workbook-&gt;body-&gt;spreadsheet <span style=\"color:blue\">as</span> $workbookData) {\r\n        $workbookData = $workbookData-&gt;children($namespacesContent[<span style=\"color:#a31515\">'table'</span>]);\r\n        <span style=\"color:blue\">foreach</span>($workbookData-&gt;table <span style=\"color:blue\">as</span> $worksheetDataSet) {\r\n          $worksheetData = $worksheetDataSet-&gt;children($namespacesContent[<span style=\"color:#a31515\">'table'</span>]);\r\n          $worksheetDataAttributes = $worksheetDataSet-&gt;attributes($namespacesContent[<span style=\"color:#a31515\">'table'</span>]);\r\n\r\n          $tmpInfo = <span style=\"color:blue\">array</span>();\r\n          $tmpInfo[<span style=\"color:#a31515\">'worksheetName'</span>] = (string) $worksheetDataAttributes[<span style=\"color:#a31515\">'name'</span>];                <span style=\"color:green\">// Change</span>\r\n          $tmpInfo[<span style=\"color:#a31515\">'lastColumnLetter'</span>] = <span style=\"color:#a31515\">'A'</span>;\r\n          $tmpInfo[<span style=\"color:#a31515\">'lastColumnIndex'</span>] = 0;\r\n          $tmpInfo[<span style=\"color:#a31515\">'totalRows'</span>] = 0;\r\n          $tmpInfo[<span style=\"color:#a31515\">'totalColumns'</span>] = 0;\r\n\r\n          $rowIndex = 0;\r\n          <span style=\"color:blue\">foreach</span> ($worksheetData <span style=\"color:blue\">as</span> $key =&gt; $rowData) {\r\n            $rowHasData = false;\r\n\r\n            <span style=\"color:blue\">switch</span> ($key) {\r\n              <span style=\"color:blue\">case</span> <span style=\"color:#a31515\">'table-row'</span> :\r\n                $columnIndex = 0;\r\n\r\n                <span style=\"color:blue\">foreach</span> ($rowData <span style=\"color:blue\">as</span> $key =&gt; $cellData) {                                       <span style=\"color:green\">// change</span>\r\n                  $tmpInfo[<span style=\"color:#a31515\">'lastColumnIndex'</span>] = max($tmpInfo[<span style=\"color:#a31515\">'lastColumnIndex'</span>], $columnIndex); <span style=\"color:green\">// change</span>\r\n                  &#43;&#43;$columnIndex;                                                               <span style=\"color:green\">// change</span>\r\n                }                                                                               <span style=\"color:green\">// change</span>\r\n                                                                                                <span style=\"color:green\">// change</span>\r\n                &#43;&#43;$rowIndex;                                                                    <span style=\"color:green\">// change</span>\r\n                                                                                                <span style=\"color:green\">// change</span>\r\n                $tmpInfo[<span style=\"color:#a31515\">'totalRows'</span>] = max($tmpInfo[<span style=\"color:#a31515\">'totalRows'</span>], $rowIndex);                  <span style=\"color:green\">// change</span>\r\n                <span style=\"color:blue\">break</span>;\r\n            }\r\n          }\r\n\r\n          $tmpInfo[<span style=\"color:#a31515\">'lastColumnLetter'</span>] = PHPExcel_Cell::stringFromColumnIndex($tmpInfo[<span style=\"color:#a31515\">'lastColumnIndex'</span>]);\r\n          $tmpInfo[<span style=\"color:#a31515\">'totalColumns'</span>] = $tmpInfo[<span style=\"color:#a31515\">'lastColumnIndex'</span>] &#43; 1;\r\n\r\n          $worksheetInfo[] = $tmpInfo;\r\n        }\r\n      }\r\n    }\r\n\r\n    <span style=\"color:blue\">return</span> $worksheetInfo;\r\n  }\r\n\r\n</pre>\r\n</div>\r\n<p></p>\r\n<p></p>\r\n<hr>\r\n<p></p>\r\n<p>&nbsp;</p>\r\n<p>- &nbsp;Christopher Mullins</p>\r\n",
    "PostedDate": "2012-06-06T09:48:25.307-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "846898",
    "ThreadId": "358604",
    "Html": "<p>Thanks for that fix Christopher, welcome to the feeling of open source contributor obligation :)</p>\r\n<p>I've now added this to the SVN source code.</p>",
    "PostedDate": "2012-06-09T06:12:48.817-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]