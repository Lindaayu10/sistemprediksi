[
  {
    "Id": "1204301",
    "ThreadId": "529684",
    "Html": "Hi,\r<br />\nSystem info:\r<br />\nphpExcel version 1.7.9\r<br />\nMySQL Server version: 5.5.8\r<br />\nMicrosoft-IIS/7.5\r<br />\nMySQL client version: mysqlnd 5.0.7-dev\r<br />\nMyphpAdmin Version information: 3.4.4\r<br />\n<br />\nI want to click on a download button and download the query result into excel file.\r<br />\nthe action is i click the button Export and it should call the function export2xls and download the file to the local pc, but for some reason it says the function is not defined. and if i remove the function and download the file on page reload the file cannot be opened it says corrupted.\r<br />\ni guess these are the two problems i'm facing, please help.\r<br />\nno forum gives an example on how to download the file on clicking the button.\r<br />\n<br />\nThanks,\r<br />\nhere is my code:\r<br />\n&lt;?php\r<br />\n$query = &quot;SELECT * FROM <code>employees</code>&quot;; //building query\r<br />\n$rows=$db-&gt;select($query); //running query\r<br />\n$i=1;\r<br />\n<br />\nfunction export2xls(){\r<br />\nrequire_once 'Classes/PHPExcel.php';\r<br />\n$objPHPExcel = new PHPExcel();\r<br />\n$objPHPExcel-&gt;setProperties()-&gt;setCreator(&quot;Me&quot;)<br />\n<pre><code>                -&gt;setLastModifiedBy(&quot;Me&quot;)\n                -&gt;setTitle(&quot;Office 2007 XLSX Report&quot;)\n                -&gt;setSubject(&quot;Office 2007 XLSX Report&quot;)\n                -&gt;setDescription(&quot;Test XLSX, generated using PHP classes.&quot;)\n                -&gt;setKeywords(&quot;office 2007 openxml php&quot;)\n                -&gt;setCategory(&quot;Deposits Report&quot;);</code></pre>\n\n$headings = array('First Name','Last Name','Company','Phone','Gender');<br />\n<pre><code>    $rowNumber = 1; \n    $col = 'A';\n\n    foreach($headings as $heading) {\n        $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($col.$rowNumber,$heading); \n        $col++; \n    }</code></pre>\n\n$rowNumber = 2;<br />\n<pre><code>    foreach($rows as $row) {\n        $col = 'A';\n        foreach($row as $cell) { \n            $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($col.$rowNumber,$cell); \n            $col++; \n        } \n        $rowNumber++; \n    }\n    $objPHPExcel-&gt;getActiveSheet()-&gt;freezePane('A2');</code></pre>\n\n$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle('Report');\r<br />\n$objPHPExcel-&gt;setActiveSheetIndex(0);\r<br />\nheader('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\r<br />\nheader('Content-Disposition: attachment;filename=&quot;Report.xlsx&quot;');\r<br />\nheader('Cache-Control: max-age=0');\r<br />\n\t\t\r<br />\n$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');\r<br />\n$objWriter-&gt;save('php://output');\r<br />\nexit;\t\r<br />\n}\r<br />\n?&gt;\r<br />\n<br />\n&lt;html&gt;<br />\n&lt;head&gt;\r\n&lt;?php include_once('incs/head.php'); ?&gt;\r\n&lt;/head&gt;\r\n&lt;body class=&quot;iframed&quot;&gt;<br />\n&lt;div class=&quot;title&quot;&gt;Report&lt;/div&gt;\r\n&lt;br /&gt;<br />\n&lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;\r\n&lt;button id=&quot;export&quot; name&quot;export&quot; onclick=&quot;export2xls&quot;&gt;Export&lt;/button&gt;\r<br />\n&lt;br /&gt;\r<br />\n&lt;br /&gt;<br />\n&lt;table &gt;\r\n  &lt;thead&gt;\r\n    &lt;tr&gt;\r\n      &lt;th&gt;First name&lt;/th&gt;\r\n      &lt;th&gt;Last name&lt;/th&gt;\r\n      &lt;th&gt;Company&lt;/th&gt;\r\n      &lt;th&gt;Phone&lt;/th&gt;\r\n      &lt;th&gt;Gender&lt;/th&gt;\r\n    &lt;/tr&gt;\r\n  &lt;/thead&gt;\r\n  &lt;tbody&gt;\r\n    &lt;?php\r\n\tforeach ($rows as $row){\r\n&lt;tr&gt;\r\n      &lt;td&gt;&lt;?php echo $row['fname']?&gt;.&lt;/td&gt;\r\n      &lt;td&gt;&lt;?php echo $row['lname']?&gt;&lt;/td&gt;\r\n      &lt;td&gt;&lt;?php echo $row['company']?&gt;&lt;/td&gt;\r\n      &lt;td&gt;&lt;?php echo $row['phone']?&gt;&lt;/td&gt;\r\n      &lt;td&gt;&lt;?php echo $row['gender']?&gt;&lt;/td&gt;\r\n    &lt;/tr&gt;\r\n    &lt;?php $i++; }\r\n\t } ?&gt;\r\n  &lt;/tbody&gt;\r\n&lt;/table&gt;\r\n&lt;br /&gt;\r<br />\n&lt;br /&gt;\r<br />\n&lt;/body&gt;\r<br />\n&lt;/html&gt;<br />\n",
    "PostedDate": "2014-02-07T06:31:41.13-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]