[
  {
    "Id": "546161",
    "ThreadId": "241008",
    "Html": "\r\n<p>Hello</p>\r\n<p>Im trying to make a dynamic php document wich renders as an Excel 97-2003 document. I can get the Excel document to work and everything, but when i start collecting data from my database thrugh normal mysql_query() requests i can't download my document anymore,\r\n it just errors :(</p>\r\n<p>The working code is as followed:</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:green\">    //====================================</span>\r\n    <span style=\"color:green\">// Start af Excel dokument</span>\r\n    <span style=\"color:green\">//====================================    </span>\r\n    <span style=\"color:green\">// Header</span>\r\n    header(<span style=\"color:#a31515\">&quot;Content-type: application/vnd.ms-excel&quot;</span>);\r\n    header(<span style=\"color:#a31515\">&quot;Content-Disposition: attachment; filename=&quot;</span>.$filename.<span style=\"color:#a31515\">&quot;&quot;</span>);\r\n    header(<span style=\"color:#a31515\">'Cache-Control: max-age=0'</span>);\r\n\r\n    <span style=\"color:blue\">require_once</span> <span style=\"color:#a31515\">'class/PHPExcel.php'</span>;\r\n    <span style=\"color:blue\">require_once</span> <span style=\"color:#a31515\">'class/PHPExcel/IOFactory.php'</span>;\r\n\r\n    <span style=\"color:green\">// Database og filnavn</span>\r\n    $filename = <span style=\"color:#a31515\">&quot;holdliste.xls&quot;</span>;\r\n    $database = <span style=\"color:#a31515\">&quot;tap_hold&quot;</span>;\r\n    \r\n    $objPHPExcel = <span style=\"color:blue\">new</span> PHPExcel();\r\n\r\n    <span style=\"color:green\">// S�tter indstillinger for Excel Ark</span>\r\n    $objPHPExcel-&gt;getProperties()-&gt;setCreator(<span style=\"color:#a31515\">&quot;Thor Astrup Pedersen&quot;</span>)\r\n                         -&gt;setLastModifiedBy(<span style=\"color:#a31515\">&quot;Thor Astrup Pedersen&quot;</span>)\r\n                         -&gt;setTitle(<span style=\"color:#a31515\">&quot;Tricking &amp; Parkour Holdet i VIK&quot;</span>)\r\n                         -&gt;setSubject(<span style=\"color:#a31515\">&quot;Hold Liste&quot;</span>)\r\n                         -&gt;setDescription(<span style=\"color:#a31515\">&quot;Holdmedlemmer for Tricking &amp; Parkour Holdet i VIK.&quot;</span>)\r\n                         -&gt;setKeywords(<span style=\"color:#a31515\">&quot;Tricking Parkour holdliste thor astrup pedersen&quot;</span>)\r\n                         -&gt;setCategory(<span style=\"color:#a31515\">&quot;Sport&quot;</span>);\r\n    \r\n    <span style=\"color:green\">// S�tter overskrifter</span>\r\n    $objPHPExcel-&gt;setActiveSheetIndex(0);\r\n    $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A1'</span>, <span style=\"color:#a31515\">&quot;#&quot;</span>);\r\n    $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B1'</span>, <span style=\"color:#a31515\">&quot;Fulde Navn&quot;</span>);\r\n    $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C1'</span>, <span style=\"color:#a31515\">&quot;Alder&quot;</span>);\r\n    $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'D1'</span>, <span style=\"color:#a31515\">&quot;Adresse&quot;</span>);\r\n    $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'E1'</span>, <span style=\"color:#a31515\">&quot;Telefon&quot;</span>);\r\n    $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'F1'</span>, <span style=\"color:#a31515\">&quot;Email&quot;</span>);\r\n    \r\n    <span style=\"color:green\">// Henter bruger data</span>\r\n    $sql = <span style=\"color:#a31515\">&quot;SELECT * FROM `&quot;</span>.$database.<span style=\"color:#a31515\">&quot;` WHERE `godkendt`='1' ORDER BY fullname ASC&quot;</span>;\r\n    $query = mysql_query($sql) <span style=\"color:blue\">or</span> <span style=\"color:blue\">die</span>(mysql_error());\r\n    \r\n    <span style=\"color:green\">/* THIS IS WHERE MY DOCUMENT GOES ROUGE! */</span>\r\n    \r\n    <span style=\"color:green\">// Formatere Celler s� det ser p�nt ud</span>\r\n    $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension(<span style=\"color:#a31515\">'A'</span>)-&gt;setAutoSize(true);\r\n    $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension(<span style=\"color:#a31515\">'B'</span>)-&gt;setAutoSize(true);\r\n    $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension(<span style=\"color:#a31515\">'C'</span>)-&gt;setAutoSize(true); \r\n    $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension(<span style=\"color:#a31515\">'D'</span>)-&gt;setAutoSize(true); \r\n    $objPHPExcel-&gt;getActiveSheet()-&gt;getColumnDimension(<span style=\"color:#a31515\">'F'</span>)-&gt;setAutoSize(true);\r\n    \r\n    $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'A1:F1'</span>)-&gt;getFill()-&gt;setFillType(PHPExcel_Style_Fill::FILL_SOLID);\r\n    $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'A1:F1'</span>)-&gt;getFill()-&gt;getStartColor()-&gt;setARGB(<span style=\"color:#a31515\">'FF9bbb59'</span>);\r\n    $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#a31515\">'A1:F1'</span>)-&gt;getFont()-&gt;getColor()-&gt;setARGB(PHPExcel_Style_Color::COLOR_WHITE); \r\n    \r\n    <span style=\"color:green\">// Renamer sheetet</span>\r\n    $objPHPExcel-&gt;getActiveSheet()-&gt;setTitle(<span style=\"color:#a31515\">'Holdliste'</span>);\r\n        \r\n    <span style=\"color:green\">// Afslutter Excel Ark</span>\r\n    $objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color:#a31515\">'Excel5'</span>);\r\n    $objWriter-&gt;save(<span style=\"color:#a31515\">'php://output'</span>);\r\n    <span style=\"color:blue\">exit</span>;\r\n    <span style=\"color:green\">//====================================</span>\r\n    <span style=\"color:green\">// Slut af Excel dokument</span>\r\n    <span style=\"color:green\">//====================================</span>\r\n</pre>\r\n</div>\r\n<p>Where i wrote on english (sorry the rest of the comments is in danish)&nbsp;<strong>/* THIS IS WHERE MY DOCUMENT GOES ROUGE! */\r\n</strong>is where i get my data from my database and plot them into the excel document.</p>\r\n<p>This is the fetch and plot code of my data:</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:green\">// Henter bruger data</span>\r\n    $sql = <span style=\"color:#a31515\">&quot;SELECT * FROM `&quot;</span>.$database.<span style=\"color:#a31515\">&quot;` WHERE `godkendt`='1' ORDER BY fullname ASC&quot;</span>;\r\n    $query = mysql_query($sql) <span style=\"color:blue\">or</span> <span style=\"color:blue\">die</span>(mysql_error());\r\n    \r\n    <span style=\"color:green\">// Inds�tter folk i Excel Ark</span>\r\n    $row = 2; <span style=\"color:green\">// Hvilken r�kke folk starter med at blive listet i</span>\r\n    <span style=\"color:blue\">while</span>($d = mysql_fetch_array($query))\r\n    {\r\n        <span style=\"color:green\">// Henter bruger of s�tter f�dselsdag</span>\r\n        $date       = date(<span style=\"color:#a31515\">&quot;d-m-Y&quot;</span>, $d[<span style=\"color:#a31515\">'fodselsdag'</span>]);\r\n        $bruger     = $this-&gt;login-&gt;getUser($d[<span style=\"color:#a31515\">'userid'</span>]);\r\n        \r\n        <span style=\"color:green\">// Adresse formatering</span>\r\n        $adresse    = $d[<span style=\"color:#a31515\">'adresse'</span>] . <span style=\"color:#a31515\">&quot;, &quot;</span> . $d[<span style=\"color:#a31515\">'postnr'</span>] . <span style=\"color:#a31515\">&quot; &quot;</span> . $d[<span style=\"color:#a31515\">'by'</span>];\r\n        $adresse    = utf8_encode($adresse);\r\n        \r\n        <span style=\"color:green\">// Telefon formatering</span>\r\n        $telefon = $d[<span style=\"color:#a31515\">'telefon'</span>];\r\n        $telefon = str_replace(<span style=\"color:#a31515\">&quot; &quot;</span>, <span style=\"color:#a31515\">&quot;&quot;</span>, $telefon); <span style=\"color:green\">// fjerner mellemrum            </span>\r\n        \r\n        <span style=\"color:green\">// ID formatting</span>\r\n        $id = $row-1;\r\n        \r\n        $objPHPExcel-&gt;setActiveSheetIndex(0); \r\n        $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'A'</span> . $row, $id);\r\n        $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'B'</span> . $row, $d[<span style=\"color:#a31515\">'fullname'</span>]);\r\n        $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'C'</span> . $row, $date);\r\n        $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'D'</span> . $row, $adresse);\r\n        $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'E'</span> . $row, $telefon);\r\n        $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#a31515\">'F'</span> . $row, $bruger[<span style=\"color:#a31515\">'email'</span>]);\r\n        $row&#43;&#43;;  \r\n    }\r\n</pre>\r\n</div>\r\n<p>When i paste this in already when i only paste in the $sql and $query lines in the beginning it stops working!? What am I doing wrong? (again sorry for the danish comments)</p>\r\n<p>Best Regards,<br>\r\nThor The Dane&nbsp;</p>\r\n",
    "PostedDate": "2011-01-09T02:03:34.227-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "546356",
    "ThreadId": "241008",
    "Html": "\r\n<p>First question: what exactly do you mean by &quot;going rogue&quot;? You say it errors: what error message do you get?</p>\r\n<p>What encoding are you using in your database?</p>\r\n",
    "PostedDate": "2011-01-09T14:27:45.36-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "546368",
    "ThreadId": "241008",
    "Html": "\r\n<p>Just a quick reply here, remember to go from:</p>\r\n<pre>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span>'A'</span> . $row, $id);</pre>\r\n<pre>to</pre>\r\n<pre><pre>$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span>'A'</span> . $row, utf8_encode($id));</pre>\r\n<pre><br></pre>\r\n<pre>If you didn't see it, utf8_encode() for the value inserted.</pre>\r\n<pre>Regards,</pre>\r\n<pre>Kim Steinhaug, <a href=\"mailto:kim@steinhaug.com\">kim@steinhaug.com</a>, <a href=\"http://www.easywebshop.no/\">www.easywebshop.no</a></pre>\r\n</pre>\r\n<p>&nbsp;</p>\r\n",
    "PostedDate": "2011-01-09T15:01:00.807-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "546567",
    "ThreadId": "241008",
    "Html": "\r\n<p>Hi,</p>\r\n<p>&nbsp;</p>\r\n<p>I don't see a mysql_connect() call anywehere, are you sure a db connection is available? Since you use a die() if the query fails, are yiou sure the query actually succeeds? Furthermore, if you want mysql to output utf8 character encodings, you have to tell\r\n it explicitly to do so, otherwise strange results may occur. I don't see the point of utf8-encoding an integer value anyway.</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>Mike</p>\r\n",
    "PostedDate": "2011-01-10T03:24:30.407-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "546669",
    "ThreadId": "241008",
    "Html": "\r\n<p>i was about to write i testet out some minor things, and then found a stupid ass error :P<br>\r\nmy bad!!</p>\r\n<p>I was getting my user information through this line of code:</p>\r\n<pre>$this-&gt;login-&gt;getUser($d[<span style=\"color:#a31515\">'userid'</span>]);<br></pre>\r\n<p>and what i should have done (i made this loop in a class some months ago) is call: &quot;$cms-&gt;getUser($id)&quot; DOH!!!</p>\r\n<p>My bad everybody :P</p>\r\n",
    "PostedDate": "2011-01-10T06:11:12.403-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]