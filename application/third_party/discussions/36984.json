[
  {
    "Id": "122679",
    "ThreadId": "36984",
    "Html": "Does anyone have sample code for doing this? I'd like to read in a number of Excel files (xlsx format), each with multiple worksheets and named data ranges, and append the sheets to a larger file so that in the end I have one large workbook with multiple sheets - preserving the sheetnames and named data ranges. Â <div><br></div><div>Thanks in advance,</div><div>Marisa</div>",
    "PostedDate": "2008-10-03T08:27:54.287-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "122876",
    "ThreadId": "36984",
    "Html": "<p>You may try out the following:<br> <br> <code> $filenames = array('doc1.xlsx', 'doc2.xlsx');<br> <br> $bigExcel = new PHPExcel();<br> $bigExcel-&gt;removeSheetByIndex(0);<br> <br> $reader = new PHPExcel_Reader_Excel2007();<br> <br> foreach ($filenames as $filename) {<br> &nbsp;&nbsp;&nbsp; $excel = $reader-&gt;load($filename);<br> &nbsp;&nbsp;&nbsp; <br> &nbsp;&nbsp;&nbsp; foreach ($excel-&gt;getAllSheets() as $sheet) {<br> &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $bigExcel-&gt;addExternalSheet($sheet);<br> &nbsp;&nbsp;&nbsp; }<br> &nbsp;&nbsp;&nbsp; <br> &nbsp;&nbsp;&nbsp; foreach ($excel-&gt;getNamedRanges() as $namedRange) {<br> &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $bigExcel-&gt;addNamedRange($namedRange);<br> &nbsp;&nbsp;&nbsp; }<br> }<br> <br> $writer = new PHPExcel_Writer_Excel2007($bigExcel);<br> $writer-&gt;save('2007-write.xlsx');<br> </code> <br> Note that if some of the sheet have identical names, then <span style=\"font-family:Courier New\">addExternalSheet()</span> will throw an exception.</p>\r\n<p><strong>Edit</strong>: Corrected <span style=\"font-family:Courier New\">addSheet($sheet)</span> to <span style=\"font-family:Arial\"><span style=\"font-family:Courier New\">addExternalSheet($sheet)</span> so that styles will not be messed up in PHPExcel 1.7.0.</span></p>",
    "PostedDate": "2008-10-04T09:58:28.183-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "212776",
    "ThreadId": "36984",
    "Html": "<p>Sorry to be a thread Necro, but I'm having a bit of a problem with this when trying to combine multiple sheets each with 10,000 records.</p>\r\n<p>What I'm doing to save my server memory is creating these sheets one at a time using the exec() function so that the memory gets cleared every time one is completed. Before when I didn't do that and just creating each one in a for loop it wasn't releasing the memory and it was getting up to 1.8gigs going through 40,000 rows in a query.&nbsp; Now it takes up just ~480megs per 10,000 records which is fine.&nbsp; The way I'm trying to combine these is looping through the sheets and combining them into one another one at a time. This works if there are only a couple but when it gets to around 3 or 4 sheets, it starts sucking up tons of memory since two sheets have to be loaded into memory for one of them to be inserted into the other.</p>\r\n<p>My question is: Is there a way to load an excel file without having to put all the rows into memory and just save a sheet from another excel file into it, also without having to load all those rows as well?&nbsp; Loading two excel files into memory one with 30,000 rows and the other with 10,000 rows is just a bit much for my server to handle heh.</p>\r\n<p>I appreciate any response.&nbsp; Thank you!</p>",
    "PostedDate": "2009-07-16T14:27:39.547-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "213127",
    "ThreadId": "36984",
    "Html": "<p>@meenie</p>\r\n<p><em>&gt;&gt; Is there a way to load an excel file without having to put all the rows into memory<br> &gt;&gt; and just save a sheet from another excel file into it, also without having to load all<br> &gt;&gt; those rows as well?</em><br><br>The reader can be set to load only specific sheets. There is an example here where only a single sheet is loaded:<br><a href=\"View.aspx?ThreadId=62528\">http://phpexcel.codeplex.com/Thread/View.aspx?ThreadId=62528</a><br> <br> You can also decide to load specific cells only. Check out <span style=\"font-family:Courier New\">24readfilter.php</span> in the Tests folder.<br> <br> <em>&gt;&gt; Now it takes up just ~480megs per 10,000 records which is fine.</em><br> <br> This sounds like very high memory usage. Are you using PHPExcel 1.6.7 or the latest source code? Latest source code is likely to give you much better results.</p>",
    "PostedDate": "2009-07-17T10:42:25.267-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "213208",
    "ThreadId": "36984",
    "Html": "<p>Okay, loading one sheet when loading up the main workgroup spreadsheet would probably save a lot of memory when it starts to have multiple sheets in it :).&nbsp; The thing is when I do that, it keeps on writing over the second sheet.&nbsp; So if I have 5 sheets to combine it does the first one, then the next time it only loads the first one and puts the second one in the second slot, then the next time it only loads the first one an puts the third one in the second slot overwriting the second sheet and so on.&nbsp; So at the end I only have sheets 1 and 6 in the workbook heh.&nbsp; This is the code I'm using:</p>\r\n<pre style=\"padding-left:30px\"><div style=\"color:Black;background-color:White\"><pre>    <span style=\"color:Blue\">function</span> create_workbook()\r\n    {\r\n        ini_set(<span style=\"color:#A31515\">'max_execution_time'</span>, 300);\r\n        ini_set(<span style=\"color:#A31515\">&quot;memory_limit&quot;</span>, <span style=\"color:#A31515\">&quot;512M&quot;</span>);\r\n        $<span style=\"color:Blue\">this</span>-&gt;load-&gt;library(<span style=\"color:#A31515\">'excel'</span>);\r\n        \r\n        $sheet = $_GET[<span style=\"color:#A31515\">'sheet'</span>];\r\n        $workbook = $_GET[<span style=\"color:#A31515\">'workbook'</span>];\r\n        $format = $_GET[<span style=\"color:#A31515\">'format'</span>];\r\n        \r\n        $workbook = $<span style=\"color:Blue\">this</span>-&gt;excel-&gt;load_one_sheet($workbook, $format, <span style=\"color:#A31515\">'Subscribers Sheet 1'</span>);\r\n        $sheet = $<span style=\"color:Blue\">this</span>-&gt;excel-&gt;load($sheet, $format);\r\n            \r\n        $workbook-&gt;addExternalSheet($sheet-&gt;getSheet(0));\r\n        \r\n        $extension = $format == <span style=\"color:#A31515\">'Excel2007'</span> ? <span style=\"color:#A31515\">'.xlsx'</span> : <span style=\"color:#A31515\">'.xls'</span>;\r\n        $filename = BASEPATH . <span style=\"color:#A31515\">'cache/'</span> . time() . $extension;\r\n        \r\n        $excelWriter = PHPExcel_IOFactory::createWriter($workbook, $format);\r\n        $excelWriter-&gt;save($filename);\r\n        \r\n        <span style=\"color:Blue\">echo</span> $filename;\r\n    }\r\n</pre>\r\n</div>\r\n</pre>\r\n<p>And this is the code I'm using to call that function ($filenames is the array of filenames from when the individual sheet's where created.):</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre>        $workbook = <span style=\"color:#A31515\">''</span>;\r\n        $count = 1;\r\n        $num_of_sheets = count($filenames);\r\n        $first = array_shift($filenames);\r\n        <span style=\"color:Blue\">foreach</span> ($filenames <span style=\"color:Blue\">as</span> $filename)\r\n        {\r\n            <span style=\"color:Blue\">if</span> ($workbook == <span style=\"color:#A31515\">''</span>)\r\n            {\r\n                $workbook = str_replace(<span style=\"color:#A31515\">&quot;&lt;/div&gt;&quot;</span>, <span style=\"color:#A31515\">''</span>, exec(<span style=\"color:#A31515\">&quot;php index.php c=subscribers m=create_workbook sheet={$filename} format={$format} workbook={$first}&quot;</span>));\r\n            }\r\n            <span style=\"color:Blue\">else</span>\r\n            {\r\n                $workbook = str_replace(<span style=\"color:#A31515\">&quot;&lt;/div&gt;&quot;</span>, <span style=\"color:#A31515\">''</span>, exec(<span style=\"color:#A31515\">&quot;php index.php c=subscribers m=create_workbook sheet={$filename} format={$format} workbook={$workbook}&quot;</span>));\r\n            }\r\n            $count++;\r\n            \r\n            unlink($filename);\r\n            \r\n            <span style=\"color:Blue\">if</span> ($count != $num_of_sheets)\r\n            {\r\n                $delete_workbooks[] = $workbook;\r\n            }\r\n        }\r\n        <span style=\"color:Blue\">foreach</span> ($delete_workbooks <span style=\"color:Blue\">as</span> $delete_workbook)\r\n        {\r\n            unlink($delete_workbook);\r\n        }\r\n        \r\n        $ext = $format == <span style=\"color:#A31515\">'Excel2007'</span> ? <span style=\"color:#A31515\">'.xlsx'</span> : <span style=\"color:#A31515\">'.xls'</span>;\r\n        $<span style=\"color:Blue\">this</span>-&gt;send_to_browser($workbook, $ext);\r\n</pre>\r\n</div>",
    "PostedDate": "2009-07-17T14:39:26.37-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "213211",
    "ThreadId": "36984",
    "Html": "<p>And to answer your second question, I'm creating a sheet with 19 columns and each sheet has 10000 rows.</p>\r\n<p>To see if I was doing something wrong I ran one of your test scripts called 06largscale.php, made it so it would do 19 columns and 10,000 rows and it came out to using the same amount of RAM.<br>And yes, I am using source code: phpexcel-28167.zip.</p>",
    "PostedDate": "2009-07-17T14:43:39.403-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "213288",
    "ThreadId": "36984",
    "Html": "<p>In the development snapshot, there seemed to be a bug in PHPExcel_Reader_Excel5 which could cause the weirdness you are describing when reading multiple xls files with the same instance of the reader.<br> <br> Can you try with the next source code release?<br> <a href=\"../SourceControl/ListDownloadableCommits.aspx\">http://phpexcel.codeplex.com/SourceControl/ListDownloadableCommits.aspx</a></p>",
    "PostedDate": "2009-07-17T20:28:01.45-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "213532",
    "ThreadId": "36984",
    "Html": "<p>I've tried the newest release but no, it's still taking up ~450megs of RAM to create a sheet of 10,000 rows with 19 columns.</p>\r\n<p>Also when trying to combine the sheets, each sheet that gets loaded adds ~450megs.&nbsp; So if I open the first one and the second one and add the second one to the first one it takes ~900megs.&nbsp; Then when opening the workbook with the first and second sheets to add a third sheet it takes around ~1.35 gigs.&nbsp; Then when adding a forth sheet to the first 3, it takes ~1.8 gigs.&nbsp; This is not good heh</p>\r\n<p>If I use the method you were talking about above about only opening one sheet, at the end I end up with a workbook that has the first sheet and the fifth sheet only.</p>\r\n<p>So ya...I wish there was an easier way to combine sheets into workbooks without having to load them all into memory.</p>",
    "PostedDate": "2009-07-19T04:57:20.14-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "213637",
    "ThreadId": "36984",
    "Html": "<p><em>&gt;&gt; If I use the method you were talking about above about only opening one sheet, at the end I end up with a workbook that has the first sheet and the fifth sheet only.<br> </em><br> Is it possible that you can provide a mini test case for this problem. I tried to reconstruct the error, but I couldn't.<br> <br> For example, I cannot see what the <span style=\"font-family:Courier New\">load_one_sheet()</span> method does. Not sure either if you are reading <span style=\"font-family:Courier New\">xls</span> or <span style=\"font-family:Courier New\">xlsx</span> files.</p>",
    "PostedDate": "2009-07-19T17:24:05.49-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "213640",
    "ThreadId": "36984",
    "Html": "<p>Sure :) - I'm using CodeIgniter as my framework and an class that interfaces with phpexcell and codeigniter. I'm trying to create Excell2007 files, not having much luck with Excell5 at the moment, but I'm not too worried until I can get the Excell2007 working correctly.&nbsp; I've created a function called 'load_one_sheet' like this:</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre><span style=\"color:Blue\">    function</span> load_one_sheet($<span style=\"color:Blue\">file</span>, $format, $sheet_name)\r\n    {\r\n        $reader = PHPExcel_IOFactory::createReader($format);\r\n        $reader-&gt;setReadDataOnly(TRUE);\r\n        $reader-&gt;setReadFiltersetLoadSheetsOnly($sheet_name);\r\n        <span style=\"color:Blue\">return</span> $reader-&gt;load($<span style=\"color:Blue\">file</span>);\r\n    }\r\n<br>My other load function just called 'load' is this:<br><div style=\"color:Black;background-color:White\"><pre>    <span style=\"color:Blue\">function</span> load($<span style=\"color:Blue\">file</span>, $format)\r\n    {\r\n        $reader = PHPExcel_IOFactory::createReader($format);\r\n        $reader-&gt;setReadDataOnly(TRUE);\r\n        <span style=\"color:Blue\">return</span> $reader-&gt;load($<span style=\"color:Blue\">file</span>);\r\n    }\r\n</pre>\r\n</div>\r\nThe way I'm creating my sheets is in my controller I'm doing this:<br>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre>        $query = $<span style=\"color:Blue\">this</span>-&gt;db-&gt;query(&quot;SELECT `subscribers`.*\r\n                                   FROM (`subscribers`)\r\n                                   LEFT JOIN `users` <span style=\"color:Blue\">as</span> users ON `users`.`id` =\r\n                                       `subscribers`.`user_id`\r\n                                   WHERE `users`.`client_id` = <span style=\"color:#A31515\">'{$client_id}'</span>&quot;);\r\n        \r\n        $limit = ROWS_PER_SHEET; //This is set at 10000\r\n        $num_of_rows = $query-&gt;num_rows();\r\n        \r\n        $num_of_sheets = ceil($num_of_rows / $limit);\r\n\r\n        <span style=\"color:Blue\">for</span> ($count = 1; $count &lt;= $num_of_sheets; $count++)\r\n        {\r\n            $filenames[] = str_replace(<span style=\"color:#A31515\">&quot;&lt;/div&gt;&quot;</span>, <span style=\"color:#A31515\">''</span>, exec(<span style=\"color:#A31515\">&quot;php index.php c=subscribers m=create_sheet count={$count} limit={$limit} client_id={$u-&gt;client_id} format={$format}&quot;</span>));\r\n        }\r\n<br>The exec() is calling this function inside the controller (the reason I'm using exec is so that php will release the memory after each sheet is made, other wise it just keeps on sucking it all up until each sheet is made):<br><div style=\"color:Black;background-color:White\"><pre>    <span style=\"color:Blue\">function</span> create_sheet()\r\n    {\r\n        ini_set(<span style=\"color:#A31515\">'max_execution_time'</span>, 300);\r\n        ini_set(<span style=\"color:#A31515\">&quot;memory_limit&quot;</span>, <span style=\"color:#A31515\">&quot;512M&quot;</span>);\r\n        $<span style=\"color:Blue\">this</span>-&gt;load-&gt;library(<span style=\"color:#A31515\">'excel'</span>);\r\n        $count = $_GET[<span style=\"color:#A31515\">'count'</span>];\r\n        $limit = $_GET[<span style=\"color:#A31515\">'limit'</span>];\r\n        $format = $_GET[<span style=\"color:#A31515\">'format'</span>];\r\n        $client_id = $_GET[<span style=\"color:#A31515\">'client_id'</span>];\r\n\r\n        $offset = ($count - 1) * $limit;\r\n            \r\n        $query = $<span style=\"color:Blue\">this</span>-&gt;db-&gt;query(&quot;SELECT `subscribers`.*\r\n                               FROM (`subscribers`)\r\n                               LEFT JOIN `users` <span style=\"color:Blue\">as</span> users ON `users`.`id` =\r\n                                   `subscribers`.`user_id`\r\n                               WHERE `users`.`client_id` = <span style=\"color:#A31515\">'{$client_id}'</span>\r\n                               LIMIT {$limit} OFFSET {$offset}&quot;);\r\n\r\n        $sheet_name = <span style=\"color:#A31515\">&quot;Subscribers Sheet {$count}&quot;</span>;\r\n        \r\n        <span style=\"color:Blue\">echo</span> $<span style=\"color:Blue\">this</span>-&gt;excel-&gt;create_sheet($query, $format, $sheet_name, $count);\r\n    }\r\n</pre>\r\n</div>\r\nAnd finally, the 'create_sheet' function I'm using in my class that interfaces between phpexcel and codeigniter is this:<br>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre>    <span style=\"color:Blue\">function</span> create_sheet($query, $format, $sheet_name, $count)\r\n    {\r\n        $CI =&amp; get_instance();\r\n        \r\n        $<span style=\"color:Blue\">this</span>-&gt;new_workbook();\r\n  \r\n        $<span style=\"color:Blue\">this</span>-&gt;workbook-&gt;setActiveSheetIndex(0)-&gt;setTitle($sheet_name)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'A1'</span>, <span style=\"color:#A31515\">'Title'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'B1'</span>, <span style=\"color:#A31515\">'First name'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'C1'</span>, <span style=\"color:#A31515\">'Last Name'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'D1'</span>, <span style=\"color:#A31515\">'Email'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'E1'</span>, <span style=\"color:#A31515\">'Gender'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'F1'</span>, <span style=\"color:#A31515\">'Address Line 1'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'G1'</span>, <span style=\"color:#A31515\">'Address Line 2'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'H1'</span>, <span style=\"color:#A31515\">'Suburb'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'I1'</span>, <span style=\"color:#A31515\">'State'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'J1'</span>, <span style=\"color:#A31515\">'Country'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'K1'</span>, <span style=\"color:#A31515\">'Post Code'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'L1'</span>, <span style=\"color:#A31515\">'Home Phone'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'M1'</span>, <span style=\"color:#A31515\">'Work Phone'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'N1'</span>, <span style=\"color:#A31515\">'Mobile Phone'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'O1'</span>, <span style=\"color:#A31515\">'Fax'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'P1'</span>, <span style=\"color:#A31515\">'Birthdate'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'Q1'</span>, <span style=\"color:#A31515\">'Orginisation'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'R1'</span>, <span style=\"color:#A31515\">'Comments'</span>)\r\n        -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'S1'</span>, <span style=\"color:#A31515\">'ID'</span>);\r\n\r\n        $i = 2;\r\n        <span style=\"color:Blue\">foreach</span> ($query-&gt;result() <span style=\"color:Blue\">as</span> $subscriber)\r\n        {\r\n            $<span style=\"color:Blue\">this</span>-&gt;workbook-&gt;setActiveSheetIndex(0)-&gt;setCellValueExplicit(<span style=\"color:#A31515\">'A'</span>.$i, $subscriber-&gt;title)\r\n            -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'B'</span>.$i, $subscriber-&gt;first_name)\r\n            -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'C'</span>.$i, $subscriber-&gt;last_name)\r\n            -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'D'</span>.$i, $subscriber-&gt;email)\r\n            -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'E'</span>.$i, $subscriber-&gt;gender)\r\n            -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'F'</span>.$i, $subscriber-&gt;address_line_1)\r\n            -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'G'</span>.$i, $subscriber-&gt;address_line_2)\r\n            -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'H'</span>.$i, $subscriber-&gt;suburb);\r\n            $query = $CI-&gt;db-&gt;query(&quot;SELECT `states`.*\r\n                                       FROM (`states`)\r\n                                       LEFT JOIN `subscribers` <span style=\"color:Blue\">as</span> subscribers ON `states`.`id` =\r\n                                           `subscribers`.`state_id`\r\n                                       WHERE `subscribers`.`id` = <span style=\"color:#A31515\">'{$subscriber-&gt;id}'</span>&quot;);\r\n            $state = $query-&gt;row();\r\n            $<span style=\"color:Blue\">this</span>-&gt;workbook-&gt;setActiveSheetIndex(0)-&gt;setCellValueExplicit(<span style=\"color:#A31515\">'I'</span>.$i, $state-&gt;name);\r\n            $query = $CI-&gt;db-&gt;query(&quot;SELECT `countries`.`name`\r\n                                       FROM (`countries`)\r\n                                       LEFT JOIN `states` <span style=\"color:Blue\">as</span> states ON `countries`.`id` =\r\n                                           `states`.`country_id`\r\n                                       WHERE `states`.`id` = <span style=\"color:#A31515\">'{$state-&gt;id}'</span>&quot;);\r\n            $country = $query-&gt;row();\r\n            $<span style=\"color:Blue\">this</span>-&gt;workbook-&gt;setActiveSheetIndex(0)-&gt;setCellValueExplicit(<span style=\"color:#A31515\">'J'</span>.$i, $country-&gt;name)\r\n            -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'K'</span>.$i, $subscriber-&gt;post_code)\r\n            -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'L'</span>.$i, $subscriber-&gt;home_phone)\r\n            -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'M'</span>.$i, $subscriber-&gt;work_phone)\r\n            -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'N'</span>.$i, $subscriber-&gt;mobile_phone)\r\n            -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'O'</span>.$i, $subscriber-&gt;fax)\r\n            -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'P'</span>.$i, date(<span style=\"color:#A31515\">'d/m/Y'</span>, $subscriber-&gt;birthdate))\r\n            -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'Q'</span>.$i, $subscriber-&gt;orginisation)\r\n            -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'R'</span>.$i, $subscriber-&gt;comments)\r\n            -&gt;setCellValueExplicit(<span style=\"color:#A31515\">'S'</span>.$i, $subscriber-&gt;id);\r\n\r\n            $i++;\r\n        }\r\n        $extension = $format == <span style=\"color:#A31515\">'Excel2007'</span> ? <span style=\"color:#A31515\">'.xlsx'</span> : <span style=\"color:#A31515\">'.xls'</span>;\r\n        $filename = BASEPATH . <span style=\"color:#A31515\">'cache/'</span> . time() . $extension;\r\n        \r\n        $excelWriter = PHPExcel_IOFactory::createWriter($<span style=\"color:Blue\">this</span>-&gt;workbook, $format);\r\n        \r\n        $excelWriter-&gt;save($filename); \r\n        <span style=\"color:Blue\">unset</span>($excelWriter);\r\n        <span style=\"color:Blue\">unset</span>($<span style=\"color:Blue\">this</span>-&gt;workbook);\r\n\r\n        <span style=\"color:Blue\">return</span> $filename;\r\n    }<br><br>Those 3 functions get called just before the code I posted earlier that creates the workbook.  Now if I don't use the 'load_one_sheet' function and just use 'load' it will take up that 1.8gigs of ram when working with 5 sheets.  If I do use that function, I end up with a workbook that has Sheet 1 and Sheet 5 only.</pre>\r\n</div>\r\n</pre>\r\n</div>\r\n</pre>\r\n</div>",
    "PostedDate": "2009-07-19T17:42:43.063-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "214116",
    "ThreadId": "36984",
    "Html": "<p>I looked at your code, there is quite a lot, but I am not able to see where things go wrong. For example I'm not sure what the <span style=\"font-family:Courier New\">setReadFiltersetLoadSheetsOnly()</span> method does.<br> <br> Instead of asking you to post more code I tried a simple script.<br> <br> Let's say I have 3 Excel files:<span style=\"font-family:Courier New\"> 'apple.xlsx', 'banana.xlsx', 'citrus.xlsx'</span>.<br> <br style=\"font-family:Courier New\"> <span style=\"font-family:Courier New\">apple.xlsx has 3 sheets: 'apple1', 'apple2', 'apple3'</span><br style=\"font-family:Courier New\"> <span style=\"font-family:Courier New\">banana.xlsx has 4 sheets: 'banana1', 'banana2', 'banana3', 'banana4'</span><br style=\"font-family:Courier New\"> <span style=\"font-family:Courier New\">citrus.xlsx has 2 sheets: 'citrus1', 'citrus2'</span><br> <br> Here is how they look:<br> <a href=\"http://img404.imageshack.us/img404/6246/microsoftexcelapplexlsx.png\">http://img404.imageshack.us/img404/6246/microsoftexcelapplexlsx.png</a><br> <a href=\"http://img404.imageshack.us/img404/5777/microsoftexcelbananaxls.png\">http://img404.imageshack.us/img404/5777/microsoftexcelbananaxls.png</a><br> <a href=\"http://img404.imageshack.us/img404/2972/microsoftexcelcitrusxls.png\">http://img404.imageshack.us/img404/2972/microsoftexcelcitrusxls.png</a><br> <br> I want to create a workbook <span style=\"font-family:Courier New\">2007-write.xlsx</span> containing sheets <span style=\"font-family:Courier New\">'apple1', 'apple2', 'banana2', 'banana4', 'citrus2'</span><br> <br> Here is my script that combines them (disregarding defined names):<br>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre>\r\n$filenames = <span style=\"color:Blue\">array</span>(<span style=\"color:#A31515\">'apple.xlsx'</span>, <span style=\"color:#A31515\">'banana.xlsx'</span>, <span style=\"color:#A31515\">'citrus.xlsx'</span>);\r\n\r\n$bigExcel = <span style=\"color:Blue\">new</span> PHPExcel();\r\n$bigExcel-&gt;removeSheetByIndex(0);\r\n\r\n$reader = <span style=\"color:Blue\">new</span> PHPExcel_Reader_Excel2007();\r\n\r\n<span style=\"color:Blue\">foreach</span> ($filenames <span style=\"color:Blue\">as</span> $filename) {\r\n    <span style=\"color:Blue\">switch</span> ($filename) {\r\n        <span style=\"color:Blue\">case</span> <span style=\"color:#A31515\">'apple.xlsx'</span>:        $loadSheetsOnly = <span style=\"color:Blue\">array</span>(<span style=\"color:#A31515\">'apple1'</span>, <span style=\"color:#A31515\">'apple2'</span>);    <span style=\"color:Blue\">break</span>;\r\n        <span style=\"color:Blue\">case</span> <span style=\"color:#A31515\">'banana.xlsx'</span>:        $loadSheetsOnly = <span style=\"color:Blue\">array</span>(<span style=\"color:#A31515\">'banana2'</span>, <span style=\"color:#A31515\">'banana4'</span>);    <span style=\"color:Blue\">break</span>;\r\n        <span style=\"color:Blue\">case</span> <span style=\"color:#A31515\">'citrus.xlsx'</span>:        $loadSheetsOnly = <span style=\"color:Blue\">array</span>(<span style=\"color:#A31515\">'citrus2'</span>);                <span style=\"color:Blue\">break</span>;\r\n    }\r\n    \r\n    $reader-&gt;setReadDataOnly(true);\r\n    $reader-&gt;setLoadSheetsOnly($loadSheetsOnly);\r\n    $excel = $reader-&gt;load($filename);\r\n\r\n    <span style=\"color:Blue\">foreach</span> ($excel-&gt;getAllSheets() <span style=\"color:Blue\">as</span> $sheet) {\r\n        $bigExcel-&gt;addExternalSheet($sheet);\r\n    }\r\n}\r\n\r\n$writer = <span style=\"color:Blue\">new</span> PHPExcel_Writer_Excel2007($bigExcel);\r\n$writer-&gt;save(<span style=\"color:#A31515\">'2007-write.xlsx'</span>);\r\n</pre>\r\n</div>\r\n<br> <br> Here is the result:<br> <a href=\"http://img404.imageshack.us/img404/2623/microsoftexcel2007write.png\">http://img404.imageshack.us/img404/2623/microsoftexcel2007write.png</a><br> <br> As you can see the result is as expected. There are no missing sheets, or sheets going into wrong slots.<br> <br> Can you try to compare the above code with your code and see if they differ?</p>",
    "PostedDate": "2009-07-20T21:18:59.893-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "237755",
    "ThreadId": "36984",
    "Html": "<p>I am getting this</p>\r\n<p>Exception: Workbook already contains a worksheet named 'Worksheet'. Rename the external sheet first. in /var/www/phpexcel/Classes/PHPExcel.php on line&nbsp;<em>398</em></p>\r\n<p>while using the code given below. Please suggest if there is any change required in this?</p>\r\n<p>&nbsp;</p>\r\n<p>$filenames = array('2006.xlsx', '2007.xlsx', '2008.xlsx');<br><br>$bigExcel = new PHPExcel();<br>$bigExcel-&gt;removeSheetByIndex(0);<br><br>$reader = new PHPExcel_Reader_Excel2007();<br><br>foreach ($filenames as $filename) {<br>&nbsp;&nbsp;&nbsp; $excel = $reader-&gt;load($filename);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp; foreach ($excel-&gt;getAllSheets() as $sheet) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $bigExcel-&gt;addExternalSheet($sheet);<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp; foreach ($excel-&gt;getNamedRanges() as $namedRange) {<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $bigExcel-&gt;addNamedRange($namedRange);<br>&nbsp;&nbsp;&nbsp; }<br>}<br><br>$writer = new PHPExcel_Writer_Excel2007($bigExcel);<br>$writer-&gt;save('2007-write.xlsx');</p>",
    "PostedDate": "2009-09-23T03:55:07.75-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "237779",
    "ThreadId": "36984",
    "Html": "<p><em>&gt;&gt; Please suggest if there is any change required in this?</em></p>\r\n<p>I think you might have some identical sheet names in the workbooks you are combining. Remember that your combined workbook must not have two sheets with the same title. We should probably fix PHPExcel so it automatically renames the sheet, from, say, 'Sheet1' to 'Sheet1 (2)' when you add an external sheet having some name that is already taken by another worksheet.</p>\r\n<p>For now, try to rename the sheet with some unique title before using adding it with addExternalSheet()</p>",
    "PostedDate": "2009-09-23T05:09:44.347-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "237800",
    "ThreadId": "36984",
    "Html": "<p>Yes. &nbsp;all the files having same work sheet with default name 'worksheet'.</p>\r\n<p>how can I set the worksheet name while creating the excel file using PHPExcel?</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2009-09-23T05:45:23.587-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "237804",
    "ThreadId": "36984",
    "Html": "<p>Here would be the place to rename the sheet:<br><br>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre><span style=\"color:Blue\">foreach</span> ($excel-&gt;getAllSheets() <span style=\"color:Blue\">as</span> $sheet) {\r\n    $sheet-&gt;setTitle(<span style=\"color:#A31515\">'unique title for the sheet in combined workbook'</span>); // &lt;--- rename sheet if necessary<br>   &nbsp;$bigExcel-&gt;addExternalSheet($sheet);\r\n}\r\n</pre>\r\n</div>\r\n</p>",
    "PostedDate": "2009-09-23T05:54:29.623-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "238148",
    "ThreadId": "36984",
    "Html": "<p>Thank you.</p>\r\n<p>I have created the combined .xlsx file on the server. Now if I want to save this file at user end then what would be the header settings required</p>\r\n<p>currentty I am using this</p>\r\n<p>&nbsp;</p>\r\n<p>header(&quot;Pragma: public&quot;);</p>\r\n<p>header(&quot;Expires: 0&quot;);</p>\r\n<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;header(&quot;Cache-Control: must-revalidate, post-check=0, pre-check=0&quot;);</p>\r\n<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;header(&quot;Content-Type: application/force-download&quot;);</p>\r\n<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;header(&quot;Content-Type: application/octet-stream&quot;);</p>\r\n<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;header(&quot;Content-Type: application/download&quot;);;</p>\r\n<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;header(&quot;Content-Disposition: attachment;filename=report.xlsx&quot;);</p>\r\n<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;header(&quot;Content-Transfer-Encoding: binary&quot;);</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">$bigExcel = new PHPExcel();</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">$bigExcel-&gt;removeSheetByIndex(0);</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">$reader = new PHPExcel_Reader_Excel2007();</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">foreach ($filenames as $filename) {</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\"><span style=\"white-space:pre\"> </span></div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp;$excel = $reader-&gt;load($filename); &nbsp; &nbsp;</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp;foreach($excel-&gt;getAllSheets() as $sheet) {</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp;<span style=\"white-space:pre\"> </span>$sheet-&gt;setTitle($year); // &lt;--- rename sheet if necessary</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp;<span style=\"white-space:pre\"> </span>$bigExcel-&gt;addExternalSheet($sheet);</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp;}</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp;</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp;foreach ($excel-&gt;getNamedRanges() as $namedRange) {</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;$bigExcel-&gt;addNamedRange($namedRange);</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp;} &nbsp; &nbsp;</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp; &nbsp;$year++; &nbsp;&nbsp;</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">}</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">$writer = new PHPExcel_Writer_Excel2007($bigExcel);</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">$writer-&gt;save(&quot;php://output&quot;);</div>\r\n<p>&nbsp;</p>\r\n<p>$filenames = array('2005.xlsx','2006.xlsx', '2007.xlsx','2008.xlsx', '2009.xlsx');</p>\r\n<p>$year=2005;</p>\r\n<p>$bigExcel = new PHPExcel();</p>\r\n<p>$bigExcel-&gt;removeSheetByIndex(0);</p>\r\n<p>$reader = new PHPExcel_Reader_Excel2007();</p>\r\n<p>foreach ($filenames as $filename) {</p>\r\n<p><span style=\"white-space:pre\"> </span></p>\r\n<p>&nbsp;&nbsp; &nbsp;$excel = $reader-&gt;load($filename); &nbsp; &nbsp;</p>\r\n<p>&nbsp;&nbsp; &nbsp;foreach($excel-&gt;getAllSheets() as $sheet) {</p>\r\n<p>&nbsp;&nbsp; &nbsp;<span style=\"white-space:pre\"> </span>$sheet-&gt;setTitle($year); // &lt;--- rename sheet if necessary</p>\r\n<p>&nbsp;&nbsp; &nbsp;<span style=\"white-space:pre\"> </span>$bigExcel-&gt;addExternalSheet($sheet);</p>\r\n<p>&nbsp;&nbsp; &nbsp;}</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;&nbsp; &nbsp;foreach ($excel-&gt;getNamedRanges() as $namedRange) {</p>\r\n<p>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;$bigExcel-&gt;addNamedRange($namedRange);</p>\r\n<p>&nbsp;&nbsp; &nbsp;} &nbsp; &nbsp;</p>\r\n<p>&nbsp;&nbsp; &nbsp;$year++; &nbsp;&nbsp;</p>\r\n<p>}</p>\r\n<p>$writer = new PHPExcel_Writer_Excel2007($bigExcel);</p>\r\n<p>$writer-&gt;save(&quot;php://output&quot;);</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>but after this downloaded file is&nbsp;<span style=\"color:#30332d\">garbled</span></p>\r\n<p><span style=\"color:#30332d\"><span style=\"\"><br></span></span></p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2009-09-23T23:01:42.557-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "238165",
    "ThreadId": "36984",
    "Html": "<h4>HTTP headers</h4>\r\n<p>Example of a script redirecting an Excel 2007 file to the client's browser:</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre>header(<span style=\"color:#A31515\">'Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'</span>);\r\nheader(<span style=\"color:#A31515\">'Content-Disposition: attachment;filename=&quot;myfile.xlsx&quot;'</span>);\r\nheader(<span style=\"color:#A31515\">'Cache-Control: max-age=0'</span>);\r\n \r\n$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color:#A31515\">'Excel2007'</span>);\r\n$objWriter-&gt;save(<span style=\"color:#A31515\">'php://output'</span>);\r\n</pre>\r\n</div>\r\n<p><span style=\"font-size:10pt\" lang=NL>&nbsp;</span></p>\r\n<p><span style=\"font-size:10pt\" lang=NL>Pay particular attention to the Content-Type header</span></p>",
    "PostedDate": "2009-09-24T00:41:24.603-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "238195",
    "ThreadId": "36984",
    "Html": "<p>I have tried with this code but the result is same garbled file.</p>\r\n<p>Is this kind of download requires any change in apache's config file?</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2009-09-24T02:09:31.153-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "238241",
    "ThreadId": "36984",
    "Html": "<blockquote style=\"border:solid .1em #ccc;font-style:italic;margin:.25em 1em 0 1em;padding:0 .25em 0 .25em\"><strong>vishalsahu wrote:</strong><br>\r\n<p>&gt;&gt; Is this kind of download requires any change in apache's config file?</p>\r\n</blockquote>\r\n<p>No changes are required to Apache at all</p>\r\n<blockquote style=\"border:solid .1em #ccc;font-style:italic;margin:.25em 1em 0 1em;padding:0 .25em 0 .25em\"><strong>vishalsahu wrote:</strong><br>\r\n<p>&gt;&gt; I have tried with this code but the result is same garbled file.</p>\r\n</blockquote>\r\n<p>Does this garbled file appear in the browser window? Or does the browser pop up the &quot;Open/Save&quot; dialogue box?</p>",
    "PostedDate": "2009-09-24T03:57:02.377-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "238248",
    "ThreadId": "36984",
    "Html": "<p>Browser pops up the&nbsp; &quot;Open/Save&quot; dialogue box</p>",
    "PostedDate": "2009-09-24T04:07:42.97-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "238262",
    "ThreadId": "36984",
    "Html": "<blockquote style=\"border:solid .1em #ccc;font-style:italic;margin:.25em 1em 0 1em;padding:0 .25em 0 .25em\"><strong>vishalsahu wrote:</strong><br>\r\n<p>Browser pops up the&nbsp; &quot;Open/Save&quot; dialogue box</p>\r\n</blockquote>\r\n<p>&nbsp;If your script has error reporting set to E_ALL, do you get any errors (particularly headers already sent)</p>",
    "PostedDate": "2009-09-24T04:39:57.993-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "238277",
    "ThreadId": "36984",
    "Html": "<p>I am providing the complete code for the script</p>\r\n<p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre><span style=\"color:Blue\">include</span>(<span style=\"color:#A31515\">&quot;../functions_and_variables.php&quot;</span>);\r\n$ceo = check_designation_id(<span style=\"color:#A31515\">&quot;C.E.O&quot;</span>);\r\n$svp1 = check_designation_id (<span style=\"color:#A31515\">&quot;SENIOR VICE PRESIDENT (H.R)&quot;</span>);\r\n$svp2 = check_designation_id (<span style=\"color:#A31515\">&quot;Senior Vice President (Technical)&quot;</span>);\t\t\t\r\n$database = Select_db(<span style=\"color:#A31515\">&quot;users_db&quot;</span>);\r\n<span style=\"color:Green\">/** Error reporting */</span>\r\nerror_reporting(E_ALL);\r\n<span style=\"color:Green\">/** PHPExcel */</span>\r\n<span style=\"color:Blue\">require_once</span> <span style=\"color:#A31515\">'/var/www/phpexcel/Classes/PHPExcel.php'</span>;\r\n<span style=\"color:Green\">/** PHPExcel_IOFactory */</span>\r\n<span style=\"color:Blue\">require_once</span> <span style=\"color:#A31515\">'/var/www/phpexcel/Classes/PHPExcel/IOFactory.php'</span>;\r\n<span style=\"color:Blue\">require_once</span> <span style=\"color:#A31515\">'/var/www/phpexcel/Classes/PHPExcel/Reader/Excel2007.php'</span>;\r\n<span style=\"color:Blue\">require_once</span> <span style=\"color:#A31515\">'/var/www/phpexcel/Classes/PHPExcel/Writer/Excel2007.php'</span>;\r\n\t\t\t\r\n<span style=\"color:Green\">// Create new PHPExcel object</span>\r\n$objPHPExcel = <span style=\"color:Blue\">new</span> PHPExcel();\r\n$objPHPExcel-&gt;getProperties()-&gt;setCreator(<span style=\"color:#A31515\">&quot;Attendance Register&quot;</span>)\r\n-&gt;setLastModifiedBy(<span style=\"color:#A31515\">&quot;Attendance Register&quot;</span>);\r\n\t\t\t\t\t\t\t \r\n\t\t\t\r\n\r\n$group = <span style=\"color:#A31515\">&quot;Present&quot;</span>;\r\n$_REQUEST[<span style=\"color:#A31515\">'location'</span>]=<span style=\"color:#A31515\">&quot;all&quot;</span>;\r\n\r\n<span style=\"color:Blue\">for</span>($yearCnt=2005; $yearCnt&lt;=2009; $yearCnt++)\r\n{   \r\n\t$objPHPExcel-&gt;getProperties()-&gt;setTitle(<span style=\"color:#A31515\">&quot;Office $yearCnt XLSX Test Document&quot;</span>)\r\n\t-&gt;setTitle(<span style=\"color:#A31515\">&quot;Office $yearCnt XLSX Test Document&quot;</span>)\r\n\t\t\t\t\t -&gt;setSubject(<span style=\"color:#A31515\">&quot;Office $yearCnt XLSX Test Document&quot;</span>)\r\n\t\t\t\t\t -&gt;setDescription(<span style=\"color:#A31515\">&quot;Test document for Office $yearCnt XLSX, generated using PHP classes.&quot;</span>)\r\n\t\t\t\t\t -&gt;setKeywords(<span style=\"color:#A31515\">&quot;office $yearCnt openxml php&quot;</span>)\r\n\t\t\t\t\t -&gt;setCategory(<span style=\"color:#A31515\">&quot;Test result file $yearCnt&quot;</span>);\r\n\t$startDate = <span style=\"color:#A31515\">&quot;$yearCnt-01-01&quot;</span>;\t\r\n    $endDate =  <span style=\"color:#A31515\">&quot;$yearCnt-12-31&quot;</span>;    \r\n    <span style=\"color:Blue\">if</span>($group==<span style=\"color:#A31515\">&quot;Present&quot;</span>)\r\n    {\r\n    \t$empSelectQuery = &quot;select Admin_Tbl.uniqid, CONCAT(first_name,<span style=\"color:#A31515\">' '</span>, middle_name, <span style=\"color:#A31515\">' '</span>,last_name) <span style=\"color:Blue\">as</span> fullname, emp_id, join_date, relieving_date, location\r\n        from Admin_Tbl, users_tbl WHERE\r\n        Admin_Tbl.uniqid=users_tbl.uniqid <span style=\"color:Blue\">and</span> (Admin_Tbl.relieving_date=\\&quot;0000-00-00\\&quot; || Admin_Tbl.relieving_date IS NULL || Admin_Tbl.relieving_date&gt;=\\&quot;$endDate\\&quot; || (Admin_Tbl.relieving_date&gt;=\\&quot;$startDate\\&quot; AND Admin_Tbl.relieving_date&lt;=\\&quot;$endDate\\&quot;)) <span style=\"color:Blue\">and</span>\r\n        Admin_Tbl.join_date&lt;=\\&quot;$endDate\\&quot;\r\n        <span style=\"color:Blue\">and</span> Admin_Tbl.designation!=\\&quot;$ceo\\&quot; <span style=\"color:Blue\">and</span> Admin_Tbl.designation!=\\&quot;$svp1\\&quot; <span style=\"color:Blue\">and</span> Admin_Tbl.designation!=\\&quot;$svp2\\&quot; <span style=\"color:Blue\">and</span>\r\n        users_tbl.user_type!=\\<span style=\"color:#A31515\">&quot;Admin\\&quot; &quot;</span>;\r\n\t\t$empSelectQuery .= <span style=\"color:#A31515\">&quot; order by emp_id asc&quot;</span> ;\r\n     }\r\n            <span style=\"color:Blue\">&nbsp;</span>$records = get_query_result($empSelectQuery);\r\n\r\n            <span style=\"color:Blue\">if</span>(rowsInResult($records)&gt;0)\r\n            {\r\n            \t\r\n            \t$objPHPExcel-&gt;setActiveSheetIndex(0);\r\n            \t \r\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#A31515\">'A1'</span>, <span style=\"color:#A31515\">&quot;Emp ID&quot;</span>);\r\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#A31515\">'B1'</span>, <span style=\"color:#A31515\">&quot;User Name&quot;</span>);\r\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#A31515\">'C1'</span>, <span style=\"color:#A31515\">&quot;Location&quot;</span>);\r\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#A31515\">'D1'</span>, <span style=\"color:#A31515\">&quot;Opening Balance As On &quot;</span>.formatDate($startDate));\r\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#A31515\">'E1'</span>, <span style=\"color:#A31515\">&quot;Credit During &quot;</span>.formatDate($startDate). <span style=\"color:#A31515\">&quot; To &quot;</span> .formatDate($endDate));\r\n                $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#A31515\">'F1'</span>, <span style=\"color:#A31515\">&quot;Utilized During &quot;</span>. formatDate($startDate). <span style=\"color:#A31515\">&quot; To &quot;</span>. formatDate($endDate));\r\n               \t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#A31515\">'G1'</span>, <span style=\"color:#A31515\">&quot;Closing Balance As On &quot;</span>.formatDate($endDate));\r\n                \r\n               \t$cellcount=2;\r\n                <span style=\"color:Blue\">while</span>($recordsRow = mysql_fetch_array($records))\r\n                {\r\n                    $uniqid = $recordsRow[<span style=\"color:#A31515\">'uniqid'</span>];\r\n                    $employeeCurrentLocation = employee_location($database,$uniqid);\r\n                    $filteredUsedid=<span style=\"color:#A31515\">&quot;&quot;</span>;\r\n\r\n                    <span style=\"color:Blue\">if</span>($_REQUEST[<span style=\"color:#A31515\">'location'</span>]!=<span style=\"color:#A31515\">&quot;&quot;</span> &amp;&amp; $_REQUEST[<span style=\"color:#A31515\">'location'</span>]!=<span style=\"color:#A31515\">&quot;all&quot;</span>)\r\n                    {\r\n                        $value =  CheckLocationOnDateWithGivenLocation($uniqid, $_REQUEST[<span style=\"color:#A31515\">'location'</span>], $startDate, $endDate);\r\n\r\n                        <span style=\"color:Blue\">if</span>($value==1)\r\n                        {\r\n                           $filteredUsedid = $uniqid;\r\n                        }\r\n\r\n                    }\r\n                    <span style=\"color:Blue\">else</span>\r\n                    {\r\n                        $filteredUsedid = $uniqid ;\r\n                    }\r\n\r\n                    <span style=\"color:Blue\">if</span>($filteredUsedid!=<span style=\"color:#A31515\">&quot;&quot;</span>)\r\n                    {\r\n                        $location = $recordsRow[<span style=\"color:#A31515\">'location'</span>];                        \r\n                        $leaveId = selectElLeaveId($yearCnt, $location);                         \r\n                        $join_date = $recordsRow[<span style=\"color:#A31515\">'join_date'</span>];\r\n                        $releivingDate = $recordsRow[<span style=\"color:#A31515\">'relieving_date'</span>];\r\n                        $fname = str_replace(<span style=\"color:#A31515\">'  '</span>, <span style=\"color:#A31515\">' '</span>, ucwords(strtolower($recordsRow[<span style=\"color:#A31515\">'fullname'</span>])));\r\n\r\n                        <span style=\"color:Blue\">if</span>($recordsRow[<span style=\"color:#A31515\">'relieving_date'</span>]!=<span style=\"color:#A31515\">&quot;0000-00-00&quot;</span> &amp;&amp; ReturnTimestamp($recordsRow[<span style=\"color:#A31515\">'relieving_date'</span>])&gt;=ReturnTimestamp($startDate) &amp;&amp;  ReturnTimestamp($recordsRow[<span style=\"color:#A31515\">'relieving_date'</span>])&lt;=ReturnTimestamp($endDate) &amp;&amp; ($group==<span style=\"color:#A31515\">&quot;Exits&quot;</span> || $group==<span style=\"color:#A31515\">&quot;Present&quot;</span>))\r\n                        {\r\n                            $image = $cross;\r\n                            $title =<span style=\"color:#A31515\">&quot;Relieving Date: &quot;</span>.formatDate($releivingDate);\r\n                        }\r\n                        <span style=\"color:Blue\">else</span> <span style=\"color:Blue\">if</span>(ReturnTimestamp($recordsRow[<span style=\"color:#A31515\">'join_date'</span>])&gt;=ReturnTimestamp($startDate) &amp;&amp;  ReturnTimestamp($recordsRow[<span style=\"color:#A31515\">'join_date'</span>])&lt;=ReturnTimestamp($endDate) &amp;&amp; ($group==<span style=\"color:#A31515\">&quot;NewInductees&quot;</span> || $group==<span style=\"color:#A31515\">&quot;Present&quot;</span>))\r\n                        {\r\n\r\n                            $image = $dot;\r\n                            $title =<span style=\"color:#A31515\">&quot;Joining Date: &quot;</span>.formatDate($join_date);\r\n                        }\r\n                        <span style=\"color:Blue\">else</span>\r\n                        {\r\n\r\n                            $image = $tick;\r\n                            $title =<span style=\"color:#A31515\">&quot;&quot;</span>;\r\n                        }\r\n                        \r\n                        $modifiedStartDate = returnDateWithinterval(<span style=\"color:#A31515\">&quot;Sub&quot;</span>, $startDate, 1);\r\n                \t\t$modifiedStartYear = explode(<span style=\"color:#A31515\">&quot;-&quot;</span>, $modifiedStartDate);\r\n                \t\t$modifiedYear = $modifiedStartYear[0];\r\n                \t\t$elBalanceOnStartDate = CalculateWokingDyasLeaveForMultipleYears($uniqid, <span style=\"color:#A31515\">&quot;$modifiedYear-01-01&quot;</span>, $modifiedStartDate);<span style=\"color:Green\">// - ElutilizedUptoSlecteddate($modifiedStartDate, &quot;$modifiedYear-01-01&quot;, $modifiedYear, $uniqid, $modifiedLeaveId);</span>\r\n                \t\t$elCreditedDuringthePeriod = CalculateWokingDyasLeaveWithoutPreBalance($uniqid, $yearCnt, $startDate, $endDate, $leaveId);\r\n                \t\t$elUtilizedDuringthePeriod = utilizedWorkingDaysLeave($leaveId, $startDate, $endDate, $yearCnt, $uniqid);\r\n                \t\t$elbalanceAtEndDate = $elBalanceOnStartDate + $elCreditedDuringthePeriod -$elUtilizedDuringthePeriod;\r\n\r\n                        <span style=\"color:Blue\">if</span>($releivingDate!=<span style=\"color:#A31515\">&quot;0000-00-00&quot;</span> &amp;&amp; strtotime($endDate)&lt;=strtotime($releivingDate))\r\n                        {\r\n                            $printEl = $elbalanceAtEndDate;\r\n                        }\r\n                        <span style=\"color:Blue\">else</span> <span style=\"color:Blue\">if</span>($releivingDate==<span style=\"color:#A31515\">&quot;0000-00-00&quot;</span> || $releivingDate==NULL)\r\n                        {\r\n                            $printEl = $elbalanceAtEndDate;\r\n                        }\r\n                         <span style=\"color:Blue\">else</span>\r\n                        {\r\n                            $printEl=0;\r\n                        }\r\n                        \r\n                        $objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#A31515\">'A'</span>.$cellcount, $recordsRow[<span style=\"color:#A31515\">'emp_id'</span>]);\r\n\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#A31515\">'B'</span>.$cellcount, $fname);\r\n\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#A31515\">'C'</span>.$cellcount, ucwords(strtolower(printLocationName($database, $recordsRow[<span style=\"color:#A31515\">'location'</span>]))));\r\n\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#A31515\">'D'</span>.$cellcount, $elBalanceOnStartDate);\r\n\t\t\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#A31515\">'E'</span>.$cellcount, $elCreditedDuringthePeriod);\r\n                \t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#A31515\">'F'</span>.$cellcount, $elUtilizedDuringthePeriod);\r\n               \t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color:#A31515\">'G'</span>.$cellcount, $printEl);\r\n                        <span style=\"color:Green\">//print the result in the table format</span>\r\n                        $cellcount++;\r\n                   }\r\n                }\r\n                $objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#A31515\">'A1'</span>)-&gt;getFont()-&gt;setBold(true);\r\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#A31515\">'B1'</span>)-&gt;getFont()-&gt;setBold(true);\r\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#A31515\">'C1'</span>)-&gt;getFont()-&gt;setBold(true);\r\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#A31515\">'D1'</span>)-&gt;getFont()-&gt;setBold(true);\r\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#A31515\">'E1'</span>)-&gt;getFont()-&gt;setBold(true);\r\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#A31515\">'F1'</span>)-&gt;getFont()-&gt;setBold(true);\r\n\t\t\t\t$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color:#A31515\">'G1'</span>)-&gt;getFont()-&gt;setBold(true);\r\n             }\r\n             $objPHPExcel-&gt;getActiveSheet()-&gt;setAutoFilter(<span style=\"color:#A31515\">'A1:G'</span>.$cellcount);\r\n             $objPHPExcel-&gt;setActiveSheetIndex(0);\t\t\r\n\t\t\t <span style=\"color:Green\">// \tSave Excel 2007 file\t\t\t</span>\r\n\t\t\t$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color:#A31515\">'Excel2007'</span>);\r\n\t\t\t$objWriter-&gt;save($yearCnt.<span style=\"color:#A31515\">'.xlsx'</span>);\r\n\t\t}\r\n$<span style=\"color:Blue\">file</span> = time().<span style=\"color:#A31515\">&quot;_el.xlsx&quot;</span>;\r\nheader(<span style=\"color:#A31515\">&quot;Pragma: public&quot;</span>);\r\nheader(<span style=\"color:#A31515\">&quot;Expires: 0&quot;</span>);\r\nheader(<span style=\"color:#A31515\">&quot;Cache-Control: must-revalidate, post-check=0, pre-check=0&quot;</span>);\r\nheader(<span style=\"color:#A31515\">&quot;Content-Type: application/force-download&quot;</span>);\r\nheader(<span style=\"color:#A31515\">&quot;Content-Type: application/octet-stream&quot;</span>);\r\nheader(<span style=\"color:#A31515\">&quot;Content-Type: application/download&quot;</span>);\r\nheader(<span style=\"color:#A31515\">'Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'</span>);\r\nheader(<span style=\"color:#A31515\">&quot;Content-Disposition: attachment;filename=$file&quot;</span>);\r\nheader(<span style=\"color:#A31515\">&quot;Content-Transfer-Encoding: binary&quot;</span>);\t\t\r\n$filenames = <span style=\"color:Blue\">array</span>(<span style=\"color:#A31515\">'2005.xlsx'</span>,<span style=\"color:#A31515\">'2006.xlsx'</span>, <span style=\"color:#A31515\">'2007.xlsx'</span>,<span style=\"color:#A31515\">'2008.xlsx'</span>, <span style=\"color:#A31515\">'2009.xlsx'</span>);\r\n$year=2005;\r\n$bigExcel = <span style=\"color:Blue\">new</span> PHPExcel();\r\n$bigExcel-&gt;removeSheetByIndex(0);\r\n$reader = <span style=\"color:Blue\">new</span> PHPExcel_Reader_Excel2007();\r\n<span style=\"color:Blue\">foreach</span> ($filenames <span style=\"color:Blue\">as</span> $filename) {\r\n\t\r\n    $excel = $reader-&gt;load($filename);    \r\n    <span style=\"color:Blue\">foreach</span>($excel-&gt;getAllSheets() <span style=\"color:Blue\">as</span> $sheet) {\r\n    \t$sheet-&gt;setTitle($year); <span style=\"color:Green\">// &lt;--- rename sheet if necessary</span>\r\n    \t$bigExcel-&gt;addExternalSheet($sheet);\r\n    }    \r\n    <span style=\"color:Blue\">foreach</span> ($excel-&gt;getNamedRanges() <span style=\"color:Blue\">as</span> $namedRange) {\r\n        $bigExcel-&gt;addNamedRange($namedRange);\r\n    }    \r\n    $year++;   \r\n}\r\n$writer = PHPExcel_IOFactory::createWriter($bigExcel, <span style=\"color:#A31515\">'Excel2007'</span>);\r\n$writer-&gt;save(<span style=\"color:#A31515\">&quot;php://output&quot;</span>);\r\n</pre>\r\n</div>\r\n</p>\r\n<p>&nbsp;</p>\r\n<p>I n this code if i don't use any header and use&nbsp;</p>\r\n<pre>$writer-&gt;save(<span style=\"color:#A31515\">$file</span>);<br><br>then it creates the file I want. but during download it get corrupted<br></pre>\r\n<p>&nbsp;</p>",
    "PostedDate": "2009-09-24T05:22:00.033-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "238292",
    "ThreadId": "36984",
    "Html": "<p><em>&gt;&gt; In this code if i don't use any header and use $writer-&gt;save(<span style=\"color:#a31515\">$file</span>);then it creates the file I want. but during download it get corrupted</em></p>\r\n<p>Try to open the files in a text editor, or perhaps a HEX editor. Compare them, they should be the same. Maybe you will notice some difference such as some white space at the beginning or end? For example, this can happen if you have spaces before/after the opening/closing &lt;?php tags.</p>",
    "PostedDate": "2009-09-24T06:15:14.82-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "238628",
    "ThreadId": "36984",
    "Html": "<p>Thank you.</p>\r\n<p>The problem has been rectified. I have opened the file on textpad and got the problem</p>\r\n<p>Some other functions were causing the warning message generation. Due to this the resultant file was getting corrupted.</p>\r\n<p>Thanks again.</p>",
    "PostedDate": "2009-09-24T22:11:00.077-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]