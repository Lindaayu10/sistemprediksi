[
  {
    "Id": "596808",
    "ThreadId": "253780",
    "Html": "<p>I am using Linux OS, PHP version 5.2.8 and PHPExcel version 1.7.6. I am using PHPExcel to read data from Excel files. I understood from the documentation and the discussions here that it is possible to set read filters to read only chunks of rows from an  Excel file at a time thereby restricting memory usage. I read that no matter what the size of the Excel file is, only the memory needed for the size of the chunk I am setting will be used. I have an Excel file with 60000 rows in the first sheet. I am reading  only the first sheet and I have set the chunk size to 5000 rows. When I ran the program, the memory usage increased with each iteration of the read loop and it exceeded the 512 MB memory limit I have set when it went past the 30000th row of the Excel file.  I can't understand why the memory usage kept increasing when the loop progressed because PHPExcel is supposed to use only memory needed for the 5000 chunk size throughout the loop. I am giving here the code I used. Please help me to know where I went wrong.  Thanks.</p>\n<p>&nbsp;</p>\n<p>The code:</p>\n<p><span style=\"color: #0000ff;\">&lt;?php</span><br /> <br /> <span style=\"color: #0000ff;\">error_reporting(E_ALL);</span><br /> <span style=\"color: #0000ff;\">set_time_limit(0);</span><br /> <br /> <span style=\"color: #0000ff;\">date_default_timezone_set('Europe/London');</span><br /> <br /> <span style=\"color: #0000ff;\">?&gt;</span><br /> <span style=\"color: #0000ff;\">&lt;html&gt;</span><br /> <span style=\"color: #0000ff;\">&lt;head&gt;</span><br /> <span style=\"color: #0000ff;\">&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" /&gt;</span><br /> <br /> <span style=\"color: #0000ff;\">&lt;title&gt;PHPExcel Reader Example &lt;/title&gt;</span><br /> <br /> <span style=\"color: #0000ff;\">&lt;/head&gt;</span><br /> <span style=\"color: #0000ff;\">&lt;body&gt;</span><br /> <br /> <span style=\"color: #0000ff;\">&lt;h1&gt;PHPExcel Reader Test&lt;/h1&gt;</span><br /> <span style=\"color: #0000ff;\">&lt;?php</span><br /> &nbsp;<br /> <span style=\"color: #0000ff;\">/** Include path **/</span><br /> <span style=\"color: #0000ff;\">set_include_path(get_include_path() . PATH_SEPARATOR . '../../../Classes/');</span><br /> &nbsp;<br /> <span style=\"color: #0000ff;\">/** PHPExcel_IOFactory */</span><br /> <span style=\"color: #0000ff;\">include '../classes/PHPExcel/IOFactory.php';</span><br /> <br /> <span style=\"color: #0000ff;\">/**&nbsp; Define a Read Filter class implementing PHPExcel_Reader_IReadFilter&nbsp; */ </span><br /> <span style=\"color: #0000ff;\">class chunkReadFilter implements PHPExcel_Reader_IReadFilter </span><br /> <span style=\"color: #0000ff;\">{ </span><br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp; private $_startRow = 0; </span><br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp; private $_endRow = 0; </span><br /> &nbsp;&nbsp;&nbsp; <br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp; /**&nbsp; Set the list of rows that we want to read&nbsp; */ </span><br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp; public function setRows($startRow, $chunkSize) { </span> <br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $this-&gt;_startRow&nbsp;&nbsp;&nbsp; = $startRow; </span><br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $this-&gt;_endRow&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = $startRow + $chunkSize; </span><br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp; } </span><br /> &nbsp;&nbsp;&nbsp; <br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp; public function readCell($column, $row, $worksheetName = '') { </span><br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp; Only read the heading row, and the rows that are configured in $this-&gt;_startRow and $this-&gt;_endRow </span><br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (($row == 1) || ($row &gt;= $this-&gt;_startRow &amp;&amp; $row &lt; $this-&gt;_endRow)) { </span><br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true; </span><br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } </span><br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false; </span><br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp; } </span><br /> <span style=\"color: #0000ff;\">} </span><br /> <br /> <br /> <span style=\"color: #0000ff;\">// Echo memory peak usage</span><br /> <span style=\"color: #0000ff;\">echo date('H:i:s') . \" Peak memory usage: \" . (memory_get_peak_usage(true) / 1024 / 1024) . \" MB\\r&lt;br&gt;\";</span><br /> <br /> <span style=\"color: #0000ff;\">/**&nbsp; Define how many rows we want to read for each \"chunk\"&nbsp; **/ </span><br /> <span style=\"color: #0000ff;\">$chunkSize = 5000; </span><br /> <br /> <span style=\"color: #0000ff;\">/**&nbsp; Create a new Instance of our Read Filter&nbsp; **/ </span> <br /> <span style=\"color: #0000ff;\">$chunkFilter = new chunkReadFilter(); </span><br /> <span style=\"color: #0000ff;\">$inputFileType = 'Excel5';</span><br /> <span style=\"color: #0000ff;\">$inputFileName = 'SKTR.xls';</span><br /> <br /> <br /> <span style=\"color: #0000ff;\">$objReader = PHPExcel_IOFactory::createReader($inputFileType);</span><br /> <br /> <span style=\"color: #0000ff;\">//&nbsp; Read the list of Worksheet Names from the Workbook file&nbsp; /</span><br /> <span style=\"color: #0000ff;\">&nbsp;$worksheetNames = $objReader-&gt;listWorksheetNames($inputFileName);</span><br /> <span style=\"color: #0000ff;\">$objReader-&gt;setLoadSheetsOnly($worksheetNames[0]);</span><br /> <br /> <span style=\"color: #0000ff;\">&nbsp;/**&nbsp; Tell the Reader that we want to use the Read Filter that we've Instantiated&nbsp; **/ </span><br /> <span style=\"color: #0000ff;\">$objReader-&gt;setReadFilter($chunkFilter); </span><br /> <span style=\"color: #0000ff;\">$objReader-&gt;setReadDataOnly(true);</span><br />&nbsp; <span style=\"color: #0000ff;\"></span><br /> <span style=\"color: #0000ff;\">for ($startRow = 1; $startRow &lt;= 60000; $startRow += $chunkSize) { </span><br /> <br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp; /**&nbsp; Tell the Read Filter, the limits on which rows we want to read this iteration&nbsp; **/ </span><br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp; $chunkFilter-&gt;setRows($startRow,$chunkSize); </span> <br /> &nbsp;&nbsp;&nbsp; <br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp; /**&nbsp; Load only the rows that match our filter from $inputFileName to a PHPExcel Object&nbsp; **/ </span><br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp; $objPHPExcel = $objReader-&gt;load($inputFileName); </span> <br /> &nbsp;&nbsp;&nbsp; <br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp; Get the sheet values in an array</span><br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp; $sheetData = $objPHPExcel-&gt;getActiveSheet()-&gt;toArray(); </span><br /> &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp; echo date('H:i:s') . \" Peak memory usage: \" . (memory_get_peak_usage(true) / 1024 / 1024) . \" MB\\r&lt;br&gt;\";</span><br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp; $objPHPExcel-&gt;disconnectWorksheets(); </span><br /> <span style=\"color: #0000ff;\">&nbsp;&nbsp;&nbsp; unset($objPHPExcel);</span><br /> <span style=\"color: #0000ff;\">}</span><br /> <br /> <span style=\"color: #0000ff;\">// Echo memory peak usage</span><br /> <span style=\"color: #0000ff;\">echo date('H:i:s') . \"last Peak memory usage: \" . (memory_get_peak_usage(true) / 1024 / 1024) . \" MB\\r\\&lt;br&gt;n\";</span><br /> <br /> <span style=\"color: #0000ff;\">?&gt;</span><br /> <span style=\"color: #0000ff;\">&lt;/body&gt;</span><br /> <span style=\"color: #0000ff;\">&lt;/html&gt;</span></p>",
    "PostedDate": "2011-04-13T13:09:16.603-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "600016",
    "ThreadId": "253780",
    "Html": "<div style=\"color: black; background-color: white;\">\r\n<pre>$sheetData = $objPHPExcel-&gt;getActiveSheet()-&gt;toArray(); \r\n</pre>\r\n</div>\r\n<p>will read the entire worksheet into the array. On the first iteration of the loop, this will be rows 1 to 5000, on the second iteration it will be rows 1 to 10000 (even though only row 1 and rows 5001 to 10000 actually contain any data).</p>\r\n<p>Try using</p>\r\n<pre><div style=\"color: black; background-color: white;\"><pre>$sheetData = $objPHPExcel-&gt;getActiveSheet()</pre>\r\n<pre>                         -&gt;rangeToArray(<span style=\"color: #a31515;\">'A'</span>.$startRow.<span style=\"color: #a31515;\">':'</span>.$objPHPExcel-&gt;getActiveSheet()-&gt;getHighestColumn().($startRow+$chunkSize-1)); </pre>\r\n</div>\r\n</pre>\r\n<p>instead. This will only return the cells read during that chunk.</p>",
    "PostedDate": "2011-04-19T14:25:39.027-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "683013",
    "ThreadId": "253780",
    "Html": "<p>Hello,</p>\r\n<p>I am new to the PHPExcel.</p>\r\n<p>&nbsp;</p>\r\n<p>I am trying to use the above code.</p>\r\n<p>getting the error on the</p>\r\n<p><span style=\"color: #0000ff;\">//&nbsp; Read the list of Worksheet Names from the Workbook file&nbsp; /</span><br /> <span style=\"color: #0000ff;\">&nbsp;$worksheetNames = $objReader-&gt;listWorksheetNames($inputFileName);</span><br /> <span style=\"color: #0000ff;\">$objReader-&gt;setLoadSheetsOnly($worksheetNames[0]);</span></p>\r\n<p><span style=\"color: #0000ff;\">listWorksheetNames</span></p>\r\n<p><span style=\"color: #0000ff;\">no defined.</span></p>\r\n<p><span style=\"color: #0000ff;\">Please help me out thanks<br /></span></p>",
    "PostedDate": "2011-10-12T02:22:17.137-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]