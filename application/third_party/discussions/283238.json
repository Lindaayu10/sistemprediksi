[
  {
    "Id": "713305",
    "ThreadId": "283238",
    "Html": "\r\n<p>I am developing an application that outputs a spreadsheet report and I have set auto column widths. This works fine except for all the columns that I have set background colors on; the widths are twice what they should be. The background colors are set conditional\r\n on the values in the cells, but I didn't use the PHPExcel conditional formatting because I already had a complex system I had developed for conditional formatting of HTML versions of the reports I'm developing. I am not able to provide a link to the file,\r\n but I could provide a screen shot if someone were to provide an email for that purpose.</p>\r\n<p>Below is my method for constructing the body of the report spreadsheet:</p>\r\n<p></p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:green\">//ITERATE THROUGH THE DATA AND DISPLAY WITH COLOR FORMATTING IN APPROPRIATE PLACES</span>\r\n\t<span style=\"color:blue\">protected</span> <span style=\"color:blue\">function</span> excel_table_body(){\r\n\t\t$n=3;\r\n\t\t$h = $this-&gt;row_count;\r\n\t\t$this-&gt;body_top = $this-&gt;row_count;\t\t\r\n\t\t$this-&gt;get_color_set();\r\n\t\t<span style=\"color:green\">//ITERATE THE ROWS OF DATA</span>\r\n\t\t<span style=\"color:blue\">foreach</span> ($this-&gt;data_rows <span style=\"color:blue\">as</span> $row){\r\n\t\t\t$col=<span style=\"color:#a31515\">'A'</span>;\r\n\t\t\t$ind = 0;\r\n\t\t\t<span style=\"color:green\">//ITERATE THROUGH EACH ROW AND SET BACKGROUND COLOR IN COLUMN REQUIRING BG COLOR</span>\r\n\t\t\t<span style=\"color:blue\">foreach</span>($row <span style=\"color:blue\">as</span> $val){\r\n\t\t\t\t$val = $this-&gt;split_long_field($val);<span style=\"color:green\">//CHECK IF VALUE IS LONGER THAN MAX COLUMN WIDTH </span>\r\n\t\t\t\t<span style=\"color:green\">//IF STRING IS LONGER THAN MAX COL WIDTH, SPLIT INTO LINES OF CORRECT LENGTH WITH \\n AT END</span>\r\n\t\t\t\t<span style=\"color:green\">//SET PHPExcel WRAP TEXT METHOD FOR THAT CELL</span>\r\n\t\t\t\t<span style=\"color:blue\">if</span>($this-&gt;split_flag == 1){ \r\n\t\t\t\t\t$this-&gt;split_flag = 0;\r\n\t\t\t\t\t$this-&gt;ExP-&gt;getActiveSheet()-&gt;getCell($col . $h)-&gt;setValue($val);\r\n\t\t\t\t\t$this-&gt;ExP-&gt;getActiveSheet()-&gt;getStyle($col . $h)-&gt;getAlignment()-&gt;setWrapText(true);\r\n\t\t\t\t\t}\r\n\t\t\t\t<span style=\"color:blue\">else</span>{ <span style=\"color:green\">//POPULATE CELL WITH ORIGINAL STRING</span>\r\n\t\t\t\t\t$this-&gt;ExP-&gt;getActiveSheet()-&gt;setCellValue($col . $h, $val);\r\n\t\t\t\t\t}\r\n\t\t\t\t<span style=\"color:green\">//CHECK IF THIS COLUMN NEEDS BG COLOR FORMATTING - IF SO, GET THE COLOR AND SET THE FORMATTING</span>\r\n\t\t\t\t<span style=\"color:blue\">if</span>(<span style=\"color:blue\">isset</span>($this-&gt;conditional_bg[$ind]) &amp;&amp; $this-&gt;conditional_bg[$ind] == <span style=\"color:#a31515\">'1'</span>){\r\n\t\t\t\t\t$val = $this-&gt;remove_pct($val);\r\n\t\t\t\t\t$color = $this-&gt;set_excel_color($val);\r\n\t\t\t\t\t$this-&gt;ExP-&gt;getActiveSheet()-&gt;getStyle($col . $h)-&gt;getFill()-&gt;setFillType(PHPExcel_Style_Fill::FILL_SOLID)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   -&gt;getStartColor()-&gt;setARGB($color);\r\n\t\t\t\t\t}\r\n\t\t\t\t$col&#43;&#43;;\r\n\t\t\t\t$ind&#43;&#43;;\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t$h&#43;&#43;;\r\n\t\t\t$this-&gt;row_count&#43;&#43;;\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n</pre>\r\n</div>\r\n<p></p>\r\n<p>And this is the snippet that sets the automatic column sizing:</p>\r\n<p></p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:blue\">foreach</span>($this-&gt;col_letters <span style=\"color:blue\">as</span> $column){\r\n\t\t\t<span style=\"color:green\">//COLUMN WIDTHS SET AUTOMATICALLY ACCORDING TO WIDEST ROW CELL PER COLUMN </span>\r\n\t\t\t$this-&gt;ExP-&gt;getActiveSheet()-&gt;getColumnDimension($column)-&gt;setAutoSize(true);\r\n\t\t\t\r\n\t\t}\r\n</pre>\r\n</div>\r\nIs there any way to get these columns to adhere to the appropriate column widths when using Auto Size?\r\n<p></p>\r\n",
    "PostedDate": "2011-12-16T09:46:55.623-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]