[
  {
    "Id": "1332838",
    "ThreadId": "575557",
    "Html": "Hi,\r<br />\n<br />\n<br />\nI am working on a project in Symfony 2.1.PHPExcel version is 1.8.0. I use Doctrine to retrieve the data from Db and filter if required. <br />\n<pre><code>$em = $this-&gt;getDoctrine()-&gt;getManager();\n                    $guardquery = $em-&gt;createQueryBuilder()\n                            -&gt;select('g.attendancePopupTime', 'd.atmName', 'd.region', 'd.zone', 'd.state')\n                            -&gt;from('ATMMonitorAPIBundle:GuardMonitor', 'g')\n                            -&gt;innerJoin('ATMMonitorAPIBundle:DeviceAtmInfo', 'd', Join::WITH, 'd.deviceId = g.deviceId');\n                  \n                    if ($userZones[0]['userZones'] != '0') {\n                        $guardquery-&gt;innerJoin('ATMMonitorAPIBundle:RegisteredDevices', 'r', Join::WITH, 'r.deviceId = g.deviceId')\n                                -&gt;where('r.deviceZone IN (:devicezone)')\n                                -&gt;setParameter('devicezone', $zone_array);\n                    }\n\n                    if (isset($dateLow)) {\n                        $guardquery-&gt;andWhere('g.attendancePopupTime BETWEEN :date_low and :date_high')\n                                -&gt;setParameter('date_low', $dateLow)\n                                -&gt;setParameter('date_high', $dateHigh);\n                    }\n\n                    $finalAttendanceQuery = $guardquery-&gt;getQuery();\n                    $attendanceResult = $finalAttendanceQuery-&gt;getArrayResult();</code></pre>\n\nThis is my query and by giving variables as 2014-12-1 as $dateLow and 2014-12-8 as $dateHigh, the query returns 122 rows. There are 579 rows in the database. The data returned after filtering is proper and I am able insert it into Excel using the following code.<br />\n<pre><code>$phpExcelObject = $this-&gt;get('phpexcel')-&gt;createPHPExcelObject();\n                      $phpExcelObject-&gt;getProperties()-&gt;setCreator(&quot;&quot;)\n                      -&gt;setLastModifiedBy(&quot;Administrator&quot;)\n                      -&gt;setTitle(&quot;ATTENDANCE DETAILS XLSX&quot;)\n                      -&gt;setSubject(&quot;ATTENDANCE DETAILS  XLSX&quot;)\n                      -&gt;setDescription(&quot;EXCEL document for Attendance Details&quot;);\n                      $phpExcelObject-&gt;setActiveSheetIndex(0);\n                      $phpExcelObject-&gt;getActiveSheet()-&gt;setTitle('GUARD_ATTENDANCE - DETAILS');\n                      $phpExcelObject-&gt;getActiveSheet()\n                      -&gt;SetCellValue('A3', &quot;STATE&quot;)\n                      -&gt;SetCellValue('B3', &quot;ZONE&quot;)\n                      -&gt;SetCellValue('C3', &quot;REGION&quot;)\n                     -&gt;SetCellValue('D3', &quot;DATE&quot;)\n                    \n                     -&gt;SetCellValue('A1', &quot;GUARD ATTENDANCE RECORDS&quot;);\n              $count = count($attendanceResult);\n               $rowCount = 4;\n\n                      for ($i = 0; $i &lt; $count; $i++) {\n $phpExcelObject-&gt;getActiveSheet()-&gt;SetCellValue('A' . $rowCount, $attendanceResult[$i]['state']);\n $phpExcelObject-&gt;getActiveSheet()-&gt;SetCellValue('B' . $rowCount, $attendanceResult[$i]['zone']);\n $phpExcelObject-&gt;getActiveSheet()-&gt;SetCellValue('C' . $rowCount, $attendanceResult[$i]['region']);\n if ($attendanceResult[$i]['attendancePopupTime'] instanceof \\DateTime) {\n       $attendanceDate = $attendanceResult[$i]['attendancePopupTime']-&gt;format('d-m-Y');\n                            }\n$phpExcelObject-&gt;getActiveSheet()-&gt;SetCellValue('D' . $rowCount, $punchTime);                 \n$phpExcelObject-&gt;getActiveSheet()-&gt;SetCellValue('E' . $rowCount, count($attendanceResult));\n$rowCount++\n}\n\n$writer = $this-&gt;get('phpexcel')-&gt;createWriter($phpExcelObject, 'Excel5');\n$response = $this-&gt;get('phpexcel')-&gt;createStreamedResponse($writer); \n\n$response-&gt;headers-&gt;set('Content-Type', 'text/vnd.ms-excel; charset=utf-8');\n$response-&gt;headers-&gt;set('Content-Disposition', 'attachment;filename=AttendanceDetails.xls'); \n\n$response-&gt;headers-&gt;set('Pragma', 'public');\n$response-&gt;headers-&gt;set('Cache-Control', 'maxage=1');\nreturn $response;</code></pre>\n\nThe variable $count has the value 122 before entering the for loop. In the excel generated there are 579 rows(entire data available in DB ) of data instead of 122 rows obtained after filtration. The column E of the excel also shows the values 579 instead of 122. The for loop also gets executed 579 times instead of 122 times. Some how, the array $attendanceResult changes while inserting data in phpExcel.\r<br />\n<br />\nI tried saving contents of $attendanceResult into another array and using that array to insert data into the excel. The same issue exists there too. \r<br />\nPlease help as I couldn't find anything wrong with the code.\r<br />\n<br />\nThanks in Advance<br />\n",
    "PostedDate": "2014-12-16T02:58:23.883-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1332940",
    "ThreadId": "575557",
    "Html": "Solved the problem. The issue had nothing to do with phpexcel. Sorry for the trouble\r<br />\n<br />\n Thanks a lot<br />\n",
    "PostedDate": "2014-12-16T10:08:57.547-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]