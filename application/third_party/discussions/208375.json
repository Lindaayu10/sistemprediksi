[
  {
    "Id": "427553",
    "ThreadId": "208375",
    "Html": "<p>Hi,</p>\r\n<p>I'm using PHPExcel on my reporting engine and is working perfect, it writes 590 excel rows with 14 columns in 16 seconds for composing the excel and 7.5 seconds to write the Excel2007 file.</p>\r\n<p>but the main problem is in Merging cells,&nbsp;when i start using this line of code</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;mergeCells(<span style=\"color:#A31515\">&quot;A351:N351&quot;</span>);\r\n</pre>\r\n</div>\r\n<p>it takes same composing time, but writing Excel2007 time has dramatically jumped from 7.5 seconds to become 225 seconds.</p>\r\n<p>by examining the merge container with this code</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre>var_dump($this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;getMergeCells());</pre>\r\n</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">'A2:N2' =&gt; string 'A2:N2' (length=5)</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp;'A7:K7' =&gt; string 'A7:K7' (length=5)</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">&nbsp;&nbsp;'L7:N7' =&gt; string 'L7:N7' (length=5)</div>\r\n<p>&nbsp;</p>\r\n<p>it contains about 70 entries, looks like those following:</p>\r\n<p>'A2:N2' =&gt; string 'A2:N2' (length=5)</p>\r\n<p>'A7:K7' =&gt; string 'A7:K7' (length=5)</p>\r\n<p>'L7:N7' =&gt; string 'L7:N7' (length=5)</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>I need to know is that an error in my code, noticing that when commenting merging line, writing Excel2007 speeds up to normal time again, or there is something that i shall do to speed up the performance?!</p>\r\n<p>OS: windows 7 Professional</p>\r\n<p>PHP:&nbsp;</p>\r\n<p>\r\n<p>PHP 5.2.11 (cli) (built: Sep 16 2009 19:39:46)</p>\r\n<p>Copyright (c) 1997-2009 The PHP Group</p>\r\n<p>Zend Engine v2.2.0, Copyright (c) 1998-2009 Zend Technologies</p>\r\n<p>&nbsp;&nbsp; &nbsp;with Xdebug v2.0.5, Copyright (c) 2002-2008, by Derick Rethans</p>\r\n<div>Apache HTTP:</div>\r\n<div>\r\n<div>Server version: Apache/2.2.14 (Win32)</div>\r\n<div>Server built: &nbsp; Sep 28 2009 22:41:08</div>\r\n<div></div>\r\n<div>Beast Regards,</div>\r\n<div>Mohamed Nabil</div>\r\n<div></div>\r\n</div>\r\n</p>",
    "PostedDate": "2010-04-05T11:28:23.3-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "427570",
    "ThreadId": "208375",
    "Html": "<p>Sample code performance results, it might help</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">When executing this code:</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">if ($this-&gt;shallMerge() == true) {// if it is more than 1 comlumn or more than 1 row</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\"><span style=\"white-space:pre\"> </span>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;mergeCells($this-&gt;getExcelRange($rowID));</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">}</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">//$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setSharedStyle($this-&gt;getExcelStyle($this-&gt;getGroupRowID()), $this-&gt;getExcelRange($rowID));</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">//$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($this-&gt;getExcelCell($rowID), $output);</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">result:</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">Excel composing Time = 0.5611422061920166</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">Excel writing Time = 0.1078641414642334</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">When executing this code:</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">if ($this-&gt;shallMerge() == true) {// if it is more than 1 comlumn or more than 1 row</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\"><span style=\"white-space:pre\"> </span>//$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;mergeCells($this-&gt;getExcelRange($rowID));</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">}</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setSharedStyle($this-&gt;getExcelStyle($this-&gt;getGroupRowID()), $this-&gt;getExcelRange($rowID));</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($this-&gt;getExcelCell($rowID), $output);</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">result:</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">Excel composing Time = 16.51956081390381</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">Excel writing Time = 7.201866865158081</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">When executing this code:</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">if ($this-&gt;shallMerge() == true) {// if it is more than 1 comlumn or more than 1 row</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\"><span style=\"white-space:pre\"> </span>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;mergeCells($this-&gt;getExcelRange($rowID));</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">}</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">//$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setSharedStyle($this-&gt;getExcelStyle($this-&gt;getGroupRowID()), $this-&gt;getExcelRange($rowID));</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($this-&gt;getExcelCell($rowID), $output);</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">result:</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">Excel composing Time = 2.914301156997681</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">Excel writing Time = 136.3055419921875</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">When executing this code:</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">if ($this-&gt;shallMerge() == true) {// if it is more than 1 comlumn or more than 1 row</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\"><span style=\"white-space:pre\"> </span>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;mergeCells($this-&gt;getExcelRange($rowID));</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">}</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setSharedStyle($this-&gt;getExcelStyle($this-&gt;getGroupRowID()), $this-&gt;getExcelRange($rowID));</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">//$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($this-&gt;getExcelCell($rowID), $output);</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">result:</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">Excel composing Time = 14.79245638847351</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">Excel writing Time = 207.0156230926514</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">When executing this code:</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">if ($this-&gt;shallMerge() == true) {// if it is more than 1 comlumn or more than 1 row</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\"><span style=\"white-space:pre\"> </span>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;mergeCells($this-&gt;getExcelRange($rowID));</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">}</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setSharedStyle($this-&gt;getExcelStyle($this-&gt;getGroupRowID()), $this-&gt;getExcelRange($rowID));</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($this-&gt;getExcelCell($rowID), $output);</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">result:</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">Excel composing Time = 16.50382709503174</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">\r\n<p>Excel writing Time = 225.4184210300446</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n</div>\r\n<p>\r\n<p>When executing this code:</p>\r\n<p>if ($this-&gt;shallMerge() == true) {// if it is more than 1 comlumn or more than 1 row</p>\r\n<p><span style=\"white-space:pre\"> </span>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;mergeCells($this-&gt;getExcelRange($rowID));</p>\r\n<p>}</p>\r\n<p>//$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setSharedStyle($this-&gt;getExcelStyle($this-&gt;getGroupRowID()), $this-&gt;getExcelRange($rowID));</p>\r\n<p>//$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($this-&gt;getExcelCell($rowID), $output);</p>\r\n<p>result:</p>\r\n<p>Excel composing Time = 0.5611422061920166</p>\r\n<p>Excel writing Time = 0.1078641414642334</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>When executing this code:</p>\r\n<p>if ($this-&gt;shallMerge() == true) {// if it is more than 1 comlumn or more than 1 row</p>\r\n<p><span style=\"white-space:pre\"> </span>//$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;mergeCells($this-&gt;getExcelRange($rowID));</p>\r\n<p>}</p>\r\n<p>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setSharedStyle($this-&gt;getExcelStyle($this-&gt;getGroupRowID()), $this-&gt;getExcelRange($rowID));</p>\r\n<p>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($this-&gt;getExcelCell($rowID), $output);</p>\r\n<p>result:</p>\r\n<p>Excel composing Time = 16.51956081390381</p>\r\n<p>Excel writing Time = 7.201866865158081</p>\r\n<p>&nbsp;</p>\r\n<p>When executing this code:</p>\r\n<p>if ($this-&gt;shallMerge() == true) {// if it is more than 1 comlumn or more than 1 row</p>\r\n<p><span style=\"white-space:pre\"> </span>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;mergeCells($this-&gt;getExcelRange($rowID));</p>\r\n<p>}</p>\r\n<p>//$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setSharedStyle($this-&gt;getExcelStyle($this-&gt;getGroupRowID()), $this-&gt;getExcelRange($rowID));</p>\r\n<p>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($this-&gt;getExcelCell($rowID), $output);</p>\r\n<p>result:</p>\r\n<p>Excel composing Time = 2.914301156997681</p>\r\n<p>Excel writing Time = 136.3055419921875</p>\r\n<p>&nbsp;</p>\r\n<p>When executing this code:</p>\r\n<p>if ($this-&gt;shallMerge() == true) {// if it is more than 1 comlumn or more than 1 row</p>\r\n<p><span style=\"white-space:pre\"> </span>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;mergeCells($this-&gt;getExcelRange($rowID));</p>\r\n<p>}</p>\r\n<p>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setSharedStyle($this-&gt;getExcelStyle($this-&gt;getGroupRowID()), $this-&gt;getExcelRange($rowID));</p>\r\n<p>//$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($this-&gt;getExcelCell($rowID), $output);</p>\r\n<p>result:</p>\r\n<p>Excel composing Time = 14.79245638847351</p>\r\n<p>Excel writing Time = 207.0156230926514</p>\r\n<p>&nbsp;</p>\r\n<p>When executing this code:</p>\r\n<p>if ($this-&gt;shallMerge() == true) {// if it is more than 1 comlumn or more than 1 row</p>\r\n<p><span style=\"white-space:pre\"> </span>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;mergeCells($this-&gt;getExcelRange($rowID));</p>\r\n<p>}</p>\r\n<p>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setSharedStyle($this-&gt;getExcelStyle($this-&gt;getGroupRowID()), $this-&gt;getExcelRange($rowID));</p>\r\n<p>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($this-&gt;getExcelCell($rowID), $output);</p>\r\n<p>result:</p>\r\n<p>Excel composing Time = 16.50382709503174</p>\r\n<p>Excel writing Time = 225.4184210300446</p>\r\n</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2010-04-05T12:22:07.73-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "427577",
    "ThreadId": "208375",
    "Html": "<p>Are you using any autosize columns?</p>",
    "PostedDate": "2010-04-05T12:45:24.117-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "427584",
    "ThreadId": "208375",
    "Html": "<p>WOW, Yes i do?</p>\r\n<p>What is the relation!</p>\r\n<p>&nbsp;</p>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">When executing this code:</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">if ($this-&gt;shallMerge() == true) {// if it is more than 1 comlumn or more than 1 row</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\"><span style=\"white-space:pre\"> </span>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;mergeCells($this-&gt;getExcelRange($rowID));</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">}</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setSharedStyle($this-&gt;getExcelStyle($this-&gt;getGroupRowID()), $this-&gt;getExcelRange($rowID));</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($this-&gt;getExcelCell($rowID), $output);</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">result:</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">Excel composing Time = 15.43027901649475</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px;top:0px;width:1px;height:1px;overflow-x:hidden;overflow-y:hidden\">Excel writing Time = 3.040853023529053</div>\r\n<p>Now&nbsp;When executing this code:</p>\r\n<p>\r\n<p>if ($this-&gt;shallMerge() == true) {// if it is more than 1 comlumn or more than 1 row</p>\r\n<p><span style=\"white-space:pre\"> </span>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;mergeCells($this-&gt;getExcelRange($rowID));</p>\r\n<p>}</p>\r\n<p>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setSharedStyle($this-&gt;getExcelStyle($this-&gt;getGroupRowID()), $this-&gt;getExcelRange($rowID));</p>\r\n<p>$this-&gt;objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue($this-&gt;getExcelCell($rowID), $output);</p>\r\n<p>result:</p>\r\n<p>Excel composing Time = 15.43027901649475</p>\r\n<p>Excel writing Time = 3.040853023529053</p>\r\n</p>\r\n<p>&nbsp;</p>\r\n<p>But column widths are not auto any more</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2010-04-05T12:55:33.82-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "427599",
    "ThreadId": "208375",
    "Html": "<p>Work item created:<br><a href=\"http://phpexcel.codeplex.com/WorkItem/View.aspx?WorkItemId=12509\">http://phpexcel.codeplex.com/WorkItem/View.aspx?WorkItemId=12509</a></p>\r\n<p>Replace this in PHPExcel/Worksheet.php</p>\r\n<p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre><span style=\"color:Green\">/**\r\n     * Calculate widths for auto-size columns\r\n     *\r\n     * @param  boolean  $calculateMergeCells  Calculate merge cell width\r\n     * @return PHPExcel_Worksheet;\r\n     */</span>\r\n    <span style=\"color:Blue\">public</span> <span style=\"color:Blue\">function</span> calculateColumnWidths($calculateMergeCells = false)\r\n    {\r\n        <span style=\"color:Green\">// initialize $autoSizes array</span>\r\n        $autoSizes = <span style=\"color:Blue\">array</span>();\r\n        <span style=\"color:Blue\">foreach</span> ($this-&gt;getColumnDimensions() <span style=\"color:Blue\">as</span> $colDimension) {\r\n            <span style=\"color:Blue\">if</span> ($colDimension-&gt;getAutoSize()) {\r\n                $autoSizes[$colDimension-&gt;getColumnIndex()] = -1;\r\n            }\r\n        }\r\n\r\n        <span style=\"color:Green\">// There is only something to do if there are some auto-size columns</span>\r\n        <span style=\"color:Blue\">if</span> (count($autoSizes) &gt; 0) {\r\n            <span style=\"color:Green\">// loop though all cells in sheet expand $autoSizes</span>\r\n            <span style=\"color:Blue\">foreach</span> ($this-&gt;getCellCollection(false) <span style=\"color:Blue\">as</span> $cell) {\r\n                <span style=\"color:Blue\">if</span> (<span style=\"color:Blue\">isset</span>($autoSizes[$cell-&gt;getColumn()])) {\r\n                    <span style=\"color:Green\">// Calculated value</span>\r\n                    $cellValue = $cell-&gt;getCalculatedValue();\r\n\r\n                    <span style=\"color:Green\">// To formatted string</span>\r\n                    $cellValue = PHPExcel_Style_NumberFormat::toFormattedString($cellValue, $this-&gt;getParent()-&gt;getCellXfByIndex($cell-&gt;getXfIndex())-&gt;getNumberFormat()-&gt;getFormatCode());\r\n\r\n                    <span style=\"color:Blue\">foreach</span> ($this-&gt;getMergeCells() <span style=\"color:Blue\">as</span> $cells) {\r\n                        <span style=\"color:Blue\">if</span> ($cell-&gt;isInRange($cells) &amp;&amp; !$calculateMergeCells) {\r\n                            $cellValue = <span style=\"color:#A31515\">''</span>; <span style=\"color:Green\">// do not calculate merge cells</span>\r\n                        }\r\n                    }\r\n\r\n                    $autoSizes[$cell-&gt;getColumn()] = max(\r\n                        (float)$autoSizes[$cell-&gt;getColumn()],\r\n                        (float)PHPExcel_Shared_Font::calculateColumnWidth(\r\n                            $this-&gt;getParent()-&gt;getCellXfByIndex($cell-&gt;getXfIndex())-&gt;getFont(),\r\n                            $cellValue,\r\n                            $this-&gt;getParent()-&gt;getCellXfByIndex($cell-&gt;getXfIndex())-&gt;getAlignment()-&gt;getTextRotation(),\r\n                            $this-&gt;getDefaultStyle()-&gt;getFont()\r\n                        )\r\n                    );\r\n                }\r\n            }\r\n\r\n            <span style=\"color:Green\">// adjust column widths</span>\r\n            <span style=\"color:Blue\">foreach</span> ($autoSizes <span style=\"color:Blue\">as</span> $columnIndex =&gt; $width) {\r\n                <span style=\"color:Blue\">if</span> ($width == -1) $width = $this-&gt;getDefaultColumnDimension()-&gt;getWidth();\r\n                $this-&gt;getColumnDimension($columnIndex)-&gt;setWidth($width);\r\n            }\r\n        }\r\n\r\n        <span style=\"color:Blue\">return</span> $this;\r\n    }\r\n</pre>\r\n</div>\r\n</p>\r\n<p>With this:</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre><span style=\"color:Green\">/**\r\n     * Calculate widths for auto-size columns\r\n     *\r\n     * @param  boolean  $calculateMergeCells  Calculate merge cell width\r\n     * @return PHPExcel_Worksheet;\r\n     */</span>\r\n    <span style=\"color:Blue\">public</span> <span style=\"color:Blue\">function</span> calculateColumnWidths($calculateMergeCells = false)\r\n    {\r\n        <span style=\"color:Green\">// initialize $autoSizes array</span>\r\n        $autoSizes = <span style=\"color:Blue\">array</span>();\r\n        <span style=\"color:Blue\">foreach</span> ($this-&gt;getColumnDimensions() <span style=\"color:Blue\">as</span> $colDimension) {\r\n            <span style=\"color:Blue\">if</span> ($colDimension-&gt;getAutoSize()) {\r\n                $autoSizes[$colDimension-&gt;getColumnIndex()] = -1;\r\n            }\r\n        }\r\n\r\n        <span style=\"color:Green\">// There is only something to do if there are some auto-size columns</span>\r\n        <span style=\"color:Blue\">if</span> (!<span style=\"color:Blue\">empty</span>($autoSizes)) {\r\n\r\n            <span style=\"color:Green\">// build list of cells references that participate in a merge</span>\r\n            $isMergeCell = <span style=\"color:Blue\">array</span>();\r\n            <span style=\"color:Blue\">foreach</span> ($this-&gt;getMergeCells() <span style=\"color:Blue\">as</span> $cells) {\r\n                <span style=\"color:Blue\">foreach</span> (PHPExcel_Cell::extractAllCellReferencesInRange($cells) <span style=\"color:Blue\">as</span> $cellReference) {\r\n                    $isMergeCell[$cellReference] = true;\r\n                }\r\n            }\r\n\r\n            <span style=\"color:Green\">// loop through all cells in the worksheet</span>\r\n            <span style=\"color:Blue\">foreach</span> ($this-&gt;getCellCollection(false) <span style=\"color:Blue\">as</span> $cell) {\r\n                <span style=\"color:Blue\">if</span> (<span style=\"color:Blue\">isset</span>($autoSizes[$cell-&gt;getColumn()])) {\r\n                    <span style=\"color:Green\">// Determine width if cell does not participate in a merge</span>\r\n                    <span style=\"color:Blue\">if</span> (!<span style=\"color:Blue\">isset</span>($isMergeCell[$cell-&gt;getCoordinate()])) {\r\n                        <span style=\"color:Green\">// Calculated value</span>\r\n                        $cellValue = $cell-&gt;getCalculatedValue();\r\n\r\n                        <span style=\"color:Green\">// To formatted string</span>\r\n                        $cellValue = PHPExcel_Style_NumberFormat::toFormattedString($cellValue, $this-&gt;getParent()-&gt;getCellXfByIndex($cell-&gt;getXfIndex())-&gt;getNumberFormat()-&gt;getFormatCode());\r\n\r\n                        $autoSizes[$cell-&gt;getColumn()] = max(\r\n                            (float)$autoSizes[$cell-&gt;getColumn()],\r\n                            (float)PHPExcel_Shared_Font::calculateColumnWidth(\r\n                                $this-&gt;getParent()-&gt;getCellXfByIndex($cell-&gt;getXfIndex())-&gt;getFont(),\r\n                                $cellValue,\r\n                                $this-&gt;getParent()-&gt;getCellXfByIndex($cell-&gt;getXfIndex())-&gt;getAlignment()-&gt;getTextRotation(),\r\n                                $this-&gt;getDefaultStyle()-&gt;getFont()\r\n                            )\r\n                        );\r\n                    }\r\n                }\r\n            }\r\n\r\n            <span style=\"color:Green\">// adjust column widths</span>\r\n            <span style=\"color:Blue\">foreach</span> ($autoSizes <span style=\"color:Blue\">as</span> $columnIndex =&gt; $width) {\r\n                <span style=\"color:Blue\">if</span> ($width == -1) $width = $this-&gt;getDefaultColumnDimension()-&gt;getWidth();\r\n                $this-&gt;getColumnDimension($columnIndex)-&gt;setWidth($width);\r\n            }\r\n        }\r\n\r\n        <span style=\"color:Blue\">return</span> $this;\r\n    }\r\n\r\n\r\n</pre>\r\n</div>\r\n<p>Or just wait until tomorrow and download latest source code from here:</p>\r\n<p><a href=\"http://phpexcel.codeplex.com/SourceControl/list/changesets\">http://phpexcel.codeplex.com/SourceControl/list/changesets</a></p>",
    "PostedDate": "2010-04-05T13:53:41.347-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "427608",
    "ThreadId": "208375",
    "Html": "<p>wonderful code<br><br>I've a suggestion regarding this block of code<br><br>// build list of cells references that participate in a merge<br>$isMergeCell = array();<br>foreach ($this-&gt;getMergeCells() as $cells) {<br>&nbsp;&nbsp; &nbsp;foreach (PHPExcel_Cell::extractAllCellReferencesInRange($cells) as $cellReference) {<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$isMergeCell[$cellReference] = true;<br>&nbsp;&nbsp; &nbsp;}<br>}<br><br><br>I suggest if you move it to mergeCells() function, once I merge, the list updated on time.</p>\r\n<p><br>foreach (PHPExcel_Cell::extractAllCellReferencesInRange($cells) as $cellReference) {<br>&nbsp;&nbsp; &nbsp;$isMergeCell[$cellReference] = true;<br>}<br><br>I think this will reduce the execution time of calculateColumnWidths()</p>",
    "PostedDate": "2010-04-05T14:27:06.137-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]