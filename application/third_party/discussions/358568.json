[
  {
    "Id": "845499",
    "ThreadId": "358568",
    "Html": "\r\n<p>Hello,</p>\r\n<p>&nbsp;</p>\r\n<p>I'm using PHPExcel to extract data from big Excel file (to store it in the database). But in some cases the data is calculated using formulae shared on a range of cells. Here is an extract of the Open XML data of my file :</p>\r\n<p></p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">c</span> <span style=\"color:red\">r</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">EA6</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">s</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">42</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">t</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">str</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">&gt;</span>\r\n  <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">f</span> <span style=\"color:red\">t</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">shared</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">ref</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">EA6:ER6</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">si</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">0</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">&gt;</span>IF(SUM(EA16:EA22)=0,&quot;&quot;,SUM(EA16:EA22))<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">f</span><span style=\"color:blue\">&gt;</span>\r\n  <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">v</span><span style=\"color:blue\">/&gt;</span>\r\n<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">c</span><span style=\"color:blue\">&gt;</span>\r\n<span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">c</span> <span style=\"color:red\">r</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">EB6</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">s</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">42</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">t</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">str</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">&gt;</span>\r\n  <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">f</span> <span style=\"color:red\">t</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">shared</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">si</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">0</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">/&gt;</span>\r\n  <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">v</span><span style=\"color:blue\">/&gt;</span>\r\n<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">c</span><span style=\"color:blue\">&gt;</span>\r\n<span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">c</span> <span style=\"color:red\">r</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">EC6</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">s</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">57</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">&gt;</span>\r\n  <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">f</span> <span style=\"color:red\">t</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">shared</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">si</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">0</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">/&gt;</span>\r\n  <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">v</span><span style=\"color:blue\">&gt;</span>2.88889<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">v</span><span style=\"color:blue\">&gt;</span>\r\n<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">c</span><span style=\"color:blue\">&gt;</span>\r\n<span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">c</span> <span style=\"color:red\">r</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">ED6</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">s</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">57</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">&gt;</span>\r\n  <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">f</span> <span style=\"color:red\">t</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">shared</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">si</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">0</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">/&gt;</span>\r\n  <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">v</span><span style=\"color:blue\">&gt;</span>2.88889<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">v</span><span style=\"color:blue\">&gt;</span>\r\n<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">c</span><span style=\"color:blue\">&gt;</span>\r\n<span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">c</span> <span style=\"color:red\">r</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">EE6</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">s</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">57</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">&gt;</span>\r\n  <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">f</span> <span style=\"color:red\">t</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">shared</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">si</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">0</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">/&gt;</span>\r\n  <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">v</span><span style=\"color:blue\">&gt;</span>2.88889<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">v</span><span style=\"color:blue\">&gt;</span>\r\n<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">c</span><span style=\"color:blue\">&gt;</span>\r\n<span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">c</span> <span style=\"color:red\">r</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">EF6</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">s</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">57</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">&gt;</span>\r\n  <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">f</span> <span style=\"color:red\">t</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">shared</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">si</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">0</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">/&gt;</span>\r\n  <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">v</span><span style=\"color:blue\">&gt;</span>2.88889<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">v</span><span style=\"color:blue\">&gt;</span>\r\n<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">c</span><span style=\"color:blue\">&gt;</span>\r\n</pre>\r\n</div>\r\n<p></p>\r\n<p>As you can see, the calculated values are not null, but when I read the file, it returns me an empty string.</p>\r\n<p>For the record, here is my &quot;setup&quot; of PHPExcel, using a ReaderFilter, and custom cache method :</p>\r\n<p></p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:green\">//Set the cache for PHPExcel</span>\r\n$cacheMethod = PHPExcel_CachedObjectStorageFactory::cache_to_phpTemp;\r\n$cacheSettings = <span style=\"color:blue\">array</span>( <span style=\"color:#a31515\">'memoryCacheSize'</span> =&gt; <span style=\"color:#a31515\">'128MB'</span>);\r\nPHPExcel_Settings::setCacheStorageMethod($cacheMethod,$cacheSettings);\r\n\r\n<span style=\"color:green\">//Declare a reader for an &quot;xlsx&quot; file</span>\r\n$objReader = <span style=\"color:blue\">new</span> PHPExcel_Reader_Excel2007();\r\n\r\n<span style=\"color:green\">//Read data without format only</span>\r\n$objReader-&gt;setReadDataOnly(true);\r\n<span style=\"color:green\">//Implement settings of PHPExcel Reader and loads the file</span>\r\n$startRow=1;\r\n$chunkSize = 1;\r\n$chunkFilter = <span style=\"color:blue\">new</span> App_MyReaderFilter();\r\n$objReader-&gt;setReadFilter($chunkFilter);\r\n$chunkFilter-&gt;setRows($startRow,$chunkSize);\r\n$objReader-&gt;setLoadSheetsOnly(<span style=\"color:blue\">array</span>($sheetName));\r\n$excel = $objReader-&gt;load($<span style=\"color:blue\">file</span>);\r\n</pre>\r\n</div>\r\n<p></p>\r\n<p>Any idea why it's doing that ?</p>\r\n<p>&nbsp;</p>\r\n<p>Thanks</p>\r\n",
    "PostedDate": "2012-06-06T05:26:41.853-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "845589",
    "ThreadId": "358568",
    "Html": "<p>The problem is likely to be the read filter ignoring the cell containing the original definition of the shared formula, so it's not available to other cells included by the read filter that use it</p>",
    "PostedDate": "2012-06-06T08:49:55.707-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "845590",
    "ThreadId": "358568",
    "Html": "This discussion has been copied to a work item. Click <a href=\"http://phpexcel.codeplex.com/workitem/18192\">here</a> to go to the work item and continue the discussion.",
    "PostedDate": "2012-06-06T08:50:38.16-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "845932",
    "ThreadId": "358568",
    "Html": "<p>You're right, I removed the ReaderFilter and it worked.</p>\r\n<p>Thanks !</p>",
    "PostedDate": "2012-06-07T02:45:06.443-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]