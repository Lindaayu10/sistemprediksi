[
  {
    "Id": "521343",
    "ThreadId": "234530",
    "Html": "\r\n<p>Hi Folks,</p>\r\n<p>I had try to use cell caching , so i need help , cause i dont know do i make mistake on my side or this class has some problem.</p>\r\n<p>Here i give short sample of my script :</p>\r\n<p></p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>&lt;?php\r\n<span style=\"color:blue\">require_once</span>(<span style=\"color:#a31515\">'phpexcel/Classes/PHPExcel.php'</span>) ;\r\nset_time_limit(0) ;\r\n\r\n$cacheMethod = PHPExcel_CachedObjectStorageFactory:: cache_to_phpTemp; <span style=\"color:green\">//PHPExcel_CachedObjectStorageFactory::cache_to_discISAM ; //</span>\r\n$cacheSettings = <span style=\"color:blue\">array</span>( <span style=\"color:#a31515\">'memoryCacheSize'</span> =&gt; <span style=\"color:#a31515\">'32MB'</span>);\r\nPHPExcel_Settings::setCacheStorageMethod($cacheMethod, $cacheSettings);\r\n\r\n$objReader = PHPExcel_IOFactory::createReader(<span style=\"color:#a31515\">'Excel2007'</span>);\r\n$objPHPExcel = $objReader-&gt;load(<span style=\"color:#a31515\">&quot;mega_list.xlsx&quot;</span>); <span style=\"color:green\">// my file has 10 columns and 25200 rows</span>\r\n\r\n?&gt;\r\n</pre>\r\n</div>\r\n<p></p>\r\n<p>I have a box with 2 GB ram only , i have free for use 1.4 GB. I will use this so that i use so low memory as possible</p>\r\n<p>So i have following problems :</p>\r\n<p>1.) What Caching method should i use (speed is not so importaint)</p>\r\n<p>2.) What means &quot;memoryCacheSize&quot;=&gt;&quot;32MB&quot; ? I have understand if memory usage is greater than &quot;32MB&quot; rest will be stored in file on disk ? If this is right i have problem that the script try to use all my memory what i have</p>\r\n<p>3.) After my script has finished, it would be aprox. 350MB RAM memory not freed , it goes to NIRVANA somewhere in APACHE2, even after 1 Hour the memory is not freed. I must restart my apache to get this memory free , if my customers start this script few\r\n times , i must reboot my box</p>\r\n<p>&nbsp;</p>\r\n<p>What could be here wrong ?</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n",
    "PostedDate": "2010-11-12T16:20:28.987-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "521446",
    "ThreadId": "234530",
    "Html": "\r\n<blockquote style=\"border:solid .1em #ccc; font-style:italic; margin:.25em 1em 0 1em; padding:0 .25em 0 .25em\">\r\n<strong>misic wrote:</strong><br>\r\n<p>1.) What Caching method should i use (speed is not so importaint)</p>\r\n</blockquote>\r\n<p>APC, Memcache or &nbsp;WinCache offer the best reduction in memory usage, but are also the slowest performance. DiskIsam and PHPTemp offer the next best memory performance.</p>\r\n<p>&nbsp;</p>\r\n<blockquote style=\"border:solid .1em #ccc; font-style:italic; margin:.25em 1em 0 1em; padding:0 .25em 0 .25em\">\r\n<strong>misic wrote:</strong><br>\r\n<p>2.) What means &quot;memoryCacheSize&quot;=&gt;&quot;32MB&quot; ? I have understand if memory usage is greater than &quot;32MB&quot; rest will be stored in file on disk ? If this is right i have problem that the script try to use all my memory what i have</p>\r\n</blockquote>\r\n<p>&nbsp;Your understanding is basically correct. PHPTemp will use up to 32MB of memory; and if trying to store more information than will fit in&nbsp;32MB of memory, then it will use disk storage for the rest. Note that all cache mechanisms retain an &quot;in memory&quot;\r\n index of cells, and it is the cell objects that are cached. When using in memory cells, my rule of thumb is 1k memory/cell (about 1.6k&nbsp;when using&nbsp;64-bit PHP), doubled if writing the workbook rather than just reading... actual values will depend on\r\n the value of the cell, and the styles used. When using DiskISAM or PHPTemp, this 1k is reduced to about 320 bytes/cell to maintain the index.</p>\r\n<blockquote style=\"border:solid .1em #ccc; font-style:italic; margin:.25em 1em 0 1em; padding:0 .25em 0 .25em\">\r\n<strong>misic wrote:</strong><br>\r\n<p>3.) After my script has finished, it would be aprox. 350MB RAM memory not freed , it goes to NIRVANA somewhere in APACHE2, even after 1 Hour the memory is not freed. I must restart my apache to get this memory free , if my customers start this script few\r\n times , i must reboot my box</p>\r\n</blockquote>\r\n<p>&nbsp;After the script has finished executing, PHP itself clears all the memory that was used by the script. That is not a function of PHPExcel, and I'm not aware that PHP itself has any bugs regarding the garbage collection on termination of the script\r\n (although it has known problems with garbage collection and cyclic references while the script is still running). If memory isn't being cleared by PHP/Apache, then it is a much more serious problem. If anything, this should be raised with the Apache or PHP\r\n development teams.</p>\r\n",
    "PostedDate": "2010-11-13T03:56:26.437-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "521457",
    "ThreadId": "234530",
    "Html": "\r\n<p>&nbsp;</p>\r\n<p>3.) You are right for garbage collection , must see to fix the settings via ini_set&nbsp; before my script runs , and then when the next session started should clear garbage collection. Must test this and write my result in forum , for other customers if\r\n they have such problem too.</p>\r\n<p><strong><em><span style=\"font-size:9pt\">misic wrote:</span></em></strong><em>&nbsp;</em></p>\r\n<p><em><span style=\"font-size:9pt\">2.) What means &quot;memoryCacheSize&quot;=&gt;&quot;32MB&quot; ? I have understand if memory usage is greater than &quot;32MB&quot; rest will be stored in file on disk ? If this is right i have problem that the script try to use all my memory what i have</span></em></p>\r\n<p><span style=\"font-size:9pt\">&nbsp;Your understanding is basically correct. PHPTemp will use up to 32MB of memory; and if trying to store more information than will fit in&nbsp;32MB of memory, then it will use disk storage for the rest. Note that all cache\r\n mechanisms retain an &quot;in memory&quot; index of cells, and it is the cell objects that are cached. When using in memory cells, my rule of thumb is 1k memory/cell (about 1.6k&nbsp;when using&nbsp;64-bit PHP), doubled if writing the workbook rather than just reading...\r\n actual values will depend on the value of the cell, and the styles used. When using DiskISAM or PHPTemp, this 1k is reduced to about 320 bytes/cell to maintain the index.</span></p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"font-size:9pt\">I have 64 Bit box , so what would be the best solution for saving memory ? Is possible to get it so that my script use only 32MB (or 64MB) ram and rest goes to cache file ?</span></p>\r\n",
    "PostedDate": "2010-11-13T04:15:14.717-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "521464",
    "ThreadId": "234530",
    "Html": "\r\n<blockquote style=\"border:solid .1em #ccc; font-style:italic; margin:.25em 1em 0 1em; padding:0 .25em 0 .25em\">\r\n<strong>misic wrote:</strong><br>\r\n<p><span style=\"font-size:9pt\">I have 64 Bit box , so what would be the best solution for saving memory ? Is possible to get it so that my script use only 32MB (or 64MB) ram and rest goes to cache file ?</span></p>\r\n</blockquote>\r\n<p>&nbsp;The only solution that I can think of to guarantee that a large workbook would run in 32MB or 64MB of memory would be to write a custom cache that would also store the cell index outside of the PHP memory. I did try this when I introduced cell caching,\r\n but the performance really was impossible to work with, but it might be practical to use (for example) DiskISAM or PHPTemp for the actual cell object storage, and APC or MemCache for storing the cell index (with entries for each individual cell rather than\r\n stored as an array). This would be a case of a very specific caching method, with very limit usage generally, but could be the best way to optimise memory usage for a very specific instance.</p>\r\n<p>While cells themselves are cached, there are still shared string and style arrays maintained in memory. For optimum memory performance, these should also be cached.</p>\r\n<p>&nbsp;</p>\r\n<p>Reducing memory is a situation where I have to provide a series of general options that will provide solutions to a majority of PHPExcel users, but every solution provides a trade off between memory usage and pereformance. At the moment, I'm working on the\r\n performance of the Writers, trying to increase speed and reduce their memory usage... but there are no quick solutions to the memory problems.</p>\r\n",
    "PostedDate": "2010-11-13T04:43:39.027-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "521487",
    "ThreadId": "234530",
    "Html": "\r\n<p>Maybe cuould you put something like this in future releases....</p>\r\n<p>&nbsp;</p>\r\n<p>Cause phpExcel is very memory &quot;hungry&quot; and with more user at the same time on 1 box can cause trouble if you have limited resources</p>\r\n",
    "PostedDate": "2010-11-13T06:42:14.177-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1118911",
    "ThreadId": "234530",
    "Html": "Hi,\r<br />\nI'm new in PHPExcel and I have some problems.\r<br />\nI read to much about the situation with the memory usage.\r<br />\nI need your help because I get this message &quot;15:09:33 Create new PHPExcel object&lt;br /&gt;&lt;br /&gt;\r<br />\n&lt;b&gt;Fatal error&lt;/b&gt;:  Allowed memory size of 100663296 bytes exhausted (tried to allocate 20 bytes) in &lt;b&gt;/home/x067vm23/public_html/mercedes-benz/application/libraries/PHPExcel/Style/Supervisor.php&lt;/b&gt; on line &lt;b&gt;125&lt;/b&gt;&lt;br /&gt;&quot; when execute the code.\r<br />\nI think the cell caching don't work in my code because I do anything wrong.\r<br />\nThe code is:\r<br />\n<br />\nerror_reporting(E_ALL);<br />\n<pre><code>        ini_set('display_errors', TRUE);\n        ini_set('display_startup_errors', TRUE);\n        ini_set('memory_limit', '96m');\n\n        define('EOL',(PHP_SAPI == 'cli') ? PHP_EOL : '&lt;br /&gt;');\n\n        date_default_timezone_set('Europe/London');\n\n        $this-&gt;load-&gt;library('PHPExcel');\n</code></pre>\n\nset_time_limit(0) ;\r<br />\n<br />\n$cacheMethod = PHPExcel_CachedObjectStorageFactory:: cache_to_phpTemp; //PHPExcel_CachedObjectStorageFactory::cache_to_discISAM ; //\r<br />\n$cacheSettings = array( 'memoryCacheSize' =&gt; '96MB');\r<br />\nPHPExcel_Settings::setCacheStorageMethod($cacheMethod, $cacheSettings);\r<br />\n<br />\n// Create new PHPExcel object\r<br />\necho date('H:i:s') , &quot; Create new PHPExcel object&quot; , EOL;<br />\n<pre><code>            $objPHPExcel = new PHPExcel();\n</code></pre>\n\n...\r<br />\n...\r<br />\n...<br />\n<pre><code>                    echo date('H:i:s') , &quot; Write to Excel2007 format&quot; , EOL;\n        $callStartTime = microtime(true);\n\n        // Save Excel 2007 file\n        $objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');\n        $objWriter-&gt;save($this-&gt;NombreArchivo);\n        $objPHPExcel-&gt;disconnectWorksheets();\n        unset($objPHPExcel);\n\n        $callEndTime = microtime(true);\n        $callTime = $callEndTime - $callStartTime;\n\n        echo date('H:i:s') , &quot; File written to &quot; , str_replace('.php', '.xls', pathinfo(__FILE__, PATHINFO_BASENAME)) , EOL;\n        echo 'Call time to write Workbook was ' , sprintf('%.4f',$callTime) , &quot; seconds&quot; , EOL;\n        // Echo memory usage\n        echo date('H:i:s') , ' Current memory usage: ' , (memory_get_usage(true) / 1024 / 1024) , &quot; MB&quot; , EOL;\n\n        // Echo memory peak usage\n        echo date('H:i:s') , &quot; Peak memory usage: &quot; , (memory_get_peak_usage(true) / 1024 / 1024) , &quot; MB&quot; , EOL;\n</code></pre>\n\nCan you help me?\r<br />\n<br />\nThank you very much.\r<br />\n<br />\nEzequiel,<br />\n",
    "PostedDate": "2013-11-06T07:17:56.617-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]