[
  {
    "Id": "727530",
    "ThreadId": "286662",
    "Html": "<p>Im having trouble coping the styles from reading one xls modifying then writing a new file. The duplicate styles doesnt seem to work across different files.&nbsp; Any suggestions?</p>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<div style=\"color: black; background-color: white;\">\n<pre>&lt;?php\n <span style=\"color: blue;\">include</span> <span style=\"color: #a31515;\">'Phpexcel/PHPExcel.php'</span>;\n <span style=\"color: blue;\">include</span> <span style=\"color: #a31515;\">'Phpexcel/PHPExcel/Writer/Excel2007.php'</span>;\n\n$objPHPExcel = <span style=\"color: blue;\">new</span> PHPExcel();\n$new_sheet =  $objPHPExcel-&gt;getActiveSheet();\n$objReader = PHPExcel_IOFactory::createReader(<span style=\"color: #a31515;\">'Excel2007'</span>);\n$objReader = $objReader-&gt;load(<span style=\"color: #a31515;\">\"Projection_Template.xlsx\"</span>);\n$read_sheet = $objReader-&gt;getActiveSheet();\n\n<span style=\"color: blue;\">foreach</span> ($read_sheet-&gt;getRowIterator() <span style=\"color: blue;\">as</span> $row) {\n   $cellIterator = $row-&gt;getCellIterator();\n   <span style=\"color: blue;\">foreach</span> ($cellIterator <span style=\"color: blue;\">as</span> $cell) {\n      <span style=\"color: blue;\">if</span> (($cell-&gt;getValue() != <span style=\"color: #a31515;\">\"\"</span>)) {\n         $coord = $cell-&gt;getCoordinate();\n         <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"Cell:$coord - \"</span> . $cell-&gt;getValue() .<span style=\"color: #a31515;\">\"&lt;BR&gt;\"</span>;\n         $new_sheet-&gt;SetCellValue($coord,$cell-&gt;getValue());\n         $new_sheet-&gt;duplicateStyle($read_sheet-&gt;getStyle($coord), $coord ); //&lt;--------\n      }\n   }\n}\n\n$objWriter = <span style=\"color: blue;\">new</span> PHPExcel_Writer_Excel2007($objPHPExcel);\n$objWriter-&gt;save(<span style=\"color: #a31515;\">\"1_modified.xlsx\"</span>);\n?&gt;\n</pre>\n</div>",
    "PostedDate": "2012-01-19T04:08:51.24-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "727829",
    "ThreadId": "286662",
    "Html": "<p>This is where the addExternalSheet() is useful: it allows you to copy a worksheet from one workbook to another, including merging the styles correctly into the new worksheet.</p>",
    "PostedDate": "2012-01-19T13:34:50.537-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "727957",
    "ThreadId": "286662",
    "Html": "<p>Thanks heaps. That worked like a charm! Although I think I found a bug using addExternalSheet.&nbsp; After the following code copied over the sheet into the new workbook (styles and all) it now appears that if you try and edit one of the cells the background of the cell changes to black  instead of the normal thinning of the line. My code is as follows:</p>\n<p>Edit: I fixed the black cell problem by commenting out a line in PHPExcel/Reader/Excel2007.php as found by quacki in this post: <a title=\"http://phpexcel.codeplex.com/discussions/213643\" href=\"213643\"> http://phpexcel.codeplex.com/discussions/213643</a></p>\n<pre><span style=\"color: green;\">//Comment line 1584  $docStyle-&gt;getFill()-&gt;getStartColor()-&gt;setARGB('FF000000');</span></pre>\n<p>My new code:</p>\n<div style=\"color: black; background-color: white;\">\n<pre>&lt;?php\n <span style=\"color: blue;\">include</span> <span style=\"color: #a31515;\">'Phpexcel/PHPExcel.php'</span>;\n <span style=\"color: blue;\">include</span> <span style=\"color: #a31515;\">'Phpexcel/PHPExcel/Writer/Excel2007.php'</span>;\n\n\n$objPHPExcel = <span style=\"color: blue;\">new</span> PHPExcel();\n$new_sheet =  $objPHPExcel-&gt;getActiveSheet();\n\n$objReader = PHPExcel_IOFactory::createReader(<span style=\"color: #a31515;\">'Excel2007'</span>);\n$objReader = $objReader-&gt;load(<span style=\"color: #a31515;\">\"1_test.xlsx\"</span>);\n$template = $objReader-&gt;getActiveSheet();\n\n$objPHPExcel-&gt;addExternalSheet($template); <span style=\"color: green;\">//our template is now in the same workbook</span>\n$objPHPExcel-&gt;setActiveSheetIndex(1); <span style=\"color: green;\">//set it to the newly added sheet</span>\n$template = $objPHPExcel-&gt;getActiveSheet(); \n\n<span style=\"color: blue;\">foreach</span> ($template-&gt;getRowIterator() <span style=\"color: blue;\">as</span> $row) {\n   $cellIterator = $row-&gt;getCellIterator();\n   <span style=\"color: blue;\">foreach</span> ($cellIterator <span style=\"color: blue;\">as</span> $cell) {\n      <span style=\"color: blue;\">if</span> (($cell-&gt;getValue() != <span style=\"color: #a31515;\">\"\"</span>)) {\n         $coord = $cell-&gt;getCoordinate();\n         <span style=\"color: blue;\">echo</span> <span style=\"color: #a31515;\">\"Cell:$coord - \"</span> . $cell-&gt;getValue() .<span style=\"color: #a31515;\">\"&lt;BR&gt;\"</span>;\n         $new_sheet-&gt;SetCellValue($coord,$cell-&gt;getValue());\n         $new_sheet-&gt;duplicateStyle($template-&gt;getStyle($coord), $coord );\n      }\n   }\n}\n\n$objWriter = <span style=\"color: blue;\">new</span> PHPExcel_Writer_Excel2007($objPHPExcel);\n$objWriter-&gt;save(<span style=\"color: #a31515;\">\"1_modified.xlsx\"</span>);\n?&gt;\n</pre>\n</div>",
    "PostedDate": "2012-01-19T21:14:26.737-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]