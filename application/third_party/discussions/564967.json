[
  {
    "Id": "1298169",
    "ThreadId": "564967",
    "Html": "I'm using somethings from this site to convert table html to excel file . <a href=\"https://phpexcel.codeplex.com/discussions/275807\" rel=\"nofollow\">https://phpexcel.codeplex.com/discussions/275807</a>\r<br />\n<br />\nI realised when Im open the excel file ,it not include my data that have special char &lt; .Example,I have a columns that have data like this , &lt;1004&gt; . I think I have to change something about DOM but I'm really new in this topic.Anyone have a experience about this.Any help will be greatly appreciate.Thanks.<br />\n<pre><code>&lt;?php\ninclude_once(dirname(__FILE__) . '/../php/ixcdr.php');\nsession_start();\n$callhistoryTable .='&lt;html&gt;';\n$callhistoryTable .='&lt;head&gt;';\n$callhistoryTable .='&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;';\n$callhistoryTable .='&lt;/head&gt;';\n$callhistoryTable .='&lt;div class=&quot;contentlist&quot;&gt;';\n$callhistoryTable .='&lt;form id=&quot;history_form&quot;&gt;';\n$callhistoryTable .='&lt;table style=&quot;font-size:11px;&quot; width=&quot;1050&quot; border=&quot;0&quot; id=&quot;allhist&quot; class=&quot;tablesorter-blue&quot;&gt;';\n$callhistoryTable .='&lt;thead&gt;';\n$callhistoryTable .='&lt;tr&gt;';\n$callhistoryTable .='&lt;th width=&quot;50&quot;&gt;Call Date&lt;/th&gt;';\n$callhistoryTable .='&lt;th width=&quot;200&quot;&gt;CallerId&lt;/th&gt;';\n$callhistoryTable .='&lt;th width=&quot;100&quot;&gt;Origination&lt;/th&gt;';\n$callhistoryTable .='&lt;th width=&quot;100&quot;&gt;Destination&lt;/th&gt;';\n$callhistoryTable .='&lt;th width=&quot;100&quot;&gt;Duration&lt;/th&gt;';\n$callhistoryTable .='&lt;th width=&quot;200&quot;&gt;Account Code&lt;/th&gt;';\n$callhistoryTable .='&lt;/tr&gt;';\n$callhistoryTable .='&lt;/thead&gt;';\n$callhistoryTable .='&lt;tbody&gt;';\n\n                $userid = $_POST['searchnum'];\n                $fromdate = $_POST['fromdate'];\n                $todate = $_POST['todate'];\n\n                $getCdrList = getAllCdr($userid, $fromdate, $todate);\n                if (count($getCdrList) &gt; 0) {\n                    for ($i = 0; $i &lt; count($getCdrList); $i ++) {\n                        $getCdrListRecord = $getCdrList[$i];\n$callhistoryTable .='&lt;tr&gt;';\n$callhistoryTable .='&lt;td style=&quot;font-weight: bold;&quot;&gt;'.$getCdrListRecord-&gt;get_CallDate().'&lt;/td&gt;';\n$callhistoryTable .='&lt;td style=&quot;font-weight: bold;&quot;&gt;'.$getCdrListRecord-&gt;get_Clid().'&lt;/td&gt;';\n$callhistoryTable .='&lt;td style=&quot;font-weight: bold;&quot;&gt;'.$getCdrListRecord-&gt;get_Src().'&lt;/td&gt;';\n$callhistoryTable .='&lt;td style=&quot;font-weight: bold;&quot;&gt;'.$getCdrListRecord-&gt;get_Dst().'&lt;/td&gt;';\n$callhistoryTable .='&lt;td style=&quot;font-weight: bold;&quot;&gt;'.$getCdrListRecord-&gt;get_Duration().'&lt;/td&gt;';\n$callhistoryTable .='&lt;td&gt;'.$getCdrListRecord-&gt;get_AccountCode().'&lt;/td&gt;';\n$callhistoryTable .='&lt;/tr&gt;';\n                    }\n                } else {\n$callhistoryTable .='&lt;tr&gt;';\n$callhistoryTable .='&lt;td colspan=&quot;6&quot;&gt;No cdr to display&lt;/td&gt;';\n$callhistoryTable .='&lt;/tr&gt;';\n                }\n\n                echo $callhistoryTable;\n                ?&gt;\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n        &lt;table width=&quot;1000px&quot; style=&quot;margin: 10px 30px 15px;&quot;&gt;\n            &lt;tr&gt;&lt;td&gt;\n                    &lt;div id=&quot;pager&quot; class=&quot;pager&quot;&gt;\n                        &lt;form&gt;\n                            &lt;a href=&quot;/Blackbox/ippbx/load/exportxls.php?var=tableConvertxls&quot; target=&quot;_blank&quot; title=&quot;Export table to Excel&quot;&gt;&lt;img src=&quot;img/32x32/file_extension_xls.png&quot; alt=&quot;Export table to Excel&quot; hspace=&quot;3&quot; /&gt;&lt;/a&gt;\n                        &lt;/form&gt;\n                    &lt;/div&gt;\n                &lt;/td&gt;&lt;/tr&gt;\n        &lt;/table&gt;\n    &lt;/form&gt;\n&lt;/div&gt;\n&lt;html&gt;\n&lt;?php\n$_SESSION['tableConvertxls'] = $callhistoryTable;\nexit;\n\n?&gt;</code></pre>\n\nSend to this FILE\r<br />\n<br />\n```\r\n&lt;?php\r<br />\nsession_start();\r<br />\nini_set(&quot;memory_limit&quot;, &quot;-1&quot;);\r<br />\nini_set(&quot;set_time_limit&quot;, &quot;0&quot;);\r<br />\nset_time_limit(0);\r<br />\n<br />\nif (!isset($_GET['var'])) {<br />\n<pre><code>echo &quot;&lt;br /&gt;No Table Variable Present, nothing to Export.&quot;;\nexit;</code></pre>\n\n} else {<br />\n<pre><code>$tablevar = $_GET['var'];</code></pre>\n\n}\r<br />\nif (!isset($_SESSION[$tablevar]) OR $_SESSION[$tablevar] == '') {<br />\n<pre><code>echo &quot;&lt;br /&gt;Empty HTML Table, nothing to Export.&quot;;\nexit;</code></pre>\n\n} else {<br />\n<pre><code>$htmltable = $_SESSION[$tablevar];  //table data as html format</code></pre>\n\n}\r<br />\nif (strlen($htmltable) == strlen(strip_tags($htmltable))) {  //if data_table format not as expected<br />\n<pre><code>echo &quot;&lt;br /&gt;Invalid HTML Table after Stripping Tags, nothing to Export.&quot;;\nexit;</code></pre>\n\n}\r<br />\n$htmltable = strip_tags($htmltable, &quot;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&quot;);\r<br />\n$htmltable = str_replace(&quot;&lt;br /&gt;&quot;, &quot;\\n&quot;, $htmltable);\r<br />\n$htmltable = str_replace(&quot;&lt;br/&gt;&quot;, &quot;\\n&quot;, $htmltable);\r<br />\n$htmltable = str_replace(&quot;&lt;br&gt;&quot;, &quot;\\n&quot;, $htmltable);\r<br />\n$htmltable = str_replace(&quot;&nbsp;&quot;, &quot; &quot;, $htmltable);\r<br />\n$htmltable = str_replace(&quot;\\n\\n&quot;, &quot;\\n&quot;, $htmltable);\r<br />\n<br />\n//\r<br />\n//  Extract HTML table contents to array\r<br />\n//\r<br />\n$dom = new domDocument;\r<br />\n//$dom-&gt;loadHTML($htmltable);\r<br />\n//$dom-&gt;loadHTML(mb_convert_encoding($htmltable, 'HTML-ENTITIES', 'UTF-8'));\r<br />\n$dom-&gt;loadHTML('&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;'.$htmltable);\r<br />\nif (!$dom) {<br />\n<pre><code>echo &quot;&lt;br /&gt;Invalid HTML DOM, nothing to Export.&quot;;\nexit;</code></pre>\n\n}\r<br />\n$dom-&gt;preserveWhiteSpace = false;             // remove redundant whitespace\r<br />\n$tables = $dom-&gt;getElementsByTagName('table');\r<br />\n<br />\nif (!is_object($tables)) {<br />\n<pre><code>echo &quot;&lt;br /&gt;Invalid HTML Table DOM, nothing to Export.&quot;;\nexit;</code></pre>\n\n}\r<br />\nif ($debug) {<br />\n<pre><code>fwrite($handle, &quot;\\nTable Count: &quot; . $tables-&gt;length);</code></pre>\n\n}\r<br />\n$tbcnt = $tables-&gt;length - 1;                 // count minus 1 for 0 indexed loop over tables\r<br />\nif ($tbcnt &gt; $limit) {<br />\n<pre><code>$tbcnt = $limit;</code></pre>\n\n}\r<br />\n//\r<br />\n//\r<br />\n// Create new PHPExcel object with default attributes\r<br />\n//\r<br />\nrequire_once ('/../classes/PHPExcel.php');\r<br />\n$objPHPExcel = new PHPExcel();\r<br />\n$objPHPExcel-&gt;getDefaultStyle()-&gt;getFont()-&gt;setName('Arial');\r<br />\n$objPHPExcel-&gt;getDefaultStyle()-&gt;getFont()-&gt;setSize(9);\r<br />\n$tm = date(Ymd);\r<br />\n$name = &quot;historyrecord&quot;;\r<br />\n$tfn = $name . &quot;_&quot; . $tm . &quot;.xlsx&quot;;\r<br />\n//$fname = &quot;AuditLog/&quot;.$tfn;\r<br />\n$fname = $tfn;\r<br />\n$objPHPExcel-&gt;getProperties()-&gt;setCreator($_SESSION['IX_USERNAME'])<br />\n<pre><code>    -&gt;setLastModifiedBy($_SESSION['IX_USERNAME'])\n    -&gt;setTitle(&quot;Automated Export&quot;)\n    -&gt;setSubject(&quot;Automated Report Generation&quot;)\n    -&gt;setDescription(&quot;Automated report generation.&quot;)\n    -&gt;setKeywords(&quot;Exported File&quot;)\n    -&gt;setCompany($usercompany)\n    -&gt;setCategory(&quot;Export&quot;);</code></pre>\n\n//\r<br />\n// Loop over tables in DOM to create an array, each table becomes a worksheet\r<br />\n//\r<br />\nfor ($z = 0; $z &lt;= $tbcnt; $z++) {<br />\n<pre><code>$maxcols = 0;\n$totrows = 0;\n$headrows = array();\n$bodyrows = array();\n$r = 0;\n$h = 0;\n$rows = $tables-&gt;item($z)-&gt;getElementsByTagName('tr');\n$totrows = $rows-&gt;length;\nif ($debug) {\n    fwrite($handle, &quot;\\nTotal Rows: &quot; . $totrows);\n}\nforeach ($rows as $row) {\n    $ths = $row-&gt;getElementsByTagName('th');\n    if (is_object($ths)) {\n        if ($ths-&gt;length &gt; 0) {\n            $headrows[$h]['colcnt'] = $ths-&gt;length;\n            if ($ths-&gt;length &gt; $maxcols) {\n                $maxcols = $ths-&gt;length;\n            }\n            $nodes = $ths-&gt;length - 1;\n            for ($x = 0; $x &lt;= $nodes; $x++) {\n                $thishdg = $ths-&gt;item($x)-&gt;nodeValue;\n                $headrows[$h]['th'][] = $thishdg;\n                $headrows[$h]['bold'][] = findBoldText(innerHTML($ths-&gt;item($x)));\n                if ($ths-&gt;item($x)-&gt;hasAttribute('style')) {\n                    $style = $ths-&gt;item($x)-&gt;getAttribute('style');\n                    $stylecolor = findStyleColor($style);\n                    if ($stylecolor == '') {\n                        $headrows[$h]['color'][] = findSpanColor(innerHTML($ths-&gt;item($x)));\n                    } else {\n                        $headrows[$h]['color'][] = $stylecolor;\n                    }\n                } else {\n                    $headrows[$h]['color'][] = findSpanColor(innerHTML($ths-&gt;item($x)));\n                }\n                if ($ths-&gt;item($x)-&gt;hasAttribute('colspan')) {\n                    $headrows[$h]['colspan'][] = $ths-&gt;item($x)-&gt;getAttribute('colspan');\n                } else {\n                    $headrows[$h]['colspan'][] = 1;\n                }\n                if ($ths-&gt;item($x)-&gt;hasAttribute('align')) {\n                    $headrows[$h]['align'][] = $ths-&gt;item($x)-&gt;getAttribute('align');\n                } else {\n                    $headrows[$h]['align'][] = 'left';\n                }\n                if ($ths-&gt;item($x)-&gt;hasAttribute('valign')) {\n                    $headrows[$h]['valign'][] = $ths-&gt;item($x)-&gt;getAttribute('valign');\n                } else {\n                    $headrows[$h]['valign'][] = 'top';\n                }\n                if ($ths-&gt;item($x)-&gt;hasAttribute('bgcolor')) {\n                    $headrows[$h]['bgcolor'][] = str_replace(&quot;#&quot;, &quot;&quot;, $ths-&gt;item($x)-&gt;getAttribute('bgcolor'));\n                } else {\n                    $headrows[$h]['bgcolor'][] = 'FFFFFF';\n                }\n            }\n            $h++;\n        }\n    }\n}\nforeach ($rows as $row) {\n    $tds = $row-&gt;getElementsByTagName('td');\n    if (is_object($tds)) {\n        if ($tds-&gt;length &gt; 0) {\n            $bodyrows[$r]['colcnt'] = $tds-&gt;length;\n            if ($tds-&gt;length &gt; $maxcols) {\n                $maxcols = $tds-&gt;length;\n            }\n            $nodes = $tds-&gt;length - 1;\n            for ($x = 0; $x &lt;= $nodes; $x++) {\n                $thistxt = $tds-&gt;item($x)-&gt;nodeValue;  //value data\n                $bodyrows[$r]['td'][] = $thistxt;\n                $bodyrows[$r]['bold'][] = findBoldText(innerHTML($tds-&gt;item($x)));\n                if ($tds-&gt;item($x)-&gt;hasAttribute('style')) {\n                    $style = $tds-&gt;item($x)-&gt;getAttribute('style');\n                    $stylecolor = findStyleColor($style);\n                    if ($stylecolor == '') {\n                        $bodyrows[$r]['color'][] = findSpanColor(innerHTML($tds-&gt;item($x)));\n                    } else {\n                        $bodyrows[$r]['color'][] = $stylecolor;\n                    }\n                } else {\n                    $bodyrows[$r]['color'][] = findSpanColor(innerHTML($tds-&gt;item($x)));\n                }\n                if ($tds-&gt;item($x)-&gt;hasAttribute('colspan')) {\n                    $bodyrows[$r]['colspan'][] = $tds-&gt;i</code></pre>\n\n",
    "PostedDate": "2014-09-02T07:46:21.183-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1298183",
    "ThreadId": "564967",
    "Html": "Please someone reply on this !!!!<br />\n",
    "PostedDate": "2014-09-02T08:16:15.913-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]