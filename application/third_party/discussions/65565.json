[
  {
    "Id": "223287",
    "ThreadId": "65565",
    "Html": "<p>I'd like to create a zip file containing a database dump with several files that link to each other.</p>\r\n<p>For that, I tried to insert a link within an xsl file using setUrl command.</p>\r\n<p>&nbsp;</p>\r\n<pre>$objPHPExcel-&gt;getActiveSheet()-&gt;getCell(&quot;A1&quot;)-&gt;getHyperlink()-&gt;setUrl(&quot;product_documents/xxx.pdf&quot;);</pre>\r\n<p>&nbsp;</p>\r\n<p>This creates a link that doesn't work, but if I edit it in Excel, don't change anything and click ok the link has changed somehow and works.</p>\r\n<p>Link before as hover displays:</p>\r\n<p style=\"padding-left:30px\">Mac: file://product_documents/xxx.pdf</p>\r\n<p style=\"padding-left:30px\">Win: product_documents/xxx.pdf</p>\r\n<p>Link after as hover displays:</p>\r\n<p style=\"padding-left:30px\">Mac: file://localhost/.../product_documents/xxx.pdf</p>\r\n<p style=\"padding-left:30px\">Win: file:///C:\\Users\\...\\product_documents/xxx.pdf</p>\r\n<p>I also tried to add &quot;file://&quot; to the URL but this I have to remove in Excel to make it working.</p>\r\n<p>&nbsp;</p>\r\n<p>Please help.</p>",
    "PostedDate": "2009-08-14T01:53:37.653-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "223472",
    "ThreadId": "65565",
    "Html": "<p>I will try to investigate this, it will be helpful if you can send me the two versions of the file. 1. before save, 2. after save.</p>\r\n<p>Send to: erik at phpexcel dot net</p>",
    "PostedDate": "2009-08-14T06:06:19.163-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "223947",
    "ThreadId": "65565",
    "Html": "<p>[file received]</p>\r\n<p>I was able to verify the problem. These things should hopefully be fixed now:</p>\r\n<p><a href=\"http://phpexcel.codeplex.com/WorkItem/View.aspx?WorkItemId=10459\">http://phpexcel.codeplex.com/WorkItem/View.aspx?WorkItemId=10459</a></p>\r\n<p>Download source code release tomorrow:</p>\r\n<p><a href=\"http://phpexcel.codeplex.com/SourceControl/ListDownloadableCommits.aspx\">http://phpexcel.codeplex.com/SourceControl/ListDownloadableCommits.aspx</a></p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2009-08-15T19:18:10.203-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "224168",
    "ThreadId": "65565",
    "Html": "<p>Thanks for your quick help.</p>\r\n<p>I've downloaded the nightly half an hour ago and tested it but I can't see any changes...<br>The h<span>yperlink to local file still doesn't work in my version.</span></p>\r\n<p><span>In which file are you working?<br></span></p>",
    "PostedDate": "2009-08-17T00:37:34.843-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "224380",
    "ThreadId": "65565",
    "Html": "<p>Can you try to run this test and see if you get the same as me:</p>\r\n<p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre>$excel = <span style=\"color:Blue\">new</span> PHPExcel();\r\n\r\n$sheet = $excel-&gt;getActiveSheet();\r\n$sheet-&gt;getCell(<span style=\"color:#A31515\">'A1'</span>)-&gt;setValue(<span style=\"color:#A31515\">'Test link'</span>);\r\n$sheet-&gt;getCell(<span style=\"color:#A31515\">'A1'</span>)-&gt;getHyperlink(<span style=\"color:#A31515\">'Test link'</span>)-&gt;setUrl(<span style=\"color:#A31515\">'product_documents/xxx.pdf'</span>);\r\n\r\n$writer = PHPExcel_IOFactory::createWriter($excel, <span style=\"color:#A31515\">'Excel5'</span>);\r\n$writer-&gt;save(<span style=\"color:#A31515\">'write.xls'</span>);\r\n</pre>\r\n</div>\r\n</p>\r\n<p>When I inspect the hyperlink properties, the hyperlink looks ok after the fix: product_documents\\xxx.pdf.</p>\r\n<p><a href=\"http://img299.imageshack.us/img299/655/ss20090817134718.png\">http://img299.imageshack.us/img299/655/ss20090817134718.png</a></p>\r\n<p><a href=\"http://img299.imageshack.us/img299/5691/ss20090817134731.png\">http://img299.imageshack.us/img299/5691/ss20090817134731.png</a></p>\r\n<p><em><span>&gt;&gt; In which file are you working?</span></em></p>\r\n<p><span>I made minor change in </span>Classes\\PHPExcel\\Writer\\Excel5\\Worksheet.php.</p>",
    "PostedDate": "2009-08-17T04:52:31.79-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "224437",
    "ThreadId": "65565",
    "Html": "<p>Thanks for your test code.</p>\r\n<p>The code generates this: <a href=\"http://img17.imageshack.us/img17/2456/bild1num.png\">http://img17.imageshack.us/img17/2456/bild1num.png</a></p>\r\n<p>As you wrote, hover looks like this: <a href=\"http://img8.imageshack.us/img8/7089/bild2kds.png\">http://img8.imageshack.us/img8/7089/bild2kds.png</a></p>\r\n<p>What I expected it to look like is this: <a href=\"http://img195.imageshack.us/img195/2108/bild3bjn.png\">http://img195.imageshack.us/img195/2108/bild3bjn.png</a></p>\r\n<p>I tried to add your &quot;external:&quot; to my url by hand but the colon is replaced by a slash.</p>\r\n<p>Also the file protocol doesn't work because relative urls are illegal.</p>\r\n<p>At the bottom of this posting you can find a function for writing external urls. I think you'll understand what they are talking about and where similar code in PHPExcel can be found (I don't because I've never written excel code by hand).</p>\r\n<p>PHPExcel looks like two other exporters:</p>\r\n<p><strong>PHPExcel</strong></p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre><span style=\"color:Blue\">if</span> ($cell-&gt;hasHyperlink()) {\r\n\t$url = $cell-&gt;getHyperlink()-&gt;getUrl();\r\n\r\n\t<span style=\"color:Blue\">if</span> ( strpos($url, <span style=\"color:#A31515\">'sheet://'</span>) !== false ) {\r\n\t\t<span style=\"color:Green\">// internal to current workbook</span>\r\n\t\t$url = str_replace(<span style=\"color:#A31515\">'sheet://'</span>, <span style=\"color:#A31515\">'internal:'</span>, $url);\r\n\r\n\t} <span style=\"color:Blue\">else</span> <span style=\"color:Blue\">if</span> ( preg_match(<span style=\"color:#A31515\">'/^(http:|https:|ftp:|mailto:)/'</span>, $url) ) {\r\n\t\t<span style=\"color:Green\">// URL</span>\r\n\t\t<span style=\"color:Green\">// $url = $url;</span>\r\n\r\n\t} <span style=\"color:Blue\">else</span> {\r\n\t\t<span style=\"color:Green\">// external (local file)</span>\r\n\t\t$url = <span style=\"color:#A31515\">'external:'</span> . $url;\r\n\t}\r\n\t\r\n\t$this-&gt;_writeUrl($row, $column, $url);\r\n}\r\n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p><strong>phpsurveyor</strong></p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre><span style=\"color:Green\">// Match http or ftp URL</span>\r\n<span style=\"color:Blue\">elseif</span> (preg_match(<span style=\"color:#A31515\">&quot;/^[fh]tt?p:\\/\\//&quot;</span>,$token)) {\r\n\t<span style=\"color:Blue\">return</span> $this-&gt;writeUrl($row, $col, $token, $format);\r\n}\r\n<span style=\"color:Green\">// Match mailto:</span>\r\n<span style=\"color:Blue\">elseif</span> (preg_match(<span style=\"color:#A31515\">&quot;/^mailto:/&quot;</span>,$token)) {\r\n\t<span style=\"color:Blue\">return</span> $this-&gt;writeUrl($row, $col, $token, $format);\r\n}\r\n<span style=\"color:Green\">// Match internal or external sheet link</span>\r\n<span style=\"color:Blue\">elseif</span> (preg_match(<span style=\"color:#A31515\">&quot;/^(?:in|ex)ternal:/&quot;</span>,$token)) {\r\n\t<span style=\"color:Blue\">return</span> $this-&gt;writeUrl($row, $col, $token, $format);\r\n}<br>&nbsp;</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p><strong>kimport</strong></p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre><span style=\"color:Blue\">function</span> _writeUrlRange($row1, $col1, $row2, $col2, $url)\r\n{\r\n\t<span style=\"color:Green\">// Check for internal/external sheet links or default to web link</span>\r\n\t<span style=\"color:Blue\">if</span> (preg_match(<span style=\"color:#A31515\">'[^internal:]'</span>, $url)) {\r\n\t\t\t<span style=\"color:Blue\">return</span>($this-&gt;_writeUrlInternal($row1, $col1, $row2, $col2, $url));\r\n\t}\r\n\t<span style=\"color:Blue\">if</span> (preg_match(<span style=\"color:#A31515\">'[^external:]'</span>, $url)) {\r\n\t\t\t<span style=\"color:Blue\">return</span>($this-&gt;_writeUrlExternal($row1, $col1, $row2, $col2, $url));\r\n\t}\r\n\t<span style=\"color:Blue\">return</span>($this-&gt;_writeUrlWeb($row1, $col1, $row2, $col2, $url));\r\n}\r\n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p><strong>vbcll2</strong></p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre><span style=\"color:Green\">###############################################################################</span>\r\n<span style=\"color:Green\">#</span>\r\n<span style=\"color:Green\"># _write_url_external($row1, $col1, $row2, $col2, $url, $string, $format)</span>\r\n<span style=\"color:Green\">#</span>\r\n<span style=\"color:Green\"># Write links to external directory names such as 'c:\\foo.xls',</span>\r\n<span style=\"color:Green\"># c:\\foo.xls#Sheet1!A1', '../../foo.xls'. and '../../foo.xls#Sheet1!A1'.</span>\r\n<span style=\"color:Green\">#</span>\r\n<span style=\"color:Green\"># Note: Excel writes some relative links with the $dir_long string. We ignore</span>\r\n<span style=\"color:Green\"># these cases for the sake of simpler code.</span>\r\n<span style=\"color:Green\">#</span>\r\n<span style=\"color:Green\"># See also write_url() above for a general description and return values.</span>\r\n<span style=\"color:Green\">#</span>\r\n<span style=\"color:Blue\">function</span> _write_url_external() {\r\n\r\n    $_=func_get_args();\r\n\r\n    <span style=\"color:Green\"># Network drives are different. We will handle them separately</span>\r\n    <span style=\"color:Green\"># MS/Novell network drives and shares start with \\\\</span>\r\n    <span style=\"color:Blue\">if</span> (preg_match(<span style=\"color:#A31515\">'[^external:\\\\\\\\]'</span>, $_[4])) {\r\n        <span style=\"color:Blue\">return</span> call_user_func_array(<span style=\"color:Blue\">array</span>(&amp;$this, <span style=\"color:#A31515\">'_write_url_external_net'</span>), $_);\r\n    }\r\n\r\n    $record      = 0x01B8;                       <span style=\"color:Green\"># Record identifier</span>\r\n    $length      = 0x00000;                      <span style=\"color:Green\"># Bytes to follow</span>\r\n\r\n    $row1        = $_[0];                        <span style=\"color:Green\"># Start row</span>\r\n    $col1        = $_[1];                        <span style=\"color:Green\"># Start column</span>\r\n    $row2        = $_[2];                        <span style=\"color:Green\"># End row</span>\r\n    $col2        = $_[3];                        <span style=\"color:Green\"># End column</span>\r\n    $url         = $_[4];                        <span style=\"color:Green\"># URL string</span>\r\n    <span style=\"color:Blue\">if</span> (<span style=\"color:Blue\">isset</span>($_[5])) {\r\n        $str         = $_[5];                        <span style=\"color:Green\"># Alternative label</span>\r\n    }\r\n    $xf          = $_[6] ? $_[6] : $this-&gt;_url_format;  <span style=\"color:Green\"># The cell format</span>\r\n\r\n    <span style=\"color:Green\"># Strip URL type and change Unix dir separator to Dos style (if needed)</span>\r\n    <span style=\"color:Green\">#</span>\r\n    $url            = preg_replace(<span style=\"color:#A31515\">'[^external:]'</span>, <span style=\"color:#A31515\">''</span>, $url);\r\n    $url            = preg_replace(<span style=\"color:#A31515\">'[/]'</span>, &quot;\\\\&quot;, $url);\r\n\r\n    <span style=\"color:Green\"># Write the visible label</span>\r\n    <span style=\"color:Blue\">if</span> (!<span style=\"color:Blue\">isset</span>($str)) {\r\n        $str = preg_replace(<span style=\"color:#A31515\">'[\\#]'</span>, <span style=\"color:#A31515\">' - '</span>, $url);\r\n    }\r\n    $str_error   = $this-&gt;write_string($row1, $col1, $str, $xf);\r\n    <span style=\"color:Blue\">if</span> ($str_error == -2) {\r\n        <span style=\"color:Blue\">return</span> $str_error;\r\n    }\r\n\r\n    <span style=\"color:Green\"># Determine if the link is relative or absolute:</span>\r\n    <span style=\"color:Green\">#   relative if link contains no dir separator, &quot;somefile.xls&quot;</span>\r\n    <span style=\"color:Green\">#   relative if link starts with up-dir, &quot;..\\..\\somefile.xls&quot;</span>\r\n    <span style=\"color:Green\">#   otherwise, absolute</span>\r\n    <span style=\"color:Green\">#</span>\r\n    $absolute    = 0x02; <span style=\"color:Green\"># Bit mask</span>\r\n\r\n    <span style=\"color:Blue\">if</span> (!preg_match(<span style=\"color:#A31515\">'[\\\\]'</span>, $url)) {\r\n        $absolute    = 0x00;\r\n    }\r\n\r\n    <span style=\"color:Blue\">if</span> (preg_match(<span style=\"color:#A31515\">'[^\\.\\.\\\\]'</span>, $url)) {\r\n        $absolute    = 0x00;\r\n    }\r\n\r\n    <span style=\"color:Green\"># Determine if the link contains a sheet reference and change some of the</span>\r\n    <span style=\"color:Green\"># parameters accordingly.</span>\r\n    <span style=\"color:Green\"># Split the dir name and sheet name (if it exists)</span>\r\n    <span style=\"color:Green\">#</span>\r\n    <span style=\"color:Blue\">list</span>($dir_long, $sheet) = preg_split(<span style=\"color:#A31515\">'/\\#/'</span>, $url);\r\n    $link_type           = 0x01 | $absolute;\r\n\r\n<span style=\"color:Green\">//!!!</span>\r\n    <span style=\"color:Blue\">if</span> (<span style=\"color:Blue\">isset</span>($sheet)) {\r\n        $link_type |= 0x08;\r\n        $sheet_len  = pack(<span style=\"color:#A31515\">&quot;V&quot;</span>, length($sheet) + 0x01);\r\n        $sheet      = join(<span style=\"color:#A31515\">&quot;\\0&quot;</span>, split(<span style=\"color:#A31515\">''</span>, $sheet));\r\n        $sheet     .= <span style=\"color:#A31515\">&quot;\\0\\0\\0&quot;</span>;\r\n    } <span style=\"color:Blue\">else</span> {\r\n        $sheet_len   = <span style=\"color:#A31515\">''</span>;\r\n        $sheet       = <span style=\"color:#A31515\">''</span>;\r\n    }\r\n\r\n    <span style=\"color:Green\"># Pack the link type</span>\r\n    $link_type      = pack(<span style=\"color:#A31515\">&quot;V&quot;</span>, $link_type);\r\n\r\n\r\n    <span style=\"color:Green\"># Calculate the up-level dir count e.g.. (..\\..\\..\\ == 3)</span>\r\n<span style=\"color:Green\">/* TODO\r\n    $up_count    = 0;\r\n    $up_count++       while $dir_long =~ s[^\\.\\.\\\\][];\r\n    $up_count       = pack(&quot;v&quot;, $up_count);\r\n*/</span>\r\n\r\n    <span style=\"color:Green\"># Store the short dos dir name (null terminated)</span>\r\n    $dir_short   = $dir_long . <span style=\"color:#A31515\">&quot;\\0&quot;</span>;\r\n\r\n    <span style=\"color:Green\"># Store the long dir name as a wchar string (non-null terminated)</span>\r\n    $dir_long       = join(<span style=\"color:#A31515\">&quot;\\0&quot;</span>, preg_split(<span style=\"color:#A31515\">''</span>, $dir_long, -1, PREG_SPLIT_NO_EMPTY));\r\n    $dir_long       = $dir_long . <span style=\"color:#A31515\">&quot;\\0&quot;</span>;\r\n\r\n    <span style=\"color:Green\"># Pack the lengths of the dir strings</span>\r\n    $dir_short_len = pack(<span style=\"color:#A31515\">&quot;V&quot;</span>, strlen($dir_short)      );\r\n    $dir_long_len  = pack(<span style=\"color:#A31515\">&quot;V&quot;</span>, strlen($dir_long)       );\r\n    $stream_len    = pack(<span style=\"color:#A31515\">&quot;V&quot;</span>, strlen($dir_long) + 0x06);\r\n\r\n    <span style=\"color:Green\"># Pack the undocumented parts of the hyperlink stream</span>\r\n    $unknown1 =pack(<span style=\"color:#A31515\">&quot;H*&quot;</span>,<span style=\"color:#A31515\">'D0C9EA79F9BACE118C8200AA004BA90B02000000'</span>       );\r\n    $unknown2 =pack(<span style=\"color:#A31515\">&quot;H*&quot;</span>,<span style=\"color:#A31515\">'0303000000000000C000000000000046'</span>               );\r\n    $unknown3 =pack(<span style=\"color:#A31515\">&quot;H*&quot;</span>,<span style=\"color:#A31515\">'FFFFADDE000000000000000000000000000000000000000'</span>);\r\n    $unknown4 =pack(<span style=\"color:#A31515\">&quot;v&quot;</span>,  0x03                                            );\r\n\r\n    <span style=\"color:Green\"># Pack the main data stream</span>\r\n    $data        = pack(<span style=\"color:#A31515\">&quot;vvvv&quot;</span>, $row1, $row2, $col1, $col2) .\r\n                      $unknown1     .\r\n                      $link_type    .\r\n                      $unknown2     .\r\n                      $up_count     .\r\n                      $dir_short_len.\r\n                      $dir_short    .\r\n                      $unknown3     .\r\n                      $stream_len   .\r\n                      $dir_long_len .\r\n                      $unknown4     .\r\n                      $dir_long     .\r\n                      $sheet_len    .\r\n                      $sheet        ;\r\n\r\n    <span style=\"color:Green\"># Pack the header data</span>\r\n    $length         = strlen($data);\r\n    $header      = pack(<span style=\"color:#A31515\">&quot;vv&quot;</span>,   $record, $length);\r\n\r\n    <span style=\"color:Green\"># Write the packed data</span>\r\n    $this-&gt;_append($header . $data);\r\n\r\n    <span style=\"color:Blue\">return</span> $str_error;\r\n}\r\n\r\n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>",
    "PostedDate": "2009-08-17T06:16:25.207-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "224544",
    "ThreadId": "65565",
    "Html": "<p>I checked the tools you are mentioning. They seem to be based on PEAR::Spreadsheet_Excel_Writer (just like PHPExcel_Writer_Excel5) so they probably share many of the same bugs.<br><br>I now see what you mean with the hover tooltip. Will re-open work item 10459 and see if we can get it fixed.<br><a href=\"http://phpexcel.codeplex.com/WorkItem/View.aspx?WorkItemId=10459\">http://phpexcel.codeplex.com/WorkItem/View.aspx?WorkItemId=10459</a></p>",
    "PostedDate": "2009-08-17T10:29:17.53-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "224550",
    "ThreadId": "65565",
    "Html": "<p>There was a problem with some option flag which seemed to be important for the hover text.</p>\r\n<p><a href=\"http://phpexcel.codeplex.com/WorkItem/View.aspx?WorkItemId=10459\">http://phpexcel.codeplex.com/WorkItem/View.aspx?WorkItemId=10459</a></p>\r\n<p>Can you try with next source code release tomorrow:</p>\r\n<p><a href=\"http://phpexcel.codeplex.com/SourceControl/ListDownloadableCommits.aspx\">http://phpexcel.codeplex.com/SourceControl/ListDownloadableCommits.aspx</a></p>",
    "PostedDate": "2009-08-17T10:43:27.697-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "225311",
    "ThreadId": "65565",
    "Html": "<p>Thank you very much!</p>\r\n<p>The link is working now as well as the hover is correct.</p>\r\n<p>Thanks</p>\r\n<p>Fritz</p>",
    "PostedDate": "2009-08-19T00:47:28.68-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]