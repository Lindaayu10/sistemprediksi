[
  {
    "Id": "1128039",
    "ThreadId": "470874",
    "Html": "I generate the array for phpexcel store it into a $_session varialbe and then have a link to the php page to create a excel data and graph to the screen.  It works on a small sampling of data but when I run it with &quot;true&quot; data it will not work, it just displays the error:\r<br />\n<br />\nExcel cannot open the file 'xxxxx.xlsx' because the file format or file extension is not valid. Verify that the file has not been corupted and that the file extension matches the format of the file.\r<br />\n<br />\nI can comment this statement and it will put the data into the file and display the spreadsheet without the chart:\r<br />\n$objWorksheet-&gt;addChart($chart);\r<br />\n<br />\nWhat am I doing wrong??\r<br />\n<br />\nfull php page code below:\r<br />\n<br />\n&lt;?php\r<br />\n// $valary=array(<br />\n<pre><code>    // array('tagname',  'Value'),\n    // array('11/19/13 14:42',   89300.0475),\n    // array('11/19/13 15:12',  89444.13835),\n    // array('11/19/13 15:42',   89332.66993),\n    // array('11/19/13 16:12',   89308.91376),\n    // array('11/19/13 16:42',  89810.509871),\n    // array('11/19/13 17:12',   90237.95934),\n    // array('11/19/13 17:42',   90235.1259),\n    // array('11/19/13 18:12',   90712.74051),\n// );</code></pre>\n\n// $ret=xlscatchart($tagnam,$valary);\r<br />\n// if(isset($_POST['tagnam']) ){\r<br />\n  // $tagnam = $_POST['tagnam'];\r<br />\n // } else {\r<br />\n  // $tagnam = &quot;nothing entered&quot;;\r<br />\n // }\r<br />\n// if(isset($_POST['valary']) ){\r<br />\n  // $valary = $_POST['valary'];\r<br />\n // } else {\r<br />\n  // $valary = &quot;nothing entered&quot;;\r<br />\n // }\r<br />\n // $str_var = $_POST[&quot;str_var&quot;]; \r<br />\n // $valary = unserialize(base64_decode($str_var)); \r<br />\n // $valary=$_SESSION['valary'];\r<br />\n// $tagnam=$_SESSION['tagnam'];\r<br />\nsession_start();\r<br />\n$valpass=($_SESSION['valpass']);\r<br />\n$tagpass=($_SESSION['tagpass']);\r<br />\n$numvals=($_SESSION['numvals']);\r<br />\n$valpass[0][0]=$tagpass;\r<br />\n// echo $valpass[0][0];\r<br />\n// echo &quot;&lt;br&gt;tagname=&quot;.$tagpass;\r<br />\n// echo &quot;&lt;br&gt;num vals=&quot;.$numvals;\r<br />\n$ret=xlscatchart($tagpass,$valpass);\r<br />\nfunction xlscatchart($tagpass,$valpass){\r<br />\n/*<em> Error reporting </em>/\r<br />\nerror_reporting(E_ALL);\r<br />\nini_set('display_errors', TRUE);\r<br />\nini_set('display_startup_errors', TRUE);\r<br />\n// date_default_timezone_set('Europe/London');\r<br />\ndefine('EOL',(PHP_SAPI == 'cli') ? PHP_EOL : '&lt;br /&gt;');\r<br />\n// date_default_timezone_set('Europe/London');\r<br />\n/**<br />\n<ul>\n<li>PHPExcel\r<br />\n *</li>\n<li>Copyright (C) 2006 - 2013 PHPExcel\r<br />\n *</li>\n<li>This library is free software; you can redistribute it and/or</li>\n<li>modify it under the terms of the GNU Lesser General Public</li>\n<li>License as published by the Free Software Foundation; either</li>\n<li>version 2.1 of the License, or (at your option) any later version.\r<br />\n *</li>\n<li>This library is distributed in the hope that it will be useful,</li>\n<li>but WITHOUT ANY WARRANTY; without even the implied warranty of</li>\n<li>MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</li>\n<li>Lesser General Public License for more details.\r<br />\n *</li>\n<li>You should have received a copy of the GNU Lesser General Public</li>\n<li>License along with this library; if not, write to the Free Software</li>\n<li>Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r<br />\n *</li>\n<li>@category   PHPExcel</li>\n<li>@package    PHPExcel</li>\n<li>@copyright  Copyright (c) 2006 - 2013 PHPExcel (<a href=\"http://www.codeplex.com/PHPExcel\" rel=\"nofollow\">http://www.codeplex.com/PHPExcel</a>)</li>\n<li>@license    <a href=\"http://www.gnu.org/licenses/old-licenses/lgpl-2.1.txt\" rel=\"nofollow\">http://www.gnu.org/licenses/old-licenses/lgpl-2.1.txt</a>    LGPL</li>\n<li>\n@version    1.7.9, 2013-06-02\r<br />\n <em>//</em>* PHPExcel */\r<br />\nrequire_once '../Dashboard/Classes/Classes/PHPExcel.php';\r<br />\n$objPHPExcel = new PHPExcel();\r<br />\n$objWorksheet = $objPHPExcel-&gt;getActiveSheet();\r<br />\n$objWorksheet-&gt;fromArray($valpass<br />\n// array(<br />\n<pre><code>// array('',   2010,   2011,   2012),\n// array(50,   12,   15,       21),\n// array(100,   56,   73,      86),\n// array(150,   52,   61,      69),\n// array(200,   30,   32,      50),\n// array(250,   12,   15,      21),\n// array(300,   56,   73,      86),\n// array(350,   52,   61,      69),\n// array(400,   30,   32,      50),</code></pre>\n\n// )<br />\n// );<br />\n// array(<br />\n<pre><code>// array('tagname',  'value'),\n// array('11/19/13 14:42',   89300.0475),\n// array('11/19/13 15:12',  89444.13835),\n// array('11/19/13 15:42',   89332.66993),\n// array('11/19/13 16:12',   89308.91376),\n// array('11/19/13 16:42',  89810.509871),\n// array('11/19/13 17:12',   90237.95934),\n// array('11/19/13 17:42',   90235.1259),\n// array('11/19/13 18:12',   90712.74051),</code></pre>\n\n// )<br />\n);\r<br />\n//  Set the Labels for each data series we want to plot\r<br />\n//      Datatype\r<br />\n//      Cell reference for data\r<br />\n//      Format Code\r<br />\n//      Number of datapoints in series\r<br />\n//      Data values\r<br />\n//      Data Marker<br />\n</li>\n</ul>\n$dataseriesLabels = array(<br />\n<pre><code>new PHPExcel_Chart_DataSeriesValues('String', 'Worksheet!$A$1', NULL, 1),   //  2010\n// new PHPExcel_Chart_DataSeriesValues('String', 'Worksheet!$C$1', NULL, 1),   //  2011\n// new PHPExcel_Chart_DataSeriesValues('String', 'Worksheet!$D$1', NULL, 1),   //  2012</code></pre>\n\n);\r<br />\n//  Set the X-Axis Labels\r<br />\n// $wksarea=&quot;Worksheet!$A$2:$A$&quot;.$numvals;\r<br />\n// echo &quot;worksheetarea=&quot;.$wksarea;\r<br />\n$xAxisTickValues = array(<br />\n<pre><code>new PHPExcel_Chart_DataSeriesValues('String', '$Worksheet!$A$2:$A$98', NULL, 8),  //  Q1 to Q4\n// new PHPExcel_Chart_DataSeriesValues('String', 'Worksheet!$A$2:$A$9', NULL, 8),  //  Q1 to Q4\n// new PHPExcel_Chart_DataSeriesValues('String', 'Worksheet!$A$2:$A$9', NULL, 8),  //  Q1 to Q4</code></pre>\n\n);\r<br />\n//  Set the Data values for each data series we want to plot\r<br />\n//      Datatype\r<br />\n//      Cell reference for data\r<br />\n//      Format Code\r<br />\n//      Number of datapoints in series\r<br />\n//      Data values\r<br />\n//      Data Marker\r<br />\n// echo &quot;&lt;br&gt;&quot;;\r<br />\n// print_r($xAxisTickValues );\r<br />\n// $wksarea=&quot;Worksheet!$B$2:$B$&quot;.$numvals;\r<br />\n$dataSeriesValues = array(<br />\n<pre><code>new PHPExcel_Chart_DataSeriesValues('Number', 'Worksheet!$B$2:$B$98', NULL, 8),\n// new PHPExcel_Chart_DataSeriesValues('Number', 'Worksheet!$C$2:$C$9', NULL, 8),\n// new PHPExcel_Chart_DataSeriesValues('Number', 'Worksheet!$D$2:$D$9', NULL, 8),</code></pre>\n\n);\r<br />\n//  Build the dataseries\r<br />\n$series = new PHPExcel_Chart_DataSeries(<br />\n<pre><code>PHPExcel_Chart_DataSeries::TYPE_SCATTERCHART,   // plotType\nNULL,                                           // plotGrouping (Scatter charts don't have any grouping)\nrange(0, count($dataSeriesValues)-1),           // plotOrder\n$dataseriesLabels,                              // plotLabel\n$xAxisTickValues,                               // plotCategory\n$dataSeriesValues,                              // plotValues\nNULL,                                           // smooth line\nPHPExcel_Chart_DataSeries::STYLE_LINEMARKER     // plotStyle</code></pre>\n\n);\r<br />\n//  Set the series in the plot area\r<br />\n$plotarea = new PHPExcel_Chart_PlotArea(NULL, array($series));\r<br />\n//  Set the chart legend\r<br />\n$legend = new PHPExcel_Chart_Legend(PHPExcel_Chart_Legend::POSITION_TOPRIGHT, NULL, false);\r<br />\n$title = new PHPExcel_Chart_Title('Chart');\r<br />\n$yAxisLabel = new PHPExcel_Chart_Title('Value');\r<br />\n//  Create the chart\r<br />\n$chart = new PHPExcel_Chart(<br />\n<pre><code>'chart1',       // name\n$title,         // title\n$legend,        // legend\n$plotarea,      // plotArea\ntrue,           // plotVisibleOnly\n0,              // displayBlanksAs\nNULL,           // xAxisLabel\n$yAxisLabel     // yAxisLabel</code></pre>\n\n);\r<br />\n//  Set the position where the chart should appear in the worksheet\r<br />\n$chart-&gt;setTopLeftPosition('F7');\r<br />\n$chart-&gt;setBottomRightPosition('ZZ98');\r<br />\n//  Add the chart to the worksheet\r<br />\n$objWorksheet-&gt;addChart($chart);        //       take this out and you will get a spreadsheet with data but no chart\r<br />\n$filename = &quot;tagvalues.xlsx&quot;;\r<br />\nheader('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\r<br />\nheader('Content-Disposition: attachment;filename=&quot;'.$filename.'&quot;');\r<br />\nheader('Cache-Control: max-age=0');\r<br />\n$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');\r<br />\n$objWriter-&gt;setIncludeCharts(TRUE);\r<br />\n$objWriter-&gt;save('php://output');\r<br />\n}\r<br />\nexit;<br />\n",
    "PostedDate": "2013-11-22T11:56:13.807-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1128548",
    "ThreadId": "470874",
    "Html": "<blockquote>\nExcel cannot open the file 'xxxxx.xlsx' because the file format or file extension is not valid[...]<br />\n</blockquote>\nWhen you see this type of message, open the file with Notepad: it is likely that an error message appears... Message that will allow you to pinpoint the problem.<br />\n",
    "PostedDate": "2013-11-24T23:47:54.367-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1128699",
    "ThreadId": "470874",
    "Html": "output is going to the screen not to a file (php://output), rights to save things to the server is restricted here, so I cannot save the file to the server then pull up with notepad.<br />\n",
    "PostedDate": "2013-11-25T06:41:00.893-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1128726",
    "ThreadId": "470874",
    "Html": "Output is going to the browser and your browser offers you save it or open it, no? Choose to save it on your machine and then open it with the Notepad.<br />\n",
    "PostedDate": "2013-11-25T07:50:44.483-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1129167",
    "ThreadId": "470874",
    "Html": "no it trys to open excel and I get the message, nothing comes back to the browser.  I know if I comment this statement:\r<br />\n$objWorksheet-&gt;addChart($chart); \r<br />\n I will get the data in excel in column a and b.  If I put the statement in I get the error message:\r<br />\nExcel cannot open the file 'xxxxx.xlsx' because the file format or file extension is not valid. Verify that the file has not been corupted and that the file extension matches the format of the file. \r<br />\n<br />\nIt seems to be something with the charting parms.  I can put in :\r<br />\n// array(\r<br />\n<br />\n// array('tagname',  'value'),\r<br />\n// array('11/19/13 14:42',   89300.0475),\r<br />\n// array('11/19/13 15:12',  89444.13835),\r<br />\n// array('11/19/13 15:42',   89332.66993),\r<br />\n// array('11/19/13 16:12',   89308.91376),\r<br />\n// array('11/19/13 16:42',  89810.509871),\r<br />\n// array('11/19/13 17:12',   90237.95934),\r<br />\n// array('11/19/13 17:42',   90235.1259),\r<br />\n// array('11/19/13 18:12',   90712.74051),\r<br />\n// )\r<br />\n<br />\nas values and it gives the data in column a and b and does a scatter chart with no problem with the: $objWorksheet-&gt;addChart($chart); \r<br />\nincluded.  This was just the first few values of the real data it had 98 lines and when I use it I get the message:\r<br />\nExcel cannot open the file 'xxxxx.xlsx' because the file format or file extension is not valid. Verify that the file has not been corupted and that the file extension matches the format of the file. <br />\n",
    "PostedDate": "2013-11-26T05:42:14.64-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1129226",
    "ThreadId": "470874",
    "Html": "I got it not sure exactly what I did but it is working now.  Thank you!<br />\n",
    "PostedDate": "2013-11-26T08:45:00.79-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1129230",
    "ThreadId": "470874",
    "Html": "Remove the header lines in script. The browser display the file (you get some &quot;garbage&quot; of course).\r<br />\n<br />\nIt's not easy with all comment lines, but playing with your script, i got a valid xlsx with a graph... I think i have change somewhere &quot;$objWorksheet-&gt;fromArray($valpass&quot; in &quot;$objWorksheet-&gt;fromArray(&quot;, a few 98 to 9 and ZZ98 to T30 (i don't have a 100&quot; monitor).<br />\n",
    "PostedDate": "2013-11-26T08:58:12.56-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]