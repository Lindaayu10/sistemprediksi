[
  {
    "Id": "639858",
    "ThreadId": "264521",
    "Html": "<p>I'm having the hardest time getting number styles to apply through a shared style. &nbsp;Seems that no matter what I try, the number formatting simply doesn't come through.</p>\n<p>The sample code below demonstrates my futility. &nbsp;I try type casting to see if that's the culprit (it's not), I try different syntax variants in the shared styles (it's not)...</p>\n<p>I simply can't get this to work. &nbsp;The only way to do it seems to be applying the style directly to the sell which rather defeats the purpose of applying a shared style.</p>\n<p>Can anyone shed some light? &nbsp;Searches for bugs or threads on this topic have come up empty. &nbsp;Many thanks in advance.&nbsp;</p>\n<p>&nbsp;</p>\n<p>\n<div style=\"color: black; background-color: white;\">\n<pre>&lt;?php\n<span style=\"color: green;\">/** PHPExcel */</span>\n<span style=\"color: blue;\">require_once</span> <span style=\"color: #a31515;\">'../Classes/PHPExcel.php'</span>;\n\n\n<span style=\"color: green;\">// Create new PHPExcel object</span>\n$objPHPExcel = <span style=\"color: blue;\">new</span> PHPExcel();\n\n<span style=\"color: green;\">// Set properties</span>\n$objPHPExcel-&gt;getProperties()-&gt;setCreator(<span style=\"color: #a31515;\">\"Maarten Balliauw\"</span>)\n -&gt;setLastModifiedBy(<span style=\"color: #a31515;\">\"Maarten Balliauw\"</span>)\n -&gt;setTitle(<span style=\"color: #a31515;\">\"Office 2007 XLSX Test Document\"</span>)\n -&gt;setSubject(<span style=\"color: #a31515;\">\"Office 2007 XLSX Test Document\"</span>)\n -&gt;setDescription(<span style=\"color: #a31515;\">\"Test document for Office 2007 XLSX, generated using PHP classes.\"</span>)\n -&gt;setKeywords(<span style=\"color: #a31515;\">\"office 2007 openxml php\"</span>)\n -&gt;setCategory(<span style=\"color: #a31515;\">\"Test result file\"</span>);\n\n\n<span style=\"color: green;\">// Add some data</span>\n$objPHPExcel-&gt;setActiveSheetIndex(0);\n\n$sharedStyle1 = <span style=\"color: blue;\">new</span> PHPExcel_Style();\n$sharedStyle2 = <span style=\"color: blue;\">new</span> PHPExcel_Style();\n$sharedStyle3 = <span style=\"color: blue;\">new</span> PHPExcel_Style();\n$sharedStyle4 = <span style=\"color: blue;\">new</span> PHPExcel_Style();\n\n$sharedStyle1-&gt;applyFromArray(\n\t<span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'numberFormat'</span>   =&gt;   <span style=\"color: blue;\">array</span>(\n\t\t<span style=\"color: #a31515;\">'code'</span>    =&gt; <span style=\"color: #a31515;\">'#,##0.00;[Red](#,##0.00)'</span>\n\t)\n));\n\n$sharedStyle2-&gt;applyFromArray(\n\t<span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'numberFormat'</span>   =&gt;   <span style=\"color: blue;\">array</span>(\n\t\t<span style=\"color: #a31515;\">'formatCode'</span>    =&gt; <span style=\"color: #a31515;\">'#,##0.00;[Red](#,##0.00)'</span>\n\t)\n));\n\n$sharedStyle3-&gt;applyFromArray(\n\t<span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'numberFormat'</span>   =&gt;   <span style=\"color: blue;\">array</span>(\n\t\t<span style=\"color: #a31515;\">'format'</span>    =&gt; PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_USD\n\t)\n));\n\n$sharedStyle4-&gt;applyFromArray(\n\t<span style=\"color: blue;\">array</span>(<span style=\"color: #a31515;\">'numberFormat'</span>   =&gt;   <span style=\"color: blue;\">array</span>(\n\t\t<span style=\"color: #a31515;\">'format'</span>    =&gt; PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_USD\n\t)\n));\n\n<span style=\"color: green;\">// DOESN'T WORK</span>\n$objPHPExcel-&gt;getActiveSheet()-&gt;setSharedStyle($sharedStyle1, <span style=\"color: #a31515;\">\"A1:A4\"</span>);\n$objPHPExcel-&gt;getActiveSheet()-&gt;setSharedStyle($sharedStyle2, <span style=\"color: #a31515;\">\"B1:B4\"</span>);\n$objPHPExcel-&gt;getActiveSheet()-&gt;setSharedStyle($sharedStyle3, <span style=\"color: #a31515;\">\"C1:C4\"</span>);\n$objPHPExcel-&gt;getActiveSheet()-&gt;setSharedStyle($sharedStyle4, <span style=\"color: #a31515;\">\"D1:D4\"</span>);\n\n<span style=\"color: green;\">// Attempts at type casting to see if it's the culprit.  It's not.</span>\n$objPHPExcel-&gt;setActiveSheetIndex(0)\n\t-&gt;setCellValue(<span style=\"color: #a31515;\">'A1'</span>, (double) -1.23)\n\t-&gt;setCellValue(<span style=\"color: #a31515;\">'A2'</span>, (double) -1.23)\n\t-&gt;setCellValue(<span style=\"color: #a31515;\">'A3'</span>, (double) -1.23)\n\t-&gt;setCellValue(<span style=\"color: #a31515;\">'A4'</span>, (double) -1.23)\n\t-&gt;setCellValue(<span style=\"color: #a31515;\">'B1'</span>, (float) -2)\n\t-&gt;setCellValue(<span style=\"color: #a31515;\">'B2'</span>, (float) -2)\n\t-&gt;setCellValue(<span style=\"color: #a31515;\">'B3'</span>, (float) -2)\n\t-&gt;setCellValue(<span style=\"color: #a31515;\">'B4'</span>, (float) -2)\n\t-&gt;setCellValue(<span style=\"color: #a31515;\">'C1'</span>, (real) -5)\n\t-&gt;setCellValue(<span style=\"color: #a31515;\">'C2'</span>, (real) -5)\n\t-&gt;setCellValue(<span style=\"color: #a31515;\">'C3'</span>, (real) -5)\n\t-&gt;setCellValue(<span style=\"color: #a31515;\">'C4'</span>, (real) -5)\n\t-&gt;setCellValue(<span style=\"color: #a31515;\">'D1'</span>, <span style=\"color: #a31515;\">'-8.1'</span>)\n\t-&gt;setCellValue(<span style=\"color: #a31515;\">'D2'</span>, <span style=\"color: #a31515;\">'-8.1'</span>)\n\t-&gt;setCellValue(<span style=\"color: #a31515;\">'D3'</span>, <span style=\"color: #a31515;\">'-8.1'</span>)\n\t-&gt;setCellValue(<span style=\"color: #a31515;\">'D4'</span>, <span style=\"color: #a31515;\">'-8.1'</span>);\n\n<span style=\"color: green;\">// WORKS</span>\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color: #a31515;\">'F1'</span>, <span style=\"color: #a31515;\">'-34.7'</span>);\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color: #a31515;\">'F1'</span>)-&gt;getNumberFormat()-&gt;setFormatCode(<span style=\"color: #a31515;\">'#,##0.00;[Red](#,##0.00)'</span>);\n$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(<span style=\"color: #a31515;\">'F2'</span>, -34.7);\n$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(<span style=\"color: #a31515;\">'F2'</span>)-&gt;getNumberFormat()-&gt;setFormatCode(<span style=\"color: #a31515;\">'#,##0.00;[Red](#,##0.00)'</span>);\n\nheader(<span style=\"color: #a31515;\">'Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'</span>);\nheader(<span style=\"color: #a31515;\">'Content-Disposition: attachment;filename=\"numbersample.xlsx\"'</span>);\nheader(<span style=\"color: #a31515;\">'Cache-Control: max-age=0'</span>);\n\n$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, <span style=\"color: #a31515;\">'Excel2007'</span>);\n$objWriter-&gt;save(<span style=\"color: #a31515;\">'php://output'</span>);\n<span style=\"color: blue;\">exit</span>;\n?&gt;\n</pre>\n</div>\n</p>",
    "PostedDate": "2011-07-09T07:19:38.14-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]